<!DOCTYPE html>
<html>
<!--
Copyright 2010 by Dan Fabulich.

Dan Fabulich licenses this file to you under the
ChoiceScript License, Version 1.0 (the "License"); you may
not use this file except in compliance with the License. 
You may obtain a copy of the License at

 http://www.choiceofgames.com/LICENSE-1.0.txt

See the License for the specific language governing
permissions and limitations under the License.

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
either express or implied.
-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name = "viewport" content = "width = device-width, initial-scale = 1.0, maximum-scale = 1.0">
<title>Kingsrun â€” by Mert Akhan</title>

<script>window.version="1.0.0"</script>





<style id="dynamic"></style>





<!--[if IE 6]><style>.alertify-logs { position: absolute; }</style><![endif]-->
<meta name="apple-mobile-web-app-capable" content="yes" />
<script>
// INSERT store name; disabled by default because it's confusing for newbie authors
window.storeName = "CS-A5034680-4842-45ED-8902-989808D03D12";
//Scene.generatedFast = true;
var rootDir = "../";
</script><meta property="ifiction:ifid" content="A5034680-4842-45ED-8902-989808D03D12" prefix="ifiction: http://babel.ifarchive.org/protocol/iFiction/"><script>allScenes = {"startup": {"crc":-768886115, "lines":["*title Kingsrun","*author Mert Akhan","*ifid a5034680-4842-45ed-8902-989808d03d12","*scene_list","  startup","  ch1_selvaggio_arrival","  ch1_selvaggio_docks","  ch1_selvaggio_departure_row","  ch1_selvaggio_first_night","  ch1_selvaggio_crew_hunt","  ch1_selvaggio_the_bell","  ch2_galluuns_tooth_approach","  ch2_galluuns_tooth_port","  ch2_galluuns_tooth_reef","  ch3_merrenbach_arrival","  ch3_merrenbach_warren","  ch3_merrenbach_reef_walk","  ch4_brannach_landfall","  ch4_brannach_fissures","  ch4_brannach_forge","  ch5_kelvanni_clinic","  ch5_kelvanni_debts","  ch5_kelvanni_crisis","  ch6_velundri_market","  ch6_velundri_revelation","  ch6_velundri_cliffhanger","","*comment ===================================================","*comment  KINGSRUN \u2014 Game 1: The Departure","*comment  Kingsrun Stops 1-6 (Selvaggio through Velundri)","*comment ===================================================","","*comment ---------------------------------------------------","*comment  MC IDENTITY \u2014 Fixed + Player-Shaped","*comment ---------------------------------------------------","","*comment MC is half-Oni/half-Human. This is fixed.","*create mc_name \"Merdou Akkan\"","*create mc_first_name \"Merdou\"","*create mc_surname \"Akkan\"","","*comment Parent who raised the MC (oni_mother / human_father)","*create mc_parent \"oni_mother\"","","*comment Height options: human_passing / noticeable / imposing / towering","*create mc_height \"imposing\"","*create mc_height_feet \"6'7\\\"\"","","*comment Horn style: swept_back / single_central / ram_curved / broken","*create mc_horns \"ram_curved\"","","*comment Skin tone: bronze_red / blue_grey / muted_violet / ash_white","*create mc_skin \"ash_white\"","","*comment Build: lean / broad / wiry / balanced","*create mc_build \"broad\"","","*comment Hair: white_long / black_cropped / dark_red_tied / silver_wild / black_mane","*create mc_hair \"black_mane\"","","*comment Starting outfit: worn / highland / maritime / stolen","*create mc_outfit \"highland\"","","*comment Backstory: debt / name_on_wall / exile / broadcast","*create mc_backstory \"exile\"","","*comment Motivation: prove_them_wrong / find_father / see_the_end / build_something","*create mc_motivation \"prove_wrong\"","","*comment ---------------------------------------------------","*comment  DOMINION SYSTEM","*comment ---------------------------------------------------","","*comment Three expressions. Scale 0-100.","*comment Tier thresholds: 0-9 Flicker, 10-29 Tempered, 30-59 Forged, 60-84 Paramount, 85+ Conqueror","*comment MC starts at Flicker with trace amounts.","*create dominion_armoring 5","*create dominion_vision 5","*create dominion_king 0","","*comment Dominion lean: armoring / vision / balanced","*create dominion_lean \"balanced\"","","*comment Descriptive tier names (updated by code when thresholds crossed)","*create armoring_tier \"Flicker\"","*create vision_tier \"Flicker\"","*create king_tier \"Dormant\"","","*comment Has King manifested at all? (first manifestation is a major story beat)","*create king_manifested false","","*comment ---------------------------------------------------","*comment  KORVAAN (Body Refinement)","*comment ---------------------------------------------------","","*comment Stages: none / callus / ironset / fleshweave / nerveburn / reforged","*create korvaan_stage \"none\"","*create korvaan_training false","*create korvaan_progress 0","","*comment ---------------------------------------------------","*comment  GOD FRUIT","*comment ---------------------------------------------------","","*create has_god_fruit false","*create god_fruit_name \"none\"","*create god_fruit_type \"none\"","*create god_fruit_awakened false","","*comment ---------------------------------------------------","*comment  BOUNTY AND REPUTATION","*comment ---------------------------------------------------","","*comment Bounty in Sovereigns. MC starts at 0 \u2014 no bounty yet.","*create bounty 0","","*comment Descriptive bounty tier","*create bounty_tier \"Unknown\"","","*comment Grimoire followers (audience size \u2014 social media equivalent)","*create grimoire_followers 0","","*comment ---------------------------------------------------","*comment  FACTION REPUTATION","*comment  Scale: -100 to 100","*comment  Negative = hostile. Zero = unknown. Positive = favorable.","*comment ---------------------------------------------------","","*create rep_wardensea 0","*create rep_kolmari 0","*create rep_renegade 0","*create rep_khari_warrens 0","*create rep_oni_highlands 0","","*comment Specific Conqueror awareness/reputation","*create rep_dessaren 0","*create rep_kuldhara 0","*create rep_senmovar 0","*create rep_vassago 0","*create rep_daeshara 0","","*comment Descriptive faction standing (updated by code)","*create wardensea_standing \"Unknown\"","*create kolmari_standing \"Unknown\"","*create renegade_standing \"Nobody\"","*create khari_standing \"Outsider\"","*create oni_standing \"Exiled\"","","*comment ---------------------------------------------------","*comment  MONEY AND SUPPLIES","*comment ---------------------------------------------------","","*comment Currency in Sovereigns. MC starts nearly broke.","*create sovereigns 12","","*comment Supply level: 0 = starving, 100 = fully stocked","*create supplies 15","","*comment Days of food remaining for current crew size","*create food_days 3","","*comment Ship condition: 0 = sinking, 100 = perfect","*create ship_condition 0","","*comment Does the MC have a ship?","*create has_ship false","*create ship_name \"none\"","*create ship_acquisition_method \"none\"","","*comment ---------------------------------------------------","*comment  CREW ROSTER","*comment  Each crew member: exists flag, alive flag, loyalty (0-100),","*comment  trust level, and role.","*comment ---------------------------------------------------","","*create crew_count 0","","*comment Crew Slot 1 \u2014 First Mate","*create crew1_exists false","*create crew1_name \"empty\"","*create crew1_race \"unknown\"","*create crew1_role \"empty\"","*create crew1_alive true","*create crew1_loyalty 0","*create crew1_trust \"stranger\"","*create crew1_romance 0","*create crew1_romance_active false","","*comment Crew Slot 2 \u2014 Navigator","*create crew2_exists false","*create crew2_name \"empty\"","*create crew2_race \"unknown\"","*create crew2_role \"empty\"","*create crew2_alive true","*create crew2_loyalty 0","*create crew2_trust \"stranger\"","*create crew2_romance 0","*create crew2_romance_active false","","*comment Crew Slot 3 \u2014 Engineer","*create crew3_exists false","*create crew3_name \"empty\"","*create crew3_race \"unknown\"","*create crew3_role \"empty\"","*create crew3_alive true","*create crew3_loyalty 0","*create crew3_trust \"stranger\"","*create crew3_romance 0","*create crew3_romance_active false","","*comment Crew Slot 4 \u2014 Cook / Morale","*create crew4_exists false","*create crew4_name \"empty\"","*create crew4_race \"unknown\"","*create crew4_role \"empty\"","*create crew4_alive true","*create crew4_loyalty 0","*create crew4_trust \"stranger\"","*create crew4_romance 0","*create crew4_romance_active false","","*comment Crew Slot 5 \u2014 Fighter / Specialist","*create crew5_exists false","*create crew5_name \"empty\"","*create crew5_race \"unknown\"","*create crew5_role \"empty\"","*create crew5_alive true","*create crew5_loyalty 0","*create crew5_trust \"stranger\"","*create crew5_romance 0","*create crew5_romance_active false","","*comment ---------------------------------------------------","*comment  NPC RELATIONSHIP FLAGS (non-crew recurring NPCs)","*comment ---------------------------------------------------","","*comment Rival CG Captains","*create met_mavrokka false","*create met_caelmund false","*create met_tomoe false","*create met_suuba false","*create met_kovesse false","","*create rival_mavrokka 0","*create rival_caelmund 0","*create rival_tomoe 0","*create rival_suuba 0","*create rival_kovesse 0","","*comment Wardensea Officers","*create met_officer_selvaggio false","*create officer_selvaggio_name \"unknown\"","*create officer_selvaggio_attitude 0","","*comment Kingsrun locals","*create met_goltieri false","*create goltieri_attitude 0","","*comment ---------------------------------------------------","*comment  MC PERSONALITY AXES","*comment  These shift based on player choices.","*comment  Scale: 0-100, starts at 50 (neutral).","*comment ---------------------------------------------------","","*comment Aggressive <-> Cautious","*create personality_aggression 50","","*comment Loyal <-> Pragmatic","*create personality_loyalty 50","","*comment Open <-> Guarded","*create personality_openness 50","","*comment Merciful <-> Ruthless","*create personality_mercy 50","","*comment ---------------------------------------------------","*comment  PLOT FLAGS \u2014 Game 1","*comment ---------------------------------------------------","","*comment Chapter 1: Selvaggio","*create rang_departure_bell false","*create bell_rings 0","*create selvaggio_fight_won false","*create selvaggio_gambit_encountered false","*create found_ship false","","*comment Chapter 2: Galluun's Tooth","*create carved_name_reef false","*create galluuns_tooth_challenge \"none\"","","*comment Chapter 3: Merrenbach","*create completed_reef_walk false","*create khari_guide_name \"unknown\"","*create khari_trust_earned false","*create merrenbach_deal \"none\"","","*comment Chapter 4: Brannach","*create received_slag_gift false","*create brannach_eruption_survived false","*create obtained_weapon false","*create weapon_name \"none\"","*create weapon_grade \"none\"","","*comment Chapter 5: Kelvanni","*create clinic_debt_owed false","*create kelvanni_favor \"none\"","*create met_oursseva false","","*comment Chapter 6: Velundri","*create coat_traded false","*create velundri_revelation false","*create revelation_type \"none\"","*create second_age_fragment false","","*comment ---------------------------------------------------","*comment  GRIMOIRE BROADCAST FLAGS","*comment  Track which broadcasts the player has seen.","*comment ---------------------------------------------------","","*create broadcast_count 0","*create latest_broadcast \"none\"","","*comment ---------------------------------------------------","*comment  KINGSRUN PROGRESS","*comment ---------------------------------------------------","","*create current_stop 1","*create current_stop_name \"Selvaggio\"","*create days_since_departure 0","*create total_sea_days 0","","*comment ---------------------------------------------------","*comment  INJURIES AND CONDITIONS","*comment ---------------------------------------------------","","*create injured false","*create injury_type \"none\"","*create injury_severity 0","*create injury_days_remaining 0","","*comment ---------------------------------------------------","*comment  SAVE CODE VARIABLES (for cross-game persistence)","*comment ---------------------------------------------------","","*comment These will be encoded into the checkpoint password at Game 1 end","*comment Kept to ~30 variables max for manageable code length","","*comment ---------------------------------------------------","*comment  GAME START","*comment ---------------------------------------------------","","*create game_version \"1.0.0\"","","*goto_scene ch1_selvaggio_arrival",""], "labels":{}},
"choicescript_stats": {"crc":1200469880, "lines":["*stat_chart","  text mc_name \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550","  text bounty_tier BOUNTY STATUS","  text current_stop_name KINGSRUN POSITION","","*stat_chart","  text mc_name","  text mc_height_feet Height","  text mc_horns Horns","  text mc_skin Skin","  text mc_build Build","","*page_break","","*comment \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550","*comment  GRIMOIRE PROFILE \u2014 DOMINION","*comment \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550","","DOMINION EXPRESSIONS","*line_break","","*stat_chart","  text armoring_tier Armoring","  percent dominion_armoring Armoring","","*if (dominion_vision > 5)","  *stat_chart","    text vision_tier Vision","    percent dominion_vision Vision","","*if (dominion_king > 0)","  *stat_chart","    text king_tier King","    percent dominion_king King","","*if korvaan_training","  *line_break","  BODY REFINEMENT \u2014 KORVAAN","  *stat_chart","    text korvaan_stage Stage","","*if has_god_fruit","  *line_break","  GOD FRUIT","  *stat_chart","    text god_fruit_name Fruit","    text god_fruit_type Type","","*page_break","","*comment \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550","*comment  GRIMOIRE PROFILE \u2014 REPUTATION","*comment \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550","","WORLD STANDING","*line_break","","*stat_chart","  text wardensea_standing Wardensea","  text kolmari_standing Kolmari","  text renegade_standing Renegade Community","  text khari_standing Khari Warrens","  text oni_standing Oni Highlands","","*line_break","*if (bounty > 0)","  BOUNTY: ${bounty} Sovereigns","*if (bounty = 0)","  BOUNTY: None issued","*line_break","GRIMOIRE FOLLOWERS: ${grimoire_followers}","","*page_break","","*comment \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550","*comment  GRIMOIRE PROFILE \u2014 CREW ROSTER","*comment \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550","","CREW ROSTER \u2014 ${crew_count} members","*line_break","","*if crew1_exists","  ${crew1_name} \u2014 ${crew1_role}","  *if (crew1_alive = false)","    [LOST]","  *line_break","  *stat_chart","    text crew1_trust Trust","    percent crew1_loyalty Loyalty","","*if crew2_exists","  *line_break","  ${crew2_name} \u2014 ${crew2_role}","  *if (crew2_alive = false)","    [LOST]","  *line_break","  *stat_chart","    text crew2_trust Trust","    percent crew2_loyalty Loyalty","","*if crew3_exists","  *line_break","  ${crew3_name} \u2014 ${crew3_role}","  *if (crew3_alive = false)","    [LOST]","  *line_break","  *stat_chart","    text crew3_trust Trust","    percent crew3_loyalty Loyalty","","*if crew4_exists","  *line_break","  ${crew4_name} \u2014 ${crew4_role}","  *if (crew4_alive = false)","    [LOST]","  *line_break","  *stat_chart","    text crew4_trust Trust","    percent crew4_loyalty Loyalty","","*if crew5_exists","  *line_break","  ${crew5_name} \u2014 ${crew5_role}","  *if (crew5_alive = false)","    [LOST]","  *line_break","  *stat_chart","    text crew5_trust Trust","    percent crew5_loyalty Loyalty","","*if (crew_count = 0)","  No crew. You sail alone.","","*page_break","","*comment \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550","*comment  GRIMOIRE PROFILE \u2014 TREASURY","*comment \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550","","TREASURY AND SUPPLIES","*line_break","","*stat_chart","  text sovereigns Sovereigns","  percent supplies Supplies","  text food_days Days of Food","","*if has_ship","  *line_break","  SHIP: ${ship_name}","  *stat_chart","    percent ship_condition Hull Condition","","*if (has_ship = false)","  *line_break","  NO SHIP.","","*line_break","KINGSRUN \u2014 Stop ${current_stop}: ${current_stop_name}","*line_break","Days since departure: ${days_since_departure}",""], "labels":{}},
"ch1_selvaggio_arrival": {"crc":-1970939839, "lines":["*comment ===================================================","*comment  CHAPTER 1: SELVAGGIO \u2014 \"The Gate\"","*comment  Scene 1: Arrival","*comment  World terms introduced: Kingsrun, Grimoire, Sovereigns","*comment  MC creation woven into the inspection checkpoint","*comment ===================================================","","The smell came first.","","Fish oil and tar. Woodsmoke. Something fermenting in the heat \u2014 fruit or flesh, impossible to tell. Salt underneath all of it, the kind that gets into cloth and doesn't leave.","","Selvaggio.","","The cargo hauler that carried you south from Caldruun listed into the harbor on a current it didn't bother fighting. Three weeks of deck-sleeping, rat-dodging, and eating whatever the crew didn't finish \u2014 and this was the destination. The gate island. The last place people stop before they stop coming back.","","The harbor was a wound in the coastline, ringed on three sides by stone jetties black with age. Ships packed the water so tight their hulls touched \u2014 fishing sloops and trade barges and fast-hulled things with no flags and crews who watched the dock like they were pricing it. Hundreds of vessels. The masts made a forest against the grey sky, and the noise coming off the water was a wall of its own.","","Shouting. Rope-creak. A hammer on wood, over and over, somewhere to the left \u2014 someone was either building a ship or punishing one. Music from a docked sloop, a string instrument badly tuned, played by someone who hadn't let that stop them. And under all of it, the low electric hum of hundreds of small stone devices chattering at once, voices and tones bleeding into each other from every direction like a hive had cracked open. Somewhere a woman was yelling the word [i]barnacles[/i] with a fury that suggested the word meant something different here than it did in the highlands.","","The cargo hauler's captain \u2014 a Bastion Sea woman with salt-crust in her hair and no patience left \u2014 jerked her thumb toward the gangplank.","","\"End of the line. Checkpoint's at the \u2014 north jetty. The big one.\" She waved vaguely at a jetty that was not the biggest. \"Don't skip it or they'll find you and it'll be worse.\"","","She looked at you for a second longer than necessary. Looked at the horns. Started to say something. Stopped. Looked away.","","\"Stay out of \u2014 good luck out there.\"","","The gangplank bowed under your weight. Forty feet of warped timber connecting the hauler's deck to a dock crowded with bodies \u2014 sailors, merchants, dock hands, beggars, three children chasing a dog between stacked crates, a woman selling fried something from a cart that smoked like a small fire. Nobody looked up. The dock absorbed you the way a river absorbs a stone.","","You were taller than most of them. The horns cleared the crowd by a foot, curving back from your temples in wide arcs that caught the light when you turned your head. People didn't stare \u2014 not here, not on a dock that processed a thousand strangers a week \u2014 but they adjusted. Gave you the extra six inches. Shifted their path without looking at you directly.","","The storm-leather coat hung open, heavy on your shoulders. Highland make \u2014 cured in volcanic ash, dark, built for mountain weather that Selvaggio had never seen. The skin-singer's work on your arms was visible past the sleeves: black ink in patterns that told a story, if you knew how to read it. The lines stopped halfway down your left forearm. Unfinished. The story cut short.","","*page_break","","The checkpoint was a stone booth at the north jetty's mouth, manned by two people in grey uniforms and one in a white coat.","","The white coat was the one who mattered. You could tell by how the grey uniforms looked at her \u2014 deference without warmth. She was young, human, with short dark hair and a jaw that kept resetting itself, like she was chewing on something she'd already swallowed. No stripe on the coat \u2014 low rank, but rank enough to run this checkpoint.","","A line of arrivals waited ahead of you. She processed them fast \u2014 name, origin, destination, purpose. A flat stone device on the counter glowed faintly as she tapped notes into it with a stylus. Same devices you'd been hearing all through the harbor. Pocket-sized. Carved limestone. Everyone had one.","","The line moved. A dock hand. A merchant with three crates of something that smelled like medicine. A pair of sailors who answered questions with the rehearsed ease of people who'd done this before.","","Your turn.","","The officer looked up. Registered the height. The horns. The ash-white skin. Her expression didn't change, but the stylus paused.","","\"Name.\"","","*fake_choice","  #Give her the truth. Merdou Akkan.","    She wrote it down. Sounded it back under her breath \u2014 getting the shape of it. A highland name, or close to one. She'd have heard a few.","  #Just the surname. Akkan.","    \"First name.\"","","    You held the pause a beat longer than courtesy allowed. The rest of the name crossed the counter like something dragged.","","    She wrote it down without comment. The pause told her more than the name did.","","\"Origin.\"","","*fake_choice","  #Sennaku Highlands. Don't flinch from it.","    The stylus stopped. She looked at you again \u2014 not at the horns this time. At the coat. The unfinished ink on your arms. Highland gear on a lowland dock.","","    \"Long way from home.\"","","    The grey-uniformed man behind her shifted his weight. His hand didn't move toward the weapon at his hip, but the thought crossed his face.","  #Caldruun. Leave the highlands out of it.","    True enough. The highlands were on Caldruun. The rest was none of her business.","","    \"Caldruun's a continent, not an origin. Narrow it down.\"","","    A vague wave eastward. Enough to fill the form. Not enough to mean anything.","","    She wrote it. Didn't push. Either she believed it or she didn't care enough to argue.","","\"Purpose of visit.\"","","The line behind you was growing. Someone coughed. The fried-food cart's smoke drifted across the checkpoint and the officer didn't blink.","","*choice","  #Passage south. (The truth \u2014 you're heading for the open ocean.)","    \"South\" meant one thing at Selvaggio. The route that started here and ended at the edge of the world \u2014 sixteen stops through water that got darker and meaner the further you went. Most people who said \"south\" at this checkpoint said it with a crew at their back and a ship in the harbor.","","    You had neither.","","    She looked at the coat again. The boots \u2014 highland-made, battered, soles worn from terrain that wasn't dock planking. The frame filling the checkpoint's doorway.","","    \"Crew?\"","","    *set personality_openness %+ 5","    You said nothing.","","    \"Ship?\"","","    The same nothing.","","    She stamped the form. Slid a square of pressed paper across the counter \u2014 your entry permit.","","    \"Departure Row's on the east wall. If you're looking for a crew or a berth, that's where.\" She paused. \"Most people heading south have both before they get here.\"","","    *goto after_checkpoint","","  #Work. (Keep it vague. Don't advertise your plans.)","    \"What kind.\"","","    A shrug that covered the full spectrum from honest hauling to the other kind.","","    *set personality_openness %- 5","    She studied you for a two-count. Half-breed in highland gear, big enough to pick up the checkpoint booth and walk away with it, asking about work at a port where \"work\" covered everything from honest hauling to the kind that raised your number on government lists.","","    She stamped the form.","","    \"Stay out of trouble.\"","","    She slid the entry permit across the counter. Her eyes were already on the next person in line.","","    *goto after_checkpoint","","  #Just passing through. (Flat. Give her nothing.)","    \"To where.\"","","    Nothing. The answer was the absence of one.","","    *set personality_openness %- 10","    *set rep_wardensea - 3","    The officer's mouth thinned. She glanced at the grey-uniform behind her \u2014 a look that said *note this one* without a word spoken. Then she stamped the form.","","    \"Enjoy Selvaggio.\"","","    She didn't mean it. She slid the entry permit across the counter and looked past you to the next in line. You'd given her nothing, and she'd given you a stamp with an edge on it. Fair trade.","","    *goto after_checkpoint","","*label after_checkpoint","*page_break","","Past the checkpoint, Selvaggio opened.","","The dock district ran half a mile along the harbor's curve \u2014 a crush of timber structures built on top of each other, newer boards nailed over old ones, rooflines that didn't match because nobody had ever planned any of it. Stalls crowded every gap between buildings. Rope bridges connected second-floor walkways across streets too narrow for your shoulders. The ground was salt-stained planking over stone, slick with fish water and something the food carts left behind.","","And people. More people than you'd seen in one place in your life. None of them knew you.","","They came in every shape. Humans mostly \u2014 the majority everywhere, the default, the ones who ran the institutions and filled the ranks. But not only. A pair of figures built like siege towers pushed through the crowd ahead of you \u2014 green-skinned, tusked, a head taller than the humans around them. Dockhands, by the look of it, hauling crates that would have taken three humans to lift. One of them laughed at something the other said, a sound like rocks in a barrel.","","To your left, a woman barely four feet tall moved through the crowd at twice everyone else's speed, weaving between legs with the automatic ease of someone who'd spent her life at knee-height. Pointed ears, sharp features, a leather tool harness strapped across her chest with pockets that clinked with metal. She was arguing with someone on one of those stone devices \u2014 the carved pocket-things that were everywhere \u2014 talking so fast the words blurred together.","","\"\u2014told Veshk the manifold's cracked, he says it's fine, I say show me the fine, he says trust me, I say trust THIS\u2014\"","","She vanished into the crowd. A man next to you \u2014 human, middle-aged, chewing something that stained his teeth dark \u2014 watched her go.","","\"Rathai,\" he said, to nobody in particular. Or to you. Hard to tell. \"Fix everything, break everything, fix it again. Talk the whole time.\" He chewed. \"Good people. Loud people. Same thing, down here.\"","","He looked up at you. Took in the horns, the height, the coat. Gave a small nod \u2014 the kind that acknowledged a thing without commenting on it.","","\"First time?\"","","*choice","  #A nod. Keep it simple.","    You returned the nod. A minimal transaction.","","    *set personality_openness %- 3","    \"Thought so.\" He spat something dark onto the dock. \"You've got the look. Like you're trying to see all of it at once and it won't hold still.\" He jerked his chin toward the harbor. \"Three hundred ships in that water right now. By the end of the month, half of them sail south. By the end of the year, half of THOSE are sunk, grounded, impounded, or turned around.\"","","    He let that sit.","","    \"The other half keep going. That's the bet.\"","","    *goto harbor_view","  #Stop. Turn toward him. Give him the full view \u2014 the horns, the frame, the coat.","    You stopped. Turned. Gave him the full weight of your attention \u2014 six foot seven of highland Oni in a storm-leather coat, ram horns catching the overcast light.","","    *set personality_aggression %+ 3","    He didn't step back. Credit to him. He looked at you the way a man looks at weather he can't change.","","    \"Easy. I'm just talking.\" He spat dark onto the dock. \"You've got the look. Fresh off a hauler, no crew, no ship, heading for Departure Row with nothing but whatever's in those pockets.\"","","    He wasn't wrong.","","    \"I've been here six years. I've seen a thousand of you.\" He pointed at the harbor. \"Three hundred ships. Half sail south by month's end. Half of those don't come back. That's just the math.\"","","    *goto harbor_view","  #Keep walking. You didn't come here for conversation.","    You kept walking. The man shrugged behind you \u2014 the sound of someone used to being ignored.","","    *set personality_openness %- 5","    The harbor was ahead. You could see it through the gaps in the crowd \u2014 the forest of masts, the water dark with the shadows of hulls pressed together, the occasional flash of color from a flag or a painted figurehead.","","    Three hundred ships, the hauler's captain had said. Three hundred crews with plans and supplies and people who knew each other's names. You had twelve coins in your pocket that wouldn't cover a meal and a bed on the same night.","","    *goto harbor_view","","*label harbor_view","*page_break","","The harbor's east curve gave you the view.","","Ships. Dozens of types you didn't have names for \u2014 fat-bellied traders, long warships with ram prows, sleek two-masted things that looked fast even standing still. Flags you didn't recognize. Paint schemes faded by salt. Crews on every deck, loading and unloading, repairing, arguing, sleeping in the sun.","","And on the stone wall above the main jetty, a board. Twenty feet wide, ten feet tall, covered in paper and ink. Names and numbers. Lines connecting them. Some papers fresh, some yellowed, some torn and replaced.","","You stepped closer.","","The board was organized by columns. Each column was a name \u2014 a person or a crew. Each row was a number and a note beside it.","","[i]Gannet Crew \u2014 680M \u2014 Mid-Kingsrun, past Brannach. Last broadcast: Brannach fight footage. 1.2 billion views.[/i]","","[i]The Kindling \u2014 275M \u2014 Early Kingsrun. Set the ocean on fire. That clip.[/i]","","[i]Deshanni Reapers \u2014 520M \u2014 Deep Kingsrun. Further south than any other rookie crew. Captain laughed at a storm on broadcast. 900 million views.[/i]","","Numbers in the millions. Hundreds of millions. Beside each name, scrawled in different hands, notes that read like arguments:","","[i]\"Gannet doesn't make it past the fortress.\"[/i]","[i]\"Reapers' captain is insane. Insane wins.\"[/i]","[i]\"Kindling = one trick. Runs out of ocean to burn.\"[/i]","","The numbers weren't money. They were something else \u2014 a measurement. A price on a person's head, set by the government that ran the white coats. The higher the number, the more the government wanted you gone. And here, on this board, the numbers were bragged about. Compared. Debated.","","A boy \u2014 human, maybe fifteen, barefoot, ink on his fingers \u2014 was pinning a fresh sheet to the board. New crew. New number. He saw you looking and grinned.","","\"Checking the field? You've got time \u2014 big departures aren't for another week.\" He looked at you sideways. \"Unless you're already on someone's crew.\"","","The question was obvious. So was the answer. Your silence gave it.","","\"Right.\" The boy's grin didn't falter. \"Departure Row. East wall. Can't miss it.\" He pointed without looking \u2014 the direction was muscle memory. \"If you want a berth, talk to Pellune at the Anchor's Rest \u2014 she knows every ship that's hiring. Or Mellune. Wait, no, Pellune died. It's \u2014 the woman with the ledger. You'll know her.\"","","He looked at the storm-leather coat. The boots. The frame that said a lot and the pockets that said almost nothing.","","\"If you want your own ship, you'd better be interesting. Or really, really big.\" He glanced up at the horns. \"So \u2014 maybe.\"","","He went back to pinning papers. You stood at the board for another minute, reading names you didn't know and numbers that meant nothing to you yet.","","Somewhere behind you, deeper in the dock district, one of the stone devices was playing a broadcast loud enough to hear from fifty feet away. A voice \u2014 smooth, professional, used to being listened to \u2014 was reading a list.","","\"\u2014updated figures from the Bureau of Enforcement. Deshaan crew: five-twenty adjusted. Vosst crew: three-ten, holding. Gallacs crew\u2014\"","","Someone in the crowd groaned. Someone else laughed. A third person shouted a name and a counter-argument. The broadcast kept going, indifferent, and the crowd argued over it like it was sport.","","The sky over Selvaggio was the color of old iron. The air tasted like salt and ambition and something burning. Three hundred ships in the harbor and most of them were crewed by people who thought they were special.","","The dock stretched ahead. Departure Row was to the east. Somewhere on this island was a ship, a crew, and a reason to ring the bell.","","Twelve coins. No crew. No ship. No name on any board.","","*page_break","","The afternoon wore itself out against the harbor.","","You walked the dock district for two hours, learning Selvaggio with your feet and your eyes. The layout was chaos with a pattern underneath: the main jetty was the spine, side streets branching off like ribs, each dominated by a trade. Rope street. Tar street. A narrow lane where three competing food carts had merged their smoke into a single grey cloud.","","And everywhere, the stone devices \u2014 Grimoires, you'd hear them called. Palm-sized, carved limestone on the cheap ones, darker stone on the better. Everyone had one. Everyone was talking into one, tapping one, watching something on one. You didn't have one. The highlands had a few for the clan elders. Down here, not carrying one marked you as broke, stubborn, or from somewhere that didn't care about the rest of the world's conversations.","","*choice","  #Study one of the devices up close \u2014 a discarded cheap one on a food cart's counter.","    A food cart vendor had left one on the counter while she flipped something in hot oil. Limestone casing, cracked at one corner, the carved symbols on its face worn from use. The surface glowed faintly \u2014 blue-white, like foxfire. You could see text scrolling across it. Names. Numbers. The same kind of figures that covered the board at the jetty.","","    The vendor caught you looking. She was human, fortyish, wide, with a burn scar across one forearm that said she'd been flipping things in hot oil for a long time.","","    \"First time seeing a Grimoire up close?\" She wasn't mocking. The question was genuine. \"Twelve coppers gets you a dead one at the salvage stalls. Twenty gets you one that works. Sort of.\"","","    She tapped the cracked device. \"This one picks up six bands. Used to get eight, but the rune-lattice is shot. Still gets the bounty feeds and the weather. That's all anyone really \u2014\" She stopped. Flipped something in the oil, too late \u2014 it had burned on one side. She scraped it off the surface and dropped it onto a plate. \"Three coppers. Slightly charred. Character building.\"","","    She looked at you again \u2014 the horns, the coat. Started to ask something. Stopped. Flipped another piece of fish.","","    \"None of my business where you're headed. But if you're heading south, eat first. That's free advice. The food costs extra.\"","","    *goto dusk_approach","","  #Keep walking. You'll learn what you need to learn when you need to learn it.","    The devices were everywhere and you were nowhere, and that was fine. You'd pick up how things worked down here the same way you'd learned everything: by watching until watching wasn't enough and then doing.","","    The highland way. Watch the elders. Watch the fighters. Watch the mountain until you understand what the mountain is doing. Then climb it.","","    Selvaggio was a living thing \u2014 ate people who moved too slowly, forgot people who moved too fast. The trick was finding the pace that let you see without being seen.","","    At your height, with your horns, \"not being seen\" was a theory.","","    *goto dusk_approach","","*label dusk_approach","","The light changed. Selvaggio's overcast sky shifted from grey to amber to a dull copper that turned the harbor water the color of old blood. The crowd didn't thin \u2014 it rotated. Day workers drifted out and a different population drifted in. Louder. Looser. The tavern doors along the east wall opened their mouths and the noise poured out like heat from a forge.","","Departure Row.","","You could hear it before you could see it \u2014 twelve establishments packed along a two-hundred-yard stretch of harbor-front, each one leaking music and argument and the specific sound of people spending money they might not live long enough to earn back. Lanterns hung from the eaves, oil-fed, throwing orange light across the foot traffic. The street was wide enough for a cart but no cart would survive the crowd. People moved in currents \u2014 into one tavern, out of another, clustering at the gaps between buildings to argue, trade, or watch the harbor.","","Above the door of the nearest tavern, a painted sign: **THE ANCHOR'S REST**. Below it, in smaller letters: *Crew board inside. Berths posted daily. No fighting on premises \u2014 house rule enforced.*","","The \"enforced\" was underlined twice.","","The evening was starting. Departure Row was where the business happened \u2014 crews forming, ships hiring, reputations being built or wrecked in a single conversation. If you were going to find a ship and a crew, this was where.","","But the day had been long. Three weeks on a cargo hauler, the checkpoint, the walk, the weight of a place that moved faster and louder than anything you'd grown up with. The twelve coins in your pocket could buy a meal or a bed. Not both.","","*choice","  #Head into the Anchor's Rest. The crew board won't wait, and neither will you.","    The door was heavy timber. You pushed it open and the room hit you \u2014 noise, heat, the smell of food and spilled drink and too many bodies in a space built for half of them. The crew board was on the far wall. Names, ship names, positions needed, pay offered. A living document, pinned and re-pinned, scrawled over and crossed out.","","    You stepped inside. The doorframe required you to duck \u2014 the horns cleared it by two inches.","","    Three people at the nearest table stopped talking when you walked in. One of them picked up her drink and put it down without drinking. They started again a second later, louder than before, as if the conversation had never paused.","","    *set personality_aggression %+ 3","    *goto scene_end","","  #Find food first. Empty stomach, bad decisions.","    The food carts near Departure Row were busy. You found one with the shortest line \u2014 a woman running a grill made from half a ship's anchor, green-skinned and broad and built like she'd been born behind that grill. The menu was whatever she pointed at. You pointed back.","","    Eight of your twelve coins got you a slab of grilled fish on flatbread, dense and hot, with a sauce that tasted like someone had declared war on your tongue with peppers and vinegar.","","    *set sovereigns 4","    You ate standing up, back to a wall, watching Departure Row's mouth. The food was good. The sauce was an assault. The warmth in your chest was the first thing all day that carried the weight of home \u2014 not the taste, but the act. Eating well before doing something hard. Highland tradition: never fight hungry.","","    *set personality_loyalty %+ 3","    *goto scene_end","","  #Find a spot above the crowd and watch. Learn the patterns before you walk into them.","    There was a stone staircase at the end of the dock row that climbed to a second-level walkway. From there, you could see Departure Row laid out below \u2014 the twelve taverns, the foot traffic, the flow of people in and out.","","    You sat on the top step. The stone was warm from the day's heat. The ram horns caught the lantern light from below, and a dock worker climbing past you flinched \u2014 saw the shape before they saw the person.","","    \"Sorry. Didn't \u2014 the horns. I mean, not that they're \u2014 I've seen horns. I work with a Gorundai on the night shift who has \u2014 they're not the same kind of horns, I know that. Sorry.\"","","    *set personality_openness %- 3","    They kept climbing. You could hear them muttering to themselves all the way to the top. You stayed. Watched. Departure Row moved in patterns. Crews entered in groups and left in groups. Individuals entered alone and some left alone and some left with new people at their sides. The taverns closest to the harbor pulled the biggest crowds. The ones further back were quieter.","","    The pattern was the same as a highland festival market. Noise at the center, deals at the edges.","","    *goto scene_end","","*label scene_end","*page_break","","The sky over Selvaggio went dark. The harbor lanterns doubled in the water, orange on black.","","No crew. No ship. Nothing but a highland coat, a fistful of coins, and a name that nobody at Selvaggio had heard yet.","","The bell at the harbor mouth \u2014 the departure bell \u2014 was a dark shape against the sky. Bronze. Old. Not tonight. But you'd ring it. You hadn't walked down from the Sennaku Highlands and crossed half a continent to watch other people leave.","","*goto_scene ch1_selvaggio_docks",""], "labels":{"after_checkpoint":135,"harbor_view":193,"dusk_approach":281,"scene_end":333}},
"ch1_selvaggio_docks": {"crc":557065462, "lines":["*comment ===================================================","*comment  CHAPTER 1: SELVAGGIO \u2014 \"The Gate\"","*comment  Scene 2: The Docks","*comment  World terms introduced: Wardensea (named), Dominion/Armoring","*comment  (shown), bounty system (context), Goltieri's presence (felt)","*comment  3 real choices. Zero fake choices.","*comment ===================================================","","Morning on the docks was a different machine than the night.","","The drunks and dreamers had crawled back into their rented beds. What replaced them was labor \u2014 organized, loud, and governed by a hierarchy you could read if you watched long enough. The loading crews answered to dock bosses. The dock bosses answered to a man in a pressed grey vest who stood at the main jetty's intersection with a ledger and didn't raise his voice because he didn't need to. And the man in the grey vest answered to a name that was painted on the jetty's support columns, scratched into the dock planking, whispered by the loading crews when they thought the dock bosses weren't listening.","","Goltieri.","","You didn't know the name yet. You learned it the way Selvaggio taught everything \u2014 by proximity.","","Two dock workers unloading a fishing sloop. One of them \u2014 human, young, arms roped with muscle \u2014 dropped a crate. Something inside it shattered. The other dock worker, older and thinner, went pale.","","\"That's a Goltieri shipment.\"","","\"It's fish. It's \u2014 there's more fish. They won't even notice.\"","","\"They notice. They count the fish.\" The older man's voice had gone flat. \"They count everything.\"","","The older man was already walking toward the dock boss. The younger one stood over the broken crate with a look that said he was calculating whether to run. He didn't run. Nobody ran from a broken crate at a dock. But nobody forgot who owned the fish, either.","","You filed the name. Goltieri. Someone who owned the docks \u2014 not the buildings, but the fear.","","*page_break","","The morning work gave you cover. At your height you couldn't hide, but you could blend into the purpose of the place \u2014 walk like you belonged, move like you had somewhere to be. It almost worked. The dock crews looked at you and saw the size first. Good. Size meant labor value. A half-Oni built like a stone wall could haul cargo that would take two or three humans. That was worth tolerating the horns.","","A dock boss \u2014 the grey-vested man at the intersection \u2014 saw you pass and called out without looking up from his ledger.","","\"You. Big one. Need work?\"","","Twelve coins in your pocket. Four, if you'd eaten last night. The offer was practical. The docks paid daily. A day's hauling bought food and a bed for two nights.","","But a day hauling was a day not spent finding a crew or a ship. And the departures wouldn't wait.","","You kept walking. The dock boss shrugged and went back to his numbers. He'd asked the question a thousand times and heard every answer. Yours wasn't interesting.","","The docks narrowed as you moved east along the harbor's curve. The main jetty gave way to smaller berths \u2014 private, rented by the week, occupied by the ships that were here for reasons beyond fishing or trade. Faster vessels. Leaner hulls. Crews that watched the walkway instead of working it.","","Two men sat on the edge of one berth, legs dangling, eating something from a shared bowl. Both wore heavy canvas jackets over leather, practical and salt-stained. One had a short blade on his belt \u2014 not a work tool, a weapon. The other had nothing visible, but his forearms had a quality you recognized.","","You'd seen it once in the highlands. An elder, mid-bout, whose skin had gone dark \u2014 not shadow, not bruise. A sheen, like oil on water, that crawled up from the wrists and settled over the knuckles. The elder had hit a stone column and the column had cracked. The skin hadn't.","","This dock man's forearms had that same density. Resting, but the tissue underneath was wrong in a way that said it had been hardened by something that wasn't exercise.","","He caught you looking. Held your gaze for a beat \u2014 not aggressive, assessing. Then he nudged his companion.","","\"Oni. Half, maybe. Or big human with \u2014 no, that's horn. That's definitely horn.\"","","\"Highland. The curve's wrong for lowland Oni.\"","","\"There are lowland Oni?\"","","\"Not anymore.\"","","They went back to their food. You kept walking. The assessment was mutual.","","*page_break","","The eastern berths ended at a stone seawall where the harbor met open water. Three ships were docked in a row, larger than the fishing sloops, smaller than the warships. Working vessels with scarred hulls and crews that moved with the economy of people who'd done this a hundred times.","","Between the second and third ship, on the narrow dock, a problem was happening.","","A woman \u2014 short, dark-skinned, with close-cropped hair and a tool belt that weighed more than she did \u2014 was standing in front of a stack of crates marked with a symbol you didn't recognize. She had her arms crossed and her chin up, which put her eye level somewhere around the chest of the man blocking her path.","","He was big. Not Oni-big, but big for a human \u2014 six foot two, wide, with a shaved head and a face that had been rearranged by fists more than once. He wore the grey vest of a dock boss, but his was newer and cleaner than the one at the main jetty. A brass pin on his collar \u2014 a bell shape.","","Goltieri's people. You were learning to read the pins.","","\"The crates stay,\" the man said. \"Dock fee's doubled for independent berths. New policy.\"","","\"New since yesterday.\" The woman's voice was flat and precise. Her hand was on her tool belt, tightening a wrench that was already tight. \"I paid dock fees for the week. The receipt's on your ledger.\"","","\"Ledger's been updated.\"","","\"In the middle of the night.\"","","\"Policy changes when policy changes.\" The dock enforcer smiled. It didn't reach his eyes or try to. \"You want the crates, pay the difference. You can't pay, the crates secure the debt.\"","","Behind the woman, on the deck of the second ship, two crew members were watching. They weren't coming down. The dock enforcer outweighed the woman by a hundred pounds and had three more of his people standing twenty feet back, pretending to inspect a hull.","","The woman noticed you. Not your face \u2014 your shadow. It fell across the crates and kept going. She looked up. Took in the height, the horns, the storm-leather coat. Her expression didn't change, but her weight shifted \u2014 half a step back, making space she hadn't needed a moment ago.","","The enforcer noticed her looking and turned.","","He was six-two. You were six-seven. He had a hundred pounds on the woman. You had a hundred on him. The ram horns added another dimension that weight couldn't measure \u2014 the shape of something that was not entirely human standing in the narrow dock space.","","His smile lost a degree. His left foot shifted back \u2014 not a step, just a weight adjustment. The kind of thing a body does when the head hasn't decided yet.","","\"Help you?\" he said.","","*choice","  #Step closer. You don't need to say anything. Let the shadow do the talking.","    You stepped forward. One step. The dock planking groaned under your weight.","","    The enforcer's three backup men stopped pretending to inspect the hull. They were looking now. The one nearest had his hand on something at his belt.","","    You didn't look at them. You looked at the enforcer. Straight down, because that was the geometry of it \u2014 six-seven to six-two, and the horns added the rest.","","    He held for two seconds. Then three. His jaw worked. His right hand opened and closed once \u2014 the unconscious motion of a man checking where his weapon was without reaching for it.","","    *set personality_aggression %+ 8","    *set personality_mercy %+ 3","    \"Fine.\" He said it to the woman, but he was watching you. \"One-time courtesy. The crates stay. Fee resets at end of week.\"","","    He stepped back. Not quickly \u2014 he controlled the retreat, made it look like a decision instead of a concession. Professional. But a concession it was.","","    The woman watched him go. Watched his three men follow. Then she looked at you.","","    \"I didn't ask for that.\" She uncrossed her arms. Crossed them again. Uncrossed them. Her hands didn't seem to know where to go now that the confrontation was over.","","    \"I mean \u2014 thank you. No. I mean I didn't need it. But also thank you.\" She pinched the bridge of her nose. \"I'm bad at this part.\" She was shorter than you'd first estimated \u2014 five foot three, maybe less. Up close, her hands were the kind that had spent years inside machinery. Grease under the nails that no amount of scrubbing would remove. The tool belt wasn't for show.","","    \"Tessavenne Gruul offered me a berth on the Polished three months ago. I turned it down because Vosst's crew runs on ledgers, not loyalty.\" She looked at the crates, then at you. \"I have twenty crates of replacement hull plating that I need moved to a ship that doesn't exist yet, because the ship I was crewing on sank two weeks ago. The Wardensea \u2014 the white coats, if you've been here less than a day \u2014 impounded the salvage and called it contraband.\"","","    She stuck out her hand. The gesture was precise, habitual, mechanical.","","    \"Dussa Kervenne. Engineer. Currently shipless, crewless, and out of patience.\"","","    *set met_officer_selvaggio true","    *goto after_dock_conflict","","  #Walk past. This isn't your fight and she didn't ask for help.","    You walked past. The enforcer watched you go \u2014 tracked the horns, the coat, the frame \u2014 and then turned back to the woman with the relief of a man whose problem just simplified itself.","","    \"So. The fee.\"","","    Behind you, the woman's voice stayed flat and controlled. She'd handle it or she wouldn't. People at Selvaggio solved their own problems or they didn't solve them. That was the math of this place and you'd learned it in the highlands, where the clan didn't carry anyone who couldn't carry themselves.","","    *set personality_aggression %- 5","    *set personality_loyalty %- 3","    Thirty feet past the confrontation, you stopped. Not because of the woman. Because of what was happening on the dock to your right.","","    A loading crew was unloading barrels from a shallow-hulled transport. One of the crew \u2014 young, human, couldn't have been older than twenty \u2014 was struggling with a barrel that the others handled in pairs. He was trying to muscle it alone. Proving something. The barrel slipped and he caught it, barely, and in the second of effort something happened to his forearms.","","    A dark sheen. Brief. Like oil catching light. It crawled up from his wrists, hardened, and then faded as his grip steadied and the barrel stopped moving.","","    The worker next to him \u2014 older, Gorundai, green-skinned and unmoved \u2014 glanced at the sheen and grunted.","","    \"Tempered. Barely. Stop showing off and use two hands.\"","","    The young man flushed and grabbed the barrel properly. The dark sheen was gone. Nobody else on the dock had noticed.","","    Armoring. The highlands had another word \u2014 *kossk*, the bone-shell \u2014 but down here they called it Armoring. You'd seen the elders use it. You'd seen the clan's strongest fighters wear it like a second skin during festival bouts. Your own had flickered once, during the First Bout, in the second before everything went wrong.","","    You kept walking.","","    *goto after_dock_conflict","","  #Stay where you are. Watch. See how this resolves \u2014 it'll tell you how power works at Selvaggio.","    You stopped. Leaned against a berth piling \u2014 the wood complained but held \u2014 and watched.","","    *set personality_openness %+ 5","    The enforcer saw you watching. It changed his math. Not enough to back down \u2014 the woman and her crates were a small-value shakedown, routine, not worth losing face over. But enough to make him efficient about it.","","    \"Half rate. Call it a correction. Pay by sundown.\"","","    The woman stared at him. The number was still wrong, but it was less wrong. She was calculating \u2014 not the money, the politics. What fighting this cost versus what paying it cost. The dock enforcer had twenty more years of these calculations behind him and he knew the answer she'd reach.","","    \"Half rate,\" she said. \"And a receipt.\"","","    \"Receipt's extra.\"","","    \"A receipt,\" she said, \"or I file a cargo dispute at the port authority and your name goes on the audit ledger. Goltieri doesn't like audits.\"","","    The enforcer's face went flat. He pulled a scrap of paper from his vest, wrote on it, and handed it over. The woman took it without looking at it.","","    He left. His three men followed. The woman stood alone with her crates and a scrap of paper that was worth more than the money it represented.","","    She noticed you leaning against the piling. Her eyes traveled the full length of you \u2014 boots, coat, arms, horns.","","    \"Enjoy the show?\"","","    You pushed off the piling. The dock protested again.","","    She watched you move. Measuring. People at Selvaggio measured everything.","","    \"You stood there and watched a man try to rob me.\"","","    She was testing what kind of person stands still during someone else's problem.","","    \"I'm Dussa Kervenne. That ship \u2014\" she pointed at the second vessel, the one with the crew who hadn't come down to help \u2014 \"was my berth until two weeks ago. Sank in a reef crossing. The Wardensea \u2014 the white coats at the checkpoint, you've seen them \u2014 impounded everything we salvaged and called it contraband. I've been on this dock arguing with Goltieri's people for eleven days.\"","","    She crossed her arms.","","    \"You're new. Highland, from the coat. And you're watching instead of doing, which means you're either smart or you don't care about anyone but yourself. I haven't decided which.\"","","    *set met_officer_selvaggio true","    *goto after_dock_conflict","","*label after_dock_conflict","*page_break","","The morning burned toward noon. The stone dock absorbed the sun and threw it back. You walked the berths. Counted ships. Listened.","","The ones heading south were easy to spot \u2014 departure flags, provisions in long-voyage quantities, crews too focused to notice you watching. The first stop south of Selvaggio was something called Galluun's Tooth. A coral island. Reef-locked anchorage. \"First test of navigation,\" one sailor had said, with the weighted tone of someone who'd watched ships fail it.","","The Kingsrun. Sixteen stops south into water that stopped being charted and started being storied. The route the strongest man in the world had sailed and then vanished on, twenty-two years ago. Down here, the Kingsrun was everything \u2014 the test, the proving ground, the road that turned nobodies into names the world argued about.","","And the white coats \u2014 the Wardensea, Dussa had called them \u2014 patrolled every mile of it.","","Their ships were easy to spot in the harbor. White-hulled, clean-lined, flying a standard with a wave crest. Three of them occupied the north end of the harbor in a neat row, berths cordoned with chain. Crews in grey uniforms moved on their decks with the coordinated rhythm of people who'd been drilled.","","On the nearest Wardensea ship's quarterdeck, an officer stood with a long-glass, scanning the harbor. White coat. A single stripe on the shoulder. She swept the glass across the merchant berths, the independent docks, the departure flags. Cataloging. Every ship that was loading for a southbound run, noted.","","Two grey-uniforms on the dock below her were stopping a departing crew \u2014 four people carrying supplies toward a berth. Papers checked. Cargo examined. The inspection was polite and thorough and the crew waited through it with the rigid patience of people who understood that arguing made it longer.","","\"Wardensea,\" said a voice at your elbow.","","You looked down. The speaker was a boy \u2014 the same ink-fingered kid from the bounty board yesterday, or his twin. Barefoot, wiry, chewing a strip of dried fish. He'd materialized beside you with the automatic stealth of someone who'd grown up on docks.","","\"You were staring. Don't stare at the \u2014 white coats don't like it when you stare. They notice.\" He bit off another piece of fish, talked through it. \"Three ships this rotation. Four? No, three. Wait. Might be four. The \u2014 doesn't matter. Commander Gress, she's the \u2014 the one up there, with the glass? She does this thing where she just \u2014\" He mimed sweeping a spyglass with his fish strip, lost his grip, caught it. \"She logs every crew heading south. Like, every one. Bounty above zero, she's got your name. Zero, she's wondering what you're hiding. It's \u2014 yeah. Don't stare.\"","","He looked up at you. The horns didn't bother him. He'd been born on a dock where everything came through.","","\"You don't have a bounty yet, do you.\"","","Not a question. The coat, the boots, the aimless walking. Nobody with a bounty walked Selvaggio's docks alone and directionless.","","\"That'll change if you ring the bell. The second you clear the harbor on a southbound heading, you're in the system. Wardensea starts a file. Bounty starts at zero but it doesn't stay there.\"","","He pointed at the bounty board, visible from here as a patch of color on the jetty wall.","","\"Every name on that board started right where you're standing. No crew, no ship, no number. Just a dock and a direction.\"","","He finished his fish, wiped his hands on his trousers, and squinted up at you one more time.","","\"The Anchor's Rest. Departure Row. That's where the crews form. You're running out of time to stand here \u2014 the next departure wave is six days out and the good berths go fast.\"","","He was gone before you could decide whether to nod or not. Dock kids. Fast-talking, fast-moving, and they knew Selvaggio the way you knew the highland trails \u2014 by muscle memory.","","*page_break","","The sun hit its peak and the dock became a furnace.","","You found shade under an awning where a Varrek woman was selling charts \u2014 actual navigation maps, hand-drawn on cured skin, priced in denominations that made your twelve coins a joke. She sat behind her table with the posture of someone who had not moved in hours and did not intend to. Thin, grey-haired, spectacles pushed up on her forehead, surrounded by tubes of rolled charts.","","She didn't look up when your shadow fell across her table.","","\"If you can't afford them, don't touch them.\"","","Reasonable. You didn't touch them. But you looked. The charts were detailed \u2014 coastlines, depth markings, current arrows, reef boundaries. Handwritten notes in small precise script. One chart was labeled in a language you didn't recognize.","","\"That one's Silverborn script,\" the Varrek said, still not looking up. \"Decorative. The actual navigation data is \u2014\" She stopped. Pulled the chart closer. Adjusted her spectacles. \"No. That one's Kolmari commercial notation. I mislabeled it.\" She pulled a pen from behind her ear and scratched out something in the corner. \"Two Gold Sovereigns for the Kingsrun entry charts \u2014 stops one through three. Five Gold for one through six. Fifteen for the full run, but nobody buys the full run because nobody makes the full run.\"","","Two Gold Sovereigns. You had twelve copper coins. The currency converted at approximately one Gold to two hundred copper. The chart she was offering cost more than everything you'd earned in the last year of highland life combined.","","\"The Wardensea sells outdated charts at the port authority for twenty coppers,\" she said. \"They're accurate to within five years and two degrees of drift. Most crews use them. The ones who survive use mine.\"","","She finally looked up. Adjusted her spectacles. Took you in \u2014 the whole of you, head to heavy boots, with the analytical attention of someone who measured the world for a living.","","\"Highland Oni. Alone. Copper-poor. Heading south.\" She said it like reading a chart \u2014 facts, no judgment. \"You'll need a navigator more than you need my charts. Good navigator makes charts secondary. Bad navigator makes charts useless.\"","","She went back to her work. Conversation over. You'd been dismissed by a woman a third your size who sold paper for a living and was entirely right about everything she'd said.","","The shade was good. The harbor rhythm was becoming legible \u2014 Wardensea patrols on a ninety-minute rotation, dock enforcers checking berths at irregular intervals, loading crews shifting with the tide. The pattern underneath the chaos.","","Six days until the next departure wave. Six days to find a crew, find a ship, and earn the right to ring a bell.","","You pushed off the awning and headed east.","","*goto_scene ch1_selvaggio_departure_row",""], "labels":{"after_dock_conflict":195}},
"ch1_selvaggio_departure_row": {"crc":342010176, "lines":["*comment ===================================================","*comment  CHAPTER 1: SELVAGGIO \u2014 \"The Gate\"","*comment  Scene 3: Departure Row","*comment  Crew recruitment begins. 3 potential crew members met.","*comment  Grimoire broadcast shows the wider world.","*comment  The famous CG crews are ALREADY GONE \u2014 the MC is late.","*comment  3 real choices. Zero fake choices.","*comment ===================================================","","Departure Row in the evening was a recruitment market wearing the skin of a bar district.","","The twelve taverns ran shoulder to shoulder along the harbor's east wall, built from the same salt-bleached timber as everything else at Selvaggio. Each had a name painted above the door. The Anchor's Rest. The Broken Compass. Galluun's Daughter. The Last Sovereign. Most of the names were aspirational or morbid or both.","","The crowd outside was a species unto itself \u2014 crew-seekers, the boy at the bounty board had called them. People who'd come to Selvaggio for the same reason you had, and who were now doing what people did when they needed something from strangers: standing in groups of two and three, talking too loud, drinking to loosen what couldn't be loosened any other way. Bragging. Lying. Sizing each other up and pretending they weren't.","","You pushed through the foot traffic. Pushed was literal \u2014 at your width, the street required people to move or be moved. Most moved. A Gorundai woman with arms thicker than your thighs held her ground on principle, looked up, and gave you a nod that was half greeting and half challenge. You returned it. She went back to her conversation.","","The Anchor's Rest was the largest of the twelve, and the most crowded. The door was propped open with what looked like a cannonball but was probably a counterweight from a broken dock crane. Someone had drawn a face on it in chalk.","","Inside. Warm. Loud. A man at the near table was arm-wrestling a woman twice his age and losing in a way that suggested money was involved. Lanterns on chains. A bar along the left wall, three people deep. The servers \u2014 two human women and one Rathai man \u2014 navigated by collision memory, and the Rathai was winning. He carried four plates at shoulder height and hadn't spilled on anyone in years, if you believed the tally scratched into the doorframe. Below the tally, in different handwriting: [i]liar[/i].","","And on the far wall, the crew board.","","It was bigger than the bounty board on the jetty. Eight feet tall, twelve feet wide, covered in pinned paper. Each sheet was a posting \u2014 a ship's name, positions needed, pay offered, departure date. Some sheets were fresh, ink still wet. Some were yellowed and curling, the ships they described long gone or long sunk.","","[i]REQUIEM \u2014 Navigator, 2 fighters, cook. Pay: shares. Departing 6th. Captain Helvaan. Ask at bar.[/i]","","[i]SALT PROMISE \u2014 Engineer (Rathai preferred). Pay: 40 Sovereigns/month + shares. See Vorreth, corner table.[/i]","","[i]NAMELESS (working title) \u2014 Full crew needed. Captain has ship, plan, and ambition. Lacks everything else. First round's on me.[/i]","","You read the board. Most of the postings were for berths on established crews \u2014 positions opening because someone quit, got hurt, or didn't come back. A few were new crews forming from scratch, like you'd need. Those postings were easy to spot because they promised more and offered less.","","The room noticed you while you read. A woman at the bar lifted her cup to cover the look. A man at a corner table turned his head too late to pretend he hadn't. The horns caught the lantern light, and the storm-leather coat was highland gear in a room full of maritime dressing. Someone near the door whispered something, and someone else laughed, and the laugh had the particular pitch of nervousness pretending to be amusement.","","A server passed behind you \u2014 the Rathai man, carrying four plates at shoulder height, weaving between a chair and your coat. He miscalculated. Your coat was wider than whatever had been standing here before. One plate clipped the leather and he caught it without looking, redistributing all four in a motion so practiced it was almost a dance. Almost. One piece of bread slid off a plate and landed on your boot.","","\"Board's best before midnight,\" he said without slowing down, retrieving the bread from your boot on the way past. \"After that, the desperate postings go up and you don't want those.\"","","*page_break","","You found a space at the bar. The stools were human-sized and your weight would have made the question academic \u2014 you stood instead, and the bar's edge hit you mid-thigh, and the two people on either side leaned away by an inch each. Geometry.","","The bartender was a woman in her fifties, human, with hands that had been pouring drinks for long enough that the motion was part of her breathing. She looked at you, looked at the horns, and reached for a specific bottle without asking.","","\"Storm tea?\"","","Highland drink. She'd served Oni before.","","You shook your head. You wanted something cheaper. She poured something amber from a different bottle.","","\"Four coppers.\"","","*if (sovereigns >= 4)","  *set sovereigns - 4","","You paid. The drink was rough and warm and tasted like someone had aged it in a boat hull, which they probably had. It was the best thing you'd had since the highlands.","","The bar gave you a vantage point. You could see the room \u2014 the crew board, the tables, the traffic between them. And you could see the people who were here for the same reason you were: alone, watching, calculating.","","Three of them caught your attention.","","The first was at a table near the crew board, sitting alone with a Grimoire device propped against a cup. Rathai. Female. Small \u2014 four foot something, which was standard. Her hands were moving while she read, not nervously but mechanically, like her fingers were testing invisible joints. A tool harness hung over the back of her chair. Her Grimoire was better than the cheap limestone ones on the docks \u2014 darker stone, basalt maybe, with a clean glow.","","Her eyes were on the Grimoire, not the crew board \u2014 shaking her head at it, muttering numbers that didn't match the drink prices.","","The second was at the bar, six seats down from you. Human. Male. Big \u2014 not Oni-big, but the kind of big that came from years of lifting things heavier than himself. Broad face, sun-dark skin, a scar across his left eyebrow that had healed crooked. He was eating. Specifically, he was eating his third plate of food since you'd arrived, which had been four minutes ago. Each plate was different. He was tasting, not gorging \u2014 taking a bite, considering it, adjusting something in a small leather notebook he kept beside his elbow.","","A cook. You could tell the way you could tell a fighter from a dock worker \u2014 not by what they carried but by how they paid attention. Fighters watched hands. Cooks watched plates.","","The third was harder to spot because she didn't want to be spotted. A woman at the back wall, in the shadow between two lanterns. Tall for a human \u2014 five-ten, maybe more. Dark hair pulled back tight. Lean, angular, the kind of build that suggested speed over strength. She wore a long coat \u2014 not highland, not Wardensea white, something between. Dark blue, well-made, with a collar turned up despite the heat.","","She was watching the room the way you were watching the room. Cataloging. Not the crew board \u2014 the people. Her gaze moved from table to table, paused, moved on. When it reached you, it stopped for half a second. Then moved on. You'd been filed.","","*page_break","","The Grimoire behind the bar \u2014 the bartender's, mounted on the wall above the bottles \u2014 was playing a broadcast. Low volume, competing with the room noise, but close enough to hear from your position.","","The voice was male, confident, built for an audience.","","\"\u2014and that brings us to this week's Kingsrun update. Let's talk about the crews that matter, because let's be honest, that's why you're listening.\"","","A few heads at the bar turned toward the sound. The broadcast was a familiar ritual, apparently. The bartender turned it up a notch.","","\"First: Gannet Crew. Tomoe Gallacs, 680 million, and if you haven't seen the Brannach footage, what are you doing with your life? She put three Wardensea Commandants on their backs in eleven seconds. Eleven. I've timed it. That Vision of hers \u2014 four seconds of future-sight, and she uses every fraction. Mid-Kingsrun now, pushing toward the fortress. My odds: she makes it past Ossengaard. Barely.\"","","Someone at a table near the bar pounded it once. Agreement or excitement \u2014 the line blurred at Selvaggio.","","\"Second: Deshanni Reapers. Mavrokka Deshaan, 520 million. Deep Kingsrun. DEEP. Further south than any other rookie crew in the last fifteen years. I've said it before, I'll say it again \u2014 that woman fights like the ocean personally insulted her family. Last broadcast was the storm clip. 900 million views. The clip where she's laughing? While her ship is taking water? While her first mate is trying to steer through a sixty-foot swell? She's LAUGHING. I love her. I fear for her crew.\"","","You listened. Mavrokka Deshaan. Oni. 520 million. The name was on the bounty board outside, and now it was in your ears, and the gap between her and you was the distance between someone the world argued about and someone the world hadn't noticed.","","\"Third: The Kindling. Suuba Mettani, 275 million. Set the ocean on fire. That's it. That's the pitch. Rathai captain with a combustion Fruit and the anger of an entire underclass. She's early Kingsrun, moving fast, and the Inheritors are trailing her at distance. If those two crews collide, I want front-row Grimoire coverage.\"","","The broadcast kept listing. More names, more numbers, more opinions delivered with the certainty of someone who'd never sailed past Selvaggio's harbor mouth. The room listened and argued and added their own analysis, and the noise climbed, and the crew board on the far wall waited with its pinned papers and its promises.","","Every name on that broadcast had started here. At Selvaggio. At Departure Row. At a bar like this one, reading a board like that one, with nothing but a direction and the conviction that they were different from the ones who didn't come back.","","*page_break","","The Rathai woman at the crew board table solved the problem of introduction by introducing herself.","","You'd been watching the room for twenty minutes. She'd been watching you watch the room for ten. When she stood up, she didn't come to you \u2014 she walked to the crew board, pulled a pin from one of the postings, read it, put it back, and then turned around in a way that made standing next to you look like an accident.","","\"That board is ninety percent garbage,\" she said. \"Half the ships listed have already left. A quarter of the captains don't exist \u2014 people post fake crews to inflate departure numbers for the betting board. The remaining quarter are real, and of those, maybe six ships are worth the wood they're built from.\"","","She talked fast. Rathai-fast. The sentences ran into each other with the confidence of someone who processed information at a speed the rest of the world found inconvenient.","","\"I'm Kessara Veldt. Engineer. Former Nettleworks assembly \u2014 you know what, you don't care about Nettleworks. Gannavar dockyards, three years. I broke a supervisor's Grimoire over his head because he docked my pay for \u2014 it's a long story. Short version: I fixed his mistake, he punished me for it, the Grimoire was the closest heavy object.\" She took a breath. \"Charges dropped. Contract voided. I'm not great at the middle part of introductions.\" She looked up at you. She had to tilt her head significantly. \"You've been standing at that bar for twenty minutes and you haven't talked to anyone. Either you're shy, which I doubt because shy people don't walk into a room shaped like that \u2014\" she gestured at the entirety of you, horns to boots \"\u2014 or you're choosing. Which means you have standards. I like standards.\"","","She stuck out her hand. It barely reached your belt line.","","\"I need a ship. You need a crew. If you're heading south, I can keep whatever you're sailing in one piece past the reefs and probably past the deep water if the hull's not already rotting. If you're not heading south, I'm wasting both our time, and I've got three more bars to hit tonight.\"","","The cook down the bar had stopped writing in his notebook. He was listening. Not obviously \u2014 his eyes were on his plate. But his fork had paused, and that pause said more than looking would have.","","The woman at the back wall was still in her shadow. Still watching. She hadn't moved since you'd walked in.","","*choice","  #Take her hand.","    Her grip was stronger than her size suggested. Mechanical hands \u2014 the kind that turned wrenches and held tension lines and knew the difference between tight-enough and too-tight by feel.","","    \"Merdou Akkan,\" Kessara said, reading the permit sticking out of your coat pocket. She'd clocked it minutes ago. \"Highland name. No crew listed on the permit, no ship, arrived yesterday on a cargo hauler. I asked the dock kid \u2014 he talks to everyone. So you're building from scratch.\"","","    *set crew3_exists true","    *set crew3_name \"Kessara Veldt\"","    *set crew3_race \"rathai\"","    *set crew3_role \"Engineer\"","    *set crew3_loyalty 15","    *set crew3_trust \"known\"","    *set crew_count 1","    She pulled a stool from a nearby table, climbed onto it, and was suddenly at chest height instead of belt height. A practiced maneuver \u2014 the stool was already positioned within reach.","","    \"Here's what I know. There are four ships at Selvaggio right now that could make the Kingsrun and don't have captains. Two of them are impound releases the Wardensea auctioned last week \u2014 cheap, damaged, fixable. One is a private sale, owner wants out, priced too high for anyone without Kolmari credit. The fourth is sitting in the north harbor under a name nobody recognizes, and the dock kid says it hasn't moved in six months.\"","","    She tapped the bar. \"I can fix a ship. What I can't do is captain one. You look like a captain.\"","","    \"He looks like a wall somebody dressed in a coat,\" said a voice from six seats down.","","    The cook. He'd given up pretending not to listen. He was turned on his stool, plate forgotten, the leather notebook closed under one hand. Up close, the scar across his eyebrow was newer than it looked \u2014 weeks, not years.","","    \"Terrek Ghaal,\" he said. \"Cook. And \u2014 yes, Gorundai, before you ask. No tusks, no green. I know. I look human. Both parents were Gorundai, Kethrun mining district, but the bloodline came out \u2014\" He gestured at his own face. \"This. I got the appetite and the volume, not the jaw. I have this speech memorized. I hate this speech.\" He grinned anyway \u2014 wide and crooked and belonging to a face that grinned whether the situation called for it or not. \"Six months at Selvaggio. Three crews, all fell apart before departure. I keep cooking and people keep leaving. Beginning to take it personally.\"","","    *set crew4_exists true","    *set crew4_name \"Terrek Ghaal\"","    *set crew4_race \"gorundai\"","    *set crew4_role \"Cook\"","    *set crew4_loyalty 10","    *set crew4_trust \"stranger\"","    *set crew_count 2","    He looked at Kessara. Looked at you. Did the math the same way everyone at Selvaggio did \u2014 fast, practical, and out loud.","","    \"An engineer and a cook. That's a maintenance crew, not a ship. You need a navigator, at least one fighter, and someone who knows what a Wardensea inspection looks like from the other side of the clipboard.\"","","    Kessara pointed at him with her fork \u2014 she'd taken it from his plate. \"He's right. But we also need a captain who can sit at a table and make people take him seriously, and I think we've got that covered.\"","","    She looked up at you. Ram horns, black mane, storm-leather coat, ash-white skin. Six foot seven of highland exile filling the space between two lanterns.","","    \"Yeah. We've got that covered.\"","","    *goto end_of_scene","","  #Don't take her hand. Not yet. You don't hire the first person who walks up.","    You looked at her hand. Looked at her. The tool harness. The basalt Grimoire. The speed of someone who'd learned to make decisions in the time it took slower people to frame the question.","","    Your hand stayed at your side.","","    *set personality_openness %- 5","    *set personality_loyalty %+ 5","    Kessara Veldt withdrew her hand without offense. She'd been rejected before. Probably today.","","    \"Fair enough. Offer stands. I'll be here until midnight, then I'm at the Broken Compass, then I'm at Galluun's Daughter, and if I haven't found a ship by dawn I'm reconsidering my life choices.\" She paused. \"I'm not reconsidering my life choices. I'll be back here tomorrow.\"","","    She returned to her table. The Grimoire went back up. The muttering resumed.","","    The cook down the bar was watching you openly now. He'd given up on subtlety.","","    \"Smart,\" he said. \"Don't take the first offer. That's a \u2014\" He stopped. \"I was going to say 'captain's instinct' but that sounded like I was flattering you. I was flattering you. I'm not subtle.\" He turned back to his plate, then turned back. \"Terrek Ghaal. Cook. I've done the Selvaggio pitch three times already and I'm tired of the pitch, so.\"","","    He didn't offer his hand. He nudged his plate \u2014 a skewer of something glazed and sharp-smelling \u2014 toward your end of the bar.","","    \"Just try it. If you like it, we can talk. If you don't \u2014\" He paused. \"Actually, if you don't like it, don't tell me. I'm fragile about the glaze.\"","","    The food was good. Better than good. The glaze had heat to it \u2014 not the blunt assault of the dock cart sauce, but a layered burn that arrived in stages, each one a different spice. The meat was tender and the char was deliberate.","","    He watched you eat it the way an engineer watched a machine run \u2014 checking for the reaction, not the compliment.","","    *goto end_of_scene","","  #Walk past her to the woman in the shadows. The one who's been watching the room like she owns it.","    You left Kessara Veldt with her hand extended and walked toward the back wall.","","    *set personality_aggression %+ 3","    *set personality_openness %+ 5","    The room was between you and the shadow-woman, and the room didn't want to move. You moved it. Shoulders turned. Chairs scraped. A server with a tray pivoted, cursed, and kept going. The path you cut through the Anchor's Rest was the path of someone who'd grown up in spaces where size was a language and you were fluent.","","    The woman in the dark blue coat watched you come. She didn't stand. Didn't reach for anything. Didn't adjust her position. She sat with her back to the wall and her hands visible on the table and let you arrive.","","    Up close, she was older than you'd estimated. Early thirties. The dark hair pulled back showed a face that was sharp at the cheekbones and jaw, with eyes that were either dark brown or black depending on the light. A scar \u2014 thin, precise, surgical or deliberate \u2014 ran from her left ear to the corner of her jaw. Old. Displayed. The collar of her coat was turned up, but not high enough to hide it.","","    She looked at you the way the Varrek chart seller had looked at you. Reading.","","    \"Sit down,\" she said. \"Or don't. But you came over here for a reason, and standing over me doesn't tell me what it is.\"","","    Her voice was even. Controlled. The accent was Caldruun coast with something underneath it, older, from somewhere she'd left behind.","","    You sat. The chair protested. You'd gotten used to that.","","    \"I've been watching you since you walked in,\" she said. \"You read the board. You didn't post. You didn't approach anyone. You stood at the bar and watched the room. That's not what the desperate ones do. The desperate ones grab the first berth on the board and pray. You're choosing.\"","","    She leaned forward. Fractionally.","","    \"Sullavenne Ohn.\" She said it like a rank and serial number. Paused. Something shifted in her jaw. \"I'm not looking for a berth. I've had berths. I'm looking for a \u2014\" She stopped. Started again. \"What I need is \u2014 a crew that doesn't \u2014 no.\" She pressed two fingers against the bridge of her nose. \"I had this. I had the words for this an hour ago. A crew that's worth the walk south. That's what I \u2014 that sounded rehearsed. It was rehearsed. I've been sitting here for two weeks rehearsing it and it still came out wrong.\"","","    The scar caught the lantern light. Her hands were still on the table. Long fingers, no calluses \u2014 not a laborer, not an engineer. Not a cook. Something else.","","    \"I was Wardensea. Four years, Second Division, Lieutenant grade. Left on my own terms, which means I have a discharge paper that says 'voluntary separation' and a commander who'd put me back in a cell if she thought I had something she wanted.\" She said it flat. No pride, no bitterness. A fact, like the chart seller's facts. \"I know how the white coats operate. Patrol schedules, inspection protocols, what makes them flag a ship and what makes them wave one through. That's what I'm offering.\"","","    Behind you, Kessara Veldt had withdrawn her hand and was watching from her table. The cook had stopped eating. The room kept moving, but this corner of it had gone still.","","    \"The question,\" Sullavenne said, \"is what you're offering.\"","","    *set personality_openness %+ 5","","    *goto end_of_scene","","*label end_of_scene","*page_break","","The night deepened. The Grimoire on the wall played another broadcast \u2014 Wardensea update. Three-ship patrol heading south in the morning. Commander Gress running sweep duty. Every departing crew logged. The bar went quieter for that one.","","At the bar's far end, a man sat alone with a drink he wasn't touching. A tattoo on his forearm \u2014 a ship's name, crossed out. Below it, another ship's name, also crossed out. Below that, a third, uncrossed. The third name was faded. The ship was gone. He was still here.","","You set your cup down. Six days until the departure wave.","","Tomorrow. Ship. Crew. The next step toward the bell.","","*goto_scene ch1_selvaggio_first_night",""], "labels":{"end_of_scene":226}},
"ch1_selvaggio_first_night": {"crc":2130549044, "lines":["*comment ===================================================","*comment  CHAPTER 1: SELVAGGIO \u2014 \"The Gate\"","*comment  Scene 4: First Night","*comment  World terms introduced: God Fruit (shown via water","*comment  weakness + Gambit conditions), Conqueror (in passing)","*comment  Quiet scene. Character bonding. Gambit encounter.","*comment  Branches based on who MC recruited in Departure Row.","*comment  2-3 real choices. Zero fake choices.","*comment ===================================================","","Selvaggio after midnight was a different country.","","The dock lanterns dimmed to half-light, oil conserved for morning. The crowd thinned to its residue \u2014 the dedicated drinkers, the night-shift dock workers, the people with nowhere to sleep and no money to change that. The harbor water went black and still. The ships became shapes without detail, masts like stripped trees against a sky that held no stars \u2014 the overcast hadn't broken in days.","","The air cooled. Not highland-cold \u2014 Selvaggio never got cold, not really \u2014 but enough that the sweat dried on your skin and the storm-leather coat earned its weight. The dock planking was slick with condensation. The smell shifted: less fish oil, more salt. The ocean asserting itself over the human noise.","","*if (crew_count > 0)","  You weren't alone.","","  *if (crew3_name = \"Kessara Veldt\")","    Kessara Veldt walked beside you, or rather below and ahead of you, her stride covering ground at double-time to match yours. She hadn't stopped talking since you'd left the Anchor's Rest, but the quality of the talking had changed. In the tavern, she'd been performing \u2014 the pitch, the resume, the engineered introduction. Out here, on the empty dock, she was thinking out loud.","","    \"The two Wardensea impound releases are our best bet. Seized from a \u2014 Kolmari loan default, the ships are collateral.\" She was walking and talking and the words were tripping over each other. \"They'll be damaged. The Wardensea doesn't maintain seized vessels because \u2014 I mean, why would they, the budget goes to patrols. But damaged I can fix. Damaged is what I do. It's literally the only thing I do.\"","","    She tapped her tool harness. The metal clinked.","","    \"The question is whether we can afford the auction price. Impound releases go for thirty to sixty Gold Sovereigns depending on condition. We don't have that.\"","","    She looked up at you. In the half-light, her features were sharper \u2014 the Rathai bone structure, all angles.","","    \"How much do you have? In total. Don't round up.\"","","    *if (sovereigns < 12)","      The number was embarrassing. She did the conversion in her head \u2014 copper to Gold \u2014 and the silence that followed was the silence of someone recalculating a plan they'd just built.","","      \"Okay,\" she said. \"Okay. So we can't buy a ship. That narrows it.\"","    *if (sovereigns >= 12)","      Twelve coppers. She did the conversion and said nothing for four full seconds, which for a Rathai was an eternity.","","      \"Okay. So we can't buy a ship. That's clear.\"","","    *if (crew4_name = \"Terrek Ghaal\")","      Terrek walked on your other side. He moved quietly for a big man \u2014 not stealthy, just comfortable in silence. His leather notebook was in his hand, and he was writing in it by the light of a Grimoire he'd borrowed from Kessara. The stylus moved in small, precise strokes.","","      \"I've got forty Sovereigns saved,\" he said, without looking up. \"Six months of cooking at Selvaggio. Two Gold and change. It's yours if this is real.\"","","      Kessara looked at him sideways. \"You'd put your savings into a crew you met an hour ago?\"","","      \"I've put my savings into three crews I met an hour ago. All three times I told myself 'this is stupid' and did it anyway because the alternative was cooking for dock workers until I died here.\" He closed the notebook. \"So yes, it's stupid. My money's on the wall.\"","","      He meant you. It took a second to realize that.","    *goto night_walk","","*if (crew_count = 0)","  You were alone.","","  The dock was yours. At this hour, nobody contested the space \u2014 the night workers were concentrated on the main jetty, loading a trade vessel by torchlight, and the rest of the harbor slept or pretended to. Your boots made a sound on the wet planking that would have been lost in the daytime crowd. Now it was the loudest thing within fifty feet.","","  Alone was familiar. The highlands after the exile had been alone \u2014 the walk south, the mountain trail to the Caldruun lowlands, the road to the coast, the cargo hauler where you'd slept among rope coils because the crew didn't want you below decks.","","  But alone didn't build a crew. And alone didn't sail a ship.","","  *goto night_walk","","*label night_walk","","The dock curved south. Past the berths, past the closed market stalls, toward the stone seawall where the harbor met the open water.","","Ahead, where the dock widened into a small plaza between two warehouses, a crowd had gathered. Twenty, maybe thirty people in a loose circle. The light was wrong \u2014 not lantern-light. Steadier. Bluer. Casting hard shadows that didn't flicker. These people were watching something.","","You moved closer. The crowd noticed you \u2014 at your height and width, you entered any gathering like a weather event \u2014 but they didn't react beyond the usual adjustment. Space opened. You could see.","","The center of the circle was a table. Stone-topped, low, the kind used for dock trades. On it: three cups, inverted. A man sat behind the table on a crate. He was thin, medium height, with the nondescript look of someone who'd cultivated nondescriptness \u2014 brown hair, plain clothes, a face you'd forget between seeing it and describing it. His hands rested on the table's edge. Still.","","Across from him, a woman was choosing. Her hand hovered over the three cups. She was Gorundai \u2014 big, green-skinned, with the focused expression of someone who'd been told the stakes.","","\"Middle,\" she said.","","The man lifted the middle cup. Empty. The crowd exhaled.","","\"Left,\" the man said. He lifted the left cup. A stone sat underneath \u2014 small, round, polished black. Worth something, by the way people leaned in.","","The Gorundai woman swore. She put coins on the table \u2014 ten, twelve, you couldn't count \u2014 and stepped back into the crowd. Someone else moved forward. A human, young, nervous. He put his coins down.","","The man behind the table set the cups again. Three cups, one stone. His hands moved \u2014 not fast, not slow. Precise. The cups shifted positions on the stone surface in a pattern that should have been trackable.","","Should have been. Your eyes tracked the stone to the right cup. Stayed there.","","The young man chose the right cup. The man lifted it. Empty.","","The stone was under the left cup.","","You'd watched the hands. The hands hadn't cheated. The cups had moved exactly where you'd tracked them. And the stone was in the wrong place.","","*page_break","","The game continued. Three more players. Three more losses. The man behind the table collected coins with the same unhurried precision he used to move the cups. Nobody won. Nobody came close.","","The crowd didn't thin. If anything, it grew. People came to lose money and stayed to understand why they'd lost. The man didn't smile, didn't taunt, didn't engage. He set cups. He moved cups. He collected money. The blue-tinted light came from a device mounted on the table's edge \u2014 a modified Grimoire, broadcasting the game to whoever was watching from elsewhere. The man had an audience beyond the dock.","","Then something happened.","","A man in the crowd \u2014 human, stocky, drunk enough to be loud but not drunk enough to be inaccurate \u2014 pushed forward. He didn't put coins down. He put his hand on the table.","","\"You're cheating.\"","","The thin man looked at him. The nondescript face was patient.","","\"Everyone can see it,\" the drunk said. \"The cups don't move right. Something's wrong with the table.\"","","\"The table is stone.\"","","\"Something's wrong with the GAME.\"","","The drunk reached for the cups. His hand got within six inches and then he stopped. Not because he decided to \u2014 because his hand stopped. His arm locked at the elbow, fingers still extended, and the momentum of his reach carried his body forward into the table's edge. He hit it and grunted and his hand stayed where it was, frozen, six inches from the cups.","","The crowd went quiet.","","The drunk stared at his own arm. Tried to push forward. His arm didn't move. Tried to pull back. His arm cooperated \u2014 he stumbled backward, free, his hand his own again.","","\"Don't touch the table.\" The thin man sighed, like this was the fourth time tonight. \"I should put up a sign. House rule.\"","","The drunk's face went that particular shade of confused that preceded either a fight or a retreat. He chose retreat. He backed into the crowd and the crowd let him go and the game resumed as if nothing had happened.","","But something had happened. The drunk's arm hadn't stopped because of a physical barrier. There was nothing between his hand and the cups \u2014 no glass, no wire, no mechanism. His arm had stopped because a rule said it would.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara, standing somewhere near your hip, let out a breath.","","  \"That's Goltieri.\"","","  She said it quietly. The name again \u2014 the name on the crates, on the dock columns, on the enforcer's bell pin.","","  \"God Fruit,\" she said. \"There's a man named Dessaren Goltieri who runs this port. He ate something called a Gambit Fruit \u2014 Law-type. Sets conditions. Rules that the world enforces whether you agree to them or not.\" She gestured at the table, the cups, the thin man's unhurried hands. \"That game operator didn't stop the drunk's arm. He can't. He's just a hustler. But Goltieri's conditions blanket this entire port district \u2014 'don't touch what isn't yours,' or something close. The thin man built his game around it. He knows where the invisible walls are. Everyone else pays to find out.\"","","  She looked up at you. \"There are maybe a hundred and forty of these Fruits in the world. The people who eat them become \u2014 well. You've heard the bounty numbers.\"","","  She paused. Considered.","","  \"There's a cost. The Fruit takes the ocean from you. Eat one and seawater kills you \u2014 deeper than your chest and you drown. No fighting it, no exceptions. On a Kingsrun crew, that means your strongest fighter can't survive falling overboard.\" She watched the thin man reset his cups. \"Goltieri controls the docks from somewhere we'll never see. And this man makes a living off the leftovers.\"","","  *goto gambit_choice","","*if (crew_count = 0)","  You watched the drunk stumble back. You watched the thin man reset his cups. You watched the game continue as if the world hadn't just bent.","","  The highland elders had spoken of this. A person, somewhere, who'd eaten something \u2014 a fruit, grown from a tree that no longer existed \u2014 and gained the ability to write rules into the world itself. The cost was the ocean. The old stories said the fruit took the water from you. Touch the sea and die.","","  The highlands had called it legend. The kind of thing the elders told children to explain why the world was dangerous.","","  The drunk's arm hadn't stopped because of the thin man. The thin man was a hustler with cups and a stone. But someone \u2014 the name on the crates, the name the dock workers whispered, the name that owned the fear \u2014 had written rules into this port. The thin man had learned where the rules were and built a game inside them.","","  Real. Here. Selvaggio. And someone owned it in a way that went deeper than money.","","  *goto gambit_choice","","*label gambit_choice","","The thin man finished another round. Another loss for the player. He collected coins, reset cups, and looked up.","","His gaze swept the crowd. Found you. Stayed.","","He didn't flinch at the horns or the height. He looked at you the way the Varrek chart seller had looked at you \u2014 measuring, but for a different value. Something past the size.","","\"You,\" he said. \"Highland. Want to play?\"","","The crowd turned. Thirty pairs of eyes on you. The blue-tinted Grimoire light caught the ram horns and the ash-white skin and the open storm-leather coat, and you were suddenly aware that whatever this broadcast was reaching, you were now on it.","","The thin man's hands rested on the table. Three cups. One stone.","","*choice","  #Sit down. You've been watching long enough. Time to learn something.","    You stepped through the crowd. The circle opened. The crate across from the thin man was too small for you \u2014 you sat on it and the wood protested and your knees were higher than the table. The geometry was absurd. Six-seven of highland exile folded over a dock table across from a man who could stop your arm with a thought.","","    *set personality_aggression %+ 5","    *if (sovereigns >= 4)","      *set sovereigns - 4","    You put your coins down. Four coppers. The thin man looked at the stake and something moved behind his eyes \u2014 not contempt, recognition. He'd seen broke players before. He'd been one.","","    \"Rules are simple,\" he said. \"Three cups. One stone. Find the stone, you double your money. Miss it, I keep it.\"","","    He set the cups. His hands moved. You watched.","","    This time, you didn't try to track the stone. You watched his face. The highland elders had a saying about bouts: *watch the body, not the fists. The body tells you where the fists are going.* The same principle applied here. The cups were the fists. The thin man's face was the body.","","    His eyes didn't move. They stayed fixed on you. But at the moment the cups stopped \u2014 the fraction of a second when the game was decided \u2014 his left hand twitched. Away from one cup. The tell was in the avoidance.","","    You tapped the middle cup. Not because you'd tracked the stone. Because his hand had told you where it wasn't.","","    The thin man lifted the middle cup. The stone sat underneath.","","    The crowd made a sound \u2014 not a cheer, closer to a collective intake of breath. Nobody had won in the last twenty minutes.","","    The thin man's expression didn't change. He pushed eight coppers across the table.","","    *set sovereigns (sovereigns + 8)","    \"Once more?\"","","    You took the coppers and stood. The crate exhaled with relief.","","    \"Smart,\" the thin man said. The word covered more than the game \u2014 it covered walking away from a table where the house had the power to rearrange reality.","","    *set selvaggio_gambit_encountered true","    *goto after_gambit","","  #Walk away. The game is rigged by something you don't understand, and you don't bet what you can't afford to lose.","    You turned. The crowd parted \u2014 they always parted \u2014 and you walked back into the dark of the dock.","","    *set personality_loyalty %+ 5","    Behind you, the thin man said nothing. The game resumed. Someone else sat down. Someone else lost.","","    *set selvaggio_gambit_encountered false","    *goto after_gambit","","*label after_gambit","*page_break","","The hour was late. The dock was empty. The harbor water lapped at the pilings in a rhythm that wasn't sleep and wasn't silence \u2014 something between, the ocean breathing in its shallow rest.","","*if (crew_count > 0)","  *if (crew3_name = \"Kessara Veldt\")","    Kessara found a dry spot between two crates on the dock's edge, sat down, and produced a flatbread from somewhere in her harness. She broke it in half \u2014 not evenly, one piece was clearly bigger. She looked at both halves. Switched which hand held which. Offered the bigger piece upward, toward the general vicinity of your chest.","","    You took it. The bread was stale and cold and better than nothing.","","    She ate in silence for a while. Three times she opened her mouth to say something. Three times she closed it. The Rathai, who had not stopped talking for two consecutive hours, was apparently discovering that silence existed and didn't like it.","","    \"I left my warren when I was sixteen,\" she said. Not to you \u2014 to the water, or to the air, or to that quality of silence that exists between two people who've decided to trust each other with a version of their lives. \"Nettleworks factory. Assembly line. Seven Rathai in a row, hands moving, twelve hours a day, building manifold components for ships I'd never sail on. Paid in coppers. Fed in portions designed for Rathai appetites, which are smaller than human appetites, which the factory managers knew and used as justification for paying us less.\"","","    She tore her bread into smaller pieces. The hands that did it were the same hands that had shaken yours \u2014 mechanical, precise, working while the mind worked on something else.","","    \"I broke the supervisor's Grimoire because he docked my pay for catching a defect in the manifold casting that would have cracked under pressure at depth. I saved a ship. He docked my pay because I slowed the line.\" She ate a piece of bread. \"The union rep told me I was right. The dock master told me I was fired. Both of those things were true.\"","","    The harbor was quiet. The ships were shapes without names.","","    \"I came to Selvaggio because a ship is a machine and machines need engineers and the Kingsrun is where the machines go to find out what they're \u2014\" She stopped. Tore off another piece of bread. Chewed. \"I'm making it sound noble. It wasn't noble. I ran out of other places to go.\"","","    She looked up at you. The harbor reflected in her eyes \u2014 dim orange, broken by water.","","    \"Anyway. You're not a machine. But you've got that look. Like something needs fixing and you haven't found the right tool yet.\" She flicked bread crumb off her harness. \"I'm the right tool, by the way. In case that wasn't clear.\"","","  *if (crew4_name = \"Terrek Ghaal\")","    Terrek had disappeared during the cup game and reappeared with food. How he'd found food at this hour, in this part of the dock, remained between him and the dock. He set down a bowl \u2014 ceramic, chipped, borrowed or stolen from somewhere \u2014 containing something hot. Rice and fish and a sauce that smelled like smoke and ginger. He tasted it. His face did something complicated.","","    \"I burned the ginger. Pretend the bitterness is intentional.\"","","    He set it between you and whoever else was there, and sat down, and ate from his own bowl with the focused attention of someone who was testing the food and the company simultaneously.","","    \"My parents were both Gorundai,\" he said, between bites. \"Kethrun mining district. My mother cooked for the shift crews \u2014 four meals a day, dense, mineral-heavy, the kind of food that kept a miner upright through a twelve-hour dig. I inherited the appetite without the tusks. People think I'm a glutton. I'm just feeding a Gorundai metabolism in a human-passing body.\"","","    He looked at you.","","    \"I saw your ink. The unfinished tattoos. Skin-singer work, stopped mid-story.\" He didn't ask why the story had stopped. He was a cook \u2014 he understood that some things weren't ready to be served. \"My mother had forge-marks. The Kethrun miners get them \u2014 iron-dust scarring on the hands and forearms, earned in the fissures. She wore hers like other people wore jewelry. When she died, they burned her on a hill outside the village because the Caldruun was too far. My father lit the fire. It was raining. She'd have liked that.\"","","    He went back to his food. Ate three more bites before he realized he'd been holding his spoon wrong \u2014 handle turned backward, gripping it the way a child does. He adjusted without comment.","","*if (crew_count = 0)","  You found a spot on the seawall where the stone was dry and the view was open. The harbor spread below you \u2014 the ships, the water, the distant lanterns of Departure Row still burning where the last drinkers hadn't quit. The bronze bell at the harbor mouth was a shape in the dark, barely visible.","","  You sat. The stone was warm from the day. Your back found the wall and the storm-leather coat bunched behind you and you were, for the first time since arriving at Selvaggio, still.","","  The highland sky had been different. Stars, most nights. The volcanic haze made them tremble, but they were there \u2014 fixed points in a world that moved around them. Selvaggio's sky was a blank. No stars. No reference. Just cloud and the faint orange glow of a port that never fully slept reflected back from above.","","  The exile. The walk down. The cargo hauler. The checkpoint. The docks. The tavern. The names on the broadcast \u2014 Tomoe, Mavrokka, Suuba \u2014 people who'd been where you were standing and had turned it into something the world argued about.","","  Your hands rested on your knees. They were large hands. Oni hands \u2014 broad across the palm, thick at the knuckle, built for gripping. The unfinished tattoo lines ran down the left forearm and stopped. The skin-singer's needle had been mid-stroke when the clan elder entered the hall. After that, the needle hadn't touched skin again.","","  The First Bout. The unfinished lines on your forearm caught the dim light. The elder's hip had broken with a sound like green wood splitting. Your own Armoring \u2014 *kossk*, the bone-shell \u2014 had surged for the first time, unbidden, a dark sheen covering your fists in the half-second before impact. The elder on the ground. The silence of the festival crowd. Your mother's face.","","  Your hands closed on your knees, and the stone underneath you groaned, and if anyone had been watching, they'd have seen something \u2014 a flicker, dark and brief, across the knuckles of your right hand. There and gone. The ghost of a thing that wasn't ready yet.","","*page_break","","Dawn came in grey. The harbor resolved from black to the flat steel color of a sky with no intention of clearing. The dock woke in stages \u2014 night workers leaving, morning crews arriving, Grimoire broadcasts buzzing with weather and bounty updates.","","*if (crew_count > 0)","  *if (crew3_name = \"Kessara Veldt\")","    Kessara was awake before you. She'd been awake before dawn, apparently \u2014 her tool harness was reorganized, her Grimoire was showing a schematic of something you didn't recognize, and she was muttering measurements under her breath.","","    \"The impound auction is at noon,\" she said. \"North harbor, Wardensea dock authority. Two ships. I've pulled the registry specs \u2014 one's a modified sloop, thirty-eight feet, single mast. The other's a ketch, forty-four feet, double-masted, deeper draft. The sloop is faster. The ketch carries more. Both need work.\"","","    She looked up. Ready. She'd been ready since before you'd opened your eyes.","","  *if (crew4_name = \"Terrek Ghaal\")","    Terrek was cooking. You didn't know where he'd found a grill, but he'd found a grill \u2014 a flat piece of salvaged iron balanced on two dock bollards, heated by a fuel brick borrowed from a night-shift worker in exchange for a share of the result. The smell was eggs and some kind of cured meat and the warm-fat aroma that meant someone competent was making breakfast.","","    \"Five days,\" he said, flipping something with a salvaged fork. \"Five days until the departure wave. Today's the day for the ship. Tomorrow's the day for supplies. Day after that, loading and checks. Day after that, rest. Day after that, the bell.\"","","    He slid food onto a dock plank that was doing service as a plate.","","    \"Eat first. Everything else is harder on an empty stomach.\"","","*if (crew_count = 0)","  You woke stiff. The seawall was not a bed. Your neck had an opinion about sleeping against stone, and the opinion was detailed and unfavorable.","","  The harbor was moving. Morning crews. Departure flags. The first bell \u2014 not the Departure Bell, the dock shift bell \u2014 rang from the main jetty and the day began whether you were ready or not.","","  Five days. Five days until the departure wave. Today, you needed a ship. Tomorrow, a crew to put on it. Or today, a crew, and tomorrow, a ship. The order didn't matter as much as the urgency. Five days. After that, the next wave wouldn't come for a month, and a month at Selvaggio was how people became the old man at the bar with crossed-out tattoos on his arm.","","You stood. Selvaggio's morning hit you \u2014 the noise, the salt, the scale of a place that didn't care whether you'd slept or what you'd decided. The harbor churned. Ships loaded. The Wardensea patrol from last night's broadcast \u2014 Commander Gress's three ships \u2014 was already moving, white hulls cutting south through the harbor mouth toward the open ocean.","","They were heading where you were heading. They'd be there when you arrived. And they'd have a file with your name on it before you cleared the harbor.","","But first: a ship.","","*goto_scene ch1_selvaggio_crew_hunt",""], "labels":{"night_walk":64,"gambit_choice":156,"after_gambit":214}},
"ch1_selvaggio_crew_hunt": {"crc":-757655658, "lines":["*comment ===================================================","*comment  CHAPTER 1: SELVAGGIO \u2014 \"The Gate\"","*comment  Scene 5: Crew Hunt","*comment  Day 2-3. Urgency. Ship acquisition is the central","*comment  choice. Crew finalization. Possible fight scene.","*comment  Dominion flickers \u2014 something is waking.","*comment  3 real choices. Zero fake choices.","*comment ===================================================","","The Departure Bell rang at dawn.","","The sound carried across the harbor \u2014 bronze, heavy, final. One ring. Safe journey. A crew was leaving.","","A ship pulled away from the south berths. Single-masted, recently patched, crew of seven or eight working the deck with the focused energy of people who'd made a decision. The departure flag flew from the mast. The captain \u2014 human, young \u2014 stood at the bow with her hand raised. Farewell or defiance.","","The dock crowd watched. The fried-food vendor shook her head. \"Third one this week. Season's starting early.\"","","The ship cleared the harbor mouth. The bell's echo died. That crew had a ship, a plan, each other.","","You had four days.","","*page_break","","*if (crew_count > 0)","  *if (crew3_name = \"Kessara Veldt\")","    Kessara had a plan. She'd had a plan since before dawn \u2014 the Rathai apparently operated on three hours of sleep and unlimited spite.","","    \"Three options. Wait. Two.\" She held up three fingers, put one down, walking beside you at double-time. The tool harness clinked with each step. \"The third one was stupid, forget the third one. The Wardensea impound auction at noon \u2014 two seized ships, the sloop and the ketch I told you about. Or the north harbor berth, the one the dock kid mentioned. Ship that hasn't moved in six months.\"","","    She ticked them off.","","    \"The auction: we can't afford either ship outright. The sloop will go for thirty to fifty Gold Sovereigns. We have \u2014\" she looked at you. \"What Terrek offered plus whatever you're carrying. Call it two Gold and change. That's not enough for the auction. But it might be enough for a deposit if the Kolmari credit agent is working the sale. Fifteen percent interest, compounding quarterly. The debt follows you.\"","","    *if (crew4_name = \"Terrek Ghaal\")","      Terrek was walking on your other side. He'd produced food again \u2014 a flatbread roll, warm, eaten in methodical bites. \"Or we don't take the debt. I've cooked for Kolmari agents. They're \u2014 nice isn't the word. Polite. Very polite while they repossess your ship.\" He tore off a piece of bread. \"One of them left me a tip on the way out. While his colleague changed the locks.\"","","    \"The other option,\" Kessara continued, \"is the north harbor ship. Unclaimed. No auction, no credit. But there's a reason nobody's claimed it. The dock kid says the previous captain died three weeks ago \u2014 infection from a reef wound, nothing dramatic. Crew scattered. Ship's been sitting. The berth fees are piling up with Goltieri's dock authority, and eventually they'll seize it for the debt.\"","","    She paused. Recalculated.","","    \"If we can clear the berth debt \u2014 pay what the dead captain owed \u2014 the ship's ours by salvage claim. Harbor law. The dock authority would rather collect the fee than warehouse another rotting hull. The debt is probably twelve to fifteen Gold Sovereigns.\"","","    Still more than you had. The math hadn't changed. Broke was broke, regardless of the plan.","","    \"I know,\" she said, reading your silence. \"We need money. Or we need someone who owes us a favor. Or we need to find something worth trading.\"","","    *goto ship_hunt","","*if (crew_count = 0)","  You walked the harbor alone. The morning light was flat and grey and gave Selvaggio the look of a photograph \u2014 all detail, no warmth. Ships loaded. Crews shouted. The bell's sound still hung in the air like a bruise.","","  The dock kid found you before you found the dock kid.","","  He materialized at your elbow \u2014 barefoot, fish-strip in hand, already talking.","","  \"You're still here. Good. Most of the ones who don't find a crew the first night leave on the next cargo hauler north. You didn't leave. That's either stubborn or stupid and the difference doesn't matter yet.\"","","  He walked beside you, matching your stride with two of his own.","","  \"Ships. You need one. You can't buy one \u2014 a used sloop runs thirty to fifty Gold Sovereigns and you're carrying copper. So. Two options for someone broke. One: the Wardensea impound auction at noon. They auction seized ships. You won't win the bid but you might find someone to partner with who can. Two: the north harbor. Berth eleven. Ship called the Sundered Wake \u2014 previous captain died, crew scattered, berth fees stacking up. Goltieri's dock authority will seize it eventually. If someone pays the owed fees before they do, harbor salvage law says the ship's theirs.\"","","  He bit off a strip of fish.","","  \"The fees are twelve to fifteen Gold. You don't have that either. But the dock authority takes labor credit. Twenty days of hauling work converts to one Gold. Or \u2014\" he looked at you sideways \"\u2014 you could fight for it. The dock bouts. They run every other night behind the Anchor's Rest. Prize money. Nobody asks where the fighters come from. They just ask if you can stand back up.\"","","  He pointed east toward the harbor's curve.","","  \"North harbor, berth eleven. Go look at it. Then decide.\"","","  He was gone. You were alone again with a direction and no money.","","  *goto ship_hunt","","*label ship_hunt","","*page_break","","North harbor. Berth eleven.","","The ship sat in the water like a promise someone had broken and left behind.","","She was a ketch \u2014 double-masted, forty-odd feet from bowsprit to stern, with a hull that had once been painted blue and was now the color of salt and neglect. The sails were furled and greyed. Rope coiled on the deck in loose tangles that said nobody had cared for weeks. The berth lines were taut but fraying \u2014 a ship held in place by habit more than intention.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara saw the hull and stopped walking. Her hands went to her tool belt \u2014 reaching for a wrench before she realized she was still on the dock.","","  \"Soft planking forward, loose stays, corroded rudder mount.\" She was already moving toward the gangway. \"But the keel line is straight. Hull's solid below the waterline. Built well, maintained badly. That's fixable.\"","","  \"I need to get on that deck.\"","","*if (crew_count = 0)","  You looked at the ship from the berth. The hull told a story you could read without being a sailor \u2014 paint peeling, rope rotting, the particular neglect of a vessel whose crew had given up before the ship did. But the bones were there. Wide at the beam, deep in the draft, built to carry weight through rough water.","","  Like you.","","A voice came from behind.","","\"Looking at the Wake?\"","","You turned. A man sat on a crate at the berth's edge \u2014 human, sixties, with a face weathered to the color of the dock planking. He wore a dock authority vest, grey and faded, and held a ledger in his lap. A brass bell-pin on his collar. Goltieri's.","","\"Berth fees are fourteen Gold Sovereigns, eight Silver Spans. Overdue thirty-one days.\" He didn't look up from the ledger. \"Previous captain was a man named Torvellane Ghess. Died of blood poisoning from a coral wound. Crew took what they could carry and left. Wife lives in Caldruun \u2014 we sent word. She doesn't want the ship.\"","","He turned a page.","","\"Dock authority seizes unclaimed vessels after sixty days of unpaid berth fees. That gives this one twenty-nine more days. After that, it's Goltieri's. He'll strip it and sell the timber.\"","","He looked up. Took you in \u2014 the horns, the coat, the width. His expression was the professional blankness of a man who'd seen everything the harbor produced and stopped being impressed a decade ago.","","\"Fourteen Gold, eight Silver clears the debt and transfers the claim. Harbor salvage law. You pay what's owed, the ship's yours.\" He paused. \"You don't have fourteen Gold.\"","","A statement. He'd been reading broke arrivals for thirty years.","","\"The dock authority accepts three forms of settlement. Coin. Kolmari credit with a minimum fifteen-percent quarterly interest and a cosigner. Or \u2014\" he closed the ledger \"\u2014 labor credit. One Gold Sovereign per twenty days of dock hauling. At fourteen Gold, that's two hundred and eighty days.\" He let the number sit. \"Most people find the money somewhere else.\"","","He opened the ledger again. The conversation was over unless you had something to offer.","","*page_break","","The harbor was running out of patience with you.","","Three days until the departure wave. The bell had already rung for one crew this morning. By noon, it would ring again \u2014 you could see two more ships loading provisions in the south berths, departure flags ready. Every bell was someone who'd solved the problem you hadn't.","","Fourteen Gold Sovereigns. Two hundred and eighty days of labor. Kolmari debt at fifteen percent compounding interest. Or something else entirely \u2014 the dock kid had mentioned the fights.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara had spent twenty minutes on the ship's deck. She came back with grease on her hands and a Grimoire full of notes.","","  \"The ship is sound. Three weeks of repair \u2014 I can get it done in five days if I have help and materials. Hull plating, new rope, sail patches. The materials I can source. The berth debt is the problem.\"","","  She looked at you.","","  \"Terrek's forty Sovereigns. Whatever you have. That puts us at maybe two Gold and change. We need twelve more. And we don't have two hundred and eighty days.\"","","  *if (crew4_name = \"Terrek Ghaal\")","    Terrek had been quiet. He'd walked the length of the ship and come back and said nothing. Now he spoke.","","    \"I know a woman. Sullavenne Ohn. She was in the Anchor's Rest last night \u2014 back wall, dark coat. She watched you all evening.\"","","    He paused.","","    \"She has money. More than she showed. Four years in the Wardensea pays well if you don't spend it. And she's been here two months, which means she's been working or trading. She could cover the gap.\"","","    \"And she wants something for it,\" Kessara said.","","    \"She wants a berth. Specifically, she wants a crew heading south that isn't already in the Wardensea's pocket. That's hard to find. Most crews forming at Selvaggio are either running Kolmari debt \u2014 which means the Wardensea knows their financing \u2014 or they're posting on the crew boards, which the Wardensea logs. She's looking for someone the white coats haven't indexed yet.\"","","    He looked at you. \"You walked through the checkpoint yesterday with no crew, no ship, and no plan. You're exactly what she's looking for.\"","","*if (crew_count = 0)","  You stood on the berth and did the math. The math lost.","","  Twelve copper coins wouldn't buy a meal and a berth debt on the same day. The labor credit option would trap you at Selvaggio for nearly a year. The Kolmari credit required a cosigner you didn't have. And the departure wave was three days away.","","  The dock fights. The kid had mentioned them. Prize money. Behind the Anchor's Rest. Dangerous and simple and immediate.","","  Or you could find people. The Rathai engineer \u2014 Kessara Veldt \u2014 had offered her hand last night. You'd turned it down. The cook, Terrek Ghaal, had offered food. The woman in the shadows \u2014 Sullavenne Ohn \u2014 had offered knowledge of the Wardensea.","","  Any of them might have resources. Connections. Solutions to the math that broke you couldn't solve alone.","","The harbor bell chimed noon. The impound auction would be starting at the Wardensea dock authority. The dock bouts ran at sundown. And the ship sat in berth eleven, rotting one day at a time.","","*choice","  #Go to Sullavenne Ohn. She has Wardensea money, Wardensea knowledge, and she's been watching you since you arrived.","    *if (crew_count = 0)","      You found her at the Anchor's Rest. Same table. Same shadow between two lanterns. Same dark blue coat with the collar turned up, same scar from ear to jaw, same steady gaze that tracked you across the room like a compass needle finding north.","","      \"Took you long enough,\" she said.","","    *if (crew_count > 0)","      You went to the Anchor's Rest. The morning crowd was thin \u2014 the desperate ones who'd been drinking since last night, and the early workers eating breakfast. Sullavenne Ohn was at the same table. Same shadow. She watched you cross the room with the patient attention of someone who'd been expecting this visit.","","      \"You found the ship at berth eleven.\" A statement. \"I know \u2014 I've been watching it for a week. The berth debt is fourteen Gold, eight Silver. You don't have it.\"","","    She gestured at the chair across from her. You sat. The chair protested.","","    \"Four years in the Wardensea. Second Division, Lieutenant grade. I saved most of what I earned because there's nothing to spend money on when you're on patrol eight months a year.\" She put her hands flat on the table. Long fingers, clean nails, the hands of someone who worked with documents and navigation charts rather than rope and metal. \"I have eleven Gold Sovereigns in a Kolmari deposit. That's not enough to clear the berth debt alone, but combined with whatever you and your \u2014\" she looked at whoever was present \"\u2014 associates can produce, it closes the gap.\"","","    *set personality_openness %+ 5","","    \"What I want is \u2014 I keep starting this like a briefing. Sorry.\" She pressed her palms flat on the table. \"A berth. South. With people who aren't \u2014 who the Wardensea hasn't already \u2014\" She exhaled through her teeth. \"Patrol schedules. I know the patrol schedules, Selvaggio to Kelvanni, they're four months out of date but the routes don't \u2014 the routes are the routes. And I know which officers take bribes and the flag codes for secondary \u2014 I'm doing it again.\" She stopped. Her jaw reset. \"I sound like I'm selling myself. I am selling myself. I just \u2014 four years of writing reports and I can't have a normal conversation about it. I don't know how to do this part.\"","","    She leaned back.","","    \"In exchange, I want crew slot five. Fighter and specialist. My discharge papers are clean. My record says 'voluntary separation.' What my record doesn't say is that I filed a formal complaint against my commanding officer. Commander Gress.\" The name landed like a coin on the table. \"The complaint disappeared. I filed again. I was offered voluntary separation with full back pay, or involuntary separation with a criminal referral for insubordination.\"","","    The scar on her jaw caught the lantern light.","","    \"I took the money and the scar is from a conversation that happened the night before my discharge was finalized. Someone wanted to make sure I understood the terms of my departure.\"","","    She said it flat. No bitterness. A fact reported to someone she'd decided to trust with it.","","    \"Eleven Gold Sovereigns. Wardensea intelligence. A fighter who knows how the white coats operate from the inside.\" She put both hands on the table, palms up. \"Do we have a deal?\"","","    *set crew5_exists true","    *set crew5_name \"Sullavenne Ohn\"","    *set crew5_race \"human\"","    *set crew5_role \"Fighter\"","    *set crew5_loyalty 15","    *set crew5_trust \"calculated\"","    *set crew_count + 1","","    *if (crew3_name = \"Kessara Veldt\")","      *if (crew4_name = \"Terrek Ghaal\")","        The math finally worked. Sullavenne's eleven Gold. Terrek's two Gold and change from his forty Silver Sovereigns. Your copper. Between the three contributions, the total scraped past fourteen Gold and eight Silver. Barely. The margin was counted in coppers.","","        Kessara did the addition on her Grimoire and looked up with the expression of someone who'd just solved an equation she'd expected to fail.","","        \"That's enough. That's \u2014 yes. That clears the berth debt.\"","","        *set sovereigns 3","        *goto sullavenne_finish","      *else","        Sullavenne's eleven Gold and whatever you could scrape together left a gap. She saw it in your face.","","        \"I know a cook,\" she said. \"Terrek Ghaal. He's been at Selvaggio six months and he's sitting on two Gold in savings. He was watching you last night \u2014 he's interested. If you bring him in, we have enough.\"","","        That meant trusting a stranger's recommendation about another stranger. The chain of trust was thin and new and held together by money and shared desperation.","","        But the math worked.","","        *set crew4_exists true","        *set crew4_name \"Terrek Ghaal\"","        *set crew4_race \"gorundai\"","        *set crew4_role \"Cook\"","        *set crew4_loyalty 10","        *set crew4_trust \"stranger\"","        *set crew_count + 1","        *set sovereigns 3","        *goto sullavenne_finish","","    *elseif (crew_count = 1)","      Sullavenne's eleven Gold and your copper. The gap was still three Gold.","","      \"We're short,\" she said. \"We need more people or more money. There's an engineer at the Anchor's Rest \u2014 Rathai, small, talks fast, carrying a basalt Grimoire worth more than everything in my pocket. She's looking for the same thing we are.\"","","      You found Kessara Veldt at her table by the crew board. She was already standing when you reached her \u2014 she'd been watching the door.","","      \"I saw you talking to the shadow woman. You've found a ship.\" A statement. Her hands were already moving to her tool harness, checking, adjusting. \"How much do we need?\"","","      The three of you, plus the cook Terrek Ghaal who materialized as if he'd been waiting for exactly this configuration, pooled everything. Kessara had no money but offered labor value \u2014 the dock authority accepted skilled work as partial credit. Terrek's forty Silver Sovereigns. Your copper. Sullavenne's eleven Gold.","","      It was enough. The sum arrived at fourteen Gold and nine Silver \u2014 one Silver Span over the debt. The margin was a joke. The margin was everything.","","      *set crew3_exists true","      *set crew3_name \"Kessara Veldt\"","      *set crew3_race \"rathai\"","      *set crew3_role \"Engineer\"","      *set crew3_loyalty 10","      *set crew3_trust \"known\"","      *set crew4_exists true","      *set crew4_name \"Terrek Ghaal\"","      *set crew4_race \"gorundai\"","      *set crew4_role \"Cook\"","      *set crew4_loyalty 10","      *set crew4_trust \"stranger\"","      *set crew_count + 3","      *set sovereigns 0","      *goto sullavenne_finish","","    *label sullavenne_finish","    *set ship_acquisition_method \"salvage_claim\"","    *set personality_loyalty %+ 5","    *goto claim_the_ship","","  #Go to the dock bouts. Fight. Win the money yourself. You don't owe anybody for a ship you earned with your fists.","    The dock bouts ran behind the Anchor's Rest in a courtyard hemmed in by warehouse walls on three sides. No roof. The sky overhead was grey and the walls held the noise in \u2014 the shuffle of feet on packed dirt, the murmur of the crowd, the sound of money changing hands at the edges.","","    *set personality_aggression %+ 8","","    The fights were simple. Two enter, one wins. No weapons. No rules beyond \"don't kill anyone.\" The prize purse came from entry fees and the betting pool.","","    You arrived at sundown. Fifty, sixty people packed along warehouse walls, leaving a circle of packed earth twenty feet across. Lanterns made the fighters' shadows large.","","    A Gorundai ran the bouts from a crate at the courtyard's edge \u2014 sixties, grey-green skin, hands that had held a thousand purses. He saw you push through and his face did something that was almost a smile.","","    \"Highland Oni. Half, from the skin. Six-seven, broad, and you walk like you know where your weight is.\" He looked at the crowd, then back at you. \"Two Gold entry. Purse for the winner is six Gold, eight Silver. Three fights tonight \u2014 you'd be the fourth if we pair you.\"","","    Two Gold entry fee. You didn't have two Gold.","","    The old Gorundai read the hesitation.","","    \"Credit entry for new fighters. You lose, you owe me the two Gold from dock work. You win, the entry comes out of the purse and you walk with four Gold, eight Silver clear.\"","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara was behind you. She'd followed without being invited.","","      \"This is insane,\" she said. Then: \"Win.\"","","    *if (crew4_name = \"Terrek Ghaal\")","      Terrek leaned against the wall. He had his notebook out.","","      \"I'll bet on you. That way we double whatever you win.\"","","      \"Or lose everything,\" Kessara said.","","      \"I didn't say it was a good bet. I said it was a bet.\"","","    Your opponent was already in the ring. Human. Big \u2014 six-four, two-forty, scarred knuckles and a stance that said trained. His forearms had the density of someone who'd pushed past natural limits.","","    He looked at the horns. At the coat you were already shrugging off.","","    \"Highland,\" he said. One word.","","    *page_break","","    The fight started without ceremony. The old Gorundai said \"go\" and the human moved.","","    He was fast. Faster than his size suggested \u2014 he closed the distance in two steps and threw a combination that would have broken ribs on someone who wasn't ready for it. A left hook to the body, a right cross to the head, both thrown with the mechanical precision of repetition.","","    You moved. The highland bouts had taught you one thing before they'd taught you anything else: a big body moves differently than a fast body, and the trick is being both. Your mother had drilled it \u2014 *feet first, horns last, and never let them see your weight until it's already on them.*","","    The left hook missed your ribs by two inches. You pivoted. The right cross grazed your temple \u2014 not clean, but enough to light a white flash behind your eyes and remind you that the dock bouts weren't a festival exhibition.","","    You answered. A straight right hand \u2014 no technique worth naming, just the weight of a 6'7\" frame with Oni bone density behind the knuckles. The punch connected with his solar plexus and the sound it made was heavy and final.","","    He folded. Not down \u2014 forward, bending at the waist, his guard dropping for a fraction of a second. You didn't follow up. The highland code said a clean hit earns a clean count. You stepped back.","","    He straightened. Breathed. Looked at you \u2014 recalculating everything he'd assumed about this fight.","","    \"Again,\" he said.","","    He came in lower this time. Smarter. Worked the body \u2014 three, four shots to the ribs that you caught on your arms, each one jarring. He knew that trading head shots with a half-Oni was a losing bet, so he went for the ribs, the liver, the soft architecture that didn't care about bone density.","","    It hurt. The ribs absorbed it and the pain was sharp and real and the courtyard got brighter the way it does when the body dumps chemicals you don't control.","","    And then \u2014 briefly, for less than a second \u2014 your forearms went dark.","","    The sheen. The same thing you'd seen on the dock worker's arms. The same thing the highland elders wore like armor. It crawled up from the wrists and hardened across the knuckles and the human's next punch landed on something that was no longer just skin over bone.","","    He felt it. His fist hit your forearm and the impact transferred wrong \u2014 his wrist buckled instead of your guard. He pulled back. Stared at your arms.","","    The sheen was already fading. Half a second. Gone.","","    *set dominion_armoring + 3","    *if (dominion_armoring >= 30)","      *set armoring_tier \"Forged\"","    *if (dominion_armoring >= 10)","      *if (dominion_armoring < 30)","        *set armoring_tier \"Tempered\"","","    You hit him. A left hand to the body and a right hand that started at the hip and ended at his jaw and carried the weight of the highlands behind it. He went down. The packed earth caught him. He didn't get up immediately \u2014 not unconscious, but done. His body had made the decision before his mind caught up.","","    The crowd made noise. The old Gorundai counted. The human stayed down for the count and then rolled to his hands and knees and looked up at you with the grudging recognition of a professional who'd just been beaten by something he didn't understand.","","    The Gorundai pushed a purse across the crate. Coins. Heavy.","","    *set sovereigns + 48","    *set selvaggio_fight_won true","","    \"Four Gold, eight Silver,\" the Gorundai said. \"Minus entry fee. Clean win. The crowd liked you \u2014 the Oni thing, the horns. You'll get bets next time.\"","","    There wouldn't be a next time. You'd come for money, not a career.","","    *if (crew_count > 0)","      *if (crew3_name = \"Kessara Veldt\")","        Kessara was waiting outside the courtyard. She was holding a cup of something she'd bought and hadn't drunk. She held it out to you, then pulled it back, then held it out again.","","        \"I saw it,\" she said. Quietly. \"Your arms. For a second, they \u2014\"","","        She stopped. Handed you the cup. Pulled out her Grimoire and started tapping notes into it, mouth set in a line that had nothing to do with the fight and everything to do with what she'd seen on your forearms.","","        \"Four Gold, eight Silver. With Terrek's money and Sullavenne's \u2014\" she paused. \"We haven't talked to Sullavenne yet.\"","","        \"We have now,\" said a voice from the courtyard entrance.","","        Sullavenne Ohn stepped out of the shadow she'd been standing in. Dark blue coat. Scar. The same steady gaze.","","        \"I watched the fight. I've been watching you since yesterday. I was Wardensea \u2014 I know what that sheen was on your arms and I know what it means and I know you don't have control of it yet.\" She looked at the purse in your hand. \"You have four Gold. I have eleven. Between us, with whatever your crew has, the berth debt is covered.\"","","        *if (crew5_exists = false)","          *set crew5_exists true","          *set crew5_name \"Sullavenne Ohn\"","          *set crew5_race \"human\"","          *set crew5_role \"Fighter\"","          *set crew5_loyalty 20","          *set crew5_trust \"tested\"","          *set crew_count + 1","","        The math resolved. Fight money plus Sullavenne's savings plus Terrek's contribution. The total crossed fourteen Gold. The ship was reachable.","","        *set sovereigns 5","","    *if (crew_count = 0)","      You stood in the courtyard with a purse of coins and bruised ribs and the fading memory of your forearms going dark. Four Gold, eight Silver. Enough for a third of the berth debt. One fight wasn't going to solve this.","","      But one fight had changed the math. And it had changed something else \u2014 the crowd had seen you. The old Gorundai had announced your fight to the betting pool. Somewhere, a Grimoire had been broadcasting.","","      *set grimoire_followers + 50","","      Someone was going to have seen a half-Oni from the highlands beating a trained dock fighter with fists that flickered dark for half a second.","","      You needed the rest of the money. You needed a crew. The two problems were the same problem.","","      You went to the Anchor's Rest. Kessara Veldt was at her table. Terrek Ghaal was at the bar. Sullavenne Ohn was in her shadow. And this time, you didn't walk past any of them.","","      The conversation took twenty minutes. The math took five. Your fight money, Sullavenne's Wardensea savings, Terrek's six months of cooking wages. Kessara had nothing but skills and a willingness to work twenty-hour days repairing the ship. The total arrived at fourteen Gold and six Silver \u2014 two Silver short.","","      Kessara reached for her basalt Grimoire. Stopped. Her hand hovered. She pulled it from her harness and set it on the table, then adjusted its position twice, lining it up with the table's edge like she was organizing a workbench.","","      \"This is worth eight Silver at any salvage stall. I'll use a limestone one until \u2014\" She turned the Grimoire over in her hands. Turned it back. Lined it up with the table's edge again. \"Until we can afford better. It's fine. It's a device. I'm not \u2014\" Her thumb ran across the basalt casing one more time, finding the smooth spot where three years of grip had worn a groove. She pulled her hands into her lap. \"It's fine.\"","","      She was still looking at it when Terrek gently slid it toward the center of the table, out of her reach.","","      The gap closed.","","      *set crew3_exists true","      *set crew3_name \"Kessara Veldt\"","      *set crew3_race \"rathai\"","      *set crew3_role \"Engineer\"","      *set crew3_loyalty 15","      *set crew3_trust \"known\"","      *set crew4_exists true","      *set crew4_name \"Terrek Ghaal\"","      *set crew4_race \"gorundai\"","      *set crew4_role \"Cook\"","      *set crew4_loyalty 10","      *set crew4_trust \"stranger\"","      *set crew5_exists true","      *set crew5_name \"Sullavenne Ohn\"","      *set crew5_race \"human\"","      *set crew5_role \"Fighter\"","      *set crew5_loyalty 15","      *set crew5_trust \"tested\"","      *set crew_count 3","      *set sovereigns 0","","    *set ship_acquisition_method \"fight_earned\"","    *goto claim_the_ship","","  #Work the docks for labor credit. No debt, no violence, no favors owed. The slow way is the clean way.","    *set personality_loyalty %+ 5","    *set personality_mercy %+ 3","","    You went to the dock boss \u2014 the grey-vested man at the main jetty intersection, the one who'd offered you work the day before. He looked up from his ledger.","","    \"Changed your mind.\"","","    You had.","","    \"Labor credit runs at one Gold per twenty days. But the dock authority also runs a fast-track for skilled heavy hauling \u2014 double loads, dangerous cargo, the jobs the regular crews won't take. Fuel barrels. Forge materials. The Gorundai shipments from the inner harbor where the heat warps the planking and the crates weigh as much as a man. Fast-track pays double. One Gold per ten days.\"","","    He looked at you \u2014 the height, the width, the frame that could carry what two humans couldn't.","","    \"For someone your size, I'd guess triple rate. The loading bosses will fight over you. Three Gold per ten days. Fourteen Gold in \u2014 call it five days of hard hauling.\"","","    Five days. The departure wave was in four. Tight. Too tight for comfort, but not impossible \u2014 if you worked every waking hour and the dock authority processed the credit fast enough.","","    \"Start now?\"","","    *page_break","","    You hauled.","","    Fuel barrels from the inner harbor \u2014 two hundred pounds each, iron-banded. The regular crews carried one per trip. You carried two. The loading boss watched and stopped arguing. Forge shipments next \u2014 crates of raw iron, packed in straw that did nothing for the weight. Fourteen trips in the first hour. The boss stopped counting.","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara worked alongside you \u2014 not hauling, but repairing. She'd struck a deal with the dock authority: skilled repair labor at a Rathai engineer's rate counted as double credit. She spent the first day underneath a seized fishing sloop, replacing hull planking with tools from her harness and profanity from a vocabulary built across three dockyards.","","    *if (crew4_name = \"Terrek Ghaal\")","      Terrek cooked for the loading crews. He'd negotiated food-for-credit \u2014 feeding the dock workers in exchange for labor points applied to your account. The dock boss agreed because the regular food cart had raised prices and the workers were eating garbage.","","      By the second day, the loading crews were asking for Terrek by name.","","    The days blurred. Haul. Eat. Sleep on the dock near berth eleven. Haul again. The Departure Bell rang twice more \u2014 two more bells you weren't ringing.","","    By day three, the dock authority ledger showed ten Gold credited. Two more days would close the gap. The departure wave was tomorrow.","","    The dock boss came to you on the morning of day four.","","    \"Fourteen Gold, two Silver credited. The berth debt is fourteen Gold, eight Silver.\" He checked the ledger. \"You're short six Silver Spans.\"","","    Six Silver. After four days of hauling cargo that would have broken anyone under six feet. Six Silver Spans between you and the ship.","","    *if (crew_count > 0)","      *if (crew3_name = \"Kessara Veldt\")","        Kessara had been repairing the ship for three days, working on credit and promise. She'd already replaced the forward deck planking and re-rigged the mast stays. She heard the number.","","        \"I have it.\" She pulled coins from the inside pocket of her tool harness \u2014 six Silver Spans, counted out on the dock boss's ledger. \"I've been saving the repair credit separately. In case we needed it.\"","","        The dock boss marked the ledger. The debt cleared.","        *goto labor_finish","","      *else","        Sullavenne Ohn appeared \u2014 she had a way of appearing, silent and precise, when the math required her. She set six Silver Spans on the ledger without a word.","","        \"Consider it an investment,\" she said.","","        The debt cleared.","        *goto labor_finish","    *elseif (crew_count = 0)","      Six Silver Spans. You'd earned fourteen Gold through labor and you were short by six Silver.","","      A voice from behind you.","","      \"You've been hauling cargo for four days. I've been watching for four days. Here's what I know: you don't quit, you don't complain, and you carry more than any two men on this dock.\"","","      Sullavenne Ohn. Dark blue coat. Scar. Standing at the edge of the berth with six Silver Spans held between two fingers.","","      \"I was Wardensea. I have eleven Gold in savings and skills your crew needs. I've been waiting for someone worth following south. You've spent four days earning a ship with your back instead of your fists or someone else's money.\" She set the coins on the dock boss's ledger. \"That tells me what I needed to know.\"","","      Behind her \u2014 Kessara Veldt, tool harness clanking, already eyeing the ship. And beside Kessara \u2014 Terrek Ghaal, carrying a pot of something that smelled like breakfast.","","      They'd been watching. All three. Waiting to see what you'd do when the math didn't work.","","      *set crew3_exists true","      *set crew3_name \"Kessara Veldt\"","      *set crew3_race \"rathai\"","      *set crew3_role \"Engineer\"","      *set crew3_loyalty 20","      *set crew3_trust \"earned\"","      *set crew4_exists true","      *set crew4_name \"Terrek Ghaal\"","      *set crew4_race \"gorundai\"","      *set crew4_role \"Cook\"","      *set crew4_loyalty 15","      *set crew4_trust \"earned\"","      *set crew5_exists true","      *set crew5_name \"Sullavenne Ohn\"","      *set crew5_race \"human\"","      *set crew5_role \"Fighter\"","      *set crew5_loyalty 20","      *set crew5_trust \"earned\"","      *set crew_count 3","      *set sovereigns 0","      *goto labor_finish","","    *label labor_finish","    *set ship_acquisition_method \"labor_earned\"","    *goto claim_the_ship","","*label claim_the_ship","*page_break","","The dock authority ledger updated. The berth debt cleared. The claim transferred.","","The man in the grey vest wrote a name on the form \u2014 your name, or rather the one on your entry permit: Merdou Akkan \u2014 and stamped it with a dock authority seal that smelled like hot wax and old paper.","","\"Ship's yours. Hull designation Sundered Wake \u2014 you can rename it at the port authority for two Silver or just paint over it yourself.\"","","*set has_ship true","*set found_ship true","*set ship_name \"Sundered Wake\"","*set ship_condition 35","","The Sundered Wake. A forty-four-foot ketch with a blue hull gone grey, two masts, a deep draft built for ocean swells, and a deck that needed more work than any of you wanted to admit. She sat in the water at berth eleven, and she was yours.","","Your hand found the rail. The wood was soft in places it shouldn't be. Everything this ship could do to kill the people aboard was your problem now.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was on deck within minutes. The tool harness came off. The tools came out. She was talking \u2014 not to you, not to anyone. To the ship. To the mast stays, the rudder mount, the soft deck planking in the forward section.","","  \"I know. I know. We'll fix that. And that. And \u2014 yeah, that too. But you're solid at the keel and that's what matters.\"","","  She looked up from the forward hatch.","","  \"I need two days. Three would be better. The sails need patches. The rudder mount needs a full rebuild \u2014 I can source the iron from the salvage yard. The rope is all new \u2014 none of this holds.\" She pulled a length of standing rigging and it frayed in her hand. \"See?\"","","  She threw the rope overboard without ceremony.","","  \"Two days. Give me two days and she'll sail.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek inspected the galley. The ship's cooking space was a closet-sized compartment below the quarterdeck with a brick-lined firebox and storage that smelled like the previous cook had given up months before the captain died.","","  He opened the storage. Closed it. Opened the firebox. Scraped something off the inside with his fingernail and sniffed it.","","  \"I can work with this. The firebox is functional. The storage needs cleaning \u2014 three hours, maybe four. Supplies are a different problem.\" He looked at whatever money remained. \"We need food for five people for eight days minimum. Rice, dried fish, salt, oil, spice. Call it six Silver Spans for basic provisions. More if you want the crew to eat food instead of survival.\"","","  *set supplies 20","  *set food_days 5","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne walked the deck once. Slowly. She checked sight lines \u2014 how much of the harbor was visible from the helm, from the bow, from the quarterdeck rail. She checked escape routes \u2014 how fast could five people get from below decks to above. She checked the weapons locker. Empty.","","  \"No weapons on board. We need something. Boarding situations are common past Galluun's Tooth \u2014 not piracy, just territorial. Crews protecting their route.\" She looked at you. \"You fight with your hands. I can work with that. But a crew needs contingency.\"","","  She didn't press. She'd stated the fact and let it sit. Wardensea training \u2014 present the assessment, let the commanding officer decide.","","*page_break","","Two days of work.","","Kessara rebuilt the rudder mount, re-rigged the stays, patched the sails \u2014 cursing in three languages at the rope prices. Terrek cleaned the galley and sourced provisions from the dock markets with the intensity of someone negotiating a peace treaty. Sullavenne inventoried everything on the ship and created a watch rotation in the leather notebook she carried in her coat. And you hauled \u2014 materials, provisions, water barrels. The ship came together one piece at a time.","","Two days. The ship was ready. The crew was assembled. Tomorrow was the departure wave.","","*page_break","","The evening before departure, the crew sat on the Sundered Wake's deck. Five people. One ship. The harbor at sunset was copper and grey and the water held the light like oil.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara sat cross-legged on the forward deck, her Grimoire propped on one knee \u2014 the cheap limestone replacement, cracked and dim, already showing the wear of three days' hard use. She was running calculations. Always running calculations.","","  \"Route to Galluun's Tooth is three to five days depending on the currents south of the Bastion shelf. Could be faster if the north wind holds. Could be worse if it shifts.\" She looked up. \"I'm navigating by chart and Grimoire relay. We don't have a Khari navigator. I keep saying that.\"","","  The absence in crew slot two was a hole the size of a person.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was cooking. On the ship. The first meal prepared on the Sundered Wake's brick firebox since its previous captain died. The smell was rice and fish and a sauce that he'd built from the spice sack \u2014 something that combined heat and sweetness in a ratio that made the deck smell like a place people chose to be.","","  He served it in the bowls he'd bought at the market \u2014 ceramic, mismatched, cheap, already the most personal objects on the ship. He set a bowl in front of each person and sat with his own and ate in the quiet, focused way he always ate.","","  \"First meal on a ship,\" he said. \"The highland tradition is you eat the first meal together and the food binds you to the journey. My mother told me that.\"","","  He looked at you. The unfinished tattoos on your forearm. The horns catching the last light.","","  \"She'd have liked this. Feeding an Oni heading south on a ship held together by hope and an angry Rathai.\"","","  Kessara threw a piece of flatbread at him. He caught it without looking.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne sat at the stern rail, looking south. The harbor mouth was a dark gap between the jetties, and beyond it, the ocean. She hadn't spoken much during the two days of preparation \u2014 she'd worked, organized, contributed, and kept her own counsel. Now, with the evening settling and the crew gathered, she spoke.","","  \"Wardensea patrol update. Commander Gress's three ships left yesterday morning \u2014 we saw them. They're running a south sweep to Galluun's Tooth and back, eight-day round trip. That means they'll be between Selvaggio and Galluun's Tooth when we depart. We will be inspected.\"","","  Nobody spoke.","","  \"Standard inspection: manifest, crew roster, cargo check, captain's permit. We're clean on all counts \u2014 the Sundered Wake's claim is legal, the crew's papers are in order, we're not carrying contraband. The inspection will be tense and slow and the officers will look at the captain \u2014\" she looked at you \"\u2014 and make assessments. An Oni half-blood in highland gear captaining a salvage-claim ketch with a crew of four is going to get attention.\"","","  She paused.","","  \"My name is in the Wardensea system. They'll recognize me. That could be a problem or an advantage depending on the officer. If it's one of Gress's people, it's a problem.\"","","The sun went down. The lanterns came on \u2014 orange points reflected in the black water. The Departure Bell hung at the harbor mouth, bronze on stone, waiting.","","The crew settled into their spaces \u2014 Kessara forward with her tools, Terrek in the galley, Sullavenne in the stern cabin she'd claimed by putting her coat on the bunk and daring anyone to move it.","","You stayed on deck. The overcast hadn't broken since you'd arrived. The ocean beyond the harbor mouth was a black absence where the world ended and something else began.","","Four people who'd chosen you. Or chosen the idea of you \u2014 a half-Oni with no money and no name and no plan beyond a direction. South.","","*if (selvaggio_fight_won)","  The knuckles of your right hand ached from the dock fight. And underneath the ache, something else. The memory of the sheen. The half-second when your forearms had gone dark and the world had felt different \u2014 heavier, more present, as if the air itself had weight and you were pushing through it.","","  The highland elders had a word for that feeling. *Kossk-sa*. The bone-shell waking. The Dominion stirring in the body like a tide coming in. Most Oni felt it by fifteen. You'd felt it once, at the First Bout, and then never again \u2014 until the dock fight. After years of silence, the bone-shell had moved.","","  Unreliable. Unready. A flicker, a suggestion, a promise that might break. But there.","","*if (selvaggio_fight_won = false)","  The knuckles were calloused from hauling \u2014 rope and iron and the weight of a harbor's worth of cargo. The body was sore and the muscles were tired and underneath the exhaustion, something waited. A memory from the First Bout \u2014 the half-second when the bone-shell had surged, dark and unbidden, across your fists. The highland elders called it *kossk-sa*. The waking. Most Oni felt it by fifteen. You'd felt it once, and then the exile, and then nothing.","","  But the nothing had a quality to it now. A pressure. As if the bone-shell was there, asleep, and the distance between asleep and awake was shrinking.","","The harbor rocked the ship. The overcast held. Somewhere in the dark, the ocean breathed.","","Tomorrow. The bell.","","*goto_scene ch1_selvaggio_the_bell",""], "labels":{"ship_hunt":73,"sullavenne_finish":260,"labor_finish":527,"claim_the_ship":531}},
"ch1_selvaggio_the_bell": {"crc":1907590480, "lines":["*comment ===================================================","*comment  CHAPTER 1: SELVAGGIO \u2014 \"The Gate\"","*comment  Scene 6: The Bell","*comment  The Departure Bell. The betting board. The departure.","*comment  Bell choice (1 or 2 rings). The harbor mouth.","*comment  Cliffhanger: another ship on the same heading.","*comment  2 real choices. Zero fake choices.","*comment ===================================================","","Morning came the way it always came at Selvaggio \u2014 loud, sudden, and without permission.","","The harbor horn blew at first light. The machinery of departure ground into motion. The Sundered Wake rocked at berth eleven, creaking \u2014 wood and rope and iron being asked to do something after sitting still too long.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was already awake. She'd been awake for an hour \u2014 you could tell by the progress. Three new rope coils hung from the port-side rigging, each tied with a distinctive Rathai knot-pattern that she'd explained once and you'd immediately forgotten. The forward deck plank she'd replaced yesterday had been sealed with pitch, black and gleaming.","","  She stood at the mast, running her hands along the stays, testing tension with a pull-and-release that was half engineering and half instinct.","","  \"Stays are holding. Sails are patched. Rudder mount is \u2014 functional. Not good. Functional.\" She looked at the sky. Grey. The same grey Selvaggio had worn every day since you'd arrived. \"Wind's from the north \u2014 northwest. North-northwest.\" She licked a finger and held it up, frowned, wiped it on her harness. \"That's favorable for a south heading. Probably. If it holds. I'm not a navigator. I keep saying that and nobody listens.\"","","  She pulled the cheap limestone Grimoire from her belt and tapped the screen.","","  \"Current reports show a light chop south of the harbor mouth, smoothing to open swell past the shelf. Tide turns in three hours. We should be past the harbor mouth before it turns or we're fighting the current on the way out.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was cooking breakfast. The last meal at Selvaggio \u2014 the last meal before the ocean, the last meal cooked on a dock-side grill instead of the ship's firebox. He'd sourced ingredients from the morning market and the result was rice and fish and a flatbread that he'd pressed thin and fried until it crackled.","","  He served it on the deck. Five portions, laid out on the mismatched bowls. The morning light caught the steam and the food smelled like warmth and effort and the particular care of someone who understood that the last meal before a voyage mattered more than the meal itself.","","  \"Eat,\" he said. \"This is \u2014 I'm not calling it a last meal. That sounds bad. It's a last good meal. Everything after this is ship rations and ship rations are \u2014 just eat.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was dressed and packed. Her coat was buttoned. Her leather notebook was in her inside pocket. Her hands were empty and her posture was the specific kind of still that meant readiness \u2014 the Wardensea in her bones, the parade-ground discipline that hadn't left when her rank did.","","  She stood at the stern rail, looking south through the harbor mouth. The ocean was a grey band between the jetties.","","  \"I checked the Wardensea frequencies on the Grimoire,\" she said without turning around. \"Gress's patrol is two days south. They've logged six departures \u2014 or seven, I missed one. Call it seven. We're somewhere in the middle of a wave of forty.\" She adjusted her collar. Adjusted it again. \"That means the early ships have already been inspected. Gress should have her quota by the time we reach patrol range.\"","","  She paused. Longer than the information required.","","  \"Should. That's my professional assessment. 'Should.'\"","","*page_break","","You walked to Departure Row one last time.","","The betting board was outside the Anchor's Rest \u2014 a wooden frame bolted to the wall, covered in hand-written slips. Each slip was a departing crew. Each crew had odds.","","You found yours.","","The slip was new \u2014 the paper still white, the ink still dark. Someone had posted it this morning.","","SUNDERED WAKE \u2014 Capt. M. Akkan (Oni, half, highland). Crew: 4. Ship: ketch, 44ft, salvage claim. Departure wave 7. Destination: South (Kingsrun declared).","","Below the crew listing, the odds.","","RETURN SAFE: 15 to 1.","REACH GALLUUN'S TOOTH: 8 to 1.","REACH MERRENBACH: 22 to 1.","REACH BRANNACH: 50 to 1.","COMPLETE KINGSRUN: 200 to 1.","BOUNTY WITHIN 30 DAYS: 3 to 1.","","Fifteen to one against coming back alive. Two hundred to one against completing the Kingsrun. Three to one in favor of picking up a bounty within a month.","","The numbers were honest. A half-Oni exile with no name, no money, a salvage-claim ketch, and a crew of four strangers. The betting board had measured you and found you probable to die.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara read the odds over your hip.","","  \"Two hundred to one.\" Her voice wobbled on the last word. She cleared her throat. \"I've seen worse odds on a structural integrity report. The ship held. Mostly.\"","","  She pulled a copper coin from her tool harness and walked to the betting window. Her hand was steady when she put the coin down. Her other hand, the one she kept in her pocket, wasn't.","","  \"One copper on complete. Two hundred to one.\" She looked at you. \"When we finish the Kingsrun, I want the payout in basalt Grimoire components.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek read the slip. His face did something subtle \u2014 the eyebrows lifting a fraction, the mouth settling into a line. He took out his notebook and wrote the numbers down.","","  \"Record keeping,\" he said. \"When we prove them wrong, I want to remember what they thought.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne read the slip and said nothing. Her hand moved to the scar on her jaw. Touched it once. Let it go. Moved back to the scar. This time she didn't let go \u2014 her thumb traced the line from ear to jaw, slow, like checking that the seam was still holding.","","  She read the odds a second time. Her left boot tapped twice against the dock planking \u2014 a fast, involuntary rhythm she killed the moment she noticed it.","","  \"Three to one on a bounty within thirty days,\" she said. The voice was steady. The boot stayed still. \"That's optimistic. I give it two weeks.\"","","*page_break","","The Departure Bell.","","Bronze on stone, at the harbor mouth where the jetties narrowed to a gap. The bell hung from a salt-corroded pillar, green at the edges. A rope dangled from the clapper \u2014 thick, frayed, grabbed by a thousand hands.","","The Sundered Wake moved through the harbor on the outgoing current. Kessara at the helm, hands steady on the tiller. Terrek amidships. Sullavenne at the bow, reading the water. The whole of Selvaggio condensed into a moving frame that narrowed as the jetties closed in.","","Harbor custom said the captain rang the bell. Nobody else.","","You stepped down from the quarterdeck. Crossed the deck. The crew parted without a word. The ship drifted, slowing, aligning with the bell pillar.","","The rope was at arm's reach. The harbor went quiet.","","You grabbed the rope.","","*choice","  #Ring once. Safe journey. The ocean gives no promises and neither do you.","    *set bell_rings 1","    *set rang_departure_bell true","","    One ring.","","    The bell spoke. Bronze on stone on water \u2014 the sound rolled out across the harbor in a wave that touched every ship, every dock, every wall. Deep. Heavy. Final. The note held for three seconds and then died, absorbed by the grey sky and the harbor water.","","    One ring. Safe journey. The standard. The tradition. You'd asked for nothing but the ocean's permission, and the ocean didn't answer because it never did.","","    On the dock, a vendor raised a cup. A dock worker paused, nodded, went back to his crate. The betting board man at the Anchor's Rest made a mark in his ledger.","","    The Sundered Wake moved through the gap.","","    *goto departure","","  #Ring twice. You're coming back. The highlands threw you out. Selvaggio won't be the last place that sees you \u2014 it'll be the first.","    *set bell_rings 2","    *set rang_departure_bell true","    *set personality_aggression %+ 3","    *set rep_renegade + 5","","    One ring.","","    The bell spoke. Bronze on stone on water \u2014 the sound rolled out across the harbor and people paused and looked and that was normal, that was the standard, every crew rang once.","","    You pulled the rope again.","","    Two rings.","","    The second note landed on the first like a fist on a table. The harbor went still. Not silent \u2014 Selvaggio was never silent \u2014 but the noise changed register. People turned. The dock workers. The food carts. The crews on nearby ships. Two rings meant something. Two rings was a declaration \u2014 you were going and you were coming back and anyone who doubted it could remember this morning.","","    On the dock, a woman laughed. An old man shook his head. The betting board man at the Anchor's Rest looked up from his ledger and wrote something.","","    Two rings. The last person who'd rung twice from Selvaggio had been Tomoe Gallacs, fourteen months ago. She had a bounty of 680 million. She hadn't come back yet.","","    *set grimoire_followers + 30","","    The Sundered Wake moved through the gap.","","    *goto departure","","*label departure","","*page_break","","The harbor mouth opened and the world changed.","","Inside the harbor: shelter, noise, the compressed energy of a thousand ships and ten thousand people packed into a stone bowl. Outside: the ocean. The Bastion Sea. Grey-green and rolling, stretching south to a horizon line that was ruler-straight and absolute. The swell was low \u2014 two feet, maybe three \u2014 but after weeks of dock and stone and flat ground, even a gentle swell turned the deck into something alive.","","The wind hit. North-northwest, as Kessara had predicted. It caught the patched mainsail and the canvas bellied out with a sound like a held breath released. The Sundered Wake leaned. The rigging creaked. The hull \u2014 forty-four feet of neglected ketch, rebuilt by a Rathai engineer in three days \u2014 took the swell and held.","","Selvaggio shrank behind you. The harbor mouth became a gap, then a line, then a detail in a mass of grey stone and dock timber that resolved into an island. An island you were leaving. An island that grew smaller every second and would keep growing smaller until it was gone.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was at the helm, both hands on the tiller, weight braced against the lean. The wind blew her hair flat against her skull and the cheap Grimoire was wedged between her hip and the tiller arm where she could check it without letting go. She was grinning. The Rathai didn't grin often \u2014 the expression was a stranger on her face, unfamiliar and bright.","","  \"Rudder's responding. Sail trim is \u2014 acceptable. We're making five knots in a ten-knot wind. That's \u2014\" she did the math \"\u2014 terrible, but we're moving. We're actually moving.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was below decks, securing provisions. You could hear him through the open hatch \u2014 the sound of crates being wedged, ropes being tied, the low hum of a man who sang while he worked. The song was highland \u2014 or trying to be. He'd learned it from his mother, and he had the melody wrong in two places. The intervals were too wide. A highland Oni would have caught it instantly.","","  He came up through the hatch mid-verse and saw you standing there. The song died in his mouth. His face went through three things in rapid sequence \u2014 surprise, embarrassment, and the particular horror of a man who'd just realized the one person on the ship who'd know the real melody had been listening the whole time.","","  \"That was \u2014 I know it's not right. The \u2014 my mother sang it differently than \u2014\" He wiped his hands on his trousers. Wiped them again. \"I'll stop.\"","","  He didn't wait for a response. He went back down through the hatch. For a minute, there was only the sound of crates being wedged in silence. Then, quieter, almost inaudible through the deck planking \u2014 the same song. Still wrong. Still going.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne stood at the bow. Arms at her sides. Coat open to the wind. She was watching the ocean the way she watched everything \u2014 with the patience of someone who expected what she was looking at to eventually try to kill her.","","  \"Clear water to the shelf. Six miles. After the shelf, the bottom drops from sixty feet to three hundred in about half a mile. That's where the current changes.\" She looked back at you. \"I'll take first watch tonight. The rest of you sleep.\"","","The first hour was pure motion. The ship found its rhythm \u2014 a roll and lift that repeated every seven seconds, predictable, hypnotic. The harbor current carried you south along the island's coast, past the fishing berths, past the outer docks where the cargo haulers loaded, past the last stone breakwater that marked Selvaggio's boundary.","","The ocean opened. The horizon extended. The sky and the water merged at a line so far away it stopped being a physical boundary and became something closer to an idea.","","*page_break","","The Grimoire buzzed.","","Kessara pulled it from the tiller cradle. The limestone screen flickered \u2014 the cheap device struggled with distance from the Selvaggio relays. She tilted it, tapped it, held it at an angle.","","\"Broadcast,\" she said. \"Kingsrun Watch. Veshanna Torc.\"","","The voice was female, clear, with the measured cadence of someone reading facts she'd verified personally.","","\"This is Kingsrun Watch with your morning departure update. Selvaggio wave seven has produced forty-two registered departures over the past six days. Of those, thirty-eight are merchant or fishing vessels. Four have declared Kingsrun heading.\"","","She listed them. Three crews you didn't know \u2014 names, ship types, crew sizes, odds from the Selvaggio board. Unremarkable. Standard departures.","","Then:","","\"Fourth departure: Sundered Wake. Captain Merdou Akkan, listed as half-Oni, highland origin. Crew of four. Salvage-claim ketch. Declared Kingsrun heading, destination unspecified. No prior Grimoire presence. No bounty. Selvaggio board has them at two hundred to one against Kingsrun completion. This is a cold entry \u2014 no crew history, no ship history, no captain history. Veshanna Torc will follow up when more information is available. Kingsrun Watch out.\"","","The broadcast ended. The Grimoire went dark.","","*set grimoire_followers + 200","","Two hundred to one. Cold entry. No history. The Grimoire network had noticed you and filed you under *probably dead within a month.*","","*if (crew3_name = \"Kessara Veldt\")","  \"Veshanna Torc,\" Kessara said. \"She's the one who only reports confirmed facts. If she's tracking us, it means we're on the map.\" She paused. \"The two-hundred-to-one map. But the map.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek's head appeared through the hatch. He'd heard the broadcast.","","  \"Cold entry,\" he said. He rolled the phrase around. \"I like that. Cold entry. Sounds like a recipe that starts bad and gets interesting.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne said nothing. But you saw her hand move to her coat pocket \u2014 the one where she kept the leather notebook. She wrote something. Closed it. The entry would be precise: date, time, broadcast frequency, exact wording. The Wardensea in her cataloged everything.","","*page_break","","The afternoon passed in silence and water.","","The Bastion shelf dropped away around noon \u2014 the swell deepened, the color shifted from inshore green to a blue that darkened with depth. Three hundred feet beneath the keel. Then four hundred. Then numbers that didn't mean anything because your body had never been built for water.","","The crew found their rhythms. Kessara navigated by chart and Grimoire. Terrek managed provisions and kept below-decks ordered. Sullavenne watched the horizon and reported conditions at intervals. And you stood at the quarterdeck while Selvaggio shrank to a memory behind you.","","Ahead was the Kingsrun. Sixteen stops. Four thousand miles. Crews that had been doing this for years, with ships that worked and captains with bounties in the hundreds of millions. You had a patched ketch and four people and a direction.","","The sun was setting when Sullavenne called out.","","*page_break","","\"Ship. Two points off the port bow. Bearing south-southwest.\"","","You crossed the deck. The bow rail was salt-crusted and warm from the afternoon sun. Ahead, on the horizon line where the sea met the copper-colored sky, a shape.","","A ship. Small at this distance \u2014 a silhouette, mast and hull and the faint line of a sail catching the last light. Running south. Same heading as you. Close enough to see, far enough that the details were lost.","","Kessara had the Grimoire up, scanning.","","\"Grimoire signal. Weak \u2014 they're at the edge of relay range.\" She tapped the screen. \"Ship identifier: Kindling. Captain: Suuba Mettani. Race: Rathai. Crew: eleven. Bounty: two hundred seventy-five million Sovereigns.\" She looked up. \"She's Cursed Generation.\"","","The Kindling. Suuba Mettani. The name had been on the Grimoire broadcast at Departure Row \u2014 the Rathai captain with the smallest bounty in the Cursed Generation, the one the commentators called an underdog and the betting boards called a footnote. Two hundred seventy-five million. In any other context, it was a fortune. Among the CG captains, it was the bottom of the list.","","She'd left Selvaggio six days ahead of you. She was running the same route. She was on the same ocean, under the same sky, heading toward the same stops. And she was close enough to see.","","*if (crew3_name = \"Kessara Veldt\")","  \"The Kindling's a Rathai-built sloop,\" Kessara said. She was quiet for a moment. She was never quiet. \"Fast hull design. She's making better time than us.\" She did the math. \"She left six days ago and she's only that far ahead. Either the currents were bad or she stopped somewhere.\"","","  She looked at the silhouette on the horizon. Then at her hands. Then at the silhouette again.","","  \"That's a Rathai captain. Running a Rathai ship. On the actual Kingsrun.\" She said it to the ocean, not to you. \"We'll be on a parallel heading to Galluun's Tooth. We might dock at the same time.\" She adjusted something on the tiller that didn't need adjusting. \"I just \u2014 I didn't expect to see one of us out here already.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  \"Suuba Mettani,\" Sullavenne said. \"Wardensea file says she's the least dangerous of the eight CG captains. That assessment is wrong \u2014 she's the least obvious. There's a difference.\" She watched the distant ship. \"The Wardensea has underestimated her for two years. Everyone has. She keeps surviving. That's not luck, not for two years.\"","","The Kindling's silhouette held on the horizon as the sun dropped. Two ships. Same ocean. Same direction. One with a bounty of 275 million and a crew of eleven. One with no bounty and a crew of four and a captain whose name meant nothing to anyone outside a highland village that had thrown him out.","","The distance between them was measured in miles. The distance between what they were and what you were was measured in everything else.","","The sun went down. The ocean went dark. The Kindling's running lights appeared \u2014 small points, orange, barely visible. You watched them the way you watched the bounty board at Selvaggio. Studying something that was ahead of you. Learning the shape of the gap between where you were and where you needed to be.","","*page_break","","The night was vast.","","Past the shelf, the overcast broke for the first time since Selvaggio. The stars were there \u2014 thousands of them. The highland constellations your mother had taught you \u2014 the Horned Walker, the Chain, the Opened Hand \u2014 and below them, southern stars you'd never seen. New patterns. Unnamed.","","The crew slept. Sullavenne had taken first watch at the bow. Kessara's Grimoire glowed faintly in the forward compartment \u2014 she'd fallen asleep mid-calculation. The Kindling's lights were still visible on the southern horizon.","","The Kingsrun had begun.","","The ocean didn't care who you were. Four thousand miles of salt water that would treat you the way it treated everyone \u2014 with indifference. That was fine. The highlands had prepared you for indifference. The exile had refined it.","","You were here. On the water. Heading south. With four people and a ship held together by repairs and stubbornness and the specific kind of hope that knows it's foolish and goes anyway.","","*if (bell_rings = 2)","  You'd rung twice. The promise was made. Selvaggio would see you again \u2014 not as the half-blood exile who'd scraped together a crew and a ship, but as something else. Something the betting board hadn't accounted for. Something the two-hundred-to-one odds hadn't imagined.","","*if (bell_rings = 1)","  You'd rung once. Safe journey. No promises. The ocean didn't deal in promises and neither did you. What happened next would happen because you made it happen, not because you'd asked the bell for permission.","","The stars wheeled. The water moved. The ship sailed south.","","And somewhere ahead, past the Kindling's lights and the dark water and the six stops between here and the edge of the known world, the Kingsrun waited \u2014 ancient, indifferent, and open.","","*page_break","","*comment ===================================================","*comment  END OF CHAPTER 1: SELVAGGIO \u2014 \"The Gate\"","*comment  MC Status: Has ship (Sundered Wake), crew of 4,","*comment  heading south toward Galluun's Tooth.","*comment  Kingsrun declared. Departure bell rung.","*comment  The Kindling (Suuba Mettani, CG) sighted ahead.","*comment ===================================================","","Chapter 1 \u2014 Selvaggio: The Gate","","Ahead: the Kindling. The Kingsrun. Sixteen stops between here and the end.","","Behind: the highlands. The exile. The bell.","","*goto_scene ch2_galluuns_tooth_approach",""], "labels":{"departure":147}},
"ch2_galluuns_tooth_approach": {"crc":1251969152, "lines":["*comment ===================================================","*comment  CHAPTER 2: GALLUUN'S TOOTH \u2014 \"The First Scrape\"","*comment  Scene 1: Approach","*comment  2-3 days of open ocean. MC's first time on open","*comment  water. Crew dynamics. Navigation challenge at the","*comment  reef approach. Grimoire broadcast \u2014 wider Kingsrun","*comment  update. 2 real choices. Zero fake choices.","*comment ===================================================","","The ocean was trying to kill you.","","Not actively. The Bastion Sea treated the Sundered Wake the way a mountain treats a fly: with the absolute indifference of something so large it doesn't register your existence. The swells came from the south in long, rolling sets \u2014 eight seconds between crests, each one lifting the ship and dropping it with a motion that began in the hull and ended in your stomach.","","You were sick by noon of the first day.","","The humiliation was specific and terrible. Six foot seven, broad, two hundred and sixty pounds of highland Oni \u2014 and you were gripping the port rail with both hands, watching the horizon pitch and roll, and losing the breakfast Terrek had cooked with such care three hours earlier.","","The ocean didn't care that you'd survived the highlands. The ocean didn't care about the dock fight or the bell or the two-hundred-to-one odds. The ocean was flat and grey and endless and it moved, constantly, in a rhythm your body had never learned.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek appeared beside you. He said nothing. He set a cup of clear water and a piece of dry flatbread on the rail and waited until you acknowledged them.","","  \"Ginger root in the water. Settles the \u2014\" He gestured vaguely at the situation. \"The everything.\" He paused. \"My mother had a saying about the sea and big people. I can't remember it. Something about size not mattering to waves.\" He frowned. \"That wasn't it. Anyway. Drink the water.\"","","  He left. The water helped. The flatbread stayed down. The horizon kept moving.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was fine. The Rathai apparently had the constitution of a dock rat \u2014 she ate, she worked, she navigated, and the swell that was destroying you was an inconvenience she compensated for with wider feet and a lower center of gravity.","","  \"It's the inner ear,\" she said, not looking up from the chart she'd pinned to the tiller housing. \"Your body thinks \u2014 basically your eyes and your balance are having an argument and your stomach is losing.\" She tapped something on the chart. \"Two days. Three, maybe, for \u2014\" She stopped. Looked at you. Had the decency to not finish the sentence.","","  \"Watch the horizon. It helps. Or it doesn't. One of those.\"","","The first day was endurance. The ship moved. The ocean moved. Your body learned, slowly and with resistance, that the ground was no longer ground. The deck pitched. The rigging sang. The sails caught wind that smelled like nothing \u2014 no ash, no volcanic mineral, no highland pine. Just salt and distance.","","By evening, the sickness faded to a dull ache behind the eyes. You could stand upright without gripping something. The horizon was a line \u2014 grey-blue, ruler-straight, unbroken in every direction. You'd never seen a horizon without mountains on it. The highland sky was always interrupted \u2014 peaks, ridges, the Stormspire's silhouette against the thunderheads. Here the sky went all the way down and there was nothing at the bottom except water.","","*page_break","","The second day was better.","","The body adjusted. The inner ear stopped arguing with the eyes. The deck's motion became background \u2014 still present, still felt, but no longer an emergency. Your weight found the ship's rhythm. The roll became a timing you could anticipate, and anticipation turned into balance, and balance turned into something approaching competence.","","A highland Oni learning to walk on water. The deck's pitch and roll had become a rhythm instead of an argument.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne ran the ship like a patrol vessel. The Wardensea in her emerged fully on the open water \u2014 she had a name for every rope, a protocol for every task, and a tone of voice that turned suggestions into orders without changing a syllable.","","  \"Watch rotation: four hours on, eight off. I'll take dawn. Terrek takes noon. You take dusk.\" She looked at you. \"Captain takes the hardest watch. Tradition.\"","","  Dusk watch meant the transition from day to night \u2014 the hour when the light changed and the horizon blurred and objects on the water became difficult to judge. The hour when a ship could hit something it didn't see.","","  \"I'll train you on the tiller when you can stand without leaning,\" she said.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara spent the second day in the bilge.","","  The bilge was the lowest interior space of the ship \u2014 below the cargo hold, below the crew quarters, a dark and wet and miserable compartment where the hull's health was measured in how much water collected. The Sundered Wake's bilge was bad. Kessara emerged from below decks with grease on her forehead and a wrench in her hand that she was holding the way some people hold grudges.","","  \"Three seams are weeping. Which \u2014 okay, that sounds bad but it's not, it's \u2014 well, it's not good. The caulking dried out. A month in a berth, that happens.\" She wiped her hands on a rag that was already past saving. \"I've re-caulked two. The third one is the sternpost joint and I can't \u2014 I need the whole ship hauled for that. So for now we just bail. Half a bucket, every four hours. If it gets worse I'll \u2014\" She waved the rag at the hull in a vague, encompassing gesture. \"I'll know.\"","","  She went back down. You could hear her talking to the hull. The conversation was profane and affectionate.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek cooked.","","  The ship's galley was a trial \u2014 the brick firebox worked, but the sea's motion turned every meal into a negotiation between the cook and gravity. Pots slid. Oil sloshed. The spice sack swung from its hook like a pendulum and Terrek followed it, adjusting, compensating, producing food that had no right to be as good as it was.","","  The second night's dinner was rice pressed into cakes and fried, with a fish he'd caught himself \u2014 trailing a line from the stern, an old method his mother had shown him. The fish was small and bony and he deboned it with the speed of someone who'd done it ten thousand times.","","  \"I've seen crews fall apart over food,\" he said, serving it on the deck in the last light. \"Three nights of the same rice and suddenly it's the captain's fault. It's never about the rice. It's always about the rice.\" He deboned a section, hit a bone he missed. Picked it out with his fingers. \"You won't have that problem. Probably. Unless someone complains about the bones.\"","","  He looked at the horizon. Looked at you.","","  \"Don't complain about the bones.\"","","*page_break","","The Grimoire woke on the morning of the third day.","","Kessara had it wedged in the tiller housing, tuned to the Kingsrun Watch frequency. The signal was weaker out here \u2014 the relays at Selvaggio were behind them, and the next relay was at Galluun's Tooth, still a day ahead. The broadcast came through in fragments, the voice cutting in and out.","","\"\u2014 Kingsrun Watch \u2014 Veshanna Torc \u2014 update from the southern route \u2014\"","","Static. The crew gathered. Even Sullavenne came aft from the bow, which was as close to social as she got.","","\"\u2014 Grimoire broadcast from Brannach. The Regrade \u2014 Kovesse Thrallek's Inheritors \u2014 reported a volcanic event near Stop Four. Lateral eruption, fissure collapse in the mining district. No crew casualties but significant hull damage from debris. The Inheritors are docked at Brannach for repairs \u2014 estimated two weeks before they move south.\"","","Kessara whistled. Low.","","\"Kovesse Thrallek. The one with the dead mother.\" She looked at the Grimoire. \"Her mother was Ghorvenne Thrallek. She ran the Kingsrun thirty-nine years ago and never came back. Kovesse took her crew's children, her route, and started over. The whole crew is a legacy expedition that got serious.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  \"Hundred and ninety million bounty,\" Sullavenne said. \"Second-generation Kingsrun crew. The Wardensea has a standing surveillance order on the Inheritors \u2014 not a threat assessment, an observation note. Kovesse hasn't done anything illegal. She just keeps going south, and the Wardensea can't figure out why.\"","","The broadcast continued:","","\"\u2014 bounty update from the MEAB: Tomoe Gallacs has crossed the 700 million mark following a confirmed engagement with Wardensea patrol vessels near Stop Eight. Details are sparse but the Broadwave is reporting two Wardensea ships disabled and one impounded. That's Tomoe at seven hundred and change \u2014 the second-highest active bounty in the Cursed Generation. The Reckoning's Kollivaan Gesst had this to say: 'That's not a bounty. That's a job application for the end of the world.' Kingsrun Watch will follow up. Torc out.\"","","Seven hundred million. Tomoe Gallacs \u2014 the name from the Departure Row Grimoire, the bounty that had made the bar go quiet. She was out there, past the stops you hadn't reached yet, fighting the Wardensea and winning. Her bounty was climbing the way mountains climbed \u2014 slowly, inevitably, and the view from the base was steep.","","*set met_tomoe false","","The world was larger than Selvaggio had shown you. The Kingsrun was longer. The people on it were faster and harder and further ahead.","","And the Kindling was still visible. Ahead. Closer than yesterday.","","*page_break","","Galluun's Tooth appeared on the afternoon of the third day.","","The reef announced itself before the island did. The water changed color \u2014 from the deep blue of the open Bastion shelf to a milky turquoise that shallowed in patches. The swell shortened. The ship's motion shifted from the long, rolling rhythm of deep water to a choppier, less predictable pattern that said the bottom was rising.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was at the helm, chart in one hand, Grimoire in the other, the tiller wedged against her hip. She was navigating by overlay \u2014 the chart showed the reef structure as it had been mapped six months ago, and the Grimoire showed current readings that didn't quite match.","","  \"The currents shift with the tide cycles,\" she said. \"That means the chart is accurate for the general layout but wrong for the actual channels. We need to find the entry passage \u2014 there's one way in and one way out, and if we miss it, we're on the reef.\"","","  She adjusted the tiller. The ship responded.","","  \"I need someone at the bow. Eyes on the water. The coral heads show as dark patches under the surface \u2014 anything darker than the surrounding blue, call it out.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne went to the bow without being asked. She braced against the bowsprit and looked down at the water with the focused attention of someone conducting a threat assessment of the ocean floor.","","  \"Coral head. Twenty feet. Port side.\"","","  The ship adjusted.","","  \"Another. Forty feet. Dead ahead.\"","","  Kessara swore and hauled the tiller. The ship turned. The keel passed over something that you felt in the deck \u2014 a vibration, not a strike, the proximity of stone through water through wood through your boots.","","  \"That was close,\" Kessara said. \"I need more lead time. Call them at fifty feet, not twenty.\"","","  \"I'll call them when I see them,\" Sullavenne said. Which was, in her language, an agreement.","","The approach was slow. Thirty minutes of creeping through shallowing water, the crew silent except for Sullavenne's calls from the bow and Kessara's responses from the helm. The reef was everywhere \u2014 visible through the clear water as dark masses that rose from the sand floor like ruins, branching and sharp-edged, the kind of stone that would open a hull like a knife through canvas.","","Galluun's Tooth resolved from the haze. A coral fang island \u2014 the name was literal. The island was a single ridge of white-grey coral and limestone that rose from the reef like a broken tooth, a hundred feet at its highest point, half a mile long. The vegetation was scrub and palm. The anchorage was a natural gap in the reef on the island's west side \u2014 a channel maybe sixty feet wide, flanked by coral walls that rose to within five feet of the surface at low tide.","","One way in. One way out.","","*page_break","","The channel.","","The entry was tighter than it had looked from a distance. The Sundered Wake was forty-four feet at the beam \u2014 the channel was sixty. That left eight feet of clearance on each side. Eight feet between the hull and coral that would gut the ship.","","The current was moving. The tide was shifting \u2014 Kessara had timed the approach for slack water, the brief window between incoming and outgoing when the current paused. But slack water at Galluun's Tooth lasted maybe fifteen minutes, and they'd spent twenty on the reef approach.","","The current was waking up. You could feel it \u2014 a lateral pressure on the hull, gentle, the beginning of the outgoing tide. The ship drifted. Kessara fought the tiller.","","\"The current is pulling us starboard. I'm compensating but the rudder was rebuilt three days ago and the mount is \u2014 the mount is doing its best.\" Her voice was tight. Engineer-tight. The specific tone of someone who knows the tolerances and is watching them compress.","","*choice","  #Go to the bow yourself. You're the biggest thing on this ship \u2014 if it comes to pushing off a reef, you're the one who can do it.","    You went forward. Past the mast, past the hatch, to the bowsprit where Sullavenne was still calling depths. You stood next to her and looked down.","","    The coral was close. Five feet below the surface on the starboard side, rising in a wall of branched stone that ended in edges sharp enough to draw blood through a hull. The water was clear \u2014 you could see the bottom, see the coral, see the gap the ship was threading.","","    The current pushed. The hull drifted starboard. A foot. Two feet. The eight-foot clearance became six.","","    You leaned over the rail, reached down, and put your hand against the coral wall.","","    The impact was immediate \u2014 the coral cut your palm. The edges were razor and alive and the blood welled instantly, red in the clear water. But the ship stopped drifting. Your weight, braced against the bowsprit, your arm against the reef wall, your boots dug into the deck \u2014 two hundred and sixty pounds of highland Oni holding the ship off the reef by muscle and position.","","    *set personality_aggression %+ 3","","    The current pushed. You pushed back. The ship crept forward. Kessara worked the tiller. Ten feet. Twenty. Thirty. The channel widened. The coral fell away. The anchorage opened \u2014 calm water, protected, the flat turquoise of a reef-locked lagoon.","","    You pulled your hand back. The palm was bleeding freely \u2014 three cuts, deep enough to see white beneath the red. The coral had taken its toll.","","    *set supplies - 2","","    Sullavenne looked at your hand. Looked at you.","","    \"That was either brave or stupid.\" She paused. \"Both work.\"","","    *goto anchorage","","  #Trust Kessara at the helm. She rebuilt the rudder \u2014 she knows what it can do. Your job is to stay out of her way.","    You gripped the quarterdeck rail and watched. Kessara was at the tiller, both hands, her weight braced against the lateral pull. The ship drifted starboard. Two feet. Three. The coral wall was close enough to hear \u2014 a faint scraping sound as the water carried small debris against the hull.","","    *set personality_loyalty %+ 5","","    Kessara made a sound. It was the sound an engineer makes when a machine is about to exceed its tolerance and the engineer knows it and the only option is to push anyway.","","    She hauled the tiller hard to port. The rudder mount \u2014 rebuilt, three days old, functional but not good \u2014 groaned. The ship responded. Sluggish, reluctant, the bow swinging left by inches instead of degrees.","","    \"Come on,\" Kessara said. To the ship. To the rudder. To the rebuilt mount that she'd installed with her own hands on a dock at Selvaggio.","","    The ship cleared the starboard wall by three feet. The keel passed over a coral head that vibrated through the deck like a struck drum. Everyone on board felt it. Nobody breathed.","","    The channel widened. The current eased. The anchorage opened.","","    Kessara exhaled. The breath came out in a rush that contained three days of engineering stress and fifteen minutes of pure adrenaline.","","    \"The rudder held,\" she said. She looked at her hands on the tiller. They were shaking. \"The rudder held.\"","","    *set crew3_loyalty + 5","","    *goto anchorage","","*label anchorage","","*page_break","","The anchorage at Galluun's Tooth was a different world.","","Inside the reef, the water was flat. Turquoise and still, protected from the ocean swell by the coral walls that surrounded the lagoon on three sides. The bottom was visible \u2014 white sand, scattered coral, the dark shapes of fish moving in schools. After three days of open ocean, the stillness felt wrong. The body kept bracing for a swell that didn't come.","","The island itself was small. A hundred buildings \u2014 if you could call them that. Wooden frames with palm-thatch roofs, stacked along the ridge in tiers that followed the coral's natural contour. Drying racks lined the waterfront, hung with fish and coral shards and lengths of something that might have been seaweed. The smell was salt and fish oil and the dense organic warmth of a community that lived by the reef and didn't pretend otherwise.","","Four hundred people. Maybe fewer. The entire population of Galluun's Tooth would fit in a single Selvaggio tavern.","","The dock was a wooden jetty that extended thirty feet into the lagoon. Three ships were moored \u2014 two fishing boats, wide and flat, and one that was neither.","","The third ship was a sloop. Single-masted, sleek, with a dark red hull and a sail furled with the tight precision of a crew that knew their rigging. The design was Rathai \u2014 you could tell by the hull shape, which prioritized speed over cargo capacity. Narrow at the beam, deep at the keel, built to cut water rather than carry it.","","A flag hung from the mast. Black cloth with a symbol in orange \u2014 a flame shaped like an open hand.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara stopped moving. The tiller forgotten. Her eyes on the sloop.","","  \"That's the Kindling,\" she said. Her hand went to the tiller housing and stayed there, fingers spread flat against the wood like she needed something solid. \"Rathai-built. Nettleworks yard, if I'm reading the keel shape right. That hull was designed by someone who \u2014\" She swallowed. Her other hand found her tool harness, adjusted a buckle that didn't need adjusting. Started over. \"The keel ratio. You can't fake that ratio.\"","","  She looked at you. \"Suuba Mettani is here.\"","","The Kindling. The ship they'd sighted on the horizon at sunset three days ago. The Cursed Generation crew with the smallest bounty and the biggest chip on their shoulder. They'd made it to Galluun's Tooth ahead of you \u2014 of course they had, they'd left six days earlier \u2014 and they were still here. Docked. Waiting, or resting, or planning. Present.","","The Sundered Wake drifted to the dock. Sullavenne tossed the mooring line. A dock worker \u2014 human, young, brown from the sun \u2014 caught it and tied it off with the casual competence of someone who'd secured a thousand ships.","","\"Welcome to Galluun's Tooth,\" he said. Then he looked at the Sundered Wake's hull. At the patches. At the replaced planking. The welcome died somewhere in his throat. \"Fish market opens at dawn. Boatwright's on the south end. She's \u2014 you'll want the boatwright.\" He tied off the line. Untied it. Retied it better.","","He looked at the Kindling, then back at you.","","\"Your neighbor doesn't bite. She offered me a fish yesterday. I don't know what that means yet.\"","","*page_break","","You stepped off the ship and onto solid ground for the first time in three days.","","The dock didn't move. The ground was still. The body took a moment to recalibrate \u2014 after three days of constant motion, the stillness felt like a new kind of instability. Your legs remembered land slowly, like reuniting with an old language.","","The island was quiet. After Selvaggio's roar, the silence was physical \u2014 you could feel it on the skin, a reduction in pressure. No crowds. No food carts. No Grimoire broadcasts playing from every stall. Just the lapping of the lagoon, the creak of drying racks, the distant sound of someone hammering coral at the ridge top.","","The crew disembarked behind you. Kessara first, her tools clanking, already scanning the dock for repair materials. Terrek with a canvas sack \u2014 heading for the fish market by instinct, drawn to food the way Kessara was drawn to broken things. Sullavenne last, her coat buttoned, her notebook out.","","The Kindling's crew was on their ship. You could see them \u2014 eleven people on a sloop that looked designed for twelve, moving on deck with the loose efficiency of a crew that had been sailing together long enough to skip the communication. A Rathai woman sat on the bowsprit, her legs dangling over the water, a Grimoire in her lap. She was small \u2014 five foot two, maybe less. Dark hair, cut short, with the Nettleworks complexion: pale from years of indoor assembly work, freckled from recent sun.","","She looked up as you stepped onto the dock. Looked at the horns. The height. The ash-white skin. The storm-leather coat that was highland Oni in a place where highland Oni didn't come.","","Her expression did something. Not surprise \u2014 assessment. The same measuring look that everyone gave you, but faster, sharper. Rathai processing speed.","","She went back to her Grimoire. Filed you. Moved on.","","Suuba Mettani. Two hundred and seventy-five million Sovereigns. The underdog of the Cursed Generation. Twenty feet away and utterly uninterested in you.","","That was fair. You had no bounty, no name, and a ship that had nearly killed itself on the reef getting here. In her world, you were noise. Background. The kind of crew that filled the Kingsrun's margins and disappeared between stops.","","*choice","  #Stop at the dock rail. Hold your ground twenty feet from the Kindling. Let Suuba Mettani file you away \u2014 and then don't move. Make her look twice.","    *set personality_aggression %+ 4","    *set met_suuba true","    *set rival_suuba + 5","    *goto suuba_stare","","  #Walk past the Kindling toward the fish market. Suuba Mettani measured you and found nothing worth remembering. Fair enough. You've got a hull to fix and a crew to feed.","    *set personality_loyalty %+ 3","    *goto suuba_ignore","","  *if (crew3_name = \"Kessara Veldt\")","    #Catch Kessara's eye. Tilt your head toward the Kindling. She's Nettleworks \u2014 they're Nettleworks-built. That's a door. Let her open it.","      *set personality_openness %+ 4","      *set crew3_loyalty %+ 3","      *set met_suuba true","      *goto suuba_kessara","","*label suuba_stare","","You didn't follow the crew toward the market. You stopped at the dock rail \u2014 hands flat on the wood, weight settled, the posture of something large and patient and not going anywhere.","","Twenty feet of harbor water. The Rathai woman on the bowsprit. Her Grimoire.","","She didn't look up for thirty seconds. Then she did.","","The second assessment was slower than the first. Not Rathai processing speed this time \u2014 something more deliberate. She tracked the horns. The coat. The hands on the rail that hadn't moved.","","\"You're still here.\" She said it flat, the way someone notes a weather change. Not a question. Comma-splice Rathai, the cadence of Nettleworks factory talk bled into everything.","","Her eyes went to the Sundered Wake's hull. To the scarring from the reef channel. To the waterline, which told her everything about cargo weight, which was nearly nothing.","","\"Cold entry. No funding. Salvage hull. Crew of \u2014 three? Four?\" She counted masts, sail condition, deck traffic. \"Four. One ship, four warm bodies, and a reef scar that says your navigator got lucky or your helmsman is good.\" She shrugged. \"One of those is useful.\"","","She went back to her Grimoire. But the dismissal was different this time. She'd looked twice. She'd used sentences. On the Kingsrun, that was something.","","Suuba Mettani, 275 million Sovereigns, had acknowledged that you existed. The cost was standing still while a woman half your size decided you were worth seven seconds of her time.","","*goto afternoon_logistics","","*label suuba_ignore","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was staring at the Kindling's hull. The Rathai professional interest had transformed into something more personal \u2014 a Nettleworks-born engineer looking at a Nettleworks-built ship. Home. The closest thing to home she'd seen since Selvaggio.","","  \"I want to talk to their engineer,\" she said. Quietly. The ambition was visible, but so was the hesitation. A Cursed Generation crew didn't talk to nobodies.","","  She shook it off. \"Later. We have a hull to check and provisions to source. Market first.\"","","You walked past the Kindling without slowing. Suuba Mettani didn't look up. You didn't expect her to. The Kingsrun sorted people into categories \u2014 threat, opportunity, background \u2014 and you were background until something changed. Fine. Let something change.","","*goto afternoon_logistics","","*label suuba_kessara","","Kessara had been staring at the Kindling's hull since the ship came into focus \u2014 the Rathai professional interest turned personal. Nettleworks-born, looking at a Nettleworks-built sloop. The lines, the joinery, the specific angle of the bow rake that said Tinthread yard, third-generation design.","","\"I want to talk to their engineer,\" she'd said. Quiet. The hesitation was visible.","","You caught her eye. Tilted your head toward the Kindling. The message was clear: go.","","Kessara blinked. \"They're Cursed Generation. They don't \u2014\"","","But she was already moving. The pull was stronger than the doubt. She walked the dock toward the Kindling with the focus of an engineer approaching a machine she'd read about but never touched.","","A Rathai man on the Kindling's deck \u2014 rail-thin, oil-stained to the elbows, a wrench tucked behind one ear like a quill \u2014 saw her coming. Nettleworks recognized Nettleworks. The conversation started before she reached the gangway.","","\"Trestle-mount or crossbeam?\" he called down.","","\"Trestle, third generation, with the modified strake.\" Kessara called back. Her voice had changed \u2014 faster, the sentences clipping into Rathai engineering shorthand.","","\"Modified strake is shit,\" the man said. \"I pulled it out at Selvaggio and replaced it with a Chalkwall beam. You want to see?\"","","Kessara looked back at you once. The expression was something between gratitude and the look of a woman who'd just been handed the keys to a locked room.","","She went aboard.","","Suuba Mettani watched the exchange from the bowsprit. She looked at you \u2014 the captain who'd sent his engineer to her ship. The measuring look again. This time it stayed three seconds longer.","","She didn't say anything. She didn't need to. The acknowledgment was in the duration.","","*goto afternoon_logistics","","*label afternoon_logistics","The afternoon was logistics. Water from the cistern. Fish from the market \u2014 fresh, a luxury after three days of dried provisions. A boatwright's assessment of the Sundered Wake's hull that cost four Silver Spans and produced a list of repairs that cost more than that.","","Galluun's Tooth was small and practical and completely indifferent to ambition. The people here caught fish, harvested coral, and watched Kingsrun crews come and go the way a lighthouse watches ships. They'd seen a thousand crews. They'd remember none of them.","","Except the ones who carved their names on the reef wall.","","The First Scrape. The tradition. Tomorrow, at low tide.","","*if (crew5_name = \"Sullavenne Ohn\")","  \"Low tide is at dawn,\" Sullavenne said. \"The reef walk to the wall takes forty minutes. The carving surface is on the south face \u2014 I asked the dock worker.\" She checked her notebook. \"Every Kingsrun crew that reaches Galluun's Tooth carves their name. The wall goes back forty years.\" She paused. Flipped a page. \"Thirty. Forty. The dock worker said both. I should have asked twice.\"","","  She wrote something in the margin. A correction, or a reminder to make one.","","  \"Suuba Mettani's crew carved theirs six days ago. 'KINDLING \u2014 METTANI \u2014 We Were Here First.' The dock worker says she did it herself. He seemed impressed. Or afraid. He had the same face for both.\"","","The sun set over the reef. The lagoon went from turquoise to copper to black. The stars came out \u2014 the same southern stars from the open ocean, but brighter here, closer, the reef island's low profile letting the sky down to the horizon.","","Tomorrow. The First Scrape. Your name on a wall that stretched back four decades, added to a list of crews who'd passed through and kept going south.","","The Kingsrun's second stop. The first proof that you'd survived the ocean.","","*goto_scene ch2_galluuns_tooth_port",""], "labels":{"anchorage":204,"suuba_stare":279,"suuba_ignore":301,"suuba_kessara":314,"afternoon_logistics":344}},
"ch2_galluuns_tooth_port": {"crc":-1849710255, "lines":["*comment ===================================================","*comment  CHAPTER 2: GALLUUN'S TOOTH \u2014 \"The First Scrape\"","*comment  Scene 2: Port","*comment  Fish market. Encounter with the Kindling crew.","*comment  Suuba Mettani \u2014 the CG underdog. Crew bonding","*comment  moment. Hull assessment. Setup for the reef scene.","*comment  2 real choices. Zero fake choices.","*comment ===================================================","","The fish market at Galluun's Tooth opened with the sun.","","The entire south dock transformed \u2014 what had been empty planking the night before was now covered in wooden tables, each one holding the morning's catch laid out on beds of wet palm fronds. Fish of species you'd never seen: long silver things with translucent fins, flat-bodied reef dwellers with colors that shouldn't have existed in nature, something with too many legs that a vendor was cracking open with a stone mallet, the shell giving way to reveal meat the color of sunset.","","The sellers were locals \u2014 reef fishers, brown and wiry, with hands scarred by coral and a specific patience that came from living on an island where the tide determined everything. They didn't shout. Selvaggio's vendors had been performers \u2014 loud, competitive, working the crowd. Here, the fish was on the table. You looked or you didn't.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was already deep in the market. He'd been the first off the ship at dawn, canvas sack in hand, moving through the tables with the focused intensity of someone doing the most important work of the day. You could track him by the wake he left \u2014 vendors turning to watch the tall human who handled their fish with a cook's intimacy, pressing the gills, checking the eyes, sniffing the skin.","","  He came back with a sack that moved. And a second sack that didn't.","","  \"Reef bass. Three of them, still alive. The vendor tried to sell me yesterday's catch first \u2014 the eyes were cloudy. These are this morning's. Eight coppers for the three, which is robbery, but we're on an island and the island knows it.\" He held the sack at arm's length. Something inside it flopped. He glanced at the second sack. \"That one I bought by accident. I pointed at it and apparently pointing means buying here. I don't know what it is. It might be a vegetable.\"","","  \"Tonight I'm making a stew. Proper stew \u2014 bone broth, reef herbs, the rice we brought from Selvaggio. First real meal on the ship that isn't survival cooking.\" He looked at the sack with the affection of a man looking at a problem he was born to solve. \"This is what the galley is for.\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was not at the market. Kessara was under the ship.","","  She'd found the boatwright's yard at the south end of the island \u2014 a cleared section of reef flat with wooden blocks for hull work and a Gorundai woman named Pellanne who ran it with three apprentices and a vocabulary that made Kessara sound polite.","","  The Sundered Wake had been hauled onto the blocks at first light. The hull was exposed \u2014 the full length of it, keel to waterline, visible for the first time since you'd claimed her at Selvaggio.","","  The assessment was not encouraging.","","  \"The sternpost joint is separating,\" Kessara reported, standing in the boatwright's yard with grease to her elbows. \"That's the one I couldn't fix at sea. Pellanne says it needs new caulking and a backing plate \u2014 three days of work. We can't leave until it's done.\"","","  She pulled a strip of caulking from her tool harness. Fibrous. Black.","","  \"I can do two of the three days myself. The backing plate needs Pellanne's forge. That costs money we don't have much of.\" She looked at the hull, at the separation in the sternpost where daylight showed through gaps that should have been sealed. \"If we skip this and the joint opens at sea, the rudder mount goes. And if the rudder mount goes \u2014\"","","  She stopped there.","","The morning was warm and still. The lagoon held the heat and reflected it \u2014 by midday, the air shimmered above the water and the coral ridge threw back the light in a white glare that made your eyes narrow. The highland air had been thin and cool. This was thick and heavy and tasted like salt that had been heated until it sweated.","","You walked the island. It took forty minutes \u2014 end to end, ridge top to waterline, the entire territory of four hundred people who lived on a tooth of coral in the middle of the Bastion Sea. The ridge was the spine. Everything built on it faced the lagoon. The ocean side was cliff \u2014 thirty feet of bare coral dropping to the reef, white water at the base where the swell broke against the island's exposed face.","","At the ridge top, a cistern collected rainwater. At the south end, the boatwright's yard. At the north end, a stone platform that served as the island's gathering space \u2014 flat, worn smooth by generations of feet, with a view of the lagoon and the reef channel and the open ocean beyond.","","The Kindling's crew was on the stone platform.","","*page_break","","Eight people. You counted them from thirty feet away, approaching along the ridge path. They sat in a loose circle on the stone, eating from a shared pot, talking over each other in the rapid-fire way of a crew that had been together long enough to skip the politeness.","","A Varrek man \u2014 tall, angular, with the grey-blue skin of his race and the posture of someone who measured everything before speaking \u2014 sat at the edge of the circle with a Grimoire in his lap, running calculations. A human woman, big and cheerful, was eating from the pot with a spoon she'd clearly stolen from someone else, based on the Rathai man next to her who was pointing at it and complaining without much conviction.","","And at the center, Suuba Mettani.","","She was smaller than she'd looked on the bowsprit. Five foot one, maybe five foot two. The dark hair was cropped close, and the Nettleworks pallor was giving way to the freckled tan of someone who'd been at sea long enough for the sun to make an argument. She sat cross-legged, a bowl balanced on her knee, talking with her hands \u2014 a Rathai habit of using gesture to supplement speed, words and motion interleaving.","","She stopped talking when she saw you.","","The entire Kindling crew turned. Eleven pairs of eyes on a 6'7\" half-Oni in a storm-leather coat walking toward them along a coral ridge on an island where nobody walked unless they had a reason.","","The Varrek man \u2014 Drossik Verath, you'd learn later \u2014 put his hand flat on the Grimoire. A ready gesture. The human woman set down her stolen spoon. The Rathai Grimoire specialist \u2014 Khellen Truss \u2014 tilted her head the way you'd seen vendors tilt their heads at incoming weather.","","Suuba looked at you. Up. The height difference was over a foot and a half, and sitting down, she had to crane her neck to find your face.","","\"The ketch,\" she said. \"Sundered Wake. You nearly took out the channel wall coming in yesterday.\" She ate a bite. \"I was going to shout a warning but \u2014 actually I wasn't. I wanted to see what happened.\"","","She'd been watching.","","\"Sit down or don't. But if you're going to stand there being \u2014 however tall you are \u2014 I'm going to get a crick in my neck, and I don't forgive neck injuries.\"","","*choice","  #Sit. You've been measured by everyone since Selvaggio. The Cursed Generation can measure you too.","    You sat. The stone was warm from the sun and the circle shifted to accommodate you \u2014 your frame required it. The human woman scooted. Drossik moved his Grimoire. The gap that opened was the familiar six-inch buffer you'd learned to expect and stopped resenting.","","    *set personality_openness %+ 5","    *set met_suuba true","","    Suuba watched you settle. Her eyes moved over the storm-leather coat, the unfinished tattoos, the ram horns. The assessment was fast and thorough and she didn't bother hiding it.","","    \"Highland Oni. Half, from the skin.\" She pointed at your forearms. \"Sennaku ink. The lines stop halfway \u2014\" She paused. The fork hovered. She'd been about to say something glib and then hadn't. \"That's none of my business, actually. Sorry. I do that \u2014 I read people faster than I should and then say it out loud. It's a problem.\"","","    The circle was quiet. The crew ate and listened with the quiet attention of people who took their cues from their captain.","","    \"I'm Suuba. This is Drossik, Khellen, Hollenne \u2014\" she gestured around the circle, names attached to faces with a speed that assumed you'd keep up \"\u2014 and the rest of them are the reason I haven't died yet.\"","","    \"Yet,\" said the Varrek \u2014 Drossik \u2014 without looking up from his Grimoire.","","    \"The optimism is what holds us together,\" Suuba said. She turned back to you. \"Sundered Wake. Crew of four. Salvage-claim ketch. Selvaggio board had you at two hundred to one.\" She tilted her head. \"How much of that ship did you rebuild before you left?\"","","    *goto kindling_talk","","  #Stay standing. You're not here to sit with a Cursed Generation crew. You're here to take the measure of the island.","    You stayed upright. The height difference worked in reverse \u2014 standing over a seated circle gave you the advantage of observation, the familiar ground of being the largest thing in any space.","","    *set personality_aggression %+ 3","    *set met_suuba true","","    Suuba looked up. The angle was steep. She held it without complaint.","","    \"Standing. Okay. The highland thing \u2014 the elders don't sit with people they haven't decided to trust yet. My engineer reads.\" She gestured at the Varrek with the Grimoire. \"Drossik. He studies every culture we encounter. Calls it 'social cartography.' I call it being nosy.\"","","    Drossik didn't look up. \"It's both.\"","","    Suuba turned her attention back to you. \"Sundered Wake. Crew of four. You came through the channel yesterday like a drunk through a doorframe. How much of that ship did your engineer rebuild at Selvaggio?\"","","    *goto kindling_talk","","*label kindling_talk","","*if (crew3_name = \"Kessara Veldt\")","  Kessara appeared. She'd climbed the ridge path from the boatwright's yard, grease on her hands, a question on her face that turned into recognition when she saw the Kindling's crew.","","  \"That's \u2014\" She stopped herself. The Rathai composure locked into place. \"Captain Mettani.\"","","  Suuba looked at Kessara. At the tool harness. At the grease. At the Rathai features \u2014 the build, the bone structure, the trained hands of someone from the Nettleworks engineering tradition.","","  \"Kessara Veldt,\" Kessara said. \"Engineer. Your ship's keel was designed by Torval Yard, second-generation hull mold. I could tell from the waterline.\"","","  Something happened in Suuba's face. The assessment shifted \u2014 from casual to interested.","","  \"Torval Yard closed three years ago,\" Suuba said. \"How do you know the mold?\"","","  \"I trained there. Apprentice. Before it \u2014\" Kessara's hands were moving \u2014 the tool harness adjustments she made when she was nervous. \"The beam-to-keel ratio. You don't see that ratio outside Torval.\"","","  Suuba set her bowl down. Picked it back up. Set it down again.","","  \"Sit down, engineer.\" The invitation had an edge that wasn't hostility \u2014 more like the sound of something clicking into place. \"Tell me what you see wrong with my ship.\"","","  Kessara sat. And for the next twenty minutes, two Rathai women spoke a language that consisted entirely of hull specifications, caulking compounds, and the particular failures of Nettleworks lumber supply chains. Most of it was jargon. But somewhere in the middle of it, Kessara stopped adjusting her harness, and somewhere after that, Suuba stopped eating, and by the end they were both leaning forward and finishing each other's sentences about sternpost metallurgy.","","  *set crew3_loyalty + 3","","Hollenne Goss \u2014 the human woman, the procurement specialist \u2014 shoved a bowl at you. Rice and fish and something that burned. The burning was intentional.","","\"So do Oni eat with the horns or \u2014\" She gestured at your head. The joke arrived in the silence like a bird hitting a window. Nobody laughed. Drossik's stylus stopped moving. Hollenne's grin held for two full seconds past its expiration, then she looked into her own bowl with sudden fascination.","","\"Khellen's recipe,\" she said, louder, as if volume could erase the last five seconds. Hollenne was grinning again, shakier. \"She puts reef pepper in everything. Says it keeps the crew alert. I say it keeps the crew angry. Same result.\"","","Drossik, the Varrek, was still running numbers on his Grimoire. He hadn't looked up once during the entire conversation. At some point he'd eaten an entire bowl of the rice without apparently noticing.","","Khellen Truss \u2014 the Grimoire specialist, small and sharp-featured, with the exact same Nettleworks pallor as Suuba \u2014 looked at you from across the circle.","","\"You're the \u2014 yeah, the broadcast. Cold entry.\" She was holding a Grimoire \u2014 basalt, expensive, clearly modified. The casing had extra runes carved into the side that didn't match the factory pattern. \"Two hundred to one, Torc said. She doesn't usually \u2014 I mean, she mentions people when she's going to keep mentioning them. If that makes sense.\" She turned the Grimoire over in her hands. \"It makes sense to me.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had followed at a distance. She stood at the edge of the stone platform \u2014 not joining the circle, not leaving. Observing. The Wardensea training was invisible to most people, but Drossik noticed. His grey-blue eyes tracked her, then returned to his Grimoire.","","  \"Your crewmate,\" he said to you, quiet enough that the rest of the circle wouldn't hear. \"Former military. The posture, the situational assessment, the position she chose \u2014 back to the wind, line of sight to the path, clear exit.\" He paused. \"Wardensea?\"","","  He didn't press when you didn't answer. The Varrek quantified. They didn't always require the data.","","Suuba was watching you. She'd been watching since you arrived \u2014 the small, steady gaze of someone who ran on anger and instinct and had survived two years of the Kingsrun on both.","","\"Two hundred to one,\" she said. \"You know what my odds were when we left Selvaggio? Hundred and fifty to one. A Rathai crew from the Nettleworks with a Kindling Fruit captain and a ship built at a yard that doesn't exist anymore.\" She ate. The food didn't seem to burn her. \"The Broadwave said we'd be dead by Merrenbach. The Reckoning said we'd be famous by Brannach. Kollivaan Gesst put money on us. Five hundred Gold Sovereigns.\"","","She looked at the lagoon. The turquoise water. The reef wall.","","\"We're still here. The Broadwave was wrong. The Reckoning was wrong too, but the good kind of wrong \u2014 we're not famous. We're alive.\" She turned back. \"That's better.\"","","The morning passed. The shared pot emptied. The Kindling crew drifted back to their ship by ones and twos \u2014 Drossik first, then the unnamed members, then Khellen with a backward glance at your crew's Grimoire setup that was equal parts pity and professional curiosity.","","Hollenne was last to leave. She stopped beside you on the path down from the ridge. Started walking. Stopped again.","","\"She liked you,\" Hollenne said. Then, quieter: \"Don't tell her I said that. She gets weird about it. She's got this whole thing where she pretends she doesn't care about people and then she cooks them breakfast.\" She rubbed the back of her neck. \"I don't know why I'm telling you this. I think the horns make you look like a good listener.\"","","She walked away. Three steps. Turned back.","","\"The stolen spoon thing \u2014 it's a bit. We've been doing it for eight months. She stole it from me first. Just so you know it's not \u2014 we're not actually fighting about a spoon.\" She walked away for real this time.","","*set rival_suuba + 10","","*page_break","","The afternoon was spent on the hull.","","Kessara and Pellanne worked the sternpost joint. The forge at the boatwright's yard was crude \u2014 a charcoal pit with a bellows, nothing like the industrial setups at Selvaggio \u2014 but Pellanne made it work. The backing plate took shape: flat iron, cut and bent to fit the joint's contour, drilled for bolts. Kessara installed it while lying on her back in the sand under the hauled ship, the low-tide water lapping at her legs.","","\"One more day,\" she said, emerging at dusk, covered in caulking compound and sand. \"The plate's in. The caulking needs to cure overnight. Tomorrow morning we re-launch and the sternpost is solid.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek cooked.","","  The stew. The real stew \u2014 the one he'd been planning since the fish market. The galley's brick firebox held the heat while the ship sat on the blocks, and the smell drifted across the boatwright's yard and up the ridge path and caught the attention of everyone within two hundred feet.","","  Reef bass, slow-cooked in a broth built from the bones. Rice from the Selvaggio provisions, washed three times. Reef herbs that a local woman had traded for a handful of the Selvaggio spices Terrek carried. The combination was \u2014 something. The stew was a thing that existed between the cook's skill and the ocean's gifts and the specific alchemy of a first meal at a new place.","","  He served it on the deck. The ship was on blocks, tilted at five degrees, and the bowls had to be held. Nobody complained. The food was too good for complaints.","","  \"Reef bass stew,\" Terrek said. \"My mother's recipe. More or less. She used river fish and I'm using reef bass so the flavor's \u2014 it's wrong, actually. The bones are different. River fish bones dissolve. These don't.\" He fished a bone fragment out of the pot with his fingers. \"She'd have told me to strain it. I didn't strain it.\"","","  He looked at the bowl in your hands. At the crew eating on the tilted deck, holding bowls at an angle because the ship was at an angle.","","  \"She'd have liked the stew and hated the angle.\"","","  *set crew4_loyalty + 5","","Night fell. The lagoon went black. The Kindling's running lanterns glowed from across the water \u2014 their ship was moored at the dock while yours sat on blocks, the difference in readiness visible and unflattering.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne sat on the hull blocks beside the ship, her notebook open in the lantern light. She'd been writing since sunset \u2014 a full entry, longer than her usual terse observations.","","  \"The Kindling's crew is competent,\" she said without looking up. \"The Varrek \u2014 Drossik Verath \u2014 identified me as former Wardensea within thirty seconds.\" She wrote a line. Crossed it out. Wrote it again. \"That bothers me more than it should.\"","","  She flipped to a new page.","","  \"Suuba Mettani has a God Fruit. Kindling \u2014 Element type.\" She paused. Pen still. \"She started the charcoal pit this morning without a flint. Her hand was in the coals. Nobody on her crew looked twice.\" She closed the notebook. Opened it. Added one more line.","","  \"She's heading the same direction we are.\" She looked at you, then away, then at the notebook as if it had the answer she couldn't say out loud.","","The stars came out. The southern constellations \u2014 the ones you'd first seen from the Sundered Wake's deck \u2014 were closer here, framed by the reef walls, bright against the velvet black. The Horned Walker was gone. You'd sailed past it. The highland sky was behind you, and the stars ahead were nameless.","","Tomorrow. Low tide. The reef walk. The First Scrape.","","You'd carve your name into a wall that went back forty years, and Suuba Mettani's inscription would be there beside it \u2014 proof that someone had beaten you to this point, and proof that the wall had room for one more.","","*choice","  #Sleep on the ship. The tilted deck is home now \u2014 you sleep where your crew sleeps.","    The deck was angled on the blocks. Your body wedged against the port rail, the storm-leather coat folded under your head, the stars visible through the gap in the furled sails. The ship creaked \u2014 the land-sounds of a hull at rest, different from the water-sounds, quieter, settled.","","    *set personality_loyalty %+ 3","","    Kessara was asleep in the forward compartment, her tools arranged in a semicircle around her like a ward. Terrek was in the galley, the stew pot cleaned and stored, his breathing steady. Sullavenne was somewhere above \u2014 probably the ridge top, watching the lagoon from the highest point.","","    The crew. Four people who'd become familiar in ten days. The sounds of their sleeping, the rhythm of their work, the specific way each of them occupied space \u2014 Kessara loudly, Terrek warmly, Sullavenne like a shadow that had learned to stand guard.","","    You closed your eyes. The tilted deck held you. Tomorrow.","","    *goto morning","","  #Walk the reef at night. You can't sleep. The island is small enough to learn in the dark.","    You left the ship. The boatwright's yard was empty \u2014 Pellanne and her apprentices had gone to their homes on the ridge. The tools were stacked. The forge was cold.","","    *set personality_openness %+ 3","","    The reef flat extended south from the yard \u2014 exposed coral, knee-deep water, the lagoon's edge where the sand gave way to living stone. You walked it. Barefoot \u2014 the boots stayed on the ship. The coral was rough under your feet but not sharp, worn smooth by the tide's daily transit.","","    The water was warm. Warmer than the air. The lagoon at night was a different creature \u2014 still, luminous at the edges where something biological glowed in the shallows. Green light, faint, pulsing. Bioluminescence. You'd never seen it. The highlands had stars and lightning and the volcanic glow of the caldera. The ocean had this \u2014 light that came from below, from living things you couldn't see.","","    You walked until the water was waist-deep. Warm on the skin. The coral floor solid beneath your feet. The lagoon stretched around you \u2014 black water, green light, the reef wall a dark line against the stars.","","    You could swim. Highland Oni swam in the volcanic lakes \u2014 warm water, mineral-dense, shallow enough that the bottom was always visible. The ocean was different. Deeper. Darker. But the body knew water and the body didn't care about the depth.","","    You stood waist-deep in the Bastion Sea and the ocean held you and you held it and neither of you had decided yet what the other one was.","","    *goto morning","","*label morning","","*page_break","","Dawn. Low tide.","","The reef emerged.","","The lagoon drained by inches as the tide withdrew, and what had been water became ground \u2014 flat coral shelves, tide pools the size of rooms, channels carved by centuries of current. The reef at low tide was a world you'd been floating above without seeing. Now it was solid. Walkable. Alive.","","The reef wall was on the south face of the island \u2014 a vertical section of coral exposed at low tide, twenty feet high, stretching a hundred feet along the island's outer edge. The surface was pocked and rough, natural stone that had been carved by water and wind and, for the last four decades, by the tools of Kingsrun crews.","","Names. Dozens of them. Hundreds. Carved into the coral in every size and style \u2014 some careful and deep, some hasty and shallow, some decorated with symbols or crew flags or dates. The wall was a record. A witness. Every crew that had passed through Galluun's Tooth and kept going south had left their mark here.","","You walked the wall. The names blurred \u2014 unknown people, unknown ships, unknown stories. Some were weathered to illegibility. Some were fresh.","","Near the top: GHORVENNE THRALLEK \u2014 YEAR 4,599. Thirty-nine years old. The inscription of a woman who'd gone south and never come back. Her son's crew \u2014 the Inheritors \u2014 was at Brannach now, stuck with a damaged ship, retracing her route.","","At eye level, six days fresh, the letters still sharp: KINDLING \u2014 METTANI \u2014 We Were Here First.","","The chisel the locals provided was crude \u2014 a coral spike with a wrapped handle. The carving surface was above your head height, which at six-seven meant you were working on the upper section of the wall, above most of the inscriptions.","","The crew stood behind you. Kessara, Terrek, Sullavenne. Waiting. The First Scrape was the captain's job \u2014 the captain carved, the crew witnessed.","","You set the chisel against the coral. The stone was harder than it looked \u2014 dense, compacted, the product of millennia of reef growth. Each strike took a chip. Each letter took twenty strikes.","","You carved.","","*set carved_name_reef true","","AKKAN \u2014 SUNDERED WAKE","","Eight letters. Two words. The coral dust fell into the tide pool below. The wall accepted the inscription the way it accepted everything \u2014 without opinion, without judgment. Just another name. Just another crew. The wall had room.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara stepped forward when you stepped back. She looked at the inscription. Looked at the wall \u2014 the forty years of names, the record of everyone who'd come this way.","","  \"It's real,\" she said. Quiet. \"We're on the wall.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek pulled his notebook from his coat. He wrote the date. The inscription. The location on the wall \u2014 upper section, south face, fifteen feet from the ground.","","  \"For the record,\" he said. \"When the name Akkan is on every wall from here to the Sundren, I want to remember where it started.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne looked at the inscription for a long time. Her hand moved to the scar on her jaw. Touched it. Let it go.","","  \"Wardensea officers don't carve their names on things,\" she said. \"They file reports. The reports go into a system and the system remembers.\"","","  She looked at the wall. At the forty years of names carved by hand into living coral.","","  \"This is better.\"","","The tide was coming in. The reef floor darkened as the water returned \u2014 slowly at first, then faster, the channels filling, the pools connecting, the lagoon reclaiming what the tide had exposed. The wall would be underwater within the hour. The inscription would be there beneath the surface, visible to anyone who dove deep enough to look.","","You turned from the wall. The reef path led back toward the lagoon, toward the ship, toward the next step south. Behind you, the names of forty years of Kingsrun crews disappeared under the rising tide, and yours was among them now, cut into the coral, permanent in the way that stone is permanent \u2014 which is to say, not forever, but longer than anyone alive would remember.","","The Sundered Wake was ready. The sternpost was solid. The provisions were stocked. The crew was present.","","Galluun's Tooth had given you what it had \u2014 a wall, a name, a story about a Rathai captain who'd been here first. The second stop. The First Scrape.","","The third stop was Merrenbach. The Khari reef island. Two days south if the currents held.","","The ocean waited the way it always waited \u2014 grey, indifferent, open.","","*goto_scene ch2_galluuns_tooth_reef",""], "labels":{"kindling_talk":110,"morning":249}},
"ch2_galluuns_tooth_reef": {"crc":-32872557, "lines":["*comment ===================================================","*comment  CHAPTER 2: GALLUUN'S TOOTH \u2014 \"The First Scrape\"","*comment  Scene 3: The Reef","*comment  Underwater reef exploration. MC can swim \u2014 no God","*comment  Fruit, freedom in the water. A discovery on the","*comment  reef: something that doesn't belong. A choice with","*comment  real cost. Cliffhanger: Wardensea patrol heading","*comment  south. Chapter 2 ends.","*comment  2 real choices. Zero fake choices.","*comment ===================================================","","The Sundered Wake floated.","","The sternpost was solid \u2014 Kessara had launched the ship at first light, and the hull sat in the lagoon water with a different weight than before. Deeper in the bow, steadier at the keel. The backing plate Pellanne had forged changed the ship's center of gravity by inches, and those inches translated to a stability you felt in the deck under your boots.","","\"She's better,\" Kessara said. She stood on the dock, watching the waterline, her arms folded across the tool harness. The professional assessment was done \u2014 she'd checked the caulking, inspected the seams, run her hand along the sternpost joint until she was satisfied. \"Not good. Better. The difference between a ship that's going to sink and a ship that's going to complain.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was loading provisions. The fish market had opened for its second morning, and he'd been there at dawn \u2014 this time with knowledge of the vendors, the right tables, the reef bass seller who kept the morning catch in a saltwater tank instead of on ice. He carried the supplies aboard in canvas sacks, moving between the dock and the galley with the steady rhythm of someone restocking a kitchen he'd decided to take seriously.","","  \"Four days of fresh provisions,\" he said. \"Plus the dried stores from Selvaggio. That gives us a week before we're back to survival cooking.\" He looked south. The open ocean was visible past the reef channel \u2014 flat, blue, patient. \"Merrenbach is two days. We'll eat well on the way.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was on the ridge. She'd been there since before dawn \u2014 watching the lagoon, the reef channel, the ocean beyond. When she came down, her notebook had new entries.","","  \"The Kindling is preparing to leave,\" she said. \"Suuba's crew has been loading since the early hours. They'll clear the channel by midmorning.\" She paused. \"If we leave by noon, we'll be on the same heading. Different speeds \u2014 their sloop is faster than our ketch \u2014 but the same destination. Merrenbach.\"","","  She didn't say what she was thinking. She didn't need to. Two ships heading south on the same day meant two ships arriving at the same stop within hours of each other, and at Merrenbach \u2014 a Khari reef island with limited anchorage \u2014 that meant sharing space with a Cursed Generation crew again.","","The tide was dropping. Low tide at Galluun's Tooth came in the late morning \u2014 the lagoon thinning, the reef emerging, the underwater world becoming visible through water that went from waist-deep to knee-deep in the space of an hour.","","The locals moved with the tide. Reef fishers waded out with nets and bone-tipped spears. Children ran the exposed coral flats, turning over stones, collecting things that lived in the pools. The reef at low tide was a pantry, a pharmacy, and a playground \u2014 the island's economy laid bare on the coral shelf twice a day.","","You watched from the dock. The water was clear enough to see the bottom \u2014 thirty feet of visibility in the lagoon, the sand white, the coral formations casting blue-green shadows on the floor. Fish moved through the shallows in schools, turning in unison, the silver flash of their sides catching the morning light.","","The reef extended south from the lagoon's edge \u2014 beyond the carving wall, beyond the island's outer face, into deeper water where the coral structures grew larger and the bottom dropped away. The fishers didn't go there. The children didn't go there. It was deeper water \u2014 twenty feet, thirty, deeper at the reef edge where the shelf dropped to open ocean floor.","","*page_break","","Kessara appeared on the dock. She'd been talking to Pellanne.","","\"There's a wreck on the outer reef.\" She was wiping her hands \u2014 an unconscious habit, grease that wasn't coming off. \"Pellanne told me. Ship hit the reef wall two years ago \u2014 hull's been sitting in twenty feet of water. The locals stripped the top but the lower compartments are untouched because the reef fishers won't dive below fifteen feet. Cultural thing. Or \u2014 I don't know if it's cultural. Pellanne called it 'the line.' I didn't ask what happens below the line.\"","","She looked at the water. At you. Back at the water.","","\"Here's the thing. The wreck's sternpost has a bronze fitting. A rudder mount.\" She said \"bronze\" the way Terrek said \"reef bass.\" \"That's a forty-sovereign part. Our mount is rebuilt wood and iron. It works, it works fine, but bronze would \u2014\" She stopped wiping her hands. \"I'm not going to pretend I'm being rational about this. I want that fitting.\"","","She kicked the dock piling.","","\"Twenty feet of water. I can't do it \u2014 I can't hold my breath long enough for hull work at that depth. Terrek's a cook, not a diver. Sullavenne would go, but she's the wrong build for tight spaces.\"","","She looked at you again. The assessment was direct, Rathai-direct, no apology in it.","","\"You can swim. I saw you \u2014 in the lagoon, the night you walked the reef. You went waist-deep and stayed there like the water was a chair. The highland Oni swim in the volcanic lakes, right? Mineral water, warm, depth doesn't bother you.\"","","*if (carved_name_reef = false)","  She pointed toward the reef wall. \"The wreck is past the carving wall, on the outer face. Two hundred feet from shore.\"","","*if (carved_name_reef)","  She pointed toward the reef wall where your name was carved. \"The wreck is past the wall, on the outer face. Two hundred feet from shore.\"","","\"Twenty feet down. The water's clear \u2014 you'll see the bottom the whole way. The rudder mount is on the sternpost of the wreck. Bronze. Green with corrosion but that scrapes off. If it's intact, it's the single best upgrade we can make to this ship before Merrenbach.\"","","She folded her arms.","","\"It's also someone else's shipwreck. The ship had a name. A crew. A captain who hit that reef and probably died on it. And the locals haven't touched it because the deep reef is their boundary.\" She shrugged. \"Salvage law says an abandoned wreck is fair claim. But salvage law was written by people who don't live on reef islands.\"","","*page_break","","The reef edge.","","You stood on the coral shelf at the island's south end, where the flat exposed reef dropped away into blue water. The tide was still falling \u2014 the shelf was dry under your boots, rough and white, the same coral you'd carved your name into that morning. The wind came from the east and pushed the surface chop away from the island, leaving the water on the ocean side clear and calm.","","The wreck was visible from the shelf. Twenty feet down, sitting on a ledge of reef that jutted from the island's submerged outer wall. The hull was on its side \u2014 a sloop, smaller than the Sundered Wake, broken at the midship and settled against the coral. The mast was gone. The deck was stripped. What remained was the skeleton \u2014 ribs, keel, sternpost, the bones of a ship that had lost its argument with the reef.","","The water was warm. You'd tested it \u2014 feet first, then calves, then waist-deep on the shelf's edge where the coral dropped away. Warm and clear and salt-heavy, the mineral taste of the highland lakes absent. The ocean water was lighter on the skin. Less dense. You had to work to stay submerged \u2014 the body wanted to float.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara stood on the shelf above. She had a rope \u2014 forty feet of dock line \u2014 coiled over her shoulder.","","  \"The mount is on the sternpost. Bronze fitting, about \u2014 this big.\" She held her fists together, then moved them apart, then put them back. \"Four bolts, hex head, corroded. This is for the bolts.\" She handed you a pry bar. Short, heavy, iron. \"If the bolts won't turn, lever the wood \u2014 two years in salt water, the planking's softer than the bronze.\"","","  She tied one end of the rope to a coral anchor on the shelf. Tested the knot. Untied it. Retied it with a different knot.","","  \"Pull twice if you need air. I'll haul.\" She tested the second knot. \"I mean it. Don't be \u2014 I know you're going to be proud about it. Don't.\"","","You dove.","","Three days ago the ocean had put you on your knees at the rail. Now you were going into it on purpose.","","The water closed over your head and the world changed. The sound first \u2014 the absence of wind, the replacement of air-noise with the dense, humming quiet of water. The pressure was gentle at the surface, increasing as you went down. The reef wall passed beside you \u2014 vertical coral, alive, covered in things that moved. Small fish scattered. Something long and silver turned in the midwater and went away. The light came from above \u2014 diffused, blue-white, turning the water into something between air and glass.","","Fifteen feet. The wreck was below and to the right. The hull's ribs cast shadows on the reef ledge. The sternpost was visible \u2014 the thick, angled timber at the ship's stern, the piece that held the rudder assembly. And on it, green with two years of corrosion, the bronze fitting.","","Kessara was right. It was the size of two fists. A cylinder with a flange, bolted through the sternpost at four points. The bronze was heavy \u2014 you could feel its weight even through the water's buoyancy. Solid. Dense. Worth every copper of forty sovereigns on the open market.","","You braced your feet on the hull's ribs. The wood was soft \u2014 the salt water and the reef organisms had been working for two years, and the planking gave under pressure like wet leather. The structural timber was harder, but the surface was slick with growth. The pry bar found the first bolt.","","The bolt didn't move.","","The second breath was harder. The lungs compressed. Twenty feet was deep enough that the pressure was a presence \u2014 not painful, not dangerous, but real. You felt it in the chest, in the ears, in the sinuses. Highland Oni dived in the volcanic lakes \u2014 warm water, shallow, the bottom always visible. This was deeper and colder and the bottom was the ocean floor, which was not visible from here, which was somewhere below in the blue-dark where the reef wall ended and the open sea began.","","The pry bar found leverage. The bolt turned. A quarter-rotation, then free \u2014 the corrosion had fused the thread but the bronze was stronger than the wood around it. The bolt came out trailing a plug of rotten timber. One down.","","You surfaced. Breath. The air was shocking \u2014 warm, bright, loud after the water's quiet. Kessara was watching from the shelf edge.","","You held up one finger.","","\"Three more. You've got time \u2014 the tide won't turn for an hour.\"","","You dove again.","","The second bolt. The third. The wood around the fourth had disintegrated entirely \u2014 the bolt was loose in its hole, held by nothing except the weight of the fitting. You pried the fitting free. The bronze came away from the sternpost with a sound you felt through the water \u2014 a bass vibration, the last piece of a ship surrendering its function.","","The fitting was heavy. Ten pounds, maybe twelve. You held it against your chest and kicked for the surface.","","And stopped.","","The wreck's lower compartment was open. The hull breach at the midship had cracked the planking wide enough to see inside, and the reef growth that covered the exterior hadn't reached the interior yet. The compartment was dark \u2014 a pocket of shadow in the clear water, a hold for whatever the crew had stored below the waterline.","","Something was in there.","","Not alive. Not moving. A shape \u2014 angular, too regular to be natural, too solid to be debris. The water was clear enough to resolve it: a box. Wooden, maybe two feet on a side, bound with metal straps. Sitting in the wreck's lower compartment, undisturbed for two years, covered in a film of silt that the current hadn't reached.","","Your lungs burned. Twenty seconds of air left, maybe less.","","*page_break","","You surfaced with the bronze fitting and the knowledge of what you'd seen.","","The fitting landed on the reef shelf with a solid thud. Kessara picked it up, turned it, scraped the corrosion with her thumbnail. The bronze underneath was bright \u2014 gold-green, intact, the metal that had outlasted the ship it was built for.","","\"This is better than I \u2014\" She turned the fitting. Turned it again. Scraped the corrosion with her thumbnail and the bronze underneath was bright. She held it against her chest like it was a cat. \"Nettleworks bronze. They don't make this alloy anymore. They haven't made this alloy since Torval closed and I \u2014\"","","She stopped. She was hugging a rudder mount. She put it down. Picked it back up.","","\"Something else?\" She'd read your expression \u2014 the dripping, the bleeding hand, the look that said the dive wasn't done.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had followed. She stood at the ridge edge above the reef shelf, ten feet higher, watching the water with the careful attention of someone who had once run coastal surveillance.","","  \"You found something else down there.\" Statement. Not a question.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was on the shelf too. He'd come from the ship \u2014 curious, or worried, or both. He looked at the bronze fitting, at your bleeding hand, at the water.","","  \"You've got a face,\" he said. \"I don't know what the face means yet but you've had it three times. The cup game. The bell.\" He pointed at you. \"Now.\"","","A box. Sealed. In a dead ship's lower hold. Two years underwater. The locals hadn't touched it \u2014 the deep reef was their boundary, the fifteen-foot line they didn't cross. Salvage law said it was free claim. The reef island's customs said it was the sea's.","","And the ship had a name. Pellanne had mentioned it \u2014 the sloop that hit the reef two years ago. A Kingsrun crew, heading south, miscalculated the channel at night. The captain survived but the crew didn't. Two dead. The captain walked to the dock, reported the wreck, and took the next northbound fishing boat back to Selvaggio. Never came back. Never claimed the wreck. Never mentioned what was in the hold.","","Whatever was in that box, the captain had either forgotten it, couldn't retrieve it, or didn't want it found.","","*choice","  #Dive again. Get the box. Whatever's inside has been waiting two years \u2014 and the crew of the Sundered Wake needs every advantage the ocean offers.","    You picked up the pry bar. The bronze fitting was enough \u2014 more than enough. The rudder mount alone justified the dive. But the box was there and the tide was still falling and the water was clear and your lungs had learned the depth.","","    *set personality_aggression %+ 3","    *set galluuns_tooth_challenge \"took_box\"","","    The second dive was faster. The wreck was familiar now \u2014 the angles, the entry points, the depth. The lower compartment was tight. Your shoulders scraped the hull's broken ribs going in, and the darkness closed over you \u2014 the first real darkness since you'd entered the water. The light from above didn't reach here. You worked by touch.","","    The box was heavy. Heavier than the bronze fitting \u2014 thirty pounds, maybe more. The metal straps were corroded but intact. You gripped it by the straps and kicked backward out of the compartment, the hull's ribs scraping your back through the wet shirt, the box against your chest.","","    The ascent was slow. The weight pulled you down. Your lungs were screaming \u2014 the deep-chest burn that said you had seconds, not minutes. You kicked. The surface was a bright line above, getting closer, the blue lightening to white.","","    You broke the surface gasping. The box came up with you \u2014 green with corrosion, streaming water, heavy in your arms. You hauled it onto the reef shelf and it sat there, dripping, sealed, unknown.","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara looked at the box. At you. At the box again.","","      \"You went back in.\" Flat. The engineer's assessment of risk, after the fact. \"For a box you can't see inside.\"","","      She crouched next to it. Ran her hand along the metal straps. Tested the seal.","","      \"Iron straps. Wax seal on the lid \u2014 that's deliberate. Someone waterproofed this. Whatever's inside was meant to survive submersion.\" She stood. \"I can open it on the ship. The seal will need a chisel and heat.\"","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne came down from the ridge. She looked at the box the way she looked at everything \u2014 with the focused, categorizing attention of a woman who had spent years writing intelligence reports.","","      \"A sealed container in a wreck that nobody claimed.\" She touched the wax seal. \"Wax over iron over wood. Three layers of waterproofing. Either the contents are extremely valuable or extremely dangerous. Both motivate this level of protection.\"","","      She looked at you. \"We should open this aboard. Not here.\"","","    You carried the box and the bronze fitting back to the ship. The box went into the cargo hold. The fitting went to Kessara, who was already measuring the Sundered Wake's rudder mount with a length of cord and a look of professional satisfaction.","","    *goto box_opening","","  #Leave the box. The bronze fitting is the prize \u2014 the rest belongs to the wreck and whatever crew left it there.","    You looked at the water. The compartment was still visible \u2014 the dark gap in the hull, the shape inside it. The box had waited two years. It could wait longer. It could wait forever.","","    *set personality_mercy %+ 3","    *set galluuns_tooth_challenge \"left_box\"","","    The bronze fitting was enough. More than enough. A forty-sovereign rudder mount, pulled from a dead ship's sternpost by hand \u2014 the Sundered Wake was better for it. The box was someone else's story. The captain who'd walked away had either chosen to leave it or been unable to retrieve it. Either way, the choice was his.","","    The reef island's boundary was at fifteen feet. The locals didn't dive below it. You'd crossed that line for the fitting \u2014 a specific part, a known value, a clear purpose. The box was different. The box changed what you were doing on this island, and the ship was pointed south, not anchored to a salvage operation.","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara watched you look at the water and look away. She read it.","","      \"The fitting's enough,\" she said. She said it the way she said engineering truths \u2014 without argument, without apology. \"I can install it this afternoon. The mount will be stronger than anything we could buy at Merrenbach.\"","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne nodded. A small motion. The notebook stayed closed.","","      \"Discipline,\" she said. One word. From a former Wardensea officer, it carried a specific weight.","","    *if (crew4_name = \"Terrek Ghaal\")","      Terrek looked at the water. At the wreck below. He said nothing for a while.","","      \"My mother used to say the ocean gives you what you need. Not what you want.\" He looked at the fitting on the coral shelf. \"That's what you need. That's enough.\"","","    You carried the bronze fitting back to the ship. Kessara took it with the reverence an engineer reserves for good material. The wreck stayed on the reef. The box stayed in the dark.","","    *goto afternoon","","*label box_opening","","The cargo hold of the Sundered Wake was dim. Kessara brought a lantern. Terrek brought a chisel and a small iron pan with coals from the galley firebox.","","The wax seal was thick \u2014 a deliberate application, layered, work that took time and purpose. Kessara ran the heated chisel along the seal's edge. The wax softened, then split, peeling back from the iron straps in a single strip.","","The straps were corroded but the clasp beneath them was brass. It opened.","","The lid came off. Inside, wrapped in oilcloth that had done its job \u2014 two years in salt water and the interior was dry \u2014 were three things.","","A chart. Rolled, secured with cord, drawn on heavy vellum in ink that had survived the oilcloth's protection. The chart showed the Kingsrun \u2014 not the standard route, not the common stops. A different path. Annotations in a cramped hand: depth readings, current patterns, reef gaps. The kind of detail that came from someone who had sailed the route and marked what the official charts didn't show.","","A coin purse. Leather, water-stained despite the oilcloth. Inside: fourteen Gold Sovereigns and change. The captain's emergency fund \u2014 the money you keep in the hold because the hold is where it survives a capsizing.","","And a Grimoire. Not a standard-issue basalt tablet. This one was smaller \u2014 palm-sized, darker stone, with runes carved into the casing that didn't match the factory pattern. Modified. Customized. A Grimoire someone had spent money on.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara picked up the chart. Unrolled it. Her eyes moved over the annotations.","","  \"These are current readings between Merrenbach and Brannach. Handwritten. Someone sailed this route and documented the secondary channels \u2014 the gaps in the main reef that aren't on the standard navigation charts.\" She looked at you. \"This is worth more than the bronze fitting. This is the kind of information crews pay hundreds of Sovereigns for.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne picked up the Grimoire. She turned it. The modified runes caught the lantern light.","","  \"Custom frequency array. Someone expanded the receiver \u2014 this Grimoire can pick up Grey band.\" She looked up. Grey band was Wardensea military communications. Encrypted, restricted. \"The owner was either former Wardensea or bought this from someone who was. Either way, this is contraband. If a patrol finds this on our ship, the crew is detained and the ship is impounded.\"","","  She set it down. Carefully.","","  \"It's also the most useful piece of equipment we could have. Grey band monitoring gives us patrol schedules, deployment changes, route adjustments. At range \u2014 two hundred miles on a good relay.\" She met your eyes. \"The question is whether the advantage is worth the risk.\"","","*set sovereigns + 14","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek counted the coins. Lost count. Started over. \"Fourteen Gold Sovereigns.\" He held a coin up to the lantern. His hand wasn't steady. \"That's more than we spent on the entire ship repair. That's more than I saved in six months of cooking.\"","","  He put the coins back carefully, one at a time, as if they might break. \"A captain who walked away from this. That's \u2014\" He didn't finish the sentence. He didn't need to.","","The chart. The coins. The modified Grimoire. A dead crew's contingency kit, sealed against the water, waiting for someone to find it.","","*goto afternoon","","*label afternoon","","*page_break","","The afternoon passed in work.","","*if (galluuns_tooth_challenge = \"took_box\")","  *if (crew3_name = \"Kessara Veldt\")","    Kessara installed the bronze fitting. The old rudder mount \u2014 rebuilt wood and iron, the one she'd assembled at Selvaggio \u2014 came off in pieces. The bronze went on clean. The bolts seated into the sternpost with the clean sound of metal finding its home in metal, and the rudder's response was immediate. She tested it from the helm.","","    \"Night and day,\" she said. \"The lateral play is gone. The mount isn't fighting the current anymore \u2014 it's absorbing it. This is what the ship should have had from the beginning.\"","","    *set ship_condition + 10","","*if (galluuns_tooth_challenge = \"left_box\")","  *if (crew3_name = \"Kessara Veldt\")","    Kessara installed the bronze fitting. The work took two hours \u2014 removing the old mount, fitting the salvaged bronze to the Sundered Wake's sternpost, testing the alignment. When she was done, the rudder moved with a smoothness that made the previous rebuild feel like a rough draft.","","    \"This changes things,\" she said from the helm. \"The lateral response is clean. The mount absorbs the current instead of fighting it. In the channel approach, this fitting would have given us another two feet of clearance.\"","","    *set ship_condition + 10","","The Kindling left at midmorning. You watched from the dock \u2014 Suuba Mettani's sloop cleared the reef channel with the easy precision of a crew that had done it a dozen times. The hull slipped through the sixty-foot gap with five feet of clearance on each side, the helmsman barely adjusting. The sloop's speed was visible immediately \u2014 once past the reef, the sail filled and the ship moved south with the committed velocity of something designed for exactly this. Within an hour, the Kindling was a shape on the horizon. Within two hours, gone.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara watched them go. She had the bronze fitting in one hand and a wrench in the other and she'd forgotten she was holding both.","","  \"Rathai engineering,\" she said. Quiet. \"That hull is \u2014 we'll never be that fast.\" She set the fitting down. Picked up the wrench. Set it down too. \"Suuba asked me yesterday if I'd ever built something from scratch. Not repaired. Built. I said no.\" She wiped her hands on her harness. \"I've been thinking about that answer all morning.\"","","The crew prepared to leave. Provisions stowed. Hull checked. New rudder mount installed. The Sundered Wake was better than she'd been since you'd claimed her at Selvaggio \u2014 not good, not close to good, but better. The improvement was measurable. It was enough.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had updated the ship's log \u2014 a habit she'd started on the second day at sea, recording position, weather, crew status, and \"observations\" that read like Wardensea intelligence reports. The Galluun's Tooth entry was thorough.","","  \"Departure time: estimated fourteen hundred hours. Destination: Merrenbach, Stop Three. Distance: one hundred forty miles. Estimated transit: two days with current winds, three in adverse conditions.\"","","  She closed the log.","","  \"Current winds are favorable. Southeast, steady. The reef approach at Merrenbach is reported to be simpler than Galluun's Tooth \u2014 wider channel, deeper water, less current. The Khari warrens run a piloting service for incoming ships.\"","","You were on the deck when the Grimoire sounded.","","*page_break","","The broadcast came through clean. The Galluun's Tooth relay was close \u2014 the signal was stronger here than it had been on the open ocean, the voice sharp and clear.","","\"Kingsrun Watch \u2014 Veshanna Torc \u2014 priority broadcast.\"","","The crew stopped moving. Priority broadcasts were rare. In six days on the Kingsrun, you'd heard two standard updates and one bounty revision. Priority meant something had changed.","","*set broadcast_count + 1","","\"Wardensea alert. The Fourth Division has deployed a patrol squadron on the southern Bastion route. Three ships \u2014 two corvettes and a frigate \u2014 heading south from the Kassevaan naval station. Their route follows the Kingsrun from Stop One through Stop Four.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne's hand went to her notebook. The motion was immediate \u2014 not a choice, a reflex. She was writing before Veshanna finished the sentence.","","\"The patrol is conducting full inspections. Every vessel on the Kingsrun route is subject to boarding, manifest review, and crew identification. The stated purpose is enforcement of maritime safety regulations. The Reckoning's Kollivaan Gesst has a different analysis \u2014 quote: 'Safety regulations. Right. The same safety regulations they enforce by impounding ships and seizing cargo. The Wardensea smells blood. Somebody did something at Selvaggio and now the whole southern route gets the inspection.' End quote.\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara looked at you. The humor was gone from her face. The engineer who'd been celebrating the bronze fitting thirty minutes ago was a different person \u2014 harder, calculating, running numbers that had nothing to do with hull integrity.","","  \"Full inspections,\" she repeated. \"That means manifests, cargo checks, crew papers. We don't have crew papers. We have a salvage-claimed ship, four people, and no documentation that says any of us have a right to be on the Kingsrun.\"","","The broadcast continued:","","\"Patrol speed and heading suggest arrival at Galluun's Tooth within thirty-six hours. Merrenbach within seventy-two hours. Kingsrun Watch advises all crews on the southern Bastion route to ensure compliance with maritime regulations \u2014 or to make other plans. This is a general advisory. No specific crew has been named as a target.\"","","A pause. Static.","","\"Personal note from Torc: when the Wardensea says nobody's a target, everybody's a target. Torc out.\"","","The broadcast ended. The Grimoire went quiet. The lagoon lapped at the hull. The reef fishers on the flats kept working \u2014 they had no ship, no bounty, no reason to care about Wardensea patrols. Their world was the reef and the tide and the fish market at dawn. The patrol was someone else's problem.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had filled a page. She tore it from the notebook and laid it on the tiller housing.","","  \"Timeline.\" Her voice was the Wardensea briefing voice \u2014 clipped, stripped of opinion. \"The patrol left Kassevaan. North of Selvaggio. Three hundred miles by the coast, roughly, at patrol speed \u2014 eight, ten knots \u2014 so that's thirty to thirty-six hours before they're sitting where we're sitting.\"","","  She tapped the page. Frowned.","","  \"Us to Merrenbach, hundred forty miles. At our speed \u2014 five, six knots \u2014\" She crossed something out. Rewrote it. Crossed that out too. \"No. I did it again. That's the Kindling's number, not ours. We're not \u2014 we don't do six knots. Five. Maybe.\" She put the pen down. Picked it up. \"Twenty-six to thirty hours. And that's if I stop accidentally giving us their ship.\"","","  She looked at the crew. Each one in turn.","","  \"Half a day margin. Maybe less. If the wind holds, if nothing slows us, if I stop borrowing the Kindling's numbers.\"","","*if (galluuns_tooth_challenge = \"took_box\")","  She paused.","","  \"And we have a modified Grimoire in the hold that can receive Grey band military communications. If they find it, we're not getting inspected. We're getting arrested.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was quiet. He'd picked up the ladle from the galley counter at some point during the broadcast and was holding it in both hands, turning it, the wood clicking against his ring finger. He wasn't looking at anyone. He was looking at the water south of the channel.","","  \"We leave now,\" he said. The ladle stopped turning. It was the first time he'd made a tactical statement. \"Every hour we stay here is an hour they close the gap.\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was already moving. The mooring lines. The sail. The new rudder mount getting its first real test.","","  \"The bronze fitting means we can push harder in open water. The rudder won't fight us. That's worth half a knot, maybe more in good conditions.\" She pulled the mainsail's halyard. \"I'll take every half knot the ocean gives us.\"","","*if (galluuns_tooth_challenge = \"took_box\")","  *if (crew5_name = \"Sullavenne Ohn\")","    Sullavenne grabbed your arm. Hard. The grip was Wardensea \u2014 trained, specific, the kind of hold that meant stop.","","    \"The Grimoire.\" Her voice was flat. Below the crew's hearing. \"The modified Grimoire in the hold. It can receive Grey band. Military frequencies. If that patrol boards us and finds it, we're not getting inspected \u2014 we're getting arrested for possession of restricted Wardensea communications equipment.\"","","    She released your arm. The grip had left a mark. She didn't notice. She was already past the grip and into the calculation.","","    \"We have thirty-six hours. Maybe less. The device is the single most dangerous item on this ship, and it's also the single most valuable. Whatever we do, we do it now.\"","","    *choice","      #Keep the Grimoire. Stow it deep \u2014 wrapped in sailcloth, buried under the bilge planking. If the patrol searches, they search the hold and the cargo. Nobody crawls into a bilge on a ship this small.","        The bilge was four feet deep, dark, and wet. The modified Grimoire went into oilcloth first, then sailcloth, then into the gap between the hull ribs and the bilge planking \u2014 the dead space where the ship's skeleton met the water and nothing was meant to be stored because nothing was meant to survive there.","","        *set personality_aggression %+ 4","","        Sullavenne watched. Her mouth was a line.","","        \"Wardensea search teams are trained to check dead spaces. It's the first place they look on smuggling vessels.\" She paused. \"But we're not a smuggling vessel. We're a salvage-claimed ketch with four crew and no cargo worth inspecting. They'll look for contraband in the obvious places \u2014 the hold, the captain's bunk, the chart table. The bilge is a gamble.\"","","        She looked south. The open water. The patrol closing from the north.","","        \"Your gamble. I'll note that for the record I think it's the wrong one. But it's yours.\"","","        *goto departure_rush","","      #Disassemble it. Pull the Grey band components and scatter them across the ship \u2014 the receiver coil in the tool kit, the frequency plate under the galley stove, the housing with the regular Grimoire parts. Reassembled, it's evidence. In pieces, it's junk.","        Kessara's hands were the right hands for this. The engineer took the modified Grimoire apart in eleven minutes \u2014 the casing unscrewed, the Grey band receiver coil separated from the standard array, the frequency modulation plate pulled from its housing. Each piece went to a different location. The receiver coil into the tool kit, wrapped in copper wire, indistinguishable from spare fittings. The frequency plate under the galley stove's heat shield, where the metal was already warped and blackened. The housing reassembled around the standard Grimoire components, looking factory.","","        *set personality_openness %+ 4","","        \"Eleven pieces.\" Kessara wiped her hands on her trousers. \"I can put it back together in twenty minutes if we need it. The question is whether a Wardensea inspector knows what a Grey band receiver coil looks like when it's mixed into a box of bronze fittings.\"","","        *if (crew5_name = \"Sullavenne Ohn\")","          Sullavenne's answer was immediate. \"They don't. Standard inspectors check for complete devices, not components. The frequency plate is the risk \u2014 it has etchings that a signals officer would recognize. Under the stove, the heat damage will obscure them.\" She paused. \"This is good. This is the right call.\"","","        *goto departure_rush","","      #Dump it. Drop the whole device over the side. The Grimoire is valuable, but it's not worth the crew's freedom. Let the reef have it.","        The modified Grimoire hit the water without ceremony. The oilcloth wrapping kept it floating for three seconds \u2014 a dark shape on the turquoise surface, the device that had pulled Grey band Wardensea communications bobbing like driftwood. Then the weight took it. The device sank. The reef shelf was twenty feet down here. The Grimoire settled onto a coral formation, visible through the clear water for another ten seconds, and then the current shifted and the silt stirred and it was gone.","","        *set personality_mercy %+ 3","        *set galluuns_tooth_challenge \"dumped_grimoire\"","","        *if (crew5_name = \"Sullavenne Ohn\")","          Sullavenne watched it sink. Her expression didn't change. Her hand went to her notebook. She wrote something \u2014 one line, the pen pressing hard enough to leave a dent in the next page.","","          \"That was the best source of real-time Wardensea intelligence on the southern Kingsrun.\" She closed the notebook. \"It was also the thing most likely to get us killed. I'm not going to argue.\" She looked at the water where the device had disappeared. \"The reef takes what the reef takes.\"","","        *goto departure_rush","","  *if (crew5_name != \"Sullavenne Ohn\")","    The modified Grimoire sat in the hold. The device that could receive Wardensea Grey band communications \u2014 the device that would mark this crew as criminals if the patrol found it. Thirty-six hours before three Wardensea warships reached this reef.","","    *choice","      #Hide it in the bilge. Wrapped tight, wedged between the hull ribs. Small ship, small bilge \u2014 nobody crawls in there.","        The Grimoire went into the bilge. Oilcloth, sailcloth, dead space. A gamble on the patrol not checking the one place smugglers always checked first.","","        *set personality_aggression %+ 4","        *goto departure_rush","","      #Take it apart. Scatter the components across the ship where they look like spare parts and junk.","        *if (crew3_name = \"Kessara Veldt\")","          Kessara disassembled it. Eleven pieces, eleven locations. The receiver coil in the tool kit. The frequency plate under the stove. The housing cleaned and reassembled around standard parts.","","        *if (crew3_name != \"Kessara Veldt\")","          You took it apart yourself. Rougher than an engineer would have done \u2014 the casing cracked when the screws stuck, the receiver coil came out bent. But the pieces scattered. Tool kit. Galley. Chart table drawer. Separate, unrecognizable.","","        *set personality_openness %+ 4","        *goto departure_rush","","      #Throw it overboard. The reef can have it.","        Over the side. Three seconds floating. Then gone. The reef took the Grimoire and the Grey band intelligence and the risk, all at once.","","        *set personality_mercy %+ 3","        *set galluuns_tooth_challenge \"dumped_grimoire\"","        *goto departure_rush","","*label departure_rush","","The crew moved. The ship moved. The mooring lines came off the dock and the Sundered Wake backed into the lagoon, the hull sitting lower and steadier with the repaired sternpost and the new bronze mount.","","*set current_stop 2","*set current_stop_name \"Galluun's Tooth\"","*set days_since_departure + 4","*set total_sea_days + 3","","Galluun's Tooth fell away.","","The reef channel opened and the ship threaded it \u2014 tighter this time, with the tide lower, the coral walls closer to the surface. But the rudder responded. The bronze fitting made the difference that Kessara had promised \u2014 the lateral drift was controlled, the helm responsive, the ship answering the tiller instead of arguing with it. You cleared the channel with four feet on each side. Enough. Not generous.","","The open ocean took you. The Bastion Sea, flat and blue, the swells gentler than the outbound passage. South. The heading was south and the wind was southeast and the Sundered Wake caught it and the sails filled and the ship leaned into the work.","","*if (carved_name_reef)","  Behind you, the reef wall held your name. AKKAN \u2014 SUNDERED WAKE. The tide would cover it within the hour. The coral would hold it for decades.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne stood at the stern, watching Galluun's Tooth shrink. The island reduced \u2014 from a place with fish markets and boatwrights and a carving wall, to a shape on the water, to a shadow, to a memory of coral and light.","","  \"Half a day,\" she said. To herself. To you. To the ocean. \"We need to make it count.\"","","The sun was high. The sea was open. Merrenbach was south \u2014 a Khari reef island, Warren Suuvi on the cliffs, the low-tide reef market, a culture that measured trust the way the Varrek measured weight. Two days of sailing. A half-day margin before a Wardensea patrol that was inspecting every ship on the Kingsrun.","","The Sundered Wake sailed south. The crew was four. The ship was better than yesterday. The ocean was indifferent.","","Chapter two was behind you. The second stop. The First Scrape. A name on the wall and a bronze fitting from a dead crew's ship and a half-day lead on the Wardensea.","","Ahead: the Khari. The reef walk. The third stop. Merrenbach.","","*set latest_broadcast \"wardensea_patrol_south\"","","*page_break","","*goto_scene ch3_merrenbach_arrival",""], "labels":{"box_opening":218,"afternoon":259,"departure_rush":439}},
"ch3_merrenbach_arrival": {"crc":-717743725, "lines":["*comment ===================================================","*comment  CHAPTER 3: MERRENBACH \u2014 \"The Reef Walk\"","*comment  Scene 1: Arrival","*comment  Khari reef island. Warren Suuvi (avian, ~90).","*comment  Low-tide reef market. First contact with Khari","*comment  culture. Wardensea patrol urgency. Piloting","*comment  service. MC's size and horns noted. Trust is","*comment  currency here \u2014 and the MC has none.","*comment  2 real choices. Zero fake choices.","*comment ===================================================","","Merrenbach announced itself with birds.","","The Sundered Wake was twelve hours south of Galluun's Tooth when the first ones appeared \u2014 small, quick, brown-feathered, riding the thermals above the ship's mast. They circled twice and left. An hour later, more. Three of them, larger, with wingspans that cast shadows on the deck when they passed between the sail and the sun. They didn't circle. They flew alongside, matching the ship's heading, keeping pace at fifty feet altitude.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was watching them.","","  \"Spotters,\" she said. \"Warren Suuvi runs a \u2014 it's a lookout network. Birds. Trained to follow incoming ships and \u2014\" She watched one of them bank against the wind. Lost the sentence. Started again. \"They report back. I don't know how. The Wardensea uses signal flags. The Khari just \u2014 the birds go out and come back and somehow that's enough.\" She frowned at her own explanation. \"It's either primitive or significantly more advanced. I genuinely can't tell.\"","","  She made a note. Crossed out a word. Wrote it again.","","  \"Point is, they know we're coming. They've known for an hour. Hull type, crew count, heading \u2014 probably what Terrek cooked for breakfast.\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was at the helm. The chart from Selvaggio was pinned beside the tiller, and the stolen chart \u2014 if you'd taken the box \u2014 was beneath it. She'd been cross-referencing for the last six hours, the engineer's focus applied to a navigator's problem.","","  \"The reef approach at Merrenbach is wider than Galluun's Tooth. Deeper channel, better marked \u2014 the Khari run buoys on the outer edge. But the current is stronger. The Bastion shelf drops away to the south and the tidal exchange pulls harder through a wider gap.\"","","  She adjusted the tiller.","","  \"The Khari offer piloting. A local comes aboard and talks you through the channel. I'd recommend taking it.\"","","The island appeared in the late afternoon \u2014 a low, dark shape on the horizon that grew into something different from Galluun's Tooth. Where the coral fang had been a single ridge, white and sharp, Merrenbach was broader. Lower in the center, with cliff faces rising at the north and south ends \u2014 grey limestone weathered by salt wind, pocked with holes and ledges, the vertical faces catching the late sun in bands of shadow and light.","","The cliffs were inhabited.","","You could see it from a mile out \u2014 structures built into the rock face. Platforms. Overhangs extended with wooden frames and rope bridges. Netting strung between ledges. The architecture was vertical where every settlement you'd seen before was horizontal. Galluun's Tooth had built along the ridge. Selvaggio had built along the harbor. Merrenbach had built upward \u2014 into the cliffs, against them, as if the ground level was an afterthought and the real community lived thirty, forty, sixty feet above the waterline.","","Figures moved on the cliff face. Small at this distance. Fast. They climbed the ledges the way dock workers walked the waterfront \u2014 with the casual confidence of people who'd been doing it since they could stand.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek had come to the bow. He shaded his eyes and watched the cliffs.","","  \"Khari,\" he said. \"Avian lineage, from the architecture. They build vertically. Height has social meaning \u2014 the higher your position, the more trust you've earned. Ground level is for outsiders and cargo.\"","","  He looked at you. The look said: *We'll be on the ground.*","","  \"I spent three months on a supply route to a canine warren east of the \u2014 the Bastion coast, east side. Different lineage, different customs, but the \u2014 one thing is the same everywhere. The Khari don't trust until you've earned it.\" He scratched his jaw. \"And they don't forget. They never forget who earned it and who didn't. That part's important.\"","","The reef buoys appeared. Wooden markers, painted white, bobbing in a line that marked the outer reef edge. Inside the buoys, the water shallowed and the coral became visible \u2014 dark masses beneath the surface, the same reef architecture as Galluun's Tooth but wider, more varied. The channel between the buoys was generous \u2014 eighty feet across, with clear water and a visible sand bottom.","","A boat was waiting in the channel. Small \u2014 a single-hulled outrigger, narrow, with a lateen sail and a crew of one. The figure in the boat stood as the Sundered Wake approached, and everything about the way they stood said Khari.","","Short. Maybe five feet. The build was light \u2014 the lean, calibrated frame of someone whose body was designed for vertical movement, with long arms and legs proportioned differently from any human or Oni frame you'd seen. Feather-patterns on the forearms \u2014 not tattoos, not decorations. Plumage. Mottled brown and grey, like the cliff stone, lying flat against the skin. The face was angular, the eyes large and dark, the head capped with short feathers that lay close to the skull in place of hair. No wings \u2014 not in the way the Lunarians had wings. But the shoulders were broader than the frame suggested, and the arms moved with a rotation that said the joints were built for a range of motion your body couldn't match.","","The Khari pilot called across the water. The voice was high, clear, carrying \u2014 a voice shaped by calling across cliff faces and open water.","","\"Incoming. What ship?\"","","*if (crew3_name = \"Kessara Veldt\")","  \"Sundered Wake,\" Kessara called back. \"Ketch, forty-four foot. Crew of four. From Galluun's Tooth, two days.\"","","The pilot tilted their head. The motion was quick, birdlike \u2014 a rotation of the head that took in the ship's hull, the waterline, the sail trim, and the crew count in a single sweep. The large dark eyes found you. Paused. The height, the horns, the storm-leather coat. The head tilted the other way.","","\"Oni. Half, from the skin.\" The head tilted the other direction. The dark eyes were doing something you couldn't read \u2014 processing at a speed that made your own perception feel like it was running on a delay.","","\"Piloting is four Silver Spans. I take you through the channel, you tie off at the south dock. Market opens at low tide \u2014 three hours from now. You want piloting or you want to thread it alone?\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara looked at you. The look said: *We can do this ourselves and save the money, or we can do this smart and save the hull.*","","*choice","  #Take the piloting. Four Silver Spans for a hull that survives the reef is a trade worth making.","    *if (sovereigns >= 4)","      *set sovereigns - 4","","    The pilot's outrigger came alongside. The Khari tied a line to the Sundered Wake's port rail and scaled the hull like it was a cliff face \u2014 hands finding holds on the planking that you couldn't see, feet bracing on the waterline strake, the whole ascent taking four seconds. They landed on deck with a weight that barely registered.","","    Up close, the pilot was younger than you'd guessed. Late twenties, maybe. The feather-patterns on the forearms were dense \u2014 individual plumes, each one distinct, the brown-grey coloring shifting to a darker amber at the hands. The eyes were the most striking feature \u2014 large, dark, with an iris that caught the light in a way that suggested a different structure beneath the surface. Khari enhanced senses. Biological, not Dominion.","","    \"I'm Tessavenne. Warren Suuvi. Pilot.\" The introduction was three facts delivered in the time it took to draw a breath. \"You steer. I call the line. Stay on my calls and the reef won't touch you.\"","","    *set khari_guide_name \"Tessavenne\"","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara took the helm. Tessavenne went to the bow and crouched there \u2014 not standing, crouching, the body balanced on the balls of their feet in a posture that looked uncomfortable for a human frame but was clearly native to theirs. The dark eyes scanned the water.","","      \"Come left. Two degrees. Hold.\" The commands were musical \u2014 not sing-song, but pitched. High for urgency. Low for ease. The channel unrolled ahead of the ship like a path being walked.","","      \"Coral head, starboard, twenty feet. No danger \u2014 we're clearing by ten. Hold your line.\"","","      Kessara held. The ship moved. The channel was wider than Galluun's Tooth and the Khari's calls made it wider still \u2014 the certain, practiced voice of someone who'd guided a hundred ships through this water and never lost one to the reef.","","      \"Depth dropping. Sand bottom, twelve feet. Channel opens in thirty meters. You're through.\"","","    The anchorage opened. Wider than Galluun's Tooth \u2014 a natural harbor formed by the reef's horseshoe shape, with the island's bulk breaking the ocean swell. The water was clear and calm and a half-dozen ships were moored at a wooden dock on the south side, including a sloop with a dark red hull and an orange-on-black flag.","","    The Kindling. Suuba Mettani had arrived first. Again.","","    Tessavenne dropped from the bow to the dock \u2014 a six-foot drop taken without breaking stride. They turned, caught the mooring line that Sullavenne threw, and tied it off with three motions that were efficient enough to be choreography.","","    \"South dock. Market in three hours. Freshwater is on the ridge \u2014 free, not metered. The cisterns are communal.\" They looked at you from the dock. Eye level with your chest. \"Warren Suuvi is on the north cliff. If you want to go up, ask first. Don't climb without an invitation. The paths are mapped and the unmapped ones are unmapped for a reason.\"","","    *goto arrival_dock","","  #Thread the channel alone. The crew can read the buoys and the water is clear \u2014 save the coin for provisions.","    \"We'll take the buoys,\" Kessara called.","","    The pilot shrugged. The motion was precise. A data point. Ships that refused piloting at Merrenbach were noted. The information went into whatever system the warren used to track incoming crews, and the first fact about the Sundered Wake was that they'd declined help.","","    *set personality_aggression %+ 3","","    \"Buoys mark the center line. Stay inside the white. If you see red, you're on the reef edge and you've gone wrong.\" The pilot's outrigger peeled away, heading back toward the dock.","","    *set khari_guide_name \"unknown\"","","    The channel was wider than Galluun's Tooth. Kessara steered by the buoys \u2014 white markers in a line, the center of the navigable water, with the reef visible beneath the surface on both sides. The coral here was different from the northern stop \u2014 more varied, with structures that rose in columns and fans and branching formations that cast complex shadows on the sand bottom.","","    The approach took twenty minutes. Longer than it would have with a pilot \u2014 Kessara took it slow, reading the water, adjusting for a current that pulled from the south with more force than the chart had promised.","","    \"Stronger pull here,\" she said. \"The shelf drops away faster on this side of the island. The tidal exchange is pulling through the channel like a funnel.\" She corrected. The bronze fitting earned its keep \u2014 the rudder answered clean. \"Through. We're through.\"","","    The anchorage opened. A natural harbor, wide and calm, with ships moored at a wooden dock on the south side. Including a sloop with a dark red hull and an orange-on-black flag.","","    The Kindling.","","    Sullavenne threw the mooring line. A dock worker \u2014 Khari, avian, young \u2014 caught it and tied off with the practiced competence of someone who'd been tying lines since childhood. They looked at the hull. At the crew. At you.","","    \"South dock. Market at low tide. Freshwater on the ridge, free.\" They looked at the Sundered Wake's hull \u2014 at the patches, the replaced planking, the new bronze fitting that was the only thing on the ship that looked like it belonged. \"You need supplies, the market has them. You need repairs, we don't have a boatwright.\"","","    They left. No name offered. The first impression had been a refusal.","","    *goto arrival_dock","","*label arrival_dock","","*page_break","","Merrenbach from the dock was vertical.","","The south dock was ground level \u2014 wooden planking built on coral foundations, with bollards and cleats worn smooth by decades of mooring lines. Standard. Functional. The dock could have been at Selvaggio or Galluun's Tooth or any harbor in the Bastion Sea. But above the dock, the island began to climb, and what it climbed into was nothing you'd seen before.","","The cliff face rose sixty feet from the waterline. The limestone was grey-white, pitted by weather, layered with horizontal strata that created natural ledges every eight to ten feet. On every ledge \u2014 platforms. Some were bare stone, worn flat by feet. Some had been extended with wooden frames that jutted from the cliff face like shelves, supported by rope stays anchored to the rock above. Rope bridges connected the ledges in a web of movement paths \u2014 horizontal traversals that linked the north cliff to the south cliff, with vertical ladders and climbing routes running between the levels.","","People moved on the cliff. Avian Khari \u2014 dozens of them, climbing and traversing and standing on ledges with the casual verticality of people for whom the ground was an inconvenience. They were small. The largest you could see was maybe five-three. The feather-patterns varied \u2014 some brown-grey like Tessavenne, some with amber accents, some with a pale gold that caught the light. They wore light clothing \u2014 wraps, tunics, bare feet with toe-grip that looked prehensile from below.","","Children ran the rope bridges. Ran. Full speed, bare feet, the bridges swaying, and they didn't slow down. A child of maybe eight dropped from a ledge to a lower platform \u2014 a ten-foot drop \u2014 landed in a crouch, kept moving. An older child, twelve or thirteen, was hanging upside-down from a rope bridge by her knees, braiding another child's hair. The child being braided was also upside-down. Neither of them seemed to consider this unusual.","","You looked up. Six-seven, two hundred and sixty pounds, and you had never in your life felt more like a ground animal.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had noticed the same thing. \"Height-hierarchy,\" she said quietly. \"Avian Khari assign social trust by vertical position. Ground level is for strangers and transactions. The higher someone stands in the warren, the more trust they hold. An invitation to climb is an invitation to be trusted.\"","","  She looked at the cliff. At the rope bridges and the children running them and the Khari adults who watched the dock from sixty feet above.","","  \"We're at ground level. Which means we're unknown. Unknown is not hostile \u2014 it's untested. The Khari separate the two.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was already scanning the dock for food vendors. There were none. The dock was functional \u2014 mooring, supply transfer, nothing else. The economy of Merrenbach was elsewhere.","","  \"The market's on the reef flat,\" he said. \"Low tide. Three hours.\" He was staring at the drying racks on the lower platforms \u2014 rows of something flat and dark. \"Is that \u2014 that's kelp. Reef-dried kelp.\" His voice changed. \"I've had it once. A canine warren on the eastern coast, a woman gave me a sheet as a trade sample, I used it in a broth and it was \u2014\" He stopped. Swallowed. \"We need it. We need as much of it as we can afford. I'm not being dramatic. I am being dramatic. We need it.\"","","The south dock had a waiting area \u2014 an open-sided shelter, wooden frame, palm-thatch roof, with stone benches worn smooth. Four benches. Two were occupied.","","Suuba Mettani's crew.","","Drossik Verath sat on one bench, Grimoire in his lap, running numbers. His grey-blue Varrek skin caught the light at an angle that made him look like he was made of the same stone as the cliff. Hollenne Goss sat on the other bench, her legs stretched out, eating something from a leaf wrapper.","","Drossik looked up when you arrived. Nodded. Looked down. Looked up again. The second look lasted longer \u2014 the Varrek recalculating something he'd miscalculated the first time. He adjusted a number on his Grimoire. You were apparently worth a second data point.","","Hollenne waved. \"The ketch. You made it.\" She moved her legs to make room, then realized there was already room, then moved them back. \"Suuba's on the cliff \u2014 she got invited up the first day. Something about her ship being Rathai-designed and the Khari respecting builder cultures.\" She bit into whatever was in the leaf. \"The rest of us are dock-level. Two days. Drossik's been counting.\"","","\"I've been working,\" Drossik said, without looking up.","","\"He's been counting,\" Hollenne said.","","She looked at you. At the horns. At the crew.","","\"You hear the broadcast? Wardensea patrol.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne's hand stopped halfway to her coat pocket. The notebook stayed where it was.","","  \"What do you know?\"","","\"Same as you, probably. Fourth Division, three ships, heading south. Full inspections.\" Hollenne shrugged \u2014 the kind of shrug that used her whole body. \"Suuba's not worried. She says the Khari have some \u2014 a deal. With the Wardensea. No patrols at warren islands. Path Registration something. Accord? Path Registration Accord.\" She waved a hand. \"Suuba explained it twice. I got maybe forty percent the first time and less the second, honestly. Point is they can't inspect us at anchor. Supposedly.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne's expression didn't change. Her hand moved to her notebook pocket \u2014 touched the leather, didn't open it.","","  \"The Path Registration Accord. Year 2,400. The Khari agreed to register migration routes in exchange for sovereignty over warren settlements. The Wardensea agreed not to garrison or inspect at warren islands.\" She paused. \"It's been challenged eleven times and upheld nine. The exceptions were both during declared emergencies.\"","","  She looked at the cliff. At the Khari who were not coming down to greet anyone.","","  \"If the accord holds, this anchorage is safe from inspection. The Wardensea can patrol the waters outside the reef, but they can't board ships docked at a warren island.\"","","\"That's what Suuba said. In more words and with more hand gestures.\" Hollenne finished her leaf-wrapped food. \"She's been up there since yesterday. Talking to the trail-leader \u2014 that's their word for the \u2014 path-leader? Trail-leader. One of those.\" She wiped her hands on her trousers. \"The Khari love path metaphors. 'We're walking the same road.' 'That trail goes to a cliff.' I keep getting them wrong and Drossik keeps correcting me.\"","","\"'Goes nowhere,'\" Drossik said, still not looking up. \"'That trail goes nowhere.' You said 'cliff' last time too.\"","","\"Same concept,\" Hollenne said.","","She stood. Tall for a human woman. Broad. The easy physicality of someone who solved problems by carrying them.","","\"Market's in \u2014\" she checked the water level against a mark on the dock piling \u2014 \"two and a half hours. If you need supplies, that's where. Reef pearls, dried kelp, fishing tackle, information. The information costs more than the pearls.\"","","She looked at the cliff again.","","\"If you want to go up, you need an invitation. The Khari don't lock their doors \u2014 they just build them sixty feet in the air and let gravity sort out who belongs.\"","","*page_break","","The two and a half hours passed.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara inspected the hull. The bronze fitting was holding. The sternpost was solid. The caulking Pellanne had applied at Galluun's Tooth was cured and sealed. The ship was, by Kessara's grudging assessment, seaworthy.","","  \"We can leave in twelve hours,\" she said. \"The question is whether we should. The Wardensea patrol reaches Merrenbach in \u2014\" she calculated \u2014 \"forty-eight hours at patrol speed, give or take. If the Path Registration Accord holds, they can't inspect us at the dock. But if we leave Merrenbach and they're waiting outside the reef...\"","","  She left the sentence.","","  \"If we leave too early, we're in open water when the patrol passes. If we leave too late, we're trapped behind a Wardensea screen. The timing matters.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had been walking the dock since arrival. Not exploring \u2014 surveying. She'd mapped the anchorage, counted the ships (six, including the Kindling and the Sundered Wake), noted the reef buoys, and measured the channel width by eye.","","  *if (galluuns_tooth_challenge = \"took_box\")","    She'd also spent thirty minutes in the cargo hold with the modified Grimoire.","","    When she came out, her face was different. Harder.","","    \"Grey band. I tuned in. The patrol is broadcasting \u2014 standard Wardensea operational chatter, encrypted, but the encryption is quarterly and the Grimoire's decoder appears to be current.\" She kept her voice low. \"The patrol squadron \u2014 callsign Bastion Sweep \u2014 departed Kassevaan thirty-one hours ago. Current position: north of Selvaggio, heading south at nine knots. That puts them at Galluun's Tooth by tomorrow morning. Merrenbach by the day after.\"","","    She paused.","","    \"They've listed eighteen vessels of interest for inspection. Crew descriptions, ship types, last-known headings. We're not on the list.\" Her eyes were flat. \"The Kindling is. Ship number four. 'Rathai sloop, single mast, dark red hull, crew of eleven. Captain: Suuba Mettani, 275 million bounty, Element-type God Fruit, Kindling.'\"","","    She closed the notebook.","","    \"Suuba doesn't know she's a specific target. We know because we're listening to the Wardensea's private channel on a contraband device. If we tell her, we reveal we have the Grimoire. If we don't tell her, she sails into an inspection that's looking for her specifically.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was restless. The cook without a market was a man without a purpose, and he'd been pacing the dock in a circuit that took him past the mooring lines, past the shelter, past the water-level mark on the piling, and back. Each circuit, he checked the mark. The water was dropping.","","  \"Tide's turning,\" he said on his fourth pass. \"The reef flat's starting to show. Another hour and the market surface is exposed.\"","","  He stopped. Looked at the cliff.","","  \"I want to trade for kelp. The reef-dried kelp the Khari make \u2014 it's the best soup base on the Kingsrun. If I can get a week's supply, I can make the Selvaggio provisions last twice as long.\" He paused. \"I also want to buy reef pearls. Not to wear \u2014 to trade. Reef pearls from Merrenbach are worth three times their weight at Brannach. The Gorundai use them in ceremonial metalwork.\"","","  He looked at you. He was doing math on his fingers, which he always did when the numbers mattered.","","  \"Four coppers now. Sell at Brannach for Silver.\" He folded down a finger. \"My mother called it patience with a price tag. She was better at it than me. I keep wanting to eat the investment.\"","","The tide retreated. The reef flat emerged \u2014 slowly, the way it had at Galluun's Tooth, but wider here. The coral shelf extended south from the dock in a broad apron, flat and rough, the surface covered in ankle-deep water that shallowed by the minute. Tide pools formed. Channels drained. The underwater world became the market floor.","","*page_break","","The low-tide reef market at Merrenbach was temporary by design.","","The Khari did not build permanent markets. Permanent things got taken. The lesson was historical and the memory was institutional \u2014 path-routes registered, ancestral knowledge appropriated, settlements garrisoned. Warren Suuvi had learned, across generations, that what the tide revealed and the tide concealed was safer than anything built to last.","","The market was the reef flat. Sixty feet wide, a hundred feet long, exposed for six hours between tides. The Khari came down from the cliffs to set it \u2014 wooden frames assembled from parts carried on backs, cloth canopies stretched on poles driven into coral crevices, goods laid on mats of woven kelp. The assembly took twenty minutes. It was practiced, communal, and fast \u2014 every member of the warren who participated knew their position and their task.","","The goods were reef-sourced. Dried kelp hung from frames in dark, translucent sheets that smelled of salt and iodine. Reef pearls sat in shallow stone bowls \u2014 small, irregular, with the iridescence of things that had been formed inside living creatures. Fish, dried and salted, in quantities that said the reef fed this island the way volcanic soil fed the highlands. Rope made from reef-fiber. Bone hooks for deep-line fishing. A rack of tools \u2014 coral chisels, shell scrapers, bone needles \u2014 that were crude by Nettleworks standards and elegant by their own.","","The market was for Khari and outsiders both. Warren Suuvi occupied the upper tiers of stalls \u2014 deeper into the reef flat, further from the dock. The lower tiers, closest to the water and the dock, were where outsiders traded. The separation was physical and legible. You could shop at the outer ring. You could look at the inner ring. You could not enter it without an invitation.","","Other crews were there. Dock-level crews from the ships in the anchorage \u2014 three you didn't recognize, plus the Kindling's Hollenne and Khellen, who were haggling at a kelp stall with the focused intensity of professionals.","","The Khari who ran the outer stalls were patient. They did not call out. They did not hawk. The goods were present. You looked or you didn't. The prices were not posted \u2014 you asked, they answered, you agreed or you walked. Bargaining existed but was not theatrical. A Khari vendor named a price and meant it. The margins were in the second transaction \u2014 buy once at full price, buy again at a discount. Trust was sequential.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was already deep in the market. He'd found the kelp \u2014 dark sheets, sun-dried, the smell intense and complicated. The vendor was an older Khari, feather-patterns gone silver, with hands that moved with the particular speed of someone who'd been sorting reef products for decades.","","  \"Reef kelp. Four days drying on the south flat. Rehydrates in warm water \u2014 stock base, soup thickener, flavor carrier.\" The vendor's voice had the Khari cadence \u2014 fast, musical, each phrase a step on a path. \"Three coppers a sheet. Ten sheets, twenty-five coppers. You won't find better south of here \u2014 the Brannach kelp is ash-tainted from the volcano.\"","","  Terrek bought ten sheets. The vendor wrapped them in waxed cloth and tied the bundle with reef-fiber cord. A nod. Transaction complete. No warmth, no hostility. A path walked.","","  *set sovereigns - 1","","You walked the market. The reef flat was rough under your boots \u2014 the coral surface uneven, studded with small formations that caught the sole. The Khari moved barefoot on the same surface without visible discomfort. Their feet were different \u2014 the toes longer, more articulate, gripping the coral the way fingers grip a rung. The reef was their floor and their feet had evolved to walk it.","","Your boots drew looks. Not from the vendors \u2014 they'd seen boots before. From the children. Warren Suuvi's children watched you from the inner ring, perched on the wooden frames of their parents' stalls, the dark eyes tracking you with the open, undisguised curiosity of small things watching a large thing move through their territory.","","You were the largest person on the reef flat by a foot and a half. The horns added another dimension. The storm-leather coat was highland gear in a place that had never seen highlands. Every step you took on the coral announced weight and foreignness, and the Khari heard both.","","A vendor at the outer ring was selling reef pearls. Small, irregular, sitting in a shallow stone bowl on a kelp mat. The iridescence shifted in the light \u2014 blues and greens and a pink that came from the particular mineral content of the Merrenbach reef. The vendor was middle-aged, with amber feather-patterns on the temples and the quiet patience of someone who sold luxury goods to people who didn't know what they were worth.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was beside you. He picked up a pearl. Turned it in the light.","","  \"Three of these. The small ones \u2014 they're cheaper, and the Gorundai at Brannach use the small ones for inlay work.\" He looked at the vendor. \"How much?\"","","  \"Two coppers each.\" The vendor watched Terrek handle the pearl. Watched the care. \"Six for three. If you carry them properly \u2014 dry, not against metal, wrapped in cloth.\"","","  \"Done.\"","","  *if (sovereigns >= 1)","    *set sovereigns - 1","","*page_break","","The market ran for three hours. The tide held. The reef flat dried further, exposing the outer edges where the coral formations grew taller and the tide pools held creatures that retreated with the water \u2014 small things, bright-colored, darting for cover as feet approached.","","*if (galluuns_tooth_challenge = \"took_box\")","  *if (crew5_name = \"Sullavenne Ohn\")","    Sullavenne found you between the kelp stalls and the rope vendors. Her expression was controlled. The notebook was open.","","    \"Decision time.\" She kept her voice below the market noise. \"The Kindling is target number four on the Wardensea list. Suuba Mettani doesn't know. We know because of a contraband device that would get us arrested.\"","","    She held the notebook where only you could see. Numbers. Distances. Times.","","    \"Option one: tell Suuba. She has two days to change her heading, alter her ship's profile, or prepare for an inspection. She lives. We expose the Grimoire's existence to a crew we've known for six days.\"","","    She turned the page.","","    \"Option two: say nothing. Suuba sails into an inspection that's hunting her specifically. The Kindling's crew is eleven people. The Wardensea impounds ships whose captains have 275-million-Sovereign bounties. Suuba's crew goes to Kassevaan in chains.\"","","    She closed the notebook.","","    \"There's no clean version of this.\"","","    *choice","      #Find Suuba. Warn her. The Grimoire stays a secret \u2014 say you overheard it from a Khari vendor's Grimoire, not that you intercepted Wardensea communications.","        The lie was practical. A Khari vendor's Grimoire picking up chatter \u2014 plausible, given the Khari's information networks. The real source stayed in the cargo hold.","","        *set personality_mercy %+ 5","        *set rival_suuba + 5","","        Finding Suuba meant finding someone who could take a message up the cliff. Hollenne was at the kelp stalls.","","        \"I need to get word to Suuba. It's about the Wardensea patrol.\"","","        Hollenne looked at you. The cheerfulness compressed into something harder and more immediate.","","        \"What about the patrol?\"","","        \"The Kindling is on a target list. Eighteen ships the Wardensea wants to inspect specifically. Suuba's ship is number four.\"","","        Hollenne didn't ask how you knew. The cheerful haggler was gone. The woman who'd survived two years of the Kingsrun with a Cursed Generation crew was standing in her place.","","        \"I'll get her.\" She was already moving toward the cliff, her stride covering the reef flat in long steps that said she'd learned to walk coral the hard way. She reached the base and started climbing \u2014 not with Khari ease, but with the brute competence of someone who'd been climbing their way into and out of places for years.","","        Twenty minutes later, Suuba Mettani was on the reef flat.","","        She was angry. The anger was Rathai \u2014 fast, directed, already converting to action. She looked at you, already reassessing the variable you represented.","","        \"Who told you?\"","","        \"Khari vendor. Grimoire chatter. The Wardensea listed eighteen ships.\"","","        She held your gaze. The dark eyes \u2014 the Nettleworks eyes, sharp with intelligence and warm with anger \u2014 searched for the lie. They found something, or they didn't. Her expression didn't change.","","        \"Number four.\" She said it flat. \"They listed us number four.\"","","        She turned to Hollenne. \"Get Drossik. Get Khellen. We're changing the departure schedule.\" Back to you. \"You didn't have to tell me. The smart play was to let us sail into it \u2014 one less crew on the Kingsrun, one less ship splitting the Grimoire attention.\"","","        She was five-one. You were six-seven. She looked up at you with the same unafraid directness she'd shown on the stone platform at Galluun's Tooth.","","        \"Thank you. I owe you one. On the Kingsrun, that's not nothing.\" She was already walking. \"Hollenne. Move.\"","","        *goto evening","","      #Say nothing. The Grimoire is the most dangerous thing on your ship \u2014 and the most valuable. Protecting it protects the crew.","        The eleven people on the Kindling were Suuba's problem. The modified Grimoire in the cargo hold was yours.","","        *set personality_aggression %+ 5","","        Sullavenne watched. She didn't argue. The notebook closed. Her thumb ran along the leather spine \u2014 back and forth, three times, the way someone touches a wound to check if it still hurts. She opened it. Wrote something \u2014 one line, small, in the margin. Closed it again. Her left hand found the inside of her wrist and stayed there, pressing, like she was checking her own pulse.","","        \"I'll continue monitoring Grey band,\" she said. Her voice was the same. Everything else was a degree off-center. \"If the target list changes, we adjust.\"","","        She walked back toward the ship. The reef flat held the afternoon light and the Kindling's crew moved through the market and Suuba Mettani was on the cliff above, talking to the trail-leader, planning a route south that would take her directly into a patrol hunting her by name.","","        *goto evening","","*if (galluuns_tooth_challenge = \"left_box\")","  The afternoon light stretched across the reef flat. The market hummed \u2014 quiet commerce, the low sound of a community trading what the reef provided. The Wardensea patrol was a weight in the air, a fact that every crew at the dock knew and none discussed openly. The timeline was known. The options were limited. Two days until the patrol reached Merrenbach \u2014 less if the patrol pushed hard, more if they lingered at Galluun's Tooth.","","  *if (crew5_name = \"Sullavenne Ohn\")","    Sullavenne had been calculating. She cornered you between the tool stall and the rope vendor.","","    \"The Path Registration Accord protects us at anchor. The Wardensea can't board ships docked at a warren island.\" She kept her voice even. \"But they can wait outside the reef. If we leave and they're patrolling the waters south of Merrenbach, we're inspected at sea. No documentation. No papers. A salvage-claimed ship with four people and no registered purpose.\"","","    She tapped the notebook.","","    \"We need to leave before the patrol arrives, or we need to leave after they pass. Before means gambling on timing. After means days at anchor while the patrol sweeps south. Days we don't have \u2014 supplies, provisions, the Kingsrun doesn't wait.\"","","    She looked at you. \"The Khari have information about patrol movements. Their lookout network tracks ships. If we can earn enough trust to access that information, we can time our departure.\"","","*label evening","","*page_break","","The tide came in. The market disappeared.","","The water reclaimed the reef flat by inches \u2014 the outer edge first, the tide pools filling, the channels connecting, the coral surface darkening as the ocean returned. The Khari dismantled the market in the same twenty minutes it had taken to build it. The frames came apart. The canopies folded. The goods went into carrying sacks and up the cliff, passed from hand to hand along the vertical paths, disappearing into the warren's upper levels.","","Within half an hour, the reef flat was underwater. The market was gone. No trace remained \u2014 no permanent structure, no sign, nothing that said a hundred people had traded here an hour ago. The reef held the secret the way the Khari held their paths: temporary, protected, revealed only when the conditions were right.","","*set current_stop 3","*set current_stop_name \"Merrenbach\"","*set days_since_departure + 6","*set total_sea_days + 5","","The evening was warm. The cliff face caught the sunset \u2014 orange light on grey stone, the rope bridges casting long shadows, the Khari moving upward in the last light, returning to the heights where the warren lived.","","*if (khari_guide_name = \"Tessavenne\")","  Tessavenne appeared on the dock. The pilot had been absent since the mooring \u2014 gone to the cliff, gone up, gone into the warren's vertical world. Now they were back, standing on the dock edge, watching the last of the tide cover the reef flat.","","  \"The trail-leader knows you're here.\" Tessavenne's voice carried the evening's stillness. \"She knows your ship and your crew count and your hull condition and your heading. She knows the Wardensea patrol is coming. She knows you need something from us.\"","","  The dark eyes were steady.","","  \"Her name is Suuvi Renn. She was a scout before she was a leader. The best pathfinder Warren Suuvi has produced in two generations.\" A pause. \"She doesn't come down. If you want to talk to her, you go up.\"","","  Tessavenne looked at the cliff. At the rope bridges and the ledges and the sixty feet of vertical distance between the dock and the warren's heart.","","  \"She said to tell you: 'The path is open. Whether you walk it is your decision.'\"","","  The invitation. The first step above ground level.","","*if (khari_guide_name = \"unknown\")","  A Khari appeared on the dock as the tide covered the reef flat. Young \u2014 one of the market vendors, the pearl seller with the amber feather-patterns. They stopped at the edge of the dock and looked at you with the neutral assessment of someone delivering a message they hadn't written.","","  \"The trail-leader wants to see the new ships' captains. All of them.\" The voice was flat. Professional. \"Tomorrow. Low tide. The meeting platform \u2014 it's the third ledge, north cliff. You climb the marked path. Don't leave the path.\"","","  They looked at the cliff. At the height.","","  \"The trail-leader's name is Suuvi Renn. She was a scout. She remembers every ship that's docked here in thirty years. She'll remember yours.\"","","  They left. The message delivered. The dock empty.","","The night fell on Merrenbach.","","The cliff face came alive in the dark \u2014 lanterns and small fires on the ledges, the warm light making the limestone glow from within. The rope bridges were visible as dark lines against the cliff's lit face, with figures crossing them in silhouette. Sound carried down \u2014 voices, laughter, a song that was melodic and repetitive and structured like a chant. A path-song. The Khari singing their routes into the evening air, the melody encoding the reef and the tides and the island's relationship to the ocean.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek listened. He'd stopped moving on the ship's deck, a pot in his hands, and his face had the expression of a man hearing something he recognized but couldn't name.","","  \"That's a navigation song,\" he said. Quiet. \"My mother hummed something like it \u2014 she grew up near a canine warren on the eastern coast. The warren women sang the tide schedules. Different melody. Same structure.\"","","  He set the pot down. \"They're singing the reef. Every interval is a depth reading. The high notes are the shallows. The low notes are the deep channels. If you could read the song, you'd have a chart.\"","","The Sundered Wake rocked at the dock. The Kindling was dark \u2014 Suuba's crew had turned in early, or they were planning in the dark, or they were already preparing to run south ahead of the patrol. The other ships in the anchorage were quiet.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was on the stern. Notebook open. Writing by the ship's lantern.","","  \"Suuvi Renn.\" She didn't look up. \"The trail-leader's name. Renn. That's a Path-Hider warren lineage \u2014 Renn-descended warrens were expelled from the main Khari network three thousand years ago for hiding Silverborn refugees during the genocide. The Renn warrens accepted expulsion rather than stop.\"","","  She wrote another line.","","  \"A trail-leader from a Path-Hider lineage, running a warren on a Kingsrun stop, offering to meet with Kingsrun captains while a Wardensea patrol approaches.\" She looked up. \"That's not hospitality. That's positioning. She's going to offer something, and whatever it is will have a price that isn't money.\"","","The night deepened. The path-song continued from the cliff \u2014 cyclic, patient, the reef's shape rendered in melody and passed from voice to voice as the watch changed on the upper ledges. The sound was older than the buildings. Older than the warren. The song remembered routes the singers had never walked, and the reef held the notes the way coral held names \u2014 temporarily, persistently, long enough to matter.","","Tomorrow. The trail-leader. The climb.","","The Wardensea patrol was forty-eight hours south of Selvaggio and closing.","","*goto_scene ch3_merrenbach_warren",""], "labels":{"arrival_dock":135,"evening":392}},
"ch3_merrenbach_warren": {"crc":280705405, "lines":["*comment ===================================================","*comment  CHAPTER 3: MERRENBACH \u2014 \"The Reef Walk\"","*comment  Scene 2: The Warren","*comment  Climbing into Warren Suuvi. MC's size in Khari","*comment  spaces. Meeting trail-leader Suuvi Renn. A favor","*comment  asked. Wardensea patrol intelligence \u2014 earned,","*comment  not given. The price isn't money.","*comment  2 real choices. Zero fake choices.","*comment ===================================================","","The path up the cliff was marked with paint.","","White dots on grey stone \u2014 small, each one the size of a thumbnail, spaced at arm's length. Khari arm's length. For you, the spacing was close \u2014 hand, hand, foot, foot, the movements compressed into a rhythm that forced your body into a frame half its natural scale.","","The marked path started at the dock's north end, where the cliff face began its rise. A wooden ladder led to the first ledge \u2014 ten feet up, a horizontal shelf of limestone worn smooth by decades of Khari feet. From there, the paint dots led along the cliff face to a series of carved handholds that rose to the second ledge. Then a rope bridge. Then more handholds. Then the third ledge \u2014 the meeting platform, thirty feet above the waterline.","","*if (khari_guide_name = \"Tessavenne\")","  Tessavenne climbed beside you. The Khari moved the way water moves down a surface \u2014 finding the path of least resistance, each grip and step a continuation of the last, the body rotating around contact points with a fluidity that had nothing to do with strength and everything to do with architecture. Tessavenne's skeleton was built for this. Yours was built for walking through mountain storms.","","  \"The rungs are rated for cargo loads,\" they said. \"Two hundred pounds. You're \u2014\" The dark eyes measured. Measured again. \"I'm not going to guess. Use the stone holds instead. They go into the cliff four inches. They've held the island's weight for a thousand years.\" They paused. \"I've never actually tested them on \u2014 someone your size. But the math should work. The math works.\"","","*if (khari_guide_name = \"unknown\")","  You climbed alone. The white dots showed the path. The handholds were carved deep \u2014 four inches into the limestone, each one shaped for a Khari hand, which meant your fingers found the back of the hold and your thumb hooked the lip. Functional. Tight.","","The first problem was the ladder. The wooden rungs were spaced for Khari legs \u2014 twenty inches apart. Your legs wanted thirty. You climbed it the way you'd climb a fence built for children: by compressing, bending, fitting a body into a space that treated your size as an error in the specifications.","","The second problem was the rope bridge.","","It connected the first ledge to the second \u2014 a horizontal traverse of forty feet, the bridge made of reef-fiber rope with plank footboards spaced a foot apart. The bridge swayed when you stepped onto it. At Khari weight \u2014 ninety pounds, a hundred \u2014 the sway would have been a gentle oscillation. At your weight, it was a statement. The bridge dipped six inches and the anchor ropes groaned and the planks creaked and every Khari on the cliff face turned to watch the half-Oni in the storm-leather coat negotiate a crossing designed for people who weighed a third of what he did.","","You gripped the guide ropes. The fiber was rough \u2014 reef-rope, hand-woven, strong enough for the loads it was built for. You were testing the upper bound. Each step was deliberate. The bridge's rhythm wanted speed \u2014 the quick, light cadence of a Khari crossing. Your weight demanded the opposite. Slow. Controlled. The bridge protesting with each step, the planks flexing, the guide ropes vibrating in your grip.","","Thirty feet below, the dock and the lagoon. The Sundered Wake's deck was visible \u2014 Kessara at the helm, looking up, her expression that blend of engineering concern and personal interest that said she was calculating stress loads on the rope.","","You reached the far side. The bridge stopped complaining. The stone ledge was solid under your boots and the relief was in the knees, not the mind \u2014 the body recognizing stable ground after forty feet of something that had wanted to shake you off.","","*if (khari_guide_name = \"Tessavenne\")","  Tessavenne was already on the ledge. Waiting. They hadn't looked back during the crossing.","","  \"The bridge holds,\" they said. \"It always holds. People don't trust it because it moves. That's the point. Trust is the willingness to stand on something that moves.\" They glanced at the rope anchors. \"Although we've never had \u2014 I mean, it's not a weight thing. It's not \u2014 the bridge is rated for \u2014\" They stopped. Closed their mouth. Opened it. Closed it again. \"You're fine. The bridge is fine. Everything is fine.\" They turned and started walking very quickly toward the third ledge.","","The third ledge was the meeting platform.","","*page_break","","The platform jutted from the cliff face on the north side \u2014 a natural shelf extended with wooden planking, roofed with stretched sailcloth, open on three sides. The view was vertical and horizontal simultaneously. Below: the dock, the lagoon, the reef flat now covered by the returning tide. South: the open ocean, flat and blue, the Bastion Sea stretching to a horizon that was beginning to haze in the morning heat. Above: thirty more feet of cliff face, and the upper ledges where the warren's core lived.","","The platform was occupied.","","Suuvi Renn sat on a low stone seat at the platform's edge, her feet bare on the wooden planking, her body oriented toward the ocean. She was old. Not human-old \u2014 the Khari aged differently. Their sixty-to-seventy-year lifespans compressed the markers. Lines around the eyes came at thirty. The silver in the feather-patterns came at forty. Suuvi Renn had both, and something else \u2014 a quality in the way she held still that said the stillness was a choice, not a limitation. She'd been fast once. The body remembered speed the way the cliff remembered water: in channels worn by repetition.","","She was small. Four-ten, maybe. The feather-patterns were silver-brown, the plumage lying flat against wiry forearms. Her eyes were Khari-large and Khari-dark, but where Tessavenne's eyes had been quick \u2014 scanning, cataloging, moving \u2014 Suuvi Renn's eyes chose a target and stayed. She looked at you the way a raptor looks at terrain from altitude: with the patient, encompassing attention of something that sees the whole field before it moves.","","She looked at the horns. At the coat. At the boots that had groaned on her bridge and the frame that took up a third of her platform.","","\"Sit.\"","","There were no chairs. The platform had cushions \u2014 reef-fiber, flat, arranged in a semicircle around the stone seat. Khari-sized. You sat. The cushion compressed to nothing under your weight and your knees rose above your waist and the position put you at eye level with the trail-leader for the first time.","","\"You're the cold entry.\" The voice was quiet. Khari-fast, but aged into something steadier. \"Veshanna Torc announced you on the Kingsrun Watch. Two-hundred-to-one odds.\" She tilted her head. \"Or was it two-fifty? My memory for betting numbers is \u2014\" She waved a hand. The hand was precise even when the gesture was dismissive. \"No bounty. No name on the board. Just a ship and a direction.\"","","She looked past you, at the ocean. Then back. The head-tilt again \u2014 slower than Tessavenne's, the way an old hawk moves compared to a young one.","","\"I've watched a hundred crews dock at this island. A hundred and \u2014 more than a hundred. I stopped counting.\" She picked up the net from beside her seat and ran a knot through her fingers. \"What do you need from Warren Suuvi?\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had climbed with you. She stood at the platform's edge \u2014 the only crew member you'd brought up. The others had stayed below, by unspoken agreement. Captains' business.","","  Sullavenne met Suuvi Renn's gaze. Neither of them blinked. Sullavenne's hand drifted toward her notebook pocket and stopped. Suuvi Renn's fingers tightened on her net. Four seconds of silence that neither of them was willing to break first.","","The answer was obvious. Route intelligence. Patrol movements. The specific information that the Khari lookout network gathered \u2014 ship headings, patrol speeds, Wardensea deployment patterns \u2014 that could mean the difference between sailing through open water and sailing into an inspection.","","But Suuvi Renn hadn't asked the question to hear the obvious answer. She'd asked it to see how you asked for help. The Khari measured people by how they negotiated \u2014 not the terms, the manner. Directness was respected. Deception was remembered. Begging was the end of the conversation.","","*if (khari_guide_name = \"Tessavenne\")","  Suuvi Renn waited. The patience was absolute \u2014 the patience of a woman who'd sat on this platform through storms and calms and a hundred negotiations and had never been the first to fill a silence.","","*if (khari_guide_name = \"unknown\")","  Suuvi Renn waited. Her patience had the weight of stone \u2014 the settled silence of a woman who'd been governing a community of ninety people for longer than you'd been alive, and who had learned that most problems solve themselves if you refuse to speak first.","","*choice","  #Direct. The Wardensea patrol is coming. The crew needs route intelligence \u2014 departure timing, patrol patterns, the window. Ask for what's needed and nothing else.","    *set personality_aggression %+ 3","    *set rep_khari_warrens + 5","","    Suuvi Renn's head tilted. The slow tilt \u2014 the raptor evaluating prey that had turned to face it. Something in her expression shifted. Not warmth. Recognition. The Khari respected directness the way the reef respected the tide \u2014 as a force that arrived without decoration.","","    \"Good.\" One word. The word did all the work.","","    *goto renn_responds","","  #Frame it as mutual benefit. The Wardensea patrol threatens every ship in this harbor \u2014 including Khari trade routes. Information shared is protection shared. The warren has as much reason to help the Kingsrun crews as the crews have reason to ask.","    *set personality_openness %+ 3","","    Suuvi Renn's fingers tightened on the net. The knot she was tying \u2014 you hadn't seen her pick it up \u2014 paused. The pause was assessment. She was reading the argument the way her lookout birds read wind \u2014 measuring it for direction, not just force.","","    \"You think the patrol threatens me.\" Not a question. A test of the statement's weight. \"The Path Registration Accord protects this anchorage. The Wardensea cannot dock at a warren island.\"","","    The dark eyes held you.","","    \"But you're not wrong that a patrol changes the water. Ships flee. Trade stops. The reef market loses three days of commerce every time white sails appear on the horizon.\" She untied the paused knot. Retied it. Tighter. \"Mutual benefit. That's a trade-language argument. The Khari don't use trade language \u2014 we use path language. But I speak both.\"","","    *goto renn_responds","","  #Offer labor first. Before asking for anything, tell her the crew has hands, a diver who's already proven himself, and time before the patrol arrives. Whatever the warren needs done, the crew can do.","    *set personality_mercy %+ 3","    *set personality_loyalty %+ 3","    *set rep_khari_warrens + 10","","    Suuvi Renn went still. The specific stillness of a predator when the prey does something it hasn't seen before. Her fingers stopped on the net. The knot hung unfinished.","","    For six seconds she was quiet. Then her head tilted \u2014 not the assessment tilt. The other one. The one that said the calculation had changed.","","    \"Most captains start with what they need.\" Her voice was different. Lower. The trail-leader's voice \u2014 the one she used on the cliff at night when the warren listened and the path-songs carried the words. \"You started with what you have. That's \u2014\" She tied the knot. Fast. \"That's unusual. I've been sitting on this platform for a long time. The unusual is getting rarer.\"","","    *goto renn_responds","","*label renn_responds","","*page_break","","Suuvi Renn listened. While you spoke, she picked up a half-finished net from the platform beside her and resumed knotting it. Her fingers worked without looking. The knots were small and precise and she tied them at the rate of about one per sentence you spoke.","","When you finished, she had fourteen new knots.","","\"The patrol.\" She didn't look up from the net. \"The Fourth Division deployed three ships from Kassevaan. Two corvettes and a frigate. They're running the southern Bastion route, Stop One through Stop Four, inspecting every vessel.\"","","\"They'll reach Merrenbach in forty hours. My birds put them north of Selvaggio as of this morning, heading south at standard patrol speed.\" She tilted her head. \"The Path Registration Accord protects this anchorage. The Wardensea will not dock here. They will not board ships at my reef. That protection extends to every vessel in my harbor \u2014 yours, the Kindling, the three fishing boats, every hull that is tied to my dock when the patrol passes.\"","","She paused. The pause had the cadence of a path-song rest \u2014 a held beat before the melody turns.","","\"But the protection ends at the reef's edge. Once you leave my harbor, you're in open water, and the Wardensea inspects in open water. The timing of your departure matters more than anything else you'll decide at this stop.\"","","She looked at you with the raptor attention.","","\"I can tell you when to leave. The exact hour, the exact tide, the exact heading that puts you south of the patrol's sweep before they reach this island. My lookout network tracks their speed, their course corrections, their anchoring patterns. I know when they sleep. I know when they change watch. I know the gap.\"","","She folded her hands. Small hands. The joints were thick with age and the fingers were longer than a human's and the calluses said she'd climbed this cliff every day of her life.","","\"This information has a price. It is not Silver Spans.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne didn't react. The notebook stayed closed. She'd predicted this \u2014 the price that wasn't money \u2014 and she was waiting to see what shape it took.","","\"A ship ran aground on the outer reef eight days ago. A supply vessel \u2014 not Kingsrun, not Wardensea. A commercial hauler from the northern Bastion coast. The crew was rescued. The cargo was not.\"","","She pointed south. Past the lagoon, past the reef flat, toward the outer reef where the coral wall dropped to open ocean.","","\"The ship is sitting in thirty feet of water on the reef shelf. The hull is broken. The cargo is spice crates \u2014 sealed, waterproofed, heavy. Sixty crates. Worth approximately twelve Gold Sovereigns at market rate.\"","","She looked at you.","","\"The cargo belongs to a Kolmari trading house. The trading house has filed a salvage claim. A recovery vessel is en route from the northern coast \u2014 estimated arrival: four days.\" She paused. \"The Khari do not salvage commercial cargo. It is not our reef, not our trade, not our path. The Accord specifically excludes commercial recovery from warren obligations.\"","","She tilted her head.","","\"But if the cargo were recovered before the Kolmari vessel arrives, the salvage claim would be void. Possession is a powerful argument, and the Kolmari litigate in courts that are six months away by post. The cargo could be divided between the recoverer and Warren Suuvi. Sixty crates \u2014 thirty to you, thirty to us.\"","","The offer. The trail-leader's price. Not money \u2014 labor. Dive the wreck, recover the cargo, split it with the warren. In exchange: route intelligence, Wardensea patrol timing, the exact window for departure.","","\"The wreck is at thirty feet. Deeper than your dive at Galluun's Tooth. The current on the outer reef is stronger. The tide window for recovery is four hours at low tide.\" She held your gaze. \"You've already proven you can dive. Tessavenne told me about the bronze fitting \u2014 your pilot reports everything, even when you don't take the piloting.\"","","*if (khari_guide_name = \"unknown\")","  \"You refused my pilot. My pilot reported that, too. Everything that happens at my reef comes back to this platform.\" No irritation. Data.","","\"Thirty crates of commercial spice is worth six Gold Sovereigns to you at any market south of here. The route intelligence is worth more \u2014 it's worth your ship, your crew, and your freedom. The Wardensea doesn't negotiate with undocumented Kingsrun crews. They impound.\"","","She sat back. The stone seat held her weight the way it held the weather \u2014 permanently, without comment.","","\"The path is in front of you. Walk it or don't. I'll have an answer before the next low tide.\"","","*choice","  #Accept the deal. Thirty crates and route intelligence \u2014 the dive is worth the risk.","    *set personality_aggression %+ 3","    *set merrenbach_deal \"accepted\"","","    The trail-leader read the answer before you gave it. The body language \u2014 the weight shifting forward, the hands on the knees, the posture of a person who has already committed to action and is waiting for the conversation to catch up.","","    \"Good.\" She stood. Four-ten, her head at your chest level. \"Low tide is in six hours. Tessavenne will guide you to the wreck site. The dive is your problem \u2014 the recovery, the transport, the physical work. The warren provides rope, a platform at the reef edge, and two boats for hauling crates to shore.\"","","    She looked at you from below. The raptor eyes. The Path-Hider trail-leader who had survived forty years on a reef island by knowing exactly what she could ask for and exactly when to ask it.","","    \"Your crew can help. The more hands in the water, the faster the recovery.\" She paused. \"The spice crates are sealed. Don't open them \u2014 the seal is the proof of origin, and the Kolmari marks on the crates are what makes them tradeable. Opened crates are worthless.\"","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne waited until Suuvi Renn had turned away.","","      \"She's been waiting for a crew with a diver,\" she said quietly. \"Eight days the wreck has been sitting there. Eight days she's been watching ships dock and assessing which captain could do the work.\" She looked at the cliff face. \"We weren't the first choice. We were the first crew with someone who'd already proven they could dive to twenty feet and pull hardware from a wreck.\"","","      She paused.","","      \"The intelligence she's offering is real. A Path-Hider warren on a Kingsrun stop has better information about Wardensea movements than most Wardensea officers. The question is whether the dive is as simple as she's describing.\"","","    *goto recovery_prep","","  #Decline. Thirty feet of water, commercial cargo, a Kolmari claim \u2014 the risk outweighs the reward. Find another way past the patrol.","    *set personality_mercy %+ 3","    *set merrenbach_deal \"declined\"","","    Suuvi Renn watched the refusal the way she watched weather \u2014 without surprise, without disappointment, with the calibrating attention of someone adjusting a plan.","","    \"Understood.\" One word. The conversation recalibrated. \"The route intelligence stays with the warren. I won't sell it \u2014 the Khari don't sell paths. But I'll tell you this for free, because you took my pilot and walked my bridge and climbed my cliff, and a crew that climbs earns the courtesy.\"","","    *if (khari_guide_name = \"unknown\")","      \"Understood.\" One word. \"The route intelligence stays with the warren. But I'll give you this, because you climbed my cliff when you could have stayed on the dock, and climbing counts.\"","","    She leaned forward.","","    \"The patrol anchors at night. Every night, between midnight and four hundred hours, the squadron stops. The corvettes drift on station and the frigate drops anchor. They resume at dawn.\" She held up a finger. \"If you leave Merrenbach at dusk, you'll have ten hours of sailing before the patrol wakes. At five knots, that's fifty miles south. The patrol will reach Merrenbach by the following morning. By then, you'll be two-thirds of the way to Brannach and ahead of their sweep.\"","","    She sat back.","","    \"It's not a guarantee. If the patrol pushes speed or changes course, the math breaks. But it's better than guessing.\"","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne committed the numbers to the notebook the moment you reached the dock. The calculations were immediate \u2014 departure time, heading, speed, patrol intercept window.","","      \"She gave us the minimum. The night-anchor pattern and a departure window. If we'd taken the deal, we'd have gotten the full picture \u2014 patrol frequency, course corrections, communication patterns.\" She looked at the cliff. \"She's rational. She offered exactly what we earned and no more. The Khari don't give discounts.\"","","    *goto alternative_prep","","*label recovery_prep","","*page_break","","The climb down was faster than the climb up. Gravity was on your side, and the body had learned the holds. The bridge still complained. The ladder still compressed. But the second time through, the cliff face was geography instead of obstacle \u2014 a path known, a route walked.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was waiting on the dock.","","  \"Thirty feet.\" She was already doing math \u2014 you could see her lips moving. \"That's ten feet deeper than the wreck at Galluun's Tooth. Your ears are going to \u2014 it's a real pressure difference. Ninety seconds per dive instead of two minutes. Maybe less. I'm guessing. I've never dived.\"","","  She crossed her arms. Uncrossed them. Started pacing.","","  \"Sixty crates at thirty feet. That's \u2014 ten dives minimum. More. Probably a lot more.\" She stopped pacing. \"I'll rig a pulley from the reef shelf. Haul line to the Khari boats. You go down, attach, I pull up. It's an assembly line. I'm good at assembly lines.\" She looked at the ocean. \"I'm less good at the part where you're underwater for ninety seconds at a time and I'm standing on a rock.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek heard the deal and went quiet. He was doing the thing with his fingers again \u2014 counting, recounting, the numbers moving through his hands.","","  \"Thirty crates of commercial spice.\" He looked at you. Looked at his hands. \"If it's southern Bastion stock \u2014 pepper, turmeric, cardamom \u2014 that's six Gold Sovereigns. At Brannach, where the volcano ruins the local supply, eight. Maybe nine.\" He stopped counting. His hands didn't know what to do when they weren't counting, so they picked up a rope and started coiling it. \"That's more money than the ship cost. I keep saying the number and it keeps not sounding real.\"","","  He looked at the ocean. Put the rope down. Picked it up.","","  \"I'll sort on shore. Spice absorbs seawater. If a seal's broken, I'll smell it.\" He paused. \"I realize I just volunteered to sniff thirty boxes. I'm fine with that.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had the timeline.","","  \"Low tide in five hours. Tide window: four hours. We need the recovery complete before the water rises \u2014 the current strengthens with the incoming tide and the wreck becomes inaccessible. That gives us a hard deadline.\"","","  She looked at the crew.","","  \"Kessara runs the haul system. Terrek sorts on shore. I coordinate with the Khari boats.\" She looked at you. \"You dive.\"","","  She opened the notebook.","","  \"One more thing. The Kolmari trading house has filed a salvage claim. That means they have legal standing. If the recovery vessel arrives and finds the cargo gone, they'll report it. The report goes to the Wardensea. The Wardensea adds it to the file.\" She closed the notebook. \"Suuvi Renn said the courts are six months away by post. She didn't mention that the Wardensea's file is instantaneous by Grimoire. We'll be carrying stolen cargo through a Wardensea inspection zone.\"","","  She shrugged. The smallest motion.","","  \"Just so we're clear on what we agreed to.\"","","The hours passed. The crew prepared. Kessara rigged a pulley system from the ship's spare blocks \u2014 rope through a fixed anchor at the reef shelf edge, running to one of the Khari's flat-bottomed boats. Terrek cleared the cargo hold. Sullavenne ran the timeline.","","*goto dive_scene","","*label alternative_prep","","*page_break","","The climb down was faster. The cliff's holds were known, the bridge's rhythm expected. The body had learned the path.","","The crew was on the dock. The information was simple: leave at dusk, sail through the night, stay ahead of the patrol.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara heard the plan and started calculating sail trim.","","  \"Dusk departure. Ten hours of darkness at five to six knots. The bronze fitting gives us better rudder response in night conditions \u2014 less drift, tighter heading. If the wind holds southeast, we make fifty-five miles by dawn.\" She looked south. \"That puts us past the halfway point to Brannach. The patrol would need to push hard to close that gap.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek checked the provisions.","","  \"Three days to Brannach if we push. Four in bad conditions. We have supplies for five, counting the kelp.\" He looked at the dried sheets stacked in the galley. \"I'll cook a heavy meal before departure. The crew sails better on a full stomach, and the first night watch is the hardest.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne ran the numbers three times.","","  \"The night-anchor pattern gives us a window. If it holds \u2014 and patrol squadrons are creatures of routine \u2014 we clear Merrenbach's waters before the patrol arrives. The risk is course deviation. If they push south faster than standard patrol speed, or if they skip the night anchor, the math collapses.\"","","  She tapped the notebook.","","  \"We'll know more as the hours pass. The Khari lookout birds are still tracking. Even without the deal, the warren watches \u2014 it's what they do. If the patrol deviates, we'll see the birds change pattern.\"","","The day passed at the dock. The tide ran its cycle \u2014 in, out, the reef flat appearing and disappearing, the market assembling and folding. Warren Suuvi continued its rhythm above and below. The cliff face held its community and its path-songs and its vertical world, and the Sundered Wake sat in the harbor, preparations underway for a dusk departure that would put the ship south of the Wardensea before dawn.","","*goto departure_prep","","*label dive_scene","","*page_break","","Low tide.","","The outer reef emerged \u2014 not the lagoon side, the ocean side. The shelf that dropped to open water, where the coral formations were larger and the depth increased in steps until the reef wall ended and the Bastion Sea floor began.","","The wreck was visible from the shelf. Thirty feet down. A cargo hauler \u2014 wide-beamed, flat-bottomed, the design of a ship built to carry weight rather than speed. The hull had broken on the reef wall, the bow section lodged in the coral, the stern hanging over the shelf's edge. The cargo hold was exposed \u2014 the hull breach had opened it like a cracked egg, and inside, stacked and strapped, the spice crates.","","They were sealed. Wooden crates, two feet on a side, each one bound with waxed cord and stamped with a Kolmari trading house mark. Sixty of them, visible through the clear water, stacked in rows that the sea hadn't disturbed.","","*if (khari_guide_name = \"Tessavenne\")","  Tessavenne was on the reef shelf. The pilot had traded the outrigger for a position on the coral, feet bare, watching the water with the attention of someone who'd been reading reef conditions their entire life.","","  \"Current is low. It'll pick up in two hours as the tide turns. The window is tight \u2014 do the deep work first, the shallow work last.\" They pointed at the wreck. \"The stern crates are deepest. Start there.\"","","Kessara's pulley was rigged \u2014 a fixed anchor driven into a coral crevice at the shelf edge, rope running through a block, the haul end running to one of the Khari boats moored twenty feet back in the shallows. The system was simple. You dove, attached a crate to the rope, surfaced, and Kessara hauled. The boat crew \u2014 two Khari in a flat-bottomed craft \u2014 received the crate and ferried it to the dock.","","You dove.","","Thirty feet was different from twenty.","","The pressure was immediate \u2014 a band around the chest, a fullness in the ears, a sense of the water's weight that twenty feet had only suggested. The light changed too. At twenty feet, the world was blue-white and clear. At thirty, the blue deepened and the edges softened and the wreck sat in a twilight that was neither surface nor deep ocean \u2014 a middle space where the reef's life thinned and the open water's emptiness began.","","The wreck's cargo hold was accessible. The hull breach had cracked the planking wide enough to swim through, and inside, the crates were stacked in their shipping configuration \u2014 four rows, fifteen crates each, the bottom row sitting on the hull's ribs. The water inside the hold was still. Protected from the current, it had the dense, silty quality of water that hadn't moved in eight days.","","The first crate came free with a pull. The waxed cord held \u2014 the seal was intact. You looped the haul rope around the crate, secured it with a knot that Kessara had taught you on the second day at sea, and pulled twice. The rope went taut. The crate rose, lifting through the water column, scraping the hull's ribs, climbing toward the surface.","","You followed it up. Breath. The air burned. Thirty feet compressed the lungs harder and the recovery took longer. You gasped on the surface and the light was sharp and the sound of the reef \u2014 waves, wind, the creak of the pulley \u2014 flooded back.","","\"One,\" Kessara called from the shelf. The pulley turned. The crate broke the surface, streaming water, the Kolmari mark visible on the side. The boat crew grabbed it, hauled it aboard, ferried it to shore.","","One down. Twenty-nine to go.","","*page_break","","The work was brutal.","","Dive. Attach. Surface. Breathe. Dive again. The rhythm was industrial \u2014 the body reduced to a machine that went down and came up, each cycle taking three minutes, each dive producing one crate. Kessara ran the haul system with the engineer's focus \u2014 the pulley never jammed, the rope never tangled, the timing never slipped. The boat crew shuttled crates to shore where Terrek checked the seals and stacked them on the dock.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne timed the operation from the reef shelf. \"Fifteen crates in one hour. That's ahead of schedule. The tide window holds \u2014 two and a half hours remaining.\"","","The depth took its toll. By the tenth dive, the pressure headache was constant \u2014 a band behind the eyes that flared with each descent. The coral cuts on your hands from Galluun's Tooth had reopened, and new ones joined them \u2014 the wreck's interior was sharp, the broken planking edged with marine growth that sliced skin on contact. The salt water kept the cuts clean and kept them stinging. Blood trailed from your hands on every dive, thin pink threads that dissolved in the current.","","By the twentieth dive, the body was slowing. The lungs needed longer to recover. The muscles in the legs \u2014 the muscles that kicked you down thirty feet and back \u2014 were burning with the deep fatigue of repeated compression. Highland Oni were strong. Highland Oni were built for endurance. But thirty feet of salt water twenty times in two hours was testing the boundary between what the body could sustain and what it could endure.","","The deeper crates were harder. The bottom row sat on the hull's ribs, wedged into the structure by the weight of the crates above them. With the upper rows removed, the bottom crates shifted \u2014 some tilting, some sliding toward the hull breach, one falling through a gap in the ribs to lodge against the keel. That one cost you a full minute underwater \u2014 leveraging it free, the pry bar scraping against wood and coral, your lungs compressing, the dark water of the hold pressing close.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara noticed the slowdown. Between the twentieth and twenty-first dive, she started coiling the haul rope tighter than it needed to be. Between the twenty-third and twenty-fourth, she re-checked a pulley anchor she'd already checked twice. When you surfaced gasping on the twenty-fourth and hung on the haul rope for ten extra seconds, she stepped back from the shelf edge, wiped her palms on her trousers, stepped forward again. Her jaw was working on nothing \u2014 chewing air, the teeth grinding a problem she couldn't solve by tightening a bolt.","","  \"Six more.\" She kept her eyes on the pulley instead of on you. \"Forty minutes before the hold floods.\"","","Twenty-five. Twenty-six. Twenty-seven. The crates came up. The pulley turned. The boat shuttled. The operation was a machine and you were the part that went underwater.","","Twenty-eight.","","Twenty-nine.","","Thirty.","","The last crate broke the surface and you broke it with it \u2014 hauling yourself onto the reef shelf with arms that shook, lying on the coral, the rough stone against your back, the sky white and wide and full of the air you'd been rationing for two hours.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara stood over you. Dripping. She'd waded to the shelf edge to catch the last crate when the haul rope slipped.","","  \"Thirty crates. All seals intact. Haul time: two hours, forty \u2014 forty-eight minutes. I lost track around crate twenty.\" She looked at you. At the hands \u2014 cut, bleeding, the skin wrinkled from two hours of submersion. At the chest \u2014 rising and falling with the deep, ragged breathing of someone whose lungs had been compressed thirty times.","","  \"You're done.\" She crouched beside you. Her hands were shaking \u2014 the adrenaline of two hours standing on a reef edge watching someone she needed alive disappear underwater thirty times. She put her hands in her pockets. \"Terrek has the count. I think. I should go count.\" She didn't move. She stayed crouching beside you on the coral, her hands in her pockets, not counting anything.","","*set sovereigns + 60","","*goto departure_prep","","*label departure_prep","","*page_break","","*if (merrenbach_deal = \"accepted\")","  The crates sat on the dock in two stacks. Thirty on the south side \u2014 the warren's share. Thirty on the north side \u2014 the Sundered Wake's. Terrek had checked every seal. All intact. The Kolmari marks were visible \u2014 commercial product, legal property of a trading house that was four days away by recovery vessel and six months away by court.","","  The warren moved. The Khari came down from the cliffs in teams, carrying the crates up the vertical paths with the practiced efficiency of people who hauled everything they owned up a cliff face twice a day. Within an hour, the warren's thirty crates had disappeared into the upper levels. No trace.","","  Suuvi Renn appeared on the third ledge. She didn't come down. She called from above, the Khari voice carrying across the vertical space with the clarity of someone used to speaking across cliff faces.","","  \"The patrol anchored at Selvaggio last night. Departed at dawn. Current heading: south-southwest, seven knots. They'll reach Galluun's Tooth by midnight. Merrenbach by midday tomorrow.\"","","  She paused.","","  \"Leave at dusk. Heading: south by southeast, five degrees off the standard route. The secondary channel \u2014 the one your chart may show \u2014 runs between the outer reef and the deep shelf. It's narrower than the main route but it's below the patrol's sight line. You'll clear their sweep radius by dawn.\"","","  *if (galluuns_tooth_challenge = \"took_box\")","    \"The secondary channel is on your annotated chart. The dead captain who owned that chart knew the same routes we know. The Khari have been sharing paths with Kingsrun crews for forty years. Some of them listen.\"","","  She was quiet for a moment. The wind moved the cloth canopy above her platform.","","  \"Thirty crates of spice. My warren eats for two months. Your crew has trading currency for the next three stops.\" She looked at you from thirty feet above. The raptor eyes. \"We walked the same path today. That counts. If you reach the Kingsrun's end, remember the name Suuvi.\"","","  She turned and walked back into the cliff. Gone.","","  *set rep_khari_warrens + 15","","*if (merrenbach_deal = \"declined\")","  The afternoon aged. The dock held the low light. The preparations were simple \u2014 provisions stowed, sail ready, rudder checked. The Sundered Wake would leave at dusk and sail through the night.","","  The Khari watched from the cliffs. The lookout birds circled in wider patterns as the day turned \u2014 tracking something to the north that the humans at the dock couldn't see. The warren's information network was working, processing data that it would not share with the crew that had declined the deal.","","  The evening approached.","","*page_break","","Dusk at Merrenbach was orange and fast. The sun hit the ocean's edge and dropped, the light compressing from white to gold to amber in the space of thirty minutes. The cliff face caught the last of it \u2014 the limestone glowing warm, the rope bridges casting long shadows for the last time in this direction.","","The crew moved. Sullavenne's departure plan was precise \u2014 the mooring lines released in sequence, the sail raised by Kessara, the rudder tested by a single sweep that confirmed the bronze fitting's grip.","","*if (merrenbach_deal = \"accepted\")","  The cargo hold was full. Thirty crates stacked tight, each one worth a fraction of a Gold Sovereign at market, the total worth more than everything the crew had earned since Selvaggio combined. The ship sat lower in the water \u2014 the weight was real, and Kessara had adjusted the ballast to compensate.","","  \"We're heavier. Slower by a quarter knot. But the stability is better \u2014 a loaded ship handles open water more predictably than an empty one.\" She adjusted the tiller. \"The trade-off is acceptable.\"","","The Kindling was already gone. Suuba Mettani's sloop had departed in the late afternoon \u2014 heading south at speed, the dark red hull cutting the water with the Rathai efficiency that made the Sundered Wake's pace look geological by comparison.","","*if (galluuns_tooth_challenge = \"took_box\")","  *if (merrenbach_deal = \"accepted\")","    *if (rival_suuba > 5)","      Suuba had come to the dock before leaving. Brief. The Rathai directness stripped of everything that wasn't essential.","","      \"We're changing course. Heading east before turning south \u2014 wider arc, out of the patrol's direct line.\" She looked at you. \"Your information saved my crew. The debt stands. Brannach. If you make it there, find me.\"","","      She'd left. The Kindling was a shape on the horizon within the hour.","","The reef channel opened. The Sundered Wake threaded it \u2014 the tide was incoming, the water higher than it had been at arrival, the channel wider and deeper. The bronze fitting held the rudder true. The coral walls passed. The open ocean took the ship.","","South.","","The stars came out. The Southern Cross hung above the horizon, the constellation that every Kingsrun crew navigated by. The wind was southeast, steady, the Bastion Sea obliging for the first time since Selvaggio.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne took the first watch. The notebook was open. The numbers were running \u2014 patrol speed, heading, intercept calculations, time to Brannach.","","  \"Twenty-four hours to clear the patrol's sweep. Forty-eight to Brannach if the wind holds. The gap is tight but it's real.\" She looked at the stars. \"The Khari gave us what we paid for. Now we see if the ocean agrees with the math.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek served dinner on the deck \u2014 rice cakes with the Merrenbach kelp rehydrated into a broth that smelled like the reef itself, salt and mineral and alive. The kelp changed everything. The soup base had a depth that his Selvaggio provisions couldn't match, and the crew ate in the dark, on the water, heading south, and for the first time since the Kingsrun began, the food tasted like a journey instead of a departure.","","  \"Merrenbach kelp,\" Terrek said. The smile was visible even in the dark. \"My mother would approve.\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was at the helm. The night sailing was different \u2014 the horizon gone, the ocean reduced to sound and feel, the ship's motion the only information the body had. But the rudder responded. The bronze fitting from the Galluun's Tooth wreck and the sternpost repair from Pellanne's yard had transformed the ship's handling. The Sundered Wake was not the ship it had been at Selvaggio. It was better. Not good. Better. The word kept doing the work.","","  \"South by southeast. Five degrees off the standard route.\"","","  *if (merrenbach_deal = \"accepted\")","    \"The secondary channel Suuvi described \u2014 it's on the chart. I can see it.\" She traced the line in the dark. \"Narrow. Deep. Below the patrol's sight line. If the Khari are right, we're invisible until dawn.\"","","  The ship sailed. The night held. The stars turned slowly, the Southern Cross tracking the heading, the Bastion Sea flat and dark and cooperative.","","Merrenbach fell behind. The third stop. The reef walk. The Khari who built their world sixty feet above the people who came and went, and who sang their paths into the dark where only the reef remembered.","","*set days_since_departure + 7","*set total_sea_days + 6","","Ahead: Brannach. Volcanic scar island. The heat. The Gorundai. The fissure mines. The fourth stop on a route that was getting harder and more dangerous with every mile south.","","Behind: a Wardensea patrol that was twelve hours from where you'd slept last night and closing.","","The ocean was dark. The wind was right. The ship sailed south.","","*page_break","","*goto_scene ch3_merrenbach_reef_walk",""], "labels":{"renn_responds":117,"recovery_prep":221,"alternative_prep":266,"dive_scene":297,"departure_prep":373}},
"ch3_merrenbach_reef_walk": {"crc":-2029897281, "lines":["*comment ===================================================","*comment  CHAPTER 3: MERRENBACH \u2014 \"The Reef Walk\"","*comment  Scene 3: The Reef Walk / Transit South","*comment  At sea between Merrenbach and Brannach. The MC","*comment  reflects on what the Khari taught. Open water.","*comment  Grimoire broadcast \u2014 wider Kingsrun update.","*comment  Cliffhanger: smoke from Brannach's direction.","*comment  The volcano. Chapter 3 ends.","*comment  1 real choice. Zero fake choices.","*comment ===================================================","","The night passed on the open water.","","The Bastion Sea was different south of Merrenbach. The swells lengthened \u2014 twelve seconds between crests instead of eight, each one a slow, rolling presence that lifted the ship and set it down with a motion that had lost the choppiness of the reef zone. The water was darker. The turquoise of the coral shallows was gone, replaced by an open-ocean blue that said the bottom was no longer visible, no longer close, no longer relevant. The Sundered Wake sailed over a depth that the body could feel \u2014 the specific knowledge of nothing beneath you, transmitted through the hull, through the deck, through the bones.","","You took the dawn watch.","","The tiller was cold in the pre-dawn air \u2014 the bronze fitting conducting the water's temperature through the rudder mount, through the tiller arm, into your grip. The ship responded. The heading was south by southeast, the sails drawing well, the wind steady from the east.","","*if (merrenbach_deal = \"accepted\")","  The cargo made the ship heavier. You could feel it in the tiller's resistance \u2014 a sluggishness in the turn that hadn't been there before. Thirty crates of Kolmari spice in the hold, worth six Gold Sovereigns at market, worth more than that at Brannach where the volcano contaminated the local supply. The weight was money. The money was opportunity. Opportunity that changed a crew's trajectory.","","  The Kolmari trading house was four days away by recovery vessel. The Wardensea's file was instantaneous by Grimoire. Somewhere between those two timelines, the Sundered Wake sailed with stolen cargo in the hold and route intelligence in the navigator's chart.","","The dawn came from the east \u2014 grey first, then gold, the horizon defining itself by degrees. The ocean was empty. No ships. No reef markers. No island silhouettes. The Bastion Sea between Merrenbach and Brannach was open water \u2014 two hundred miles of nothing except depth and weather and the slow rotation of the sky.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne relieved you at dawn. She'd slept four hours \u2014 the minimum she allowed herself, the Wardensea discipline holding even at sea.","","  \"No contacts overnight. The Grimoire has been quiet \u2014 no priority broadcasts, no patrol chatter on the standard bands.\" She took the tiller. \"The gap holds. If the patrol maintained course, they reached Galluun's Tooth before dawn and Merrenbach by midday. We're sixty miles south of them.\"","","  *if (galluuns_tooth_challenge = \"took_box\")","    She paused. The morning light was grey on her face.","","    \"I checked Grey band before the watch change. The patrol is at Galluun's Tooth. They're inspecting the three ships that were still at anchor \u2014 fishing boats, local traffic. No Kingsrun vessels. They'll move south within hours.\"","","    She looked at the horizon.","","    \"We're ahead. For now.\"","","*page_break","","The first day at sea was quiet.","","The crew settled into the transit rhythm \u2014 watches, meals, maintenance. The ship demanded less attention now than it had between Selvaggio and Galluun's Tooth. The repairs had accumulated. The sternpost joint from Pellanne. The bronze fitting from the wreck. The caulking Kessara had applied and reapplied at every stop. The Sundered Wake was still not a good ship. But it was a ship that had been improved by every island it had visited, and the improvements were measurable in the tiller's response and the hull's silence and the way the bilge stayed dry through the first watch.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara spent the morning in the bilge. She came up dry.","","  \"First time,\" she said. She was grinning. The grin was wrong on her face \u2014 too wide, too surprised. \"First time since Selvaggio that the bilge hasn't needed bailing after a watch.\" She leaned against the mast. \"Caulking's cured. Sternpost solid. Bronze mount is \u2014 it's working. It's actually working.\" She touched the mast. Patted it. Caught herself patting a mast and stopped. \"She's not pretty. She's not fast. But she's \u2014\" The grin came back. \"She floated all night without complaining. I'm counting that.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek cooked with the Merrenbach kelp. The morning meal was rice and fish \u2014 dried stores from Selvaggio, rehydrated with a kelp broth that transformed the food from survival rations into something with depth and warmth and the dense minerality of the reef.","","  \"The kelp is \u2014\" He tasted it. Closed his eyes. Opened them. \"When you rehydrate it, the salt comes back, and the algae, and the \u2014 something from the coral. I don't know the word. The mineral thing.\" He served it on the deck. Tasted it again. \"Three coppers a sheet. I've been thinking about this kelp since Merrenbach. I think I might be in love with a dried plant. Don't tell anyone.\"","","  *if (merrenbach_deal = \"accepted\")","    He'd also been through the spice crates. Not opening \u2014 inspecting. Running his hands over the seals, reading the Kolmari marks, his nose close to the wood.","","    \"Pepper. Turmeric. Cardamom. I can smell them through the seal \u2014 the waxed cord doesn't contain the aromatics completely.\" He looked up from the hold. \"Southern Bastion stock, premium grade. At Brannach, where the volcanic ash taints the local spice supply, this cargo is worth its weight in Silver. At Kelvanni, where the clinic uses turmeric in medical preparations, it's worth more.\"","","    He paused.","","    \"We're carrying a spice merchant's fortune in our hold. The Kolmari will want it back. The Wardensea will want to know why we have it.\" He looked at the ocean. \"The answer needs to be ready before we need it.\"","","*page_break","","The Grimoire woke in the afternoon.","","The signal was strong \u2014 the Merrenbach relay was behind them, and the next relay was at Brannach, still a day ahead. The overlap created a clear zone where both signals reached, and the broadcast came through clean.","","\"Kingsrun Watch \u2014 Veshanna Torc \u2014 standard update from the southern route.\"","","*set broadcast_count + 1","","\"Kingsrun standings update. The MEAB has released the quarterly Cursed Generation assessment. Eight crews. Three active engagement zones. The headline: Nettava Daeshara has not been sighted in forty days. That's forty days of silence from the highest-bounty Renegade in the world \u2014 5.21 billion Sovereigns and no signal, no sighting, no Grimoire trace. The Broadwave is speculating. The Wardensea isn't talking. Draw your own conclusions.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne looked at the Grimoire. Her hand went to her coat collar \u2014 the Wardensea gesture, the habit she hadn't killed. She caught herself. Dropped the hand.","","  \"Nettava Daeshara. Forge Fruit. The Conqueror.\" She said the name the way she said all Wardensea file names \u2014 flat, clipped, professional. Then quieter: \"If the Wardensea has lost track of a 5.21 billion Sovereign target for forty days, either she's dead, she's in the Sundren, or they know exactly where she is and aren't saying.\"","","\"In other Kingsrun news: the Inheritors remain docked at Brannach for repairs. Kovesse Thrallek has reportedly hired local Gorundai labor for hull reconstruction \u2014 the volcanic eruption damaged the Regrade's port side and keel. Estimated repair time has been revised upward to three weeks.\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara listened. The engineer in her was calculating repair timelines.","","  \"Three weeks for hull and keel work. That's significant damage \u2014 the volcanic debris must have hit them hard. The Gorundai at Brannach have the metalwork skills, but keel repair requires drydock facilities.\" She looked south. \"If the Inheritors are still at Brannach when we arrive, that's a Cursed Generation crew at anchor. Kovesse Thrallek. Boar Fruit. Hundred and ninety million bounty.\"","","  She looked at you.","","  \"We've been sharing stops with Suuba's crew since Galluun's Tooth. Now we might share one with Kovesse's. The Kingsrun is getting crowded.\"","","\"Tomoe Gallacs update: The Gannet Crew has left Stop Eight heading south. Tomoe's bounty stands at seven hundred and ten million. The Wardensea Fourth Division patrol currently operating in the southern Bastion zone has been instructed to avoid engagement with the Gannet Crew. Repeat: the Fourth Division patrol has standing orders not to engage Tomoe Gallacs. That patrol is the same one conducting inspections on the southern route. Torc's analysis: they're inspecting cargo ships and rookies, not fighting the people who actually scare them.\"","","A pause.","","\"Personal note from Torc: when the Wardensea tells a patrol to avoid a 24-year-old vulpine Khari captain, the patrol knows how scary the ocean actually is. Torc out.\"","","The broadcast ended. The ocean held the silence that followed \u2014 the wide quiet of open water that had been filled with a voice and was now empty of it.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was writing. Fast. The notebook filled with numbers and names and connections.","","  \"The Fourth Division patrol has orders to avoid Tomoe Gallacs. That means they know she's on the same route \u2014 heading south from Stop Eight while they're heading south from Stop One. The patrol isn't just inspecting ships. It's threading a needle between Tomoe ahead of them and whatever Nettava is doing behind them.\"","","  She looked at you.","","  \"We're in the middle. Between the patrol coming south and whatever's happening in the deep Kingsrun. The Bastion Sea is the safe zone \u2014 the easy water, the gentle stops. It's about to end.\"","","The broadcast sat in the air. Three pieces of intelligence, each one pulling in a different direction. Nettava Daeshara \u2014 missing, which meant either dead or operating in a silence that the Wardensea couldn't penetrate. The Inheritors \u2014 docked at Brannach, damaged, a Cursed Generation crew sharing the next stop. And Tomoe Gallacs \u2014 ahead, south, moving through the deep Kingsrun with a speed that made the Wardensea give her room.","","*choice","  #Focus on the Inheritors. Kovesse Thrallek's crew is damaged and stuck at the next stop. A crew in need is a crew that owes favors \u2014 and a 190-million-bounty captain sitting at anchor changes Brannach's power balance.","    *set personality_aggression %+ 3","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne's pen stopped. She read your posture the way she read everything \u2014 as data.","","      \"The Inheritors at Brannach.\" She wrote a line. Two lines. \"Kovesse Thrallek is funded. Family legacy, Thrallek money, a ship that cost more than our entire operation. But money doesn't fix a keel \u2014 hands fix a keel. And we have hands.\"","","      She tapped the notebook.","","      \"If we help them, we gain standing with a Cursed Generation captain. If we ignore them, we pass through Brannach clean. Neither is wrong. Both cost something.\"","","    *goto second_day","","  #Focus on the patrol. The Wardensea is behind the crew and closing. Every decision from here to Brannach should be about speed, timing, and staying ahead of the inspection sweep.","    *set personality_loyalty %+ 3","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne nodded. The nod was professional \u2014 one intelligence officer acknowledging another's tactical read.","","      \"Patrol focus. The gap between us and the Fourth Division is shrinking by the hour. At Brannach, we resupply, we repair, we leave. No lingering. No side operations. The patrol reaches Brannach four days after us if they hold speed. That's our window.\"","","      She made three marks in the notebook. Each one a stop. Brannach. Kelvanni. Velundri. The route south, drawn in ink, the patrol drawn in the space behind it.","","    *goto second_day","","  #Focus on the bigger picture. Nettava Daeshara has disappeared, Tomoe Gallacs is running ahead of a patrol that won't touch her, and the Kingsrun's power dynamics are shifting. Understanding the pattern matters more than reacting to any single piece.","    *set personality_openness %+ 4","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne looked at you. The pen went still. For a moment the ex-intelligence officer surfaced \u2014 the woman who had been trained to read systems, not events.","","      \"Pattern analysis.\" She said it quietly. \"The Wardensea deployed a patrol that has orders to avoid the strongest crew in the water. Nettava Daeshara \u2014 the highest bounty in the world \u2014 vanished. The Inheritors are stuck. The middle Kingsrun is emptying.\"","","      She wrote a single line. Underlined it.","","      \"Something is happening south of Stop Eight. Everything else \u2014 the patrol, the Inheritors, the inspections \u2014 is reaction. We won't know what it is until we get there. But we can watch for the shape of it.\"","","    *goto second_day","","*label second_day","","*page_break","","The second day dawned with a change in the air.","","The temperature had been climbing since Merrenbach \u2014 a degree per day, an incremental warming that the body registered before the mind did. But on the second morning, the change was sharp. The dawn was warm. The air had weight \u2014 a humidity that settled on the skin and stayed, the ocean breathing moisture into the atmosphere with an intensity that said the water below had changed temperature.","","The Bastion Sea was warming as they went south. The reef zone was ending. The deep water was beginning.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek noticed it in the food. \"The dried fish is softening faster. The moisture in the air is getting into the stores.\" He adjusted the galley's ventilation \u2014 opening the upper hatch, closing the lower. \"The Bastion Sea's southern edge is where the currents shift. Warm water from the deep Kingsrun pushes north and meets the temperate water from the reef zone. The result is \u2014\" he gestured at the air \u2014 \"this. Humidity. Heat. The ocean sweating.\"","","The horizon changed.","","South. Past the flat blue line that had been constant since Selvaggio. Something was different. A discoloration in the sky \u2014 not cloud, not haze. A smudge. Grey-brown, rising from a point on the horizon that was too far away to resolve into shape but close enough to affect the light.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne saw it first. She had the long-glass \u2014 a collapsible telescope from the ship's equipment locker \u2014 and she'd been scanning the southern horizon since dawn.","","  \"Smoke.\" One word. \"South by southwest. Origin point: below the horizon. Volume: significant. It's been rising for at least two hours \u2014 the column is stable, not dispersing. That means sustained combustion, not a flash event.\"","","  She lowered the long-glass.","","  \"Brannach is south by southwest. Brannach sits on an active volcanic field. The Inheritors reported a lateral eruption two weeks ago.\"","","  She looked at the smoke. At the crew. At you.","","  \"The volcano is still active.\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara came to the bow. She looked at the smudge on the horizon with the expression of an engineer assessing a structural failure from a distance.","","  \"If that's Brannach, the eruption is ongoing. The Inheritors reported hull damage from debris \u2014 that means the eruption is producing ejecta, material thrown into the air. A lateral eruption means the fissures are venting sideways, not upward. That's worse for the harbor. Upward eruptions go into the atmosphere. Lateral eruptions go into the buildings.\"","","  She looked at the chart.","","  \"Brannach's harbor is on the south side of the island, sheltered from the volcanic field by a ridge. If the fissures have extended past the ridge, the harbor might be compromised.\" She paused. \"The Kingsrun doesn't have an alternative. Stop Four is Brannach. There's no stop three-and-a-half.\"","","The smoke grew. Hour by hour, as the Sundered Wake sailed south, the smudge on the horizon thickened into a column \u2014 a dark vertical stroke against the blue sky, widening at the top where the wind caught the upper plume and dragged it east. The column said fire. The column said sustained. The column said the fourth stop on the Kingsrun was burning.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was on the bow. Watching. He had a spoon in one hand \u2014 he'd been tasting something in the galley when the smoke appeared. The spoon was still in his hand. He'd forgotten about it.","","  \"The Gorundai mine the fissures,\" he said. \"Volcanic ore, obsidian, sulfur. They live in the eruption zone because that's where the \u2014 it's where the money is. Literally.\" He watched the smoke. \"My mother used to say the Gorundai have a saying about the mountain. 'Gives with one hand, takes with the other.' Something like that. She'd correct me if she heard me say it wrong.\" He watched the smoke a little longer. \"She'd probably also correct me for staring at a volcano from a boat instead of doing something useful.\"","","*choice","  #Hold course. Brannach is the next stop and the Kingsrun doesn't skip stops. Whatever's burning, you deal with it when you get there.","    *set personality_aggression %+ 3","","    The heading held. South by southwest. The smoke column grew larger and the air grew warmer and the ocean's surface began to carry things \u2014 flecks of grey, drifting on the swell, that Kessara identified as volcanic ash. Fine particles. Light enough to float. The vanguard of whatever was happening at Brannach, carried north by the wind.","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne made a note. \"Ash on the water at \u2014\" she checked the distance, frowned, rechecked \u2014 \"forty miles out. No. Thirty-five. I've been using the wrong reference point for \u2014\" She scratched out a number. Rewrote it. \"Thirty-five to forty miles. The difference matters and I'm not certain. The harbor may be operational or it may not.\"","","    The crew said nothing. The ship sailed south. The smoke column was a pillar now \u2014 visible without the long-glass, a dark mark against the southern sky that grew by the hour.","","    *goto chapter_close","","  #Reduce speed. Approach cautiously \u2014 get within visual range of Brannach before committing. If the harbor is compromised, you need options.","    *set personality_loyalty %+ 3","","    Kessara eased the sail. The ship slowed \u2014 from five knots to three, the approach measured, the heading adjusted to bring them in from the northeast where the wind would carry them clear if they needed to turn.","","    *if (crew5_name = \"Sullavenne Ohn\")","      \"Cautious approach. Smart.\" Sullavenne had the long-glass at the bow. \"At three knots, we reach visual range of Brannach by late afternoon tomorrow. We'll be able to see the harbor, the volcanic field, and the state of the island before we commit to approach.\" She lowered the glass. \"The Wardensea patrol is behind us. If we slow down, the gap shrinks. But a ship that approaches a volcanic island at full speed doesn't get to change its mind.\"","","    The Sundered Wake crept south. The smoke column was a permanent feature of the sky now \u2014 it had been there since morning and it would be there tomorrow and the day after that. The volcano was on its own schedule, and the Kingsrun's schedule was secondary.","","    *goto chapter_close","","*label chapter_close","","*page_break","","The evening fell on the open water.","","The smoke column caught the sunset \u2014 the grey-brown plume turning orange and red in the last light, the colors of fire projected into the sky by the fire below. The effect was beautiful in the way that dangerous things are beautiful when viewed from a sufficient distance. Up close, at Brannach, the beauty would be heat and ash and the sound of a mountain breaking itself apart.","","The Sundered Wake sailed in the shadow of the plume. The ash on the water thickened \u2014 a fine grey film that settled on the deck, on the rigging, on the storm-leather coat. It tasted of sulfur when it touched the lips. The Sennaku Highlands had volcanic ash \u2014 the same taste from childhood, from the eruptions that painted the highland sky orange and dropped grey snow on the ridges for days. But the highland eruptions were distant. Observed from the safety of the Stormspire's elevation. This was close. Getting closer. The source was ahead, and the ship was moving toward it.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne's final entry in the ship log for the day was concise.","","  \"Day eight at sea. Transit from Merrenbach to Brannach. Wardensea patrol estimated thirty hours behind. Volcanic activity ahead \u2014 sustained plume, ash on water at forty-mile range. Brannach harbor status: unknown. Arrival: tomorrow.\"","","  She closed the log.","","  \"Chapter three is over. The reef stops. The Bastion Sea stops. Everything south of here is harder.\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was on her knees at the waterline with a rag, scraping volcanic ash off the caulking. The ash was acidic \u2014 you could taste it on the air.","","  \"The combination \u2014\" She scrubbed harder. \"Ash and saltwater and wood. Eats caulking.\" She wrung the rag. Grey water ran through her fingers. She was scrubbing the ship the way she'd tidied her tools before the bell at Selvaggio \u2014 with the focused attention of someone who needed her hands to be busy while her mind processed something larger.","","  She looked at the hull. At the patches. At the repairs that had accumulated stop by stop. She didn't say anything about what the ship had survived. She just kept scrubbing.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek served dinner. Kelp broth with rice and the last of the Merrenbach reef bass, pan-fried in spice oil. The spice was from the cargo \u2014 one crate, slightly damaged in the dive, the seal compromised enough that Terrek had declared it unsaleable and requisitioned it for the galley. The meal was the best thing the crew had eaten since Selvaggio.","","  \"The damaged crate is ours,\" he said. \"One out of thirty. That's a loss rate I'll accept.\" He ate. \"Brannach is Gorundai territory. The food will be different \u2014 volcanic soil cooking, ash-cured meat, fire-pit grains. Heavy. Mineral. The Gorundai eat like they mine \u2014 deep and dense.\"","","  He looked at the smoke column.","","  \"If there's still a kitchen standing.\"","","*set completed_reef_walk true","","The night fell. The stars came out \u2014 fainter than they'd been at Merrenbach, the volcanic plume diffusing the light, casting a haze across the southern sky. The Southern Cross was visible but softened, its sharp points blurred by the ash in the atmosphere.","","The Sundered Wake sailed south. The crew was four. The ship carried cargo and intelligence and the memory of a Khari warren sixty feet above the waterline. Behind them: Merrenbach, the reef walk, the path-songs in the dark. Behind them: a Wardensea patrol that was closing but not catching. Behind them: three stops where you had arrived as a stranger and left as a name the Grimoire was beginning to learn.","","Ahead: the volcano. The smoke. The fourth stop on a Kingsrun that was getting harder with every mile south.","","Brannach was burning. The Sundered Wake was heading toward it.","","Chapter three ended at sea, with ash on the deck and fire on the horizon.","","*page_break","","*goto_scene ch4_brannach_landfall",""], "labels":{"second_day":153,"chapter_close":224}},
"ch4_brannach_landfall": {"crc":2070687124, "lines":["*comment ===================================================","*comment  CHAPTER 4: BRANNACH \u2014 \"The Fissure Stop\"","*comment  Scene 1: Landfall","*comment  Volcanic scar island. Sulfur air, Gorundai miners,","*comment  active volcanic field. First encounter with the","*comment  Inheritors \u2014 Kovesse Thrallek's CG crew. Gorundai","*comment  see half-Oni MC as \"kindred spirit with wrong horns.\"","*comment  2 real choices. Zero fake choices.","*comment ===================================================","","*set current_stop 4","*set current_stop_name \"Brannach\"","*set days_since_departure + 2","*if (sovereigns >= 2)","  *set sovereigns - 2","","The ash thickened through the final approach.","","It was on the water \u2014 a grey film that broke against the hull and reformed in the wake, the surface of the Bastion Sea coated with a fine particulate that looked like dust and tasted like metal. It was on the rigging \u2014 a dry accumulation that dulled the rope and turned the sail from bleached canvas to a mottled grey that Kessara kept brushing off and the wind kept replacing. It was in the air. Every breath carried a weight that wasn't humidity. A mineral presence that coated the throat and made the next breath slightly more difficult than the last, the way altitude did in the Sennaku Highlands, where the air thinned at elevation and the lungs worked harder without being told why.","","This wasn't altitude. This was the volcano.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had the long-glass trained south since dawn. She hadn't put it down.","","  \"Harbor confirmed. South side of the island, behind a basalt ridge \u2014 the ridge is intact, the harbor is sheltered. I count eight vessels at anchor. Three fishing boats, two cargo haulers, one Wardensea patrol cutter \u2014 marked but flying civilian pennants, which means it's decommissioned or pretending to be.\"","","  She adjusted the glass.","","  \"Two other ships. One large \u2014 three-masted, heavy beam, with scaffolding on the port side. That's the Regrade. The Inheritors are still here.\"","","  She lowered the glass and looked at the crew.","","  \"The last ship is small. Schooner rig, no markings. Could be local. Could be anything.\"","","*page_break","","Brannach was not what the ocean had promised.","","The smoke column had suggested devastation \u2014 an island consumed, a harbor buried, an economy cratered. The reality was different. The volcanic field occupied the north face of the island, a landscape of black rock and thermal venting that sent plumes of white-grey vapor into the sky at irregular intervals, each plume carrying the sulfur stench that had been building in the air for two days. The fissures were visible from the water \u2014 dark lines in the rock face, some venting heat, some glowing dull orange at their base where the magma was close enough to the surface to light itself. The sound carried across the water. A low harmonic. Constant. The island's voice \u2014 the vibration of a mountain that was hollow in places and full of fire in others, the sound transmitted through rock and water and air in a frequency that the ribs registered before the ears did.","","The harbor was on the south side. The ridge separated it from the volcanic field \u2014 a wall of basalt that rose three hundred feet and cut the thermal venting off from the docks, creating a pocket of air that was warm but breathable, sheltered but not sealed. The harbor was built into the rock. Stone piers jutting from the cliff base. Iron mooring rings sunk into basalt. The docks were heavy \u2014 thick timber over stone foundations, built to survive the tremors that shook the island on a cycle that the locals had calibrated to minutes and the newcomers hadn't calibrated at all.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was at the bow. Her eyes moved from the docks to the ridge to the fissure field behind it with the expression of an engineer reading a building's stress points.","","  \"The ridge is volcanic basalt \u2014 dense, slow to erode, good at absorbing thermal shock. The harbor works because the ridge works. If the fissures extend past the ridge or the next eruption undermines the base, the harbor goes with it.\" She looked at the docks. \"The infrastructure is Gorundai. Iron and stone, not wood and rope. They build for the next earthquake, not the next season.\"","","  She paused.","","  \"We need to dock on the outer pier. The inner berths put us against the cliff face, and if a tremor drops \u2014\" She looked at the ridge again. At the inner wall. Back at the ridge. \"Wait. No. The overhang angle means the debris field would \u2014 no, I was right the first time. Outer pier. Anything moored to the inner wall takes the impact. Probably. I'm doing geological physics on the fly and I'm not a geologist.\"","","The Sundered Wake entered Brannach harbor at midmorning. The approach was clean \u2014 no reef, no coral channel, no current hazard. The volcanic island had burned its approaches clean. The water was deep and dark and warm \u2014 perceptibly warm, the temperature rising as the ship neared the docks, the ocean heated from below by the same geological engine that was venting fire from the fissures above.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek leaned over the rail and touched the water. He held his hand there for three seconds, then pulled it back and smelled his fingers.","","  \"Warm. Not hot \u2014 not dangerous. But warm. And the sulfur content is high. The fish here will taste different. Mineral-heavy, slightly acidic.\" He wiped his hand on his apron. \"Gorundai cooking uses the volcanic water. They heat pots on the fissure vents and let the mineral content season the food. Gorrash \u2014 the grain porridge \u2014 tastes like it's been cooked in metal because it has been.\"","","  He looked at the smoke rising from beyond the ridge.","","  \"The island is the kitchen.\"","","*page_break","","The docking was watched.","","Not by dock officials \u2014 Brannach didn't have a harbor office in the way Selvaggio or Galluun's Tooth did. No Kolmari banking station, no Wardensea inspection post, no departure bell. The economy was extraction, and the culture was Gorundai, and the Gorundai did not build institutions that existed to process strangers. Strangers processed themselves. The docks were open. The mooring was self-service. The fee was posted on a stone slab at the pier head \u2014 \"2 Silver per day, paid to the Forge\" \u2014 and the enforcement mechanism was the population of miners who worked the fissures and did not tolerate free-riders.","","The watching came from two directions.","","The first was the dockside work crew \u2014 six Gorundai, stripped to the waist despite the ash in the air, loading volcanic ore into basalt-lined crates. They were large. The Gorundai were larger than humans by a head, with denser musculature, thicker bone structure, and the tusked lower jaw that gave their faces a permanent expression that other races read as aggression and the Gorundai themselves considered neutral. Skin from deep green to grey-brown. Arms built for the work they were doing \u2014 lifting crates that would require two humans each, handling them singly, the weight distributed through bodies that had been loading ore since adolescence.","","They looked at the Sundered Wake as it glided into the outer berth. They looked at the crew. They looked at you.","","The looking changed.","","A half-Oni at the helm of a Kingsrun vessel. Six-seven, broad-framed, ash-white skin, ram-curved horns, the black mane tied back for the approach. The storm-leather coat open to the heat. The Gorundai ore-loaders saw the horns first \u2014 everyone did \u2014 but they processed them differently than the Khari at Merrenbach or the humans at Galluun's Tooth. The Khari had been wary. The humans had been nervous. The Gorundai were interested.","","One of them \u2014 the largest, deep green skin, tusks prominent, forearms corded with scar tissue that said the fissures had bitten back more than once \u2014 looked at you for a long time. Then he turned back to his crate. The pace of his work didn't change, but the angle of his shoulders did. An opening. A space made in the peripheral awareness for someone who might belong in it.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne noticed.","","  \"They're not threatened.\" She was tying off the mooring line. Tugged it. Tugged it again. \"They're doing something. I can't tell what.\" She finished the knot and looked at the ore-loaders again. \"The big one \u2014 the one who turned back to his work. He made space. Did you see that? He shifted his shoulders.\"","","  She paused.","","  \"I think they're making room for you. I don't know what that means yet.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was watching the Gorundai. His weight had shifted \u2014 forward, onto the balls of his feet, his hands loose at his sides. The same stance the ore-loaders had. He probably didn't know he was doing it. The human-passing man from the Kethrun district, standing on a Gorundai dock, and his body was doing things his face hadn't been told about.","","  \"My mother was from the Kethrun district,\" Terrek said. \"Alessi Ghaal. She cooked for the shift crews \u2014 gorrash and ore-bread, four meals a day, the food that kept miners upright through a twelve-hour dig. She used to say the Gorundai were the mountain's children, and the mountain fed its children heavy.\" He smiled. \"I came out looking human. But the appetite came through. And the stance.\"","","*page_break","","The second source of watching was the Regrade.","","The Inheritors' ship was moored at the inner berth, against the cliff face, with scaffolding on the port side that extended from waterline to gunwale. The damage was visible. The hull planking on the port side had been stripped and partially replaced \u2014 new timber against old, the fresh wood pale against the weathered original, the contrast making the Regrade look like an animal mid-molt. The keel was supported by stone cradles on the dock \u2014 the ship had been hauled partially out of the water for structural work, the waterline exposed, the copper sheathing battered and partially peeled from whatever impact had done the damage.","","Gorundai workers moved on the scaffolding. Welding \u2014 not soldering, not fitting. The orange glow of heated metal and the sharp percussion of hammer on iron rang from the hull in a rhythm that was almost musical. The repairs were serious. Keel-deep. The kind of work that took three weeks and cost more than most crews earned in a month.","","The crew of the Regrade was on the dock.","","Three of them, visible from the outer berth. A human \u2014 lean, late twenties, dark hair, standing with his arms crossed and watching the approach of the Sundered Wake with an expression that was neutral and attentive. An Oni \u2014 tall, broad, not as large as you but built with the compact power of someone who'd learned to fight in tight spaces, a weighted chain coiled at his hip. A Rathai \u2014 short, wiry, grease-stained, hands moving constantly as she talked to one of the Gorundai scaffold workers about something that required extensive gesturing.","","The human was Sureth Kellane. First mate. The one who told Kovesse when she was becoming her mother.","","The Oni was Terrek Ghaal. Bosun. The one with the chain he called \"Conversation Starter.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek \u2014 your Terrek, the cook \u2014 saw the Oni on the dock and stopped moving.","","  \"That's an Oni.\" He said it with the quiet attention of someone who knew the race from the inside, even if the outside didn't show it. \"Kingsrun crew. Not highland \u2014 the build's different, combat-compressed, trained for ship fighting. And the chain.\" He looked at it. \"Weighted chain. Twelve feet, iron-link. Kuldhara's Warband uses those.\"","","  He looked at you.","","  \"My parents were Gorundai. I know what it looks like when someone meets their own kind far from home.\"","","The Rathai was Dussa Kervenne. The engineer who talked to the ship.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara looked at the Regrade's exposed hull and the Rathai on the dock. She said nothing for eleven seconds. Which was, for Kessara, the equivalent of a standing ovation.","","  \"The keel repair is comprehensive. They went to the structural frame, not just the hull.\" She was gripping the rail. \"The scaffolding's rigged for ventilation \u2014 that means hot-work on the keel bolts. That's \u2014\" She stopped. The Rathai on the dock was mid-argument with a Gorundai welder, gesticulating with a wrench. \"That's their engineer. She's telling him the heat distribution is wrong.\" Kessara watched the argument. \"She's right. He knows she's right. He's going to keep arguing for about ten more seconds and then do what she says.\"","","  Eight seconds later, the welder adjusted his torch angle.","","Kovesse Thrallek was not on the dock.","","The captain of the Inheritors was somewhere else \u2014 in the town, in the fissure mines, on the ship. Her crew was visible. She wasn't. The absence said something. A captain who left her damaged ship under repair with her crew on the dock was a captain who trusted both the repair and the crew. Or a captain with business elsewhere that mattered more than watching welders work.","","*page_break","","The town was above the docks.","","Brannach's settlement climbed the south face of the ridge \u2014 not vertically like Merrenbach's Khari warrens, but in a stepped progression of stone platforms cut into the basalt. The architecture was functional. Stone and iron. Walls thick enough to withstand tremors. Roofs flat, pitched slightly for ash drainage, with iron gutters that channeled the volcanic dust into collection barrels. The ash was resource. The Gorundai used it for mortar, for ceramics, for the slag-glass that was Brannach's distinctive craft \u2014 dark, translucent panels cut from cooled volcanic flow and fitted into the buildings as windows that filtered the light to a warm amber.","","The streets \u2014 paths, really, cut between the stone buildings \u2014 were busy. Gorundai miners moving between the settlement and the fissure approaches on the north side of the ridge, carrying tools and ore in basalt-lined packs. Human traders from the cargo ships at dock, loading supplies for the return trip north. Three Rathai engineers on a platform above the main path, working on a ventilation system \u2014 pipes and fans and hand-cranked bellows designed to push fresh air into the mine approaches when the volcanic gases built up.","","The air was warm. Not the wet heat of the open Bastion Sea or the gentle warmth of Merrenbach's reef zone. This was mineral heat \u2014 dry, sulfuric, carrying the taste of iron and the smell of a furnace that had been burning for geological time. The heat came from below. Through the stone. Through the boot soles. The island was warm in a way that said the fire was not just on the surface. It was in the rock. It was in the ground. Your feet registered it first \u2014 the deep thermal memory of volcanic ground, carried forward from the Sennaku Highlands, where the hotsprings turned the mountain paths warm in winter and dangerous in summer.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne's assessment was quick. \"Harbor: operational. Settlement: functional, no recent damage visible. Volcanic activity: confined to the north face, behind the ridge. Population: Gorundai majority, human trade minority, Rathai technical contingent. Infrastructure: stone and iron, built for seismic resilience.\" She looked at the ridge. \"The volcano is active. The eruption the Inheritors reported was two to three weeks ago \u2014 lateral venting on the north face. The fissures are still open. The miners are still working.\"","","  She paused.","","  \"The Gorundai mine an active volcano because the ore it produces is worth more than the risk of being buried by it. That calculus is either brave or insane, depending on your relationship with volcanic rock.\"","","*page_break","","The forge district was at the top of the settlement.","","The path climbed through the residential and market levels \u2014 stone-fronted shops selling volcanic ore in graded sizes, tool merchants with iron picks and pry-bars displayed on racks, food stalls where the cooking was done on heated stone slabs set directly over thermal vents in the ground. The food smelled different from anything the Kingsrun had produced so far. Dense. Mineral. Meat ash-cured over volcanic vents, the smoke carrying sulfur compounds that preserved and flavored simultaneously. Grain porridge \u2014 gorrash \u2014 served in iron bowls, the consistency of mortar and the color of wet stone.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek stopped at a food stall. He bought a bowl of gorrash \u2014 one copper \u2014 and tasted it. His expression went through three distinct phases: recognition, assessment, and grudging respect.","","  \"It's exactly \u2014\" He stopped. Took another bite. Put the spoon down. Picked it up. \"My mother described this. Exactly this. The sulfur taste, the grain texture, the way it sits in you like ballast.\" He took a third bite. His eyes were bright and his voice was doing something it didn't normally do. \"It doesn't taste good. I want to be clear about that. It tastes like eating a mountain. But it's \u2014\" He gave up searching for the word and just ate.","","  He looked at you.","","  \"You'd need three bowls. Minimum. Possibly four. I'm not judging.\"","","The forge district occupied the highest platform \u2014 closest to the ridge, closest to the fissures, closest to the heat. The forges were open-faced \u2014 stone walls on three sides, the fourth open to the air, with chimney shafts cut through the rock above. The heat was immediate. The temperature climbed ten degrees in the twenty steps between the last residential building and the first forge. The Gorundai smiths worked in the heat the way the Khari worked in the heights \u2014 adapted, calibrated, native to an environment that would break a newcomer in hours.","","The sound was constant. Hammer on metal. The hiss of quenching. The deep bass note of the bellows feeding air to forges that burned volcanic gas instead of coal \u2014 a natural fuel piped from the fissures through iron channels, the flame hotter and cleaner than charcoal, producing a heat that could soften volcanic ore that conventional forges couldn't touch.","","*choice","  #Walk toward the Regrade. The Inheritors are a Cursed Generation crew. They've been on the dock watching the Sundered Wake since arrival, and ignoring them is a choice with its own consequences. Better to approach than to be approached.","    *set personality_aggression %+ 3","","    The walk from the outer berth to the inner berth was sixty yards of open dock. The Gorundai ore-loaders watched. The three Inheritors crew members on the dock watched. The scaffolding workers paused their hammering. The sound vacuum lasted four seconds before the welders resumed, and in those four seconds the dock was quiet enough to hear the volcanic harmonic through the stone.","","    Sureth Kellane uncrossed his arms. The human first mate was lean in the way that hungry people were lean \u2014 not malnourished, but operating without surplus. His eyes tracked the approach with an intelligence that was patient rather than reactive. He didn't move forward. He didn't step back. He held his position and let the distance close, which was either politeness or assessment or both.","","    The Oni \u2014 Terrek Ghaal of the Inheritors \u2014 shifted his weight. The chain at his hip clinked. He was shorter than you by four inches, broader in the shoulders by different proportions, the build of someone who'd fought in ship corridors where height was a liability and width was a weapon. His skin was bronze-red. His horns were swept back \u2014 a single pair, shorter than your ram-curve, functional rather than decorative. He looked at you the way Oni looked at other Oni \u2014 direct, measuring, the automatic physical assessment that was cultural reflex.","","    *if (crew4_name = \"Terrek Ghaal\")","      Your Terrek was two steps behind. The cook from the Kethrun district and the fighter from Kuldhara's Warband looked at each other across a dock in a volcanic port. The Inheritors' Terrek saw a human. Your Terrek saw a Gorundai forge town in the stance, heard his mother's kitchen in the weight distribution. The recognition was one-directional and complicated.","","    Dussa Kervenne glanced over from her argument with the welder, saw the approaching crew, and went back to arguing. Priorities.","","    Sureth spoke first. His voice was careful \u2014 words selected and placed like he'd been burned by the wrong ones before.","","    \"Sundered Wake.\" He stopped. Rubbed the back of his neck. \"Right. So \u2014 you've been on the Grimoire since Selvaggio. We've been \u2014\" He glanced at the Oni beside him. The Oni shrugged. \"\u2014 not watching. That sounds \u2014 we've been. Aware. Of your crew.\" He exhaled through his nose. \"I had a better version of this in my head.\"","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne's response was equally measured. \"The Regrade. We've been aware of you since Galluun's Tooth.\"","","      Sureth nodded. The exchange was complete \u2014 both crews acknowledging mutual surveillance. No hostility. No warmth. Professional recognition between ships that had been sailing the same route at different speeds.","","    The Inheritors' Oni spoke. His voice was what Oni sounded like when they'd spent three years in Kuldhara's Warband \u2014 loud by nature, disciplined by training, the volume controlled but the energy uncontained.","","    \"Half.\" One word. Directed at you. His eyes were on the horns. \"Stormspire bloodline. The ram-curve, the coloring, the \u2014\" He tilted his head. \"No, the build's wrong for pure Stormspire. One of your parents wasn't \u2014\" He stopped. The correction was fast, as if he'd caught himself being too specific about something that wasn't his business. \"You're a long way south.\"","","    *if (crew4_name = \"Terrek Ghaal\")","      Your Terrek answered. \"We're all a long way south.\" He was looking at the chain. \"Kuldhara's equipment. The link pattern. Three years?\"","","      The other Terrek grinned. The expression was Oni \u2014 broad, toothy, a grin that meant enjoyment regardless of whether the situation called for it. \"Three years. Departed on good terms.\"","","      \"Nobody departs Kuldhara on bad terms.\"","","      \"Because the bad-terms people don't depart.\" The grin widened. \"Terrek Ghaal.\"","","      \"Terrek Ghaal.\"","","      The identical names hung in the air. Both men looked at each other. Then at their respective crews. Then back at each other.","","      \"That's going to be a problem,\" the Inheritors' Terrek said.","","      \"No it isn't,\" your Terrek said. \"I'm the cook. You're the chain. Solved.\"","","    Sureth Kellane's attention had moved past the crew to the Sundered Wake itself. He studied the hull \u2014 the repairs, the new timber, the bronze fitting, the caulking. His assessment was silent and thorough.","","    \"Your ship has been worked on at every stop.\"","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara answered that one. \"She needed it. Selvaggio sternpost. Galluun's Tooth rudder mount. Merrenbach caulking. The ship that left Selvaggio wouldn't have survived the reef approach at Galluun's Tooth. The ship we have now is seaworthy.\"","","      Sureth looked at the Regrade behind him. The scaffolding. The exposed keel. The 39-year-old hull that was more repair than original.","","      \"Ours has been worked on for four decades. Every plank replaced at least once. Every bolt refitted. Every joint resealed.\" He paused. \"She was my captain's mother's ship. She'll be his until one of them gives out.\"","","    *goto after_approach","","  #Stay on the Sundered Wake. Observe. The Inheritors know you're here and you know they're here. First contact with a Cursed Generation crew doesn't need to be rushed \u2014 it needs to be controlled. Watch them. Learn what you can from distance before closing it.","    *set personality_loyalty %+ 3","","    The crew worked the docking routine. Mooring lines. Sail furling. Deck wash \u2014 the volcanic ash needed clearing before it settled into the wood grain. The routine was familiar, the motions repeated at every stop, and the repetition created a framework of normalcy around a situation that was not normal. There was a Cursed Generation crew sixty yards away. A Boar Fruit user's ship under repair. A 190-million-Sovereign captain somewhere on the island. And the Sundered Wake was mooring next to them like a fishing boat at market.","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne used the work as cover. While furling the sail, she studied the Regrade's crew, the scaffolding pattern, the dock layout. Her observations came in fragments between tasks.","","      \"The human first mate is Sureth Kellane. He hasn't moved since we entered the harbor \u2014 he's been watching our approach, our docking, our crew.\" She tied off a line. \"The Oni is their fighter. Chain weapon, Warband-trained. He's relaxed, which means he's confident we're not a threat or he's confident he can handle it if we are.\" She secured a cleat. \"The Rathai is their engineer. She's focused on the repair, not on us. Either she trusts her crew to handle introductions or she doesn't care about other ships.\"","","      She looked at the Regrade.","","      \"Kovesse isn't visible. A captain who isn't on the dock when a new ship arrives is either unconcerned or sending a message. At 190 million, it's the message.\"","","    The Inheritors' crew on the dock did not approach. The observation was mutual \u2014 two Kingsrun crews at the same stop, aware of each other, neither forcing the first move. The distance was professional. The distance was also temporary. Brannach was a small island. The docks were smaller. The forge district was a single platform. Contact was inevitable. The question was timing, and timing was a choice.","","    *if (crew4_name = \"Terrek Ghaal\")","      Terrek cooked. The galley work was routine \u2014 heating water on the small stove, preparing the midday meal from Merrenbach stores. But he was watching the dock through the galley port, and his commentary was quiet and specific.","","      \"The Oni on the dock. He's Kuldhara-trained \u2014 you can see it in the stance. Weight forward, knees bent, ready to pivot. Three years minimum in the Warband to build that reflex.\" He stirred the pot. \"His chain is Warband-standard. Iron-link, weighted counterweight. Twelve feet. In a corridor fight, that weapon controls the space.\"","","      He served the meal.","","      \"He reminds me of the highland brawlers at the Grand Festival. The ones who fight because fighting is how they talk.\"","","    The afternoon passed at dock. The volcanic harmonic was a constant \u2014 a low frequency that was felt rather than heard, transmitted through the stone pier, through the hull, through the deck, a vibration that said the island was alive in a geological sense and had been alive for longer than anything built on its surface.","","    The first contact came at dusk. Not from the Inheritors. From the Gorundai.","","    *goto after_observe","","*label after_approach","","The conversation on the dock was brief. Sureth Kellane was not the type to talk longer than necessary, and the Inheritors' Terrek had the Oni capacity for silence between bursts of directness. Three facts exchanged: the Sundered Wake was running the Kingsrun south, the Regrade was under repair for another two weeks, and Kovesse Thrallek was in the fissure mines.","","\"She goes every day,\" Sureth said. \"The Gorundai let her work with the extraction teams. She moves ore for them, they teach her the volcanic rock.\" He paused. \"She needs to be doing something with her hands while the ship is broken. Otherwise she watches the repairs and the watching makes her worse.\"","","The \"worse\" was unspecified. But Sureth said it the way someone says a word they've said many times \u2014 worn smooth by repetition, the edges gone, the meaning compressed into a sound that communicated everything to people who already understood.","","*goto gorundai_contact","","*label after_observe","","*goto gorundai_contact","","*label gorundai_contact","","*page_break","","The Gorundai foreman found the Sundered Wake's crew at the dock.","","She came down from the forge district in the late afternoon \u2014 a Gorundai woman in her fifties, grey-brown skin, tusks filed to working length, wearing a leather apron over bare arms that were mapped with old burns and newer scars. Her hands were enormous. Not just large \u2014 shaped by decades of forge work, the knuckles thickened, the palms calloused to a surface that looked like tanned leather. She walked with the rolling gait of someone whose balance had been calibrated to ground that trembled.","","Her name was Brukka Venn. Forge foreman. The title meant she ran the extraction, the smelting, and the finished metalwork for Brannach's primary forge \u2014 the operation that supplied volcanic ore to the Kingsrun's southern stops and, through intermediary traders, to the Wardensea's weapons program.","","She looked at you. The look was long and unhurried \u2014 the Gorundai assessment that the ore-loaders had started from a distance, now delivered up close. Horns. Build. Skin tone. The highland Oni gear that said origin more clearly than a flag.","","\"Oni.\" Her voice was low and direct. Gorundai speech \u2014 short declaratives, no decoration. \"Half. Highland. Stormspire line, if I'm reading the horns right.\" She looked at the ram-curve. \"I'm reading them right.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne started to respond. Brukka's eyes moved to her, then back to you. The dismissal wasn't rude \u2014 it was directional. The Gorundai foreman had identified the person on the crew whose physical presence spoke a language she understood, and she was speaking to that person.","","\"Brannach doesn't get highland Oni. We get Gorundai. We get humans. We get Rathai who come to fix things and stay because the fissures keep breaking things.\" She crossed her arms. The gesture made the forearms look like bridge supports. \"An Oni on the Kingsrun is rare. A half-Oni is rarer. What's your business?\"","","The question was not hostile. It was Gorundai \u2014 direct, expecting a direct answer, the conversational equivalent of putting your cards face-up.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne answered. \"Kingsrun south. We need docking, resupply, and information about conditions ahead. We can pay dock fees and purchase supplies at listed rates.\"","","  Brukka nodded. The nod was for the information. Her eyes stayed on you.","","\"Dock fees are two Silver a day. Supplies from the market at standard rates. Water from the cistern \u2014 free, but you haul it yourself. The fissure district is open to visitors if you don't mind the heat.\" She uncrossed her arms. \"The volcano has been building for nine weeks. The harmonic shifted pitch three days ago. The miners know what that means. Everyone else is learning.\"","","She said it without alarm. The way a sailor described rough seas \u2014 a condition, not an emergency. The volcano was building. The Gorundai were still mining. The relationship between those two facts was Brannach's entire economy.","","\"The Inheritors have been here three weeks. Their captain works the fissures with us.\" Something in her tone shifted \u2014 a fraction warmer. Respect, or the Gorundai equivalent, which was acknowledging competence. \"Kovesse moves ore like a Gorundai. The horns are different. The back is the same.\"","","She looked at you again. The assessment was complete but the conclusion was still forming.","","*choice","  #Offer to work. The Gorundai value physical labor. An Oni who volunteers for the fissures is speaking a language Brukka Venn understands better than any verbal introduction.","    *set personality_aggression %+ 3","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne's expression said she understood the calculation even if she wouldn't have made the same one. An offer of labor at a volcanic mine was not a small commitment. It was a physical credential \u2014 hours in the heat, in the fissures, doing work that broke people who weren't built for it. For a half-Oni at Brannach, it was the most direct statement available.","","    Brukka Venn looked at you. The offer registered on her face the way warmth registered on stone \u2014 slowly, from the surface inward, changing the structure of the expression without changing the shape.","","    \"The morning shift starts at dawn. The fissure approach is on the north side of the ridge \u2014 follow the sound. You'll know which sound.\" She looked at your hands. \"You've never mined volcanic ore.\"","","    She'd already assessed the calluses and found them wrong.","","    \"Your first shift, you carry. The ore comes out in basalt shells \u2014 fifty-pound pieces, hot, edges sharp enough to cut leather. You carry them from the extraction face to the cooling platform. Two hundred yards. No cart \u2014 the fissure floor is too uneven. You carry or you don't mine.\"","","    She turned. Then stopped.","","    \"Kovesse Thrallek will be on the morning shift.\" She didn't look back. \"Two Kingsrun Oni in the same fissure. The miners will have opinions.\"","","    *goto day_end","","  #Ask about the volcano. The harmonic shifted three days ago. Brukka said the miners know what that means. Before committing to anything at Brannach, understanding what the mountain is doing matters more than what the people are doing.","    *set personality_loyalty %+ 3","","    Brukka's response was immediate \u2014 no hesitation, no calculation. The question was practical and the Gorundai answered practical questions.","","    \"The volcanic field has twelve active fissures. Nine are venting \u2014 gas and heat, stable, the miners work around them. Two are dormant \u2014 sealed by cooled flow from the last eruption. One is new.\" She held up one finger. The nail was black from forge work. \"Opened eleven days ago on the northwest face. The new fissure is the concern. New fissures mean the pressure system is finding new routes to the surface. When the mountain does that, it's telling you the old routes aren't enough.\"","","    She looked north, toward the ridge, toward the sound.","","    \"The harmonic is the mountain's heartbeat. Every miner on Brannach learns to read it before they learn to swing a pick. Low and steady means stable. Rising pitch means building pressure. The pitch has been climbing for nine weeks.\"","","    She paused. The pause was Gorundai \u2014 not dramatic, not for effect. A pause because the next sentence required accuracy.","","    \"Three days ago, the pitch dropped. Not gradually \u2014 in one movement. A single shift between the dawn reading and the midday reading.\" She looked at you. \"When the pitch drops after a long climb, the mountain has found a new route for the pressure. That's what the new fissure is. A relief valve.\"","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara was listening. \"A relief valve is good. The pressure is being released incrementally instead of building to a catastrophic event.\"","","      Brukka looked at her. The assessment was brief \u2014 an engineer who understood pressure systems, not a miner who'd lived inside one.","","      \"That's the theory. The practice is that the new fissure is venting hotter than the established ones. The gas composition is different \u2014 higher sulfur, traces of metals that the surface fissures don't produce. Those metals come from deeper. The relief valve is working, but the pipe is new and untested.\"","","    \"The next eruption could be tomorrow. Could be six months. The mountain doesn't publish schedules.\" Brukka shrugged \u2014 the motion of someone who lived with uncertainty as a baseline condition. \"We mine until we can't. When we can't, we go to the shelters. The shelters are cut into the ridge base \u2014 thirty feet of basalt between you and whatever the mountain throws. They've held through four eruptions in my lifetime.\"","","    She looked at you.","","    \"Your ship is on the outer berth. Smart. If the mountain moves and you need to leave fast, the outer berth clears in minutes. The inner berth \u2014\" she glanced at the Regrade \u2014 \"the inner berth is for ships that aren't leaving.\"","","    *goto day_end","","*label day_end","","*page_break","","The evening settled on Brannach with a quality the other stops hadn't had.","","At Selvaggio, the evenings were loud \u2014 crowds, Grimoire broadcasts, the Departure Bell, the noise of three hundred ships in a harbor built for a hundred. At Galluun's Tooth, the evenings were quiet \u2014 the reef absorbing sound, the coral amplifying silence. At Merrenbach, the evenings were musical \u2014 path-songs from the cliffs, the trill of Khari voices in the warm dark.","","At Brannach, the evenings were heavy.","","The volcanic harmonic filled the silence. The low frequency was stronger at night \u2014 or the absence of other sound made it louder, the way a heart becomes audible in a quiet room. The tremors came every forty minutes. Small \u2014 a vibration through the stone pier that rattled the mooring chains and sent concentric ripples across the harbor water. The crew felt them. The Gorundai didn't. The difference was calibration.","","The ash fall was heavier at night. The thermal updrafts that carried the volcanic plume during the day weakened after sunset, and the ash descended on the harbor in a fine grey snow that accumulated on every horizontal surface. The deck. The rigging. The storm-leather coat. The ash was warm. Body temperature. The remnant heat of the fissure that had produced it, carried aloft and deposited as a grey blanket that tasted of sulfur and the interior of the earth.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara had rigged a tarp over the deck \u2014 angled to shed the ash into the water, protecting the caulking from the acidic particulate. \"The ash is manageable for three to five days. After that, the acid starts eating the sealant and we're back to Selvaggio-level hull maintenance.\" She checked the tarp's angle. \"We do what we need to do here and we leave before the ship starts dissolving.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek cooked dinner with the volcanic water. He'd hauled it from the cistern \u2014 free, as Brukka had said, though the hauling was a workout on Brannach's stepped stone paths. The water had a mineral taste that transformed the rice and dried fish into something heavier, denser, the food taking on the character of the island.","","  \"The water is filtered through volcanic rock. The mineral content is higher than anything I've worked with \u2014 iron, sulfur, trace metals. It changes the cooking.\" He served the bowls. \"The Gorundai don't add salt to their food. They don't need to. The island does it for them.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne wrote in the ship log. The entry was longer than usual.","","  \"Day ten. Stop Four \u2014 Brannach. Volcanic scar island, active volcanic field, Gorundai population. Harbor operational. Inheritors (Kovesse Thrallek, Boar Fruit, 190M bounty) docked at inner berth, ship under repair. First contact with a Cursed Generation crew. Initial assessment: not hostile. Cautious. They've been here three weeks \u2014 they know this island. We don't.\"","","  She looked at you.","","  \"Brannach is different from the first three stops. Selvaggio was chaos. Galluun's Tooth was isolation. Merrenbach was trust. Brannach is \u2014\" she searched for the word. \"Physical. This island rewards people who can carry things and survive heat and swing heavy objects at rock. The Gorundai built this place for people shaped like them.\"","","  She closed the log.","","  \"For the first time since Selvaggio, you're shaped like the locals. Use it.\"","","The night deepened. The ash fell. The harmonic held its pitch \u2014 the mountain breathing in the dark, the sound a presence in the same way the ocean's depth had been a presence between the stops. The Regrade was a shadow at the inner berth, the scaffolding skeletal against the cliff. The Inheritors' lanterns glowed orange through the ash.","","Two Kingsrun crews at the same dock. The first shared stop since Suuba's Kindling had been a shadow on the Grimoire. But the Inheritors weren't a shadow. They were sixty yards away, repairing a ship that had been running this route since before their captain was born, carrying a legacy that weighed more than the volcanic ore.","","The mountain spoke. The ship answered \u2014 a creak in the hull, a tremor in the mooring lines, the wood and iron and water responding to the geological voice beneath them all.","","Brannach was burning. The Sundered Wake was docked in its harbor. Tomorrow was the fissures.","","*goto_scene ch4_brannach_fissures",""], "labels":{"after_approach":258,"after_observe":268,"gorundai_contact":272,"day_end":357}},
"ch4_brannach_fissures": {"crc":1689263684, "lines":["*comment ===================================================","*comment  CHAPTER 4: BRANNACH \u2014 \"The Fissure Stop\"","*comment  Scene 2: The Fissures","*comment  The fissure mines. Deep, hot, claustrophobic for","*comment  a 6'7\" Oni. Meeting Kovesse Thrallek. Named","*comment  Gorundai NPC. Major fight scene \u2014 Kingsrun","*comment  predator. MC's Dominion tested \u2014 Armoring holds","*comment  three seconds longer. Something is growing.","*comment  2 real choices. Zero fake choices.","*comment ===================================================","","Dawn came through the ash.","","The light was orange \u2014 filtered through the volcanic plume that drifted east of the island, the sun rising behind a curtain of particulate that turned the morning into something that looked like an ending rather than a beginning. The ash on the deck had accumulated overnight into a grey film that Kessara had already begun clearing, working the tarp's angle to shed the worst of it into the harbor water.","","The fissure approach was on the north side of the ridge.","","Brukka Venn had said to follow the sound. The sound was the volcanic harmonic \u2014 the low-frequency vibration that had been constant since arrival, transmitted through the stone, through the dock, through the soles of the boots. On the north side of the ridge, the harmonic was louder. Not a background presence but a foreground one. The mountain's voice, unobstructed by three hundred feet of basalt, speaking directly from the fissures into the open air.","","The path over the ridge was cut into the rock \u2014 stone steps carved by Gorundai labor, wide enough for a loaded ore-carrier, with iron handrails bolted into the basalt at intervals. The climb was steep. The heat increased with every step \u2014 the south side of the ridge held the harbor's sheltered warmth, but the north side was the volcanic field itself, and the temperature differential was immediate. By the halfway point, the storm-leather coat was an oven. By the ridgeline, the air tasted of sulfur thick enough to coat the tongue.","","The fissure field.","","From the ridge, the north face of the island was visible in its entirety \u2014 a landscape of black rock, fractured and venting, the fissures running through it like cracks in a fired pot. Nine active vents produced columns of white-grey vapor that rose and dispersed in the morning air. The dull orange glow of the new fissure was visible on the northwest face \u2014 brighter than the established vents, the color more intense, the heat shimmer distorting the air above it in a way the others didn't. The mining operation spread across the field. Iron tracks for ore carts. Stone platforms at the fissure mouths. A ventilation network of pipes and bellows that the Rathai engineers maintained. Gorundai miners moving between the approaches in groups of four and six, carrying picks and pry-bars and the basalt-lined packs that held the raw ore.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had come to the ridge with the long-glass. She wouldn't enter the fissures \u2014 the heat and the claustrophobia were not her terrain. But she'd wanted to see the field.","","  \"Industrial extraction on an active volcanic site. The Gorundai have been mining this island for \u2014\" she looked at the infrastructure \u2014 \"at least sixty years, based on the depth of the track cuts and the layering on the ventilation pipes.\" She lowered the glass. \"The ore is volcanic basalt with embedded metallic compounds. At the forge temperatures they achieve with the natural gas, that ore produces blade-grade iron that conventional forges can't match.\"","","  She looked at you.","","  \"Brukka's fissure is the third approach from the left. The shift is already down there. I'll be on the ridge.\"","","*page_break","","The fissure approach was a slot in the rock \u2014 eight feet wide, fourteen feet high at the entrance, narrowing as it descended. The walls were warm to the touch. Not hot. Warm. The temperature of living skin, as if the rock itself had a pulse. The volcanic harmonic was tactile here \u2014 the vibration traveling through the walls, through the floor, through the air in a way that made the chest hum with a frequency below hearing.","","The descent was forty feet.","","The fissure opened at the bottom into a chamber that was not a cave but a wound \u2014 a gap in the mountain's structure where two rock faces had separated, creating a space thirty feet wide and a hundred feet long, the ceiling at nine feet, the floor uneven and littered with ore fragments. The light came from the fissure itself \u2014 a crack in the far wall, two feet wide, glowing orange, the magma behind it close enough to illuminate the chamber in a wash of amber that made the dark rock look wet.","","The heat was serious. The air was dense with it \u2014 not the dry heat of the surface but a humid, mineral-saturated warmth that pressed against the lungs and made each breath a negotiation between oxygen and temperature. The Gorundai miners worked in it. Six of them, stripped to the waist, using picks and pry-bars to crack the ore-bearing rock from the chamber walls. The work was rhythmic. The pick strikes fell in a pattern that interlocked with the volcanic harmonic, the two rhythms creating a composite sound that was both industrial and geological.","","Brukka Venn was at the extraction face. She saw you and pointed to the cooling platform \u2014 a stone shelf near the fissure entrance where the ore was staged before being carried to the surface.","","\"Carry.\"","","The first load was fifty pounds.","","The ore came in basalt shells \u2014 dark, rough-edged, warm. Not hot enough to burn through leather gloves, but warm enough that the heat was constant, accumulating in the hands and forearms over multiple loads. The carry was two hundred yards \u2014 from the extraction face through the fissure chamber, up the approach slot, to the cooling platform on the surface. The slot was the problem. Eight feet wide at the entrance, narrowing to six feet at the tightest point. For a six-seven Oni with a broad frame and ram-curved horns, the slot was a series of calculations \u2014 angle the horns, drop the shoulder, move the ore without scraping the walls.","","The Gorundai miners navigated the slot without adjusting. They were large \u2014 larger than humans, the tusked jaws and dense frames filling the space with the ease of bodies shaped by the same architecture. But their builds were proportioned differently. Wider in the shoulder, shorter in the height. The fissure was their workplace, built to their dimensions. Your height was the problem. Your horns were the complication.","","The first trip took eight minutes. The second took six. By the third, the body had found the fissure's rhythm \u2014 the angle for the horns, the hip-turn at the narrow point, the placement of each foot on the uneven floor that avoided the loose ore fragments and the thermal vents in the rock.","","By the sixth trip, your forearms were shaking.","","Not from the weight. Fifty pounds was nothing \u2014 the highland training had conditioned the body for loads twice that. The shaking was from the heat. The sustained thermal exposure was draining energy in a way that cold and altitude did not. The body was working to stay cool and to carry ore simultaneously, and the two demands competed for the same resources.","","*page_break","","Kovesse Thrallek was at the far end of the chamber.","","She'd been there since before you arrived \u2014 Brukka had mentioned it without emphasis, the way she mentioned any miner on the shift. The Gorundai captain of the Inheritors was working the extraction face with a pick, stripped to the waist, her green-brown skin sheened with sweat and volcanic dust. She was twenty-six. She was large \u2014 Gorundai large, six-two, dense, the tusked jaw and the heavy brow and the shoulders built for the swing of a pick as much as for the swing of a weapon. Her Armoring was visible. A residual density in the skin \u2014 passive, permanent, the Dominion compressed into the body at a level that didn't require activation. Tempered. The word for someone whose will had been forged into a second layer of flesh.","","She didn't look up when you entered. She didn't look up for the first hour.","","The Gorundai miners tracked both of you. Nobody said anything. Nobody rearranged the work order. But by your third carry, the route had changed \u2014 not on paper, not by instruction. The miners had shifted their positions, opening a lane that put your carry path within ten feet of Kovesse's extraction face. The adjustment was wordless and collective and had the subtlety of a dinner party seating chart designed by someone's mother.","","On the seventh carry, Kovesse straightened.","","She was holding an ore piece \u2014 not in a basalt shell, but raw, a chunk of volcanic rock the size of a melon, shot through with veins of bright metal that caught the fissure light. She turned it in her hands. The hands were Gorundai hands \u2014 thick, calloused, the nails cracked from the rock. But younger than Brukka's. Less scarred. The hands of someone who'd been mining for three weeks, not three decades.","","She looked at you.","","The assessment was Gorundai \u2014 direct, physical, unhurried. She saw the horns, the build, the sweat, the ore dust on the arms. She saw a half-Oni carrying basalt shells through a fissure that hadn't been built for someone that size. Her face was level. Measuring. The expression of someone looking at something she hadn't expected to see and was deciding how to categorize.","","\"You carry.\" Her voice was Gorundai \u2014 short, declarative. \"Most crews stay on the dock.\" She turned the ore piece in her hands again. Set it down. Picked it up. Put it in the wrong pile. Moved it to the right one. \"Kovesse Thrallek. You already know that. The Grimoire's been saying my name for weeks. I'm tired of hearing it and I can't turn it off.\"","","Not a question. The Grimoire had been broadcasting her crew's presence at Brannach for weeks.","","*set met_kovesse true","","*if (crew4_name = \"Terrek Ghaal\")","  Your Terrek had not come into the fissure \u2014 the cook's role was the ship, the galley, the provisions. But Kovesse didn't know that. What Kovesse knew was that the Sundered Wake had a Gorundai crew member \u2014 human-passing, but Gorundai by blood. The Grimoire had mentioned it. Veshanna Torc had mentioned it. The Kingsrun was a small world and the crews on it were smaller.","","\"Your engineer. Kessara Veldt. Rathai, right? Dussa says she's good.\" The reference was casual \u2014 two engineers noticed by each other, professional respect transmitted through the grapevine of dock-side observation. \"And Sullavenne Ohn. Former Wardensea. That's unusual for a Kingsrun crew.\"","","She picked up her pick. Hefted it. The weight sat in her hands with the comfort of repetition.","","\"My mother ran this route thirty-nine years ago. Stop Fifteen. Senmovar turned her back.\" She swung. The pick bit the rock and a chunk came free. She put it in the pile. Put the next one in the wrong pile again. Moved it. \"I keep saying I'm not trying to be her. I say it a lot. To my crew, to the Grimoire, to \u2014\" She swung again, harder. \"I'm finishing what she started. That's different from being her. Supposedly.\"","","She swung again. The rhythm of the work resumed. The silence between swings was Gorundai silence \u2014 work-silence, where the pick said what the mouth wouldn't.","","*page_break","","The morning shift ran four hours.","","By the end, you had carried twenty-six loads. Thirteen hundred pounds of volcanic ore, moved two hundred yards each trip through a fissure slot that required constant adjustment. The arms were heavy. The legs were solid but warm \u2014 a deep fatigue that was thermal as much as muscular. The lungs had adjusted to the sulfur air, which was not the same as being comfortable with it. The body had learned the fissure. The fissure had not become easier.","","Brukka Venn marked the loads on a stone tally near the cooling platform. She looked at the number. Then at you.","","\"Twenty-six.\" She scored the tally. Checked it. Scored it again \u2014 she'd lost count somewhere and was reconciling. \"First shift. A Gorundai carrier does thirty. An experienced one doesn't make thirty-five.\" She looked at the tally. \"Your back's strong. Your lungs are \u2014\" She made a sound. A Gorundai assessment-sound, somewhere between a grunt and a verdict. \"Highland. Thin air, not hot air. Different demand.\"","","She put the tally stone down. Picked it back up.","","\"Come back tomorrow. I'll see if you temper or crack.\"","","The descent from the ridge was easier than the climb. The harbor air felt cold after the fissure \u2014 a relative cold, the temperature still warm by any standard, but the contrast made your skin prickle as the sweat began to cool. The Sundered Wake was at the outer berth, the tarp angled against the ash, the crew visible on deck.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara met you at the dock. She looked at the hands. Looked away. Looked back at the hands.","","  \"You went into the fissures.\" She took your hand \u2014 not gently, the way an engineer takes a component \u2014 and turned it palm-up. The skin was red, raw, the basalt shells' edges mapped in welts. \"How deep?\"","","  She listened. Didn't let go of the hand.","","  \"The gases will corrode your \u2014 three days. Maximum. The heat is cumulative and you don't feel the deficit until it's already \u2014\" She stopped. Put your hand down. Pulled wrapping cloth from her harness. Started wrapping without asking. \"Leather underneath, cloth over. The basalt edges are \u2014\" She wrapped tighter than she needed to. Her hands were steady. Her jaw was not. \"Come back from the fissures with hands. That's all I ask. I need you to have hands.\"","","*page_break","","The trouble came in the afternoon.","","The Sundered Wake's crew was on the dock \u2014 resupplying, purchasing provisions from the market stalls, hauling water from the cistern. The routine of a Kingsrun stop, repeated now for the fourth time, the process becoming efficient through repetition. The dock was open. The ore-loaders had shifted to the afternoon crew. The Regrade's scaffolding rang with the welders' work. The harbor was busy in the way Brannach's harbor was busy \u2014 not crowded, but purposeful, every person moving with a task that justified their presence.","","The three men came from the unmarked schooner.","","The ship \u2014 the one Sullavenne had noted on approach, small, no markings, schooner rig \u2014 had been quiet since the Sundered Wake's arrival. No crew visible on deck. No activity. A ship that was either empty or waiting.","","It was waiting.","","Three men on the dock. Human. Armed. The first was tall and thin, carrying a short sword on his left hip and a second blade strapped to his thigh. The second was shorter, heavier, with a crossbow slung across his back and the weathered look of someone who'd spent years on salt water without ever running a Kingsrun of his own. The third was the one who mattered.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne saw them first. Her hand went to your arm \u2014 a grip, not a touch. Warning.","","  \"The schooner. Three crew, armed. The leader \u2014 the one in front \u2014 is wearing a Wardensea-pattern belt with the insignia filed off. Ex-military or stolen. His sword is Craft-grade Resonance \u2014 I can hear the tone from here.\"","","  She released the grip.","","  \"They're not looking at the dock. They're looking at us.\"","","The leader was mid-thirties. Medium build, medium height, a frame that didn't announce itself \u2014 no size advantage, no obvious strength. Brown hair cut short. A scar across the bridge of the nose that said someone had tried to take his face and mostly failed. His eyes were wrong. Not the eyes of a sailor. The eyes of someone who calculated distances between himself and other people and converted those distances into tactical decisions.","","He walked directly to the Sundered Wake's berth.","","\"The half-Oni.\" His voice was flat. Professional. \"You've been on the Grimoire since Selvaggio. Small crew, small ship, cargo from Merrenbach. The Kolmari have a recovery contract on those spice crates.\"","","*if (galluuns_tooth_challenge = \"took_box\")","  \"And whatever was in the Galluun's Tooth wreck. The Kolmari aren't the only ones listening to the Grimoire.\"","","*if (galluuns_tooth_challenge = \"left_box\")","  \"The Kolmari insurance office at Galluun's Tooth filed a report on a small crew matching your description. Diving on claimed wrecks. Whether you took anything or not, the report exists.\"","","He stopped six feet from you. The distance was deliberate \u2014 outside arm's reach, inside conversational range. The two men behind him spread, one to each side. Not flanking. Positioning.","","\"Drellen Maas.\" He said it like he was used to saying it and tired of the sound. \"I recover things. Ships, cargo, sometimes \u2014 well. You get the idea.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne stepped forward. Her posture was Wardensea \u2014 the unconscious bearing of someone who'd spent years in a uniform.","","  \"Recovery agent. Operating under whose license? The Kolmari don't hire freelancers for early-route cargo \u2014 the insurance payout is cheaper than the commission.\"","","  Drellen looked at her. The assessment was fast.","","  \"Former military. Fourth Division? No \u2014 Second. The bearing's different.\" He smiled. The smile was thin. \"You're right. The Kolmari didn't hire me. I hired myself. The recovery contract is open \u2014 anyone who returns the cargo gets the commission. It's listed on the Blue-band commercial boards. Thirty percent of recovered value.\"","","  \"Thirty percent of six Gold Sovereigns is less than two Gold. You sailed a schooner to Brannach for two Gold.\"","","  \"I sailed a schooner to Brannach for multiple opportunities. Your cargo is one.\"","","*choice","  #Step between the crew and Drellen Maas. Whatever this man is selling, the answer is physical \u2014 a half-Oni standing at full height, horns and shoulders filling the dock space, making the calculation explicit. The cargo stays. The discussion is over.","    *set personality_aggression %+ 3","","    The step forward closed the six-foot gap to three. Drellen Maas didn't retreat. His eyes moved \u2014 up, to the horns, to the shoulders, back to center. The calculation was visible. He was measuring you against his own capability and his two men's combined capability and the distance to the schooner and the number of Gorundai on the dock who might or might not intervene.","","    \"The half-Oni approach.\" His voice didn't change. \"Physical presence as negotiating tool. It works on most people. Most people aren't standing on a dock with a Resonance blade and fifteen years of experience using it.\"","","    He drew the sword.","","    The sound was wrong. Not the scrape of steel leaving leather \u2014 a sound underneath it, a frequency, a vibration that the ears registered as tone rather than noise. The Resonance. Craft-grade. Cutting Tone. A blade designed to disrupt Armoring. The sunlight caught the metal and the metal held it differently than ordinary steel \u2014 the surface rippled with a pattern that was forged into the molecular structure, the smith's work visible as a signature in the blade's reflection.","","    \"I don't want to fight a half-Oni on a dock. It's expensive, it's loud, and the Gorundai will get involved. But if you're standing between me and a legitimate recovery contract, we're having the conversation your way.\"","","    His two men moved. The crossbow came off the back. The second blade cleared its sheath.","","    *goto fight_scene","","  #Hold position. Let the crew handle the conversation. Drellen Maas is talking \u2014 people who are going to attack don't announce themselves first. He wants something, and finding out what costs nothing.","    *set personality_loyalty %+ 3","","    The dock held. Three men from the schooner. The Sundered Wake's crew. The Gorundai ore-loaders at the adjacent berth, watching with the dispassionate attention of people who'd seen dock confrontations before and would see them again.","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne continued. \"Multiple opportunities. Meaning you're not here for us specifically. You're working the route \u2014 trailing small crews, filing recovery claims on anything that looks undefended. The Kolmari contract is your cover. Your real income is whatever you can take from ships that can't stop you.\"","","      Drellen's smile stayed. \"She's good.\"","","      \"I was trained by people who hunted people like you.\"","","      \"And then you left and joined a rookie Kingsrun crew with a half-Oni captain and a cargo hold full of someone else's spice.\" He shrugged. \"The commission is legitimate. The contract is posted. I'm offering a civilized resolution \u2014 you surrender the cargo, I pay you the Kolmari standard finder's fee, ten percent. Everyone walks away.\"","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara was behind you. She'd moved \u2014 not obviously, not dramatically. She'd shifted from the deck to the dock and positioned herself between the crossbow man and the Sundered Wake's mooring lines. An engineer protecting the ship.","","    The negotiation lasted four minutes. Drellen Maas spoke in the flat tone of a professional. The terms were simple: the spice cargo from Merrenbach, surrendered at dock, in exchange for a ten percent finder's fee. The alternative was unspoken but present in the positioning of his two men and the Resonance blade on his hip.","","    *if (merrenbach_deal = \"accepted\")","      Six Gold Sovereigns' worth of spice. Thirty crates hauled from a wreck at thirty feet. Two hours and forty-eight minutes in the water at Merrenbach. The deal with Suuvi Renn. The trust earned in the fissure. The cargo was not just money. It was proof that the crew could do the work.","","    *if (merrenbach_deal = \"declined\")","      The cargo hold was light. The spice crates from Merrenbach were absent \u2014 the deal with Suuvi Renn had not been made. Whatever Drellen Maas thought was in the hold, the hold was simpler than he expected.","","    The negotiation failed. It failed because Drellen Maas was not negotiating \u2014 he was positioning. The talk was the preamble. The blade was the sentence.","","    He drew.","","    The Resonance tone filled the dock \u2014 a frequency that the stone and the iron and the water reflected back, the Craft-grade Cutting Tone designed to shear through Armoring. His two men moved simultaneously. The crossbow came up. The second blade cleared.","","    *goto fight_scene","","*label fight_scene","","The fight was ugly.","","A dock brawl. A recovery agent with a Resonance blade and a half-Oni with nothing in hand except the distance between them and the willingness to close it.","","Drellen Maas was fast. The sword moved in short arcs \u2014 no wasted motion, no theatrical swings. The blade came at your leading arm in a cut that would have opened the forearm to the bone. Your arm pulled back. The blade passed three inches from the skin and the Resonance tone hummed in the gap \u2014 the frequency close enough to feel, a vibration that said the metal was singing and what it sang was designed to cut through things harder than flesh.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek moved. The cook from the Kethrun district was not a fighter by role, but a Gorundai who'd grown up around miners was a Gorundai who'd learned that problems were solved by closing distance. He went for the crossbow man \u2014 not with a weapon, with mass and speed and the absolute certainty that forward was always the correct answer. The crossbow fired. The bolt went wide \u2014 panic shot, the kind that happens when the target is covering ground faster than the trigger finger can track. Terrek hit the crossbow man at full stride and they went off the dock edge together, into the shallow water between the berths.","","*if (crew4_name != \"Terrek Ghaal\")","  The crossbow man raised his weapon. The bolt fired \u2014 wide, panicked, punching into the dock planking two feet from your left boot. Before he could reload, two Gorundai ore-loaders stepped off the adjacent berth and put themselves between the crossbow and the fight. They didn't speak. They didn't need to. The crossbow man looked at two Gorundai miners built like furnace doors and decided reloading was optional.","","*if (crew3_name = \"Kessara Veldt\")","  The second swordsman came at Kessara. She had no weapon. She had an iron mooring pin \u2014 eighteen inches of dock hardware, pulled from its ring with the leverage of an engineer who knew which direction the threads ran. The pin was not a sword. But it was iron, and it was heavy, and Kessara swung it with the mechanical efficiency of someone who understood force vectors and applied them to the nearest available problem.","","*if (crew3_name != \"Kessara Veldt\")","  The second swordsman circled left. He had a blade and room to use it. But the dock was Gorundai territory, and the ore-loaders at the adjacent berth had stopped working. The swordsman looked at them. Looked at you. The calculation was simple \u2014 one half-Oni in front, two Gorundai miners behind, and a dock that had decided whose side it was on. He lowered his blade.","","Drellen Maas. You. The dock.","","The recovery agent moved like someone who'd fought for fifteen years and survived all of it. His feet found the dock planking's dry spots \u2014 no stumble, no slip, the footing calibrated by reflex. His blade worked in patterns that you had never seen because you had never fought someone with a Resonance weapon. The tone was constant. Every swing carried it \u2014 a frequency that said the edge would cut through more than flesh, that the metal itself was a weapon against the body's natural defenses.","","The first cut landed.","","Across the left forearm. Shallow \u2014 you had pulled back, the highland reflexes turning a deep cut into a surface wound. But the Resonance tone bit deeper than the edge. The vibration traveled through the cut, into the forearm, through the muscle, and it felt wrong \u2014 a disruption in the body's integrity, a frequency designed to interfere with the thing that made Armoring possible.","","The blood was hot. The pain was secondary to the wrongness \u2014 the sense that the blade had touched something underneath the skin that wasn't physical.","","The second swing came at the ribs.","","And the body answered.","","The sheen. The same dark film that had covered the forearms in the Selvaggio dock fight \u2014 oil on water, crawling up from the wrists. But different. Faster. The sheen didn't flicker this time. It spread. Across the forearms, up to the elbows, across the chest where the blade was aimed. A dark surface that hardened in the half-second before impact.","","The Resonance blade hit the sheen.","","The tone screamed. The Cutting frequency met the Armoring and the sound that resulted was a collision of two forces designed to override each other \u2014 the blade's song versus the body's will, the smith's craft versus the raw material of Dominion. The blade cut. The Armoring held.","","One second.","","Two seconds.","","Three seconds.","","The blade pushed through. The Armoring cracked \u2014 a surface failure, the dark sheen splitting along the line of the cut, the Resonance finding the seam and exploiting it. The edge reached the skin and opened a line across the ribs \u2014 shallow, the same depth as the forearm cut. But the blade had been stopped for three seconds by something that hadn't been there before.","","*set dominion_armoring + 5","*if (dominion_armoring >= 30)","  *set armoring_tier \"Forged\"","*if (dominion_armoring >= 10)","  *if (dominion_armoring < 30)","    *set armoring_tier \"Tempered\"","*set injured true","*set injury_type \"resonance_cuts\"","*set injury_severity 2","*set injury_days_remaining 2","","Drellen Maas stepped back. His expression had changed \u2014 the professional calculation replaced by something less controlled. He'd felt the resistance. He'd expected to cut through a half-Oni's flesh with a Craft-grade Resonance blade and meet nothing. He'd met three seconds of something.","","\"Armoring.\" He said it like a diagnosis. \"Flicker-grade. No \u2014 that held too long for Flicker.\"","","The sheen was fading. It receded down the arms, back to the wrists, gone. The three seconds were over. But the memory of them was in the body \u2014 a warmth distinct from the fissure's residual heat, a density beyond muscle, the specific knowledge that the skin had been more than skin and could be again.","","You closed the distance.","","Without the sheen. Without Armoring. With two hundred and sixty pounds of highland Oni build and the fundamental physical truth that a half-Oni who reaches grappling range against a swordsman has changed the terms of the negotiation.","","Drellen was fast. The blade came up \u2014 a desperate defensive swing aimed at your leading hand. Your hand took the cut across the knuckles. The blood was immediate. The pain was real. But the hand didn't stop. It found Drellen's sword arm at the wrist, and the grip that closed was the grip of someone who'd spent the morning carrying thirteen hundred pounds of volcanic ore through a fissure.","","The sword dropped.","","The dock planking caught it. The Resonance tone died when the blade left the wielder's hand \u2014 the frequency cutting out like a voice mid-sentence, the silence sudden and absolute.","","Your other hand found Drellen's collar. The recovery agent's feet left the dock. Six-seven and two-sixty against five-ten and a hundred and seventy. The math was Oni math \u2014 the kind that didn't require explanation because the explanation was happening in real time, in the air, three inches above the dock surface.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was already there. She had Drellen's second blade \u2014 picked up from where it had fallen when you closed range. She was holding it correctly. The Wardensea training held.","","  \"The crossbow man is in the water. Your swordsman is on the dock with an iron pin dent in his shoulder. And you're suspended by a half-Oni who spent the morning mining volcanic ore.\" She looked at Drellen's feet. \"How's the calculation now?\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek pulled himself out of the water between the berths. The crossbow man was still in it \u2014 not unconscious, but stunned, floating on his back with the dazed look of a man who'd been hit by a Gorundai at full speed and was reconsidering his career trajectory. Terrek was soaked. He was grinning. The grin was Gorundai \u2014 wide, satisfied, the expression of someone who'd just done something purely physical and was exactly as happy about it as his bloodline dictated.","","  \"I like Brannach,\" he said.","","The Gorundai ore-loaders hadn't moved. They'd watched the entire fight from the adjacent berth with the attention of people assessing a structural test. Brukka Venn's crew. Miners who evaluated material under stress for a living.","","One of them \u2014 the large one with the deep green skin, the one who'd tracked you on arrival \u2014 spoke. His voice carried the short declarative cadence of his race.","","\"Not bad.\" Two words. Gorundai praise.","","*page_break","","The aftermath was Brannach's version of justice.","","Brukka Venn came down from the forge district twenty minutes after the fight. She'd heard about it the way information traveled on a small island \u2014 through the miners, through the dock workers, through the Gorundai network that processed physical events with the efficiency of a fire brigade. She looked at the three men from the schooner, lined up on the dock, disarmed, the recovery agent's Resonance blade confiscated.","","\"Recovery agent.\" She said it the way she'd say \"rat.\" The same number of syllables. The same degree of respect. \"You sailed to Brannach to shake down a rookie Kingsrun crew on my dock. My dock.\"","","Drellen Maas opened his mouth.","","\"Don't.\" Brukka's voice dropped to a register that the volcanic harmonic couldn't compete with. \"The dock fee for the schooner is two Silver a day. You've been here four days. That's eight Silver. Pay it and leave. Or don't pay it and explain to the forge district why you think Brannach's dock is free.\"","","The schooner left within the hour. The dock felt different after \u2014 a tension that had been present since the unmarked ship's arrival, a tension nobody had consciously registered, now absent. The harbor water closed over the wake.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was writing. The notebook filled with the tactical assessment she'd been composing since the first swing.","","  \"Drellen Maas. Recovery agent, freelance. Craft-grade Resonance sword, Cutting Tone. Trained \u2014 fifteen years minimum. He wasn't lying about his experience. What he was lying about was his intent. The Kolmari contract was real \u2014 they do post open recovery bounties on commercial boards. But a two-Gold commission doesn't justify a schooner deployment to Stop Four.\"","","  She looked up.","","  \"He was scouting. Us, the Inheritors, whatever else comes through Brannach. Recovery agents who work the early Kingsrun stops profile crews for clients further south. He'll sell his observations \u2014 crew composition, combat capability, cargo manifest \u2014 to anyone who pays.\"","","  She paused.","","  \"He'll sell the Armoring observation.\"","","  She said it plainly. The dark sheen. The three seconds. Drellen Maas had seen it, had felt it, and had named it. That information had value, and it would travel.","","*if (crew5_name != \"Sullavenne Ohn\")","  The schooner's wake was still visible on the harbor water. Drellen Maas had seen the Armoring. Had felt it. Had named it \u2014 \"Armoring,\" spoken like a diagnosis on a public dock. Recovery agents worked the early Kingsrun stops for a reason. They profiled crews. Sold observations to clients further south. Crew composition. Combat capability.","","  The dark sheen. The three seconds. That information had value. And Drellen Maas had left with it.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara looked at your hands. The knuckle cut from the Resonance blade. The forearm cut. The rib cut. All shallow. All bleeding.","","  \"The rib cut is the one that matters. The forearm and knuckles are surface \u2014 clean them, wrap them, they'll close in two days.\" She looked at the rib wound. \"This one the blade held against for three seconds before it broke through. That's not normal. The blade should have cut through immediately \u2014 Craft-grade Resonance against unprotected skin is instant. Something slowed it.\"","","  She looked at your forearms. The sheen was gone. The skin was ordinary \u2014 ash-white, Oni, marked with ore dust and blood.","","  \"The thing that slowed it. Can you do it again?\"","","  The question hung. The body didn't have an answer. The sheen had come unbidden, the same way it had come in Selvaggio \u2014 a reactive surge, the body answering a threat before the mind could process the question. Three seconds instead of half a second. Longer. Stronger. Reactive, involuntary, and gone the moment the threat passed.","","*choice","  #Go back to the fissures tomorrow. The morning shift. The work. Kovesse. The ore. The heat teaches the body things the dock can't \u2014 endurance, resistance, the hard conditioning that volcanic rock demands. The Armoring came from the body under stress. The fissures are stress.","    *set personality_aggression %+ 3","    *set dominion_armoring + 2","    *if (dominion_armoring >= 30)","      *set armoring_tier \"Forged\"","    *if (dominion_armoring >= 10)","      *if (dominion_armoring < 30)","        *set armoring_tier \"Tempered\"","","    The decision was physical. The body had done two things today \u2014 carried ore for four hours and fought a Resonance-armed recovery agent on a dock. Both had demanded something from you that you hadn't known was available. The ore had demanded endurance. The fight had demanded Armoring. The fissure was the place where both demands converged.","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne looked at you. She was quiet for a long moment.","","      \"The Wardensea has a term for what happened on the dock. Reactive Armoring surge \u2014 involuntary deployment under threat. It's how most Armoring users discover their capacity. The next step is replication under controlled stress.\" She paused. \"A volcanic fissure qualifies as controlled stress.\"","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara wrapped the cuts while you sat on the dock. Her work was precise \u2014 clean, bandage, wrap. The engineering of the body.","","      \"The ore work is progressive loading. Each shift adds thermal stress and physical demand. If the Armoring is stress-responsive \u2014\" she tied off the last wrap \u2014 \"the fissure is a training ground.\"","","    The morning would come. The fissure would be there. Kovesse Thrallek would be there, swinging her pick, carrying her mother's route in her body. And you would be there, carrying ore, learning the mountain, and waiting for the dark sheen to come again.","","    *goto scene_close","","  #Stay on the ship. Let the cuts heal. The fight proved something \u2014 the Armoring is real, it's growing, and it came when it was needed. Pushing it in the fissures risks the body before the body is ready. The crew needs you functional, not broken by volcanic heat and Resonance wounds.","    *set personality_loyalty %+ 3","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara's response was immediate. \"Correct. The Resonance cuts will interact with the thermal stress from the fissure. The blade's frequency disrupted whatever produced the Armoring \u2014 if you go back into the heat before the disruption clears, the body is fighting on two fronts.\" She wrapped the rib cut with extra attention. \"One day. Maybe two. Let the cuts close and the tissue recover. Then the fissures.\"","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne sat on the deck. The notebook was open.","","      \"The Wardensea's Armoring training protocol requires twenty-four hours between surge events. The body needs recovery time to consolidate the gains \u2014 reactive surge without recovery produces diminishing returns.\" She looked at you. \"One day on the ship. Observe. Recover. Then back to the fissures for the forge conversation.\"","","    *if (crew4_name = \"Terrek Ghaal\")","      Terrek cooked. The meal was heavier than usual \u2014 double protein, extra carbohydrates, the Merrenbach kelp broth enriched with Brannach's mineral water. Recovery food. The cook understood that the body had been asked for more than it had been given time to prepare for, and the cook's response was caloric intervention.","","      \"Eat. All of it.\" He set the bowl down. \"The highland elders used to say the body rebuilds in sleep and food. Sleep is tonight. Food is now.\"","","    The ship held. The harbor held. The volcanic harmonic held its pitch \u2014 the mountain's voice unchanged by the day's events, the geological clock running on a scale that made human conflict irrelevant. The ash fell. The evening came. The cuts ached in the specific way that Resonance wounds ached \u2014 not just pain, but a vibration in the tissue, a memory of the blade's frequency stored in the flesh.","","    *goto scene_close","","*label scene_close","","*if (armoring_tier = \"Flicker\")","  *set armoring_tier \"Tempered\"","*set broadcast_count + 1","*set latest_broadcast \"brannach_dock_fight\"","","*page_break","","The night on Brannach was different from the first.","","The Grimoire crackled at dusk. Veshanna Torc's voice \u2014 clipped, factual, the cadence of a reporter who confirmed before she broadcast.","","\"Kingsrun Watch. Stop Four update. The Sundered Wake crew \u2014 half-Oni captain \u2014 confronted and expelled an armed recovery agent at Brannach harbor this afternoon. Three-on-four engagement on the dock. No fatalities. The recovery vessel has departed south.\"","","A pause. Then: \"The Sundered Wake's captain is four stops in and already drawing iron. Make of that what you will.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  The broadcast ended. Sullavenne looked at the Grimoire, then at you.","","  \"Four stops. That's early to be on Veshanna's broadcast. She doesn't cover crew fights unless the crews are worth watching.\"","","The fight had changed the dock's awareness of the Sundered Wake. The Gorundai ore-loaders nodded at you now \u2014 small motions, minimal, Gorundai-calibrated. Acknowledgment. The half-Oni who carried ore in the morning and dropped a recovery agent in the afternoon had passed a test that the Gorundai valued without needing to name.","","The Inheritors had watched. Sureth Kellane had watched from the Regrade's deck, arms crossed, expression unchanged. The Inheritors' Terrek had watched with the grin of an Oni who'd seen a fight he enjoyed without being in it. Dussa Kervenne had watched from under the scaffolding, her attention split between the combat and the repair schedule.","","Kovesse Thrallek had not been on the dock. She'd been in the fissures. When she returned at dusk, Sureth told her. Kovesse listened without expression, then looked at the Sundered Wake at the outer berth.","","\"The half-Oni.\" Two words. Then she went to her ship.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne's evening report was delivered at the rail, looking south, the smoke column catching the last light.","","  \"Summary. Day one at Brannach. Morning: fissure work, first contact with Kovesse Thrallek. Afternoon: confrontation with recovery agent Drellen Maas, three-on-four dock fight, hostile neutralized and expelled.\" She paused. \"And your Armoring held a Resonance blade for three seconds. At Selvaggio, it lasted half a second. The growth is measurable.\"","","  She looked at you.","","  \"Three seconds of Armoring against a Craft-grade Resonance blade. The Wardensea classifies that as Tempered \u2014 professional-grade. The baseline for any crew member expected to fight. Below that threshold, you're a civilian who gets lucky. Above it, you're a combatant who can be trained.\"","","  She let that settle.","","  \"You crossed it today. On a dock, in a fight you didn't start, four stops into the Kingsrun. The standard Armoring development curve is years. You've done it in days. Either you're exceptional, or you were always capable and the highlands never gave you a reason to find out.\"","","The mountain spoke in the dark. The harmonic was constant \u2014 the pitch that Brukka had said dropped three days ago, the new baseline, the mountain's current voice. The ash fell. The tremors came every forty minutes. The island was alive.","","The Regrade's lanterns went dark. The Inheritors slept.","","The Sundered Wake held its berth. The outer pier. The escape position. The ship that could leave.","","But not yet. Not yet. Brannach had more to give.","","Tomorrow: the forge.","","*goto_scene ch4_brannach_forge",""], "labels":{"fight_scene":223,"scene_close":407}},
"ch4_brannach_forge": {"crc":-2079189282, "lines":["*comment ===================================================","*comment  CHAPTER 4: BRANNACH \u2014 \"The Fissure Stop\"","*comment  Scene 3: The Forge","*comment  Weapon opportunity \u2014 Resonance grade depends on","*comment  affordability and smith's opinion. The Slag Gift.","*comment  Crew revelation beat. Conditional eruption sequence.","*comment  Cliffhanger: crew member injured, Kelvanni is","*comment  two days south. The ship needs to move.","*comment  2 real choices. Zero fake choices.","*comment ===================================================","","*set days_since_departure + 1","*if (sovereigns >= 2)","  *set sovereigns - 2","","The third morning at Brannach began with a sound your body had learned.","","The volcanic harmonic. The frequency had been constant since arrival \u2014 the mountain's baseline, the pitch that Brukka Venn read the way sailors read wind. But this morning the pitch was different. Higher. A quarter-tone shift that the ribs registered before the ears caught up, a change in the geological voice that said the pressure system underneath the island had moved overnight.","","The Gorundai noticed. The ore-loaders on the early shift walked faster. The scaffolding workers on the Regrade paused, tools lowered, heads tilted \u2014 listening with the focused attention of people who lived on a volcanic island and understood that the mountain's voice was not decoration. It was data.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was on deck, her hand flat on the hull. Feeling the vibration transmitted through the stone pier, through the mooring lines, through the wood.","","  \"The frequency has shifted up. Approximately eight to twelve hertz above yesterday's baseline.\" She looked at the ridge. \"In a closed pressure system, a pitch increase means the volume of the resonating chamber has decreased. The magma is closer to the surface, or the fissure geometry has changed. Either way, the mountain is tighter than it was yesterday.\"","","  She removed her hand.","","  \"We should plan to leave today.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was already dressed. The Wardensea discipline \u2014 awake before the watch changed, prepared before the situation demanded it. She'd heard the shift.","","  \"The Gorundai miners are moving faster. That's the only data point I need. When the people who've lived on a volcano their entire lives change their pace, visitors should pay attention.\"","","*page_break","","The forge district was louder than the previous visits.","","The smiths had been working since before dawn \u2014 the bellows driving volcanic gas into the forges, the heat building in the open-faced workshops until the air at the top of the settlement rippled. The hammering was continuous. A dozen forges running simultaneously, the percussion overlapping into a wall of sound that competed with the harmonic beneath it. The Gorundai smiths worked stripped to the waist, grey-green and grey-brown skin gleaming with sweat and forge scale, the tusked faces concentrated on the metal under their hammers.","","Brukka Venn was at the primary forge.","","Her forge was the largest \u2014 three bellows, two anvils, a quenching trough fed by volcanic water piped from a fissure vent. The fire was white at the core. Not the orange of charcoal or the yellow of coal \u2014 the white of volcanic gas combustion, a temperature that could soften ore conventional forges couldn't touch. The heat from ten feet away pressed against the skin like a hand.","","She saw you approach. She set down her hammer. The motion was deliberate \u2014 a Gorundai smith setting down the primary tool was a punctuation mark.","","\"Your hands.\" She looked at them. The palms were calloused from the ore carrying \u2014 two days of basalt shells. The knuckle cut from Drellen's blade was healing. The forearm cut was a thin line under the wrapping.","","\"Better than I expected. Which is what I say when I expected worse.\" She picked up something from the anvil's ledge \u2014 volcanic glass, dark and translucent, the size of a closed fist. Turned it in the light. Set it down. Picked it up again. Put it in a different spot.","","\"Slag glass. The Gorundai make windows, cups, trade beads. We also make \u2014\" She turned the glass to catch the light, and it slipped. Fell. Hit the anvil edge and bounced onto the forge floor, where it rolled to a stop against a slag bucket. The sound was small and sharp and the silence after it was enormous. Two nearby smiths looked over. Brukka stared at the glass on the floor. Her tusked jaw tightened. She picked it up, checked the edge for chips, and set it back on the anvil with the exaggerated care of someone who would rather be swallowed by the fissure than acknowledge what just happened. \"Weapons. We also make weapons. Volcanic ore takes a Resonance tone better than mainland metal. That's the point. I should have started there.\"","","She looked at you.","","\"You worked my fissure. You carried twenty-six loads your first shift and didn't quit. You fought a recovery agent on my dock and put him down with ore-conditioned hands.\" The assessment was delivered the way Gorundai delivered truth \u2014 flat, direct, the words carrying only their literal weight. \"The mountain doesn't give gifts to people who watch it from the harbor. You weren't watching.\"","","She reached under the anvil and pulled out a bundle wrapped in forge leather. The bundle was long \u2014 three feet, angular. She set it on the anvil and unfolded the leather.","","A blade.","","Short sword. Twenty-eight inches of dark metal that caught the forge light and rippled it back with a surface pattern that moved like oil on heated stone. The guard was minimal \u2014 a flat crossbar, basalt-wrapped. The grip was volcanic leather over iron. The pommel was a rough sphere of cooled slag, balanced against the blade's weight.","","It was not beautiful. It was not elegant. It was a Gorundai weapon \u2014 functional, dense, built to survive the kind of use that broke prettier swords. The blade had a texture that said the metal had been worked hot and worked hard and worked until the impurities were beaten out of it.","","\"Common grade. Cutting Tone.\" Brukka touched the flat of the blade. The metal hummed \u2014 a low vibration, audible at close range, the Resonance stored in the forge pattern. \"I made it six weeks ago. The ore came from the same fissure you carried from. The volcanic gas powered the forge that heated it. The mountain made this blade. I just shaped it.\"","","She stepped back.","","\"Eight Gold Sovereigns. That's my price for anyone who walks in off the dock.\"","","*if (merrenbach_deal = \"accepted\")","  Eight Gold. Eighty Silver at the exchange rate. The spice cargo from Merrenbach had earned sixty. Dock fees, provisions, water, the accumulated costs of four stops \u2014 the treasury was lighter than the Merrenbach haul suggested.","","*if (merrenbach_deal = \"declined\")","  Eight Gold. The treasury had been thin since Selvaggio and hadn't recovered. Eight Gold was more than the crew had.","","*page_break","","The forge fell quiet around the conversation. The other smiths kept working \u2014 the hammering was constant \u2014 but the space around Brukka's primary forge had cleared. The Gorundai understood the economics of a weapon sale the way they understood the economics of the fissure. The transaction was physical. The blade was real. The buyer was being measured.","","Brukka looked at you. The assessment had not stopped \u2014 it had been running since the first morning in the fissures, accumulating data through carried ore and dock fights and the Gorundai calculus of physical worth.","","\"Eight Gold is the dock price. The outsider price.\" She crossed her arms. The forearms were bridge supports. \"You're not an outsider. You worked the fissures. That changes the number.\"","","She paused. The pause was Gorundai \u2014 accuracy, not drama.","","\"Five Gold. The mountain price. For someone who carried its ore.\"","","*comment Purchase guard: blade option hidden if player has < 50 Sovereigns","*choice","  *if (sovereigns >= 50) #Take the blade. Five Gold is steep for a Common-grade weapon, but this blade was forged from the same ore you carried. The same fissure. The same mountain. There's a logic to that worth more than the metal.","    *set personality_aggression %+ 3","    *set obtained_weapon true","    *set weapon_name \"Brannach Short Sword\"","    *set weapon_grade \"Common\"","","    *if (merrenbach_deal = \"accepted\")","      *if (sovereigns >= 50)","        *set sovereigns - 50","","    *if (merrenbach_deal = \"declined\")","      *if (sovereigns >= 50)","        *set sovereigns - 50","","    The payment was heavy. Five Gold Sovereigns counted out from the ship's treasury \u2014 coins that represented weeks of sailing, a reef dive at Galluun's Tooth, a spice deal at Merrenbach. The money left the hand and the weight of it left with it, replaced by the weight of the blade.","","    Brukka took the coin. She didn't count it \u2014 Gorundai trust. If you shortchanged a Gorundai smith, you didn't do it twice.","","    The blade sat in your hand. Twenty-eight inches. The balance was forward-heavy \u2014 a cutting weapon, designed to use momentum, the kind of balance that rewarded strength over speed. The Resonance tone was there. Faint. A hum in the grip that the palm registered as vibration and the forearm registered as warmth. Cutting Tone. The frequency designed to disrupt Armoring.","","    You now held a weapon that could do to others what Drellen Maas's blade had done to you. The symmetry was not comfortable. It was necessary.","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne looked at the blade. \"Common grade. Cutting Tone. In Wardensea terms, that's a patrol officer's weapon \u2014 standard issue for anyone expected to encounter Armoring in the field.\" She looked at you. \"You're not patrol. But you need a blade that can bite through what the Kingsrun puts in front of you. This does the job.\"","","    *goto slag_gift","","  #Decline. The treasury can't afford to bleed five Gold on a weapon when the ship needs provisions, the crew needs supplies, and Kelvanni is two days south. The blade is good. The crew's survival is better.","    *set personality_loyalty %+ 3","","    The blade stayed on the anvil. Brukka's expression didn't change \u2014 the Gorundai respected a decision made from practical calculation as much as one made from desire. Turning down a weapon because you couldn't afford to feed your crew was a choice that said something about what you valued. The Gorundai valued it.","","    \"The blade stays here. Someone will buy it.\" She folded the leather back over it. \"The mountain doesn't mind waiting.\"","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara's shoulders dropped two inches. Her fingers unclenched from the tool harness strap she'd been white-knuckling, and the leather kept the shape of her grip for a second after she let go.","","      \"Right call,\" she said. Quiet. Her hand found a different strap on the harness and tightened something that was already tight.","","    *goto slag_gift","","*label slag_gift","","*page_break","","Brukka Venn didn't leave.","","The weapon transaction was finished \u2014 completed or declined, the economics settled. But the forge foreman remained at the anvil, and her hand went to something on the shelf behind her. Small. Dark. Wrapped in a cloth that was cleaner than anything else in the forge.","","She unwrapped it.","","Volcanic glass. A piece the size of a palm, oval, the edges sharp enough to draw blood. The surface was black \u2014 not the translucent amber of the display piece. Pure black, the glass formed from the deepest flow, volcanic material that only surfaced during a major eruption. The glass caught the forge light and gave none of it back. It absorbed.","","\"This isn't for sale.\" She held it up. The glass was between them \u2014 the forge foreman and the half-Oni, the Gorundai and the highland exile, two people shaped by different mountains standing in the heat of a forge that ran on volcanic fire.","","\"Slag Gift.\" She held the glass at an angle that caught the forge light. \"You know what it means or you don't.\"","","The Slag Gift was a custom older than the Thrallic Reformation \u2014 a Gorundai offering volcanic glass to someone they judged worthy of being armed. Not sold a weapon. Armed. The distinction was the difference between a transaction and a statement.","","\"I trust you enough to \u2014\" She stopped. Worked her jaw like the next word was stuck sideways. Started over. \"I trust you enough to arm you. The mountain made this. I'm giving it to someone the mountain \u2014\" She glanced down at her own hands, as if checking she was doing this right. \"\u2014 tested. You. The mountain tested you.\" She was gripping the glass hard enough that her knuckles had gone pale under the green-brown skin. \"What you do with the trust is \u2014 shit, I always forget the order. What you do with the trust is yours. What you do to the glass is mine. That's right. That's the order.\"","","She held the glass out. Her hand was not quite steady. She'd given this speech before \u2014 the words were old, practiced, ritual. But the hand that held the glass was shaking, and the shaking said this wasn't routine. This one mattered to her.","","The second part was the warning. Breaking the Slag Gift \u2014 whether the glass itself or the trust it represented \u2014 was the one thing the Gorundai forge culture did not forgive. A broken Slag Gift was a broken word. The Gorundai didn't have many rituals. The ones they had, they held with iron.","","*set received_slag_gift true","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was still. His hands were at his sides \u2014 not cooking, not holding anything, not doing any of the things Terrek's hands always did. He was watching the glass change hands the way some people watch things they've only ever heard about. His mother had told him about this. In a kitchen that smelled like gorrash. And now he was watching it happen to someone else, and his hands were empty, and his jaw was doing something strange \u2014 working side to side, the muscles in his neck cording, the face of a man fighting to keep it together and losing ground by the second. He wiped his eyes with the back of his hand. Sniffed once, hard. Wiped them again.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne's hand went to her notebook pocket. Stopped. She left it there \u2014 the hand on the pocket, not opening it, not taking notes, just resting on the leather cover through the fabric. She watched the glass change hands and her pen stayed where it was.","","The glass was warm. Not from the forge \u2014 from the mountain. The volcanic heat stored in the material, released slowly, the glass radiating a temperature that matched the ground under the boots and the air above the fissures and the water in the harbor. The island's heat, concentrated and held and given.","","Your hand closed around it. The edges pressed against the ore-calluses on the palm. A perfect fit \u2014 not designed, not engineered. Coincidence. Or what the Gorundai called the mountain's opinion and everyone else called luck.","","*page_break","","The crew revelation came in the forge district, in the gap between the Slag Gift and the departure.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was at the edge of the forge platform, looking north. The volcanic plume was thicker than yesterday \u2014 darker at the base, the column widening as it climbed. The harmonic's new pitch vibrated through the stone platform underfoot.","","  She spoke without turning.","","  \"I didn't leave the Wardensea.\" The words came out flat. Rehearsed. She'd been carrying this sentence and it showed. \"The Wardensea left me.\"","","  She turned. The scar on her jaw caught the forge light.","","  \"Four years ago. Second Division. Intelligence and patrol assessment. We intercepted a ship running medical supplies to a clinic on the Kingsrun. Oursseva Denn's clinic at Kelvanni.\" She paused. Longer than the others. \"Medical supplies. Bandages, antibiotics, surgical \u2014\" She stopped. Started again. \"My commanding officer ordered the cargo destroyed. Standard protocol. I filed a dissent.\"","","  Her hand went to the scar. She caught it. Put it down.","","  \"The dissent was filed. The cargo was destroyed anyway. One hundred and twenty crates sunk in open water.\" Another pause. \"The next week, the clinic ran out of sutures. Three patients died.\"","","  The volcanic harmonic filled the silence.","","  \"I filed a formal complaint. They filed a conduct review. The Wardensea doesn't punish officers who follow protocol \u2014 it punishes the ones who \u2014\" Her voice cracked. One syllable. She cleared her throat. \"The scar was a reminder. From someone who took the complaint personally.\"","","  She looked at you. Her hands were in her pockets. She took them out. Put them back.","","  \"I'm going south because Oursseva Denn is at Stop Five. She doesn't know my name. She doesn't know I \u2014\" She stopped. \"Three people died because I filed a piece of paper. The next time, I won't be filing anything.\"","","  She buttoned her coat. Checked the collar. Smoothed the fabric where it sat against her shoulders \u2014 the same gesture she did every morning, the same Wardensea muscle memory she couldn't shed and had stopped trying to. Her hands were steady. They'd been steady the entire time.","","*if (crew5_name != \"Sullavenne Ohn\")","  *if (crew3_name = \"Kessara Veldt\")","    Kessara was sitting on the forge platform's edge, legs hanging over the stone, looking at the harbor below. The Sundered Wake at the outer berth. The Regrade at the inner. The two ships \u2014 one heading south, one waiting to heal before it could follow.","","    \"The ship I crewed before this one.\" She said it to the harbor, not to you. \"The Torval Rose. Nettleworks-built, Torval yard, before Torval closed. I apprenticed there. I was seventeen. The yard master was a woman named Dessima Keth \u2014 Rathai, obviously, sixty years old, could hear a cracked weld from across the shop floor.\"","","    She picked at the stone beneath her.","","    \"Torval closed because the Kolmari withdrew their insurance certification. No certification, no contracts. No contracts, no yard. Dessima said it was political \u2014 the Kolmari were consolidating shipbuilding into licensed facilities they controlled. Torval was independent. Independent meant expendable.\"","","    Her hands stopped moving.","","    \"Dessima killed herself three months after the yard closed.\"","","    She reached for her tool harness. Checked the wrench. Checked the calipers. Tested the hinge on the folding spanner \u2014 the one with the worn grip, the one she'd carried since the Torval yard. She put it back in the same loop she always put it in.","","    \"I went to sea because a ship is a machine and machines don't close. They break, and you fix them, and they keep going.\" She looked at the Sundered Wake.","","    \"That ship is mine. Not legally. Not by ownership. Mine because I've rebuilt every piece of her since Selvaggio and I will not let her die the way Torval did.\"","","*page_break","","The mountain's voice changed at midday.","","The harmonic that had been climbing since dawn shifted \u2014 not higher this time. Irregular. A stutter in the geological frequency that the miners recognized before anyone on the dock could process what it meant. The hammering in the forge district stopped. Six forges fell silent simultaneously. The smiths lowered their tools and tilted their heads with the synchronized motion of people listening to a sound they'd been trained since birth to take seriously.","","Brukka Venn's voice cut across the forge platform.","","\"Shelters. Now.\"","","The word traveled down the settlement like fire. Shelters. The Gorundai moved with a speed that was practiced \u2014 this was not panic, this was drill. The miners dropped tools. The market vendors closed their stone shutters. The dock workers left the ore crates and moved toward the ridge base, where the shelter entrances were cut into the basalt \u2014 heavy iron doors, thirty feet of solid rock overhead, the refuges built to survive what the mountain could produce.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was already moving. \"The crew. The ship. We need everyone off the dock and either in the shelters or aboard and ready to cast off.\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara looked at the ridge. \"The harmonic's gone irregular \u2014 the resonating chamber geometry is changing in real time. That means the fissure network is deforming. When fissures deform, they either vent or they seal, and sealed fissures build pressure until \u2014\"","","  She didn't finish. She was running for the dock.","","The eruption was not what you had imagined.","","There was no explosion. No fireball. No cinematic detonation that shattered the sky and rained destruction. The volcano's event was geological \u2014 a lateral blast from the new fissure on the northwest face, a directed surge of superheated gas and volcanic debris that jetted from the fissure mouth in a horizontal plume, the force angled away from the settlement, away from the harbor, into the open ocean northwest of the island.","","The sound was the sound of the world tearing. A bass concussion that rattled the stone buildings and cracked the slag-glass windows in the forge district and sent a physical shock wave through the ground that you felt in the knees and the teeth and the base of the skull. The volcanic plume billowed \u2014 the column doubling in width in seconds, the ash darkening the sky to premature dusk.","","Then the fissure collapse.","","The new fissure \u2014 eleven days old, the one Brukka had called the relief valve \u2014 sealed. The lateral blast had emptied its throat and the walls fell inward, closing the vent, and the sound of it was a deep, grinding percussion that said a piece of the mountain had just eaten itself.","","*set brannach_eruption_survived true","","*page_break","","The dock shook.","","The tremor was harder than the forty-minute cycles \u2014 a single, violent buck in the stone that cracked the pier surface and sent the mooring chains chattering against the iron rings. The Sundered Wake lurched at the outer berth. The Regrade lurched at the inner berth, the scaffolding swaying, the stone cradles groaning under the ship's weight.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was on the dock. He'd been coming down from the market with provisions \u2014 water, gorrash, the volcanic-mineral food that had become part of the crew's routine. The provisions were on his back. His feet were on the stone. When the tremor hit, the stone split under him \u2014 a crack that opened two inches wide and ran the length of the pier between the inner and outer berths.","","  He went down.","","  The fall was bad. The crack's edge caught his leg below the knee \u2014 the shin striking the basalt edge with the ugly sound of bone meeting rock at the wrong angle. He landed hard, the provisions scattering, the water barrel rolling into the harbor with a splash that was lost in the eruption's ongoing roar.","","  He didn't scream. Gorundai. The pain registered on his face as a compression \u2014 the features tightening, the jaw locking, the eyes narrowing. But the sound he made was a grunt. A single, dense exhalation that said the body had been hurt and the body's owner was too stubborn to announce it.","","  *set injured true","  *set injury_type \"broken_leg\"","  *set injury_severity 4","  *set injury_days_remaining 14","","*if (crew4_name != \"Terrek Ghaal\")","  *if (crew3_name = \"Kessara Veldt\")","    Kessara was on the dock, running for the Sundered Wake. The tremor caught her mid-stride \u2014 the stone bucking under her feet, the crack opening across the pier. She stumbled. Her hands went out to break the fall, and the left hand found the crack's edge at the wrong angle. The wrist bent. Something gave. The sound was small and ugly.","","    She held the wrist against her chest and kept moving. The engineer's priorities held \u2014 reach the ship, assess the damage, fix what was broken. Her wrist was broken. The ship might not be.","","    *set injured true","    *set injury_type \"broken_wrist\"","    *set injury_severity 3","    *set injury_days_remaining 10","","*if (crew4_name != \"Terrek Ghaal\")","  *if (crew3_name != \"Kessara Veldt\")","    Oursseva was on the dock. The Thalessi physician moved with the deliberate speed of someone who'd survived catastrophes before \u2014 not running, not frozen, the precise middle ground of a medic in a crisis. The tremor knocked her sideways. She caught herself on a mooring post, but the basalt edge grazed her forearm \u2014 a shallow cut, bleeding freely, the kind of wound she would have treated in seconds on anyone else. She pressed her sleeve against it and kept moving toward the ship.","","    *set injured true","    *set injury_type \"arm_laceration\"","    *set injury_severity 2","    *set injury_days_remaining 5","","The ash fall was immediate. Not the fine grey dust of the previous days \u2014 this was heavier, darker, the particulate from the lateral blast carrying chunks of volcanic rock the size of gravel. It fell on the harbor, on the ships, on the dock, on the crew. The tarp over the Sundered Wake's deck caught the worst of it, the canvas sagging under the accumulated weight.","","The Regrade's scaffolding collapsed.","","The tremor and the ash fall combined \u2014 the wooden framework that had supported the hull repairs sheared from its anchors and fell against the cliff face in a cascade of timber and iron fittings. The sound was industrial. The Inheritors' crew scrambled clear. Dussa Kervenne was shouting \u2014 Rathai at full volume, the professional composure gone, the engineer watching three weeks of repair work destroyed in four seconds.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was at your side. She assessed in seconds \u2014 the dock, the crew, the injured, the ships.","","  \"The lateral blast vented the pressure \u2014 the main eruption risk is reduced but the fissure collapse means the stable vent network has changed. The mountain needs new relief valves. If it doesn't find them, the next event will be larger.\"","","  She looked at the injured crew member.","","  \"Kelvanni. Two days south with good wind. Oursseva Denn's clinic.\"","","  She looked at you.","","  \"We leave now.\"","","*choice","  #Cast off immediately. The mountain is unstable, the dock is cracked, and a crew member needs medical attention that Brannach cannot provide. Every hour at harbor is an hour closer to the next event.","    *set personality_aggression %+ 3","    *set days_since_departure - 1","    *comment Leaving immediately saves a day vs helping first","","    The decision was instant. The dock was broken. The mountain was uncertain. The crew was injured. Three facts that produced one conclusion: the Sundered Wake leaves now.","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara worked the lines one-handed \u2014 or directed the work, her voice sharp and precise, compensating for the injury with the sharp authority of an engineer who knew every rope on the ship. \"Mooring lines first. Bow line, stern line, spring. The tarp stays \u2014 we'll clear the ash at sea. Get the sail up and the tiller free.\"","","    *if (crew4_name = \"Terrek Ghaal\")","      Terrek was carried aboard. The leg was splinted with a mooring pin and dock rope \u2014 Sullavenne's field work, Wardensea emergency medicine applied with the efficiency of someone who'd done it on a patrol deck. He sat against the mast, the splinted leg extended, his face grey under the weathered skin.","","      \"I can cook sitting down,\" he said. The voice was strained. The Gorundai insistence on function through pain.","","    *goto departure","","  #Help the Inheritors first. Their scaffolding is down, their repair work is destroyed, and they're at the inner berth against the cliff \u2014 the position Kessara warned about on day one. A crew that helps a rival crew in a disaster earns something that no amount of sailing can buy.","    *set personality_loyalty %+ 3","","    The Inheritors' berth was sixty yards of cracked dock away. The scaffolding debris was piled against the Regrade's hull \u2014 timber, iron fittings, the welding equipment that had been three weeks into hull repair now scattered across the stone pier. Dussa Kervenne was pulling debris clear with the frantic efficiency of someone trying to assess whether the scaffolding collapse had damaged the hull it was supposed to be repairing.","","    Sureth Kellane was organizing the crew. The human first mate's measured calm was exactly what the situation needed \u2014 no shouting, no panic. Instruction. Direction. The bearing of someone who'd been told by his captain's dead mother's legacy that keeping the crew together was the job.","","    Your crew joined the clearing.","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara \u2014 broken wrist or no \u2014 was at the hull. One-handed assessment. She ran her good hand along the copper sheathing, feeling for the telltale deformation that said the scaffolding had punched through to the structural frame.","","      \"The sheathing held. The scaffolding hit the repair sections \u2014 the new timber, not the old. The new timber is softer, so it absorbed the impact instead of transmitting it to the frame.\" She looked at Dussa Kervenne. \"Your hull is intact. The repair work needs to restart, but the ship isn't worse than it was.\"","","      Dussa stared at her. Two Rathai engineers across a damaged hull. The professional recognition was instant.","","      \"I know,\" Dussa said. Too fast. \"I know, I \u2014 yes, the hull, the vibration didn't change, I felt it, the keel's \u2014 I know.\" She wiped her face with a grease-black hand and left a smear across her forehead. \"It's the work. Three weeks. Three goddamn weeks of hot-work on the keel bolts and now the scaffolding's in the \u2014 and the welding rig, the welding rig is \u2014\" She gestured at the water where the rig had gone. The gesture said everything her mouth couldn't finish. \"Sorry. Thank you. I'm sorry. Thank you.\"","","    The Inheritors' Terrek was lifting debris with the efficiency of an Oni who'd trained to clear wreckage. The weighted chain was a tool now \u2014 looped around timber beams, hauling them clear of the hull with the leverage of someone who understood that a chain was just a very long arm.","","    Sureth Kellane looked at you. The look was long. It carried the weight of a first mate who'd spent three years managing a legacy crew and understood the rare value of another crew's captain choosing to help when they could have run.","","    \"Thank you.\" Two words. The same weight as Kovesse's \"the half-Oni\" \u2014 compressed, Sureth-measured, carrying more than the syllables held.","","    *set rival_kovesse + 15","","    *goto departure","","*label departure","","*page_break","","The Sundered Wake cast off from Brannach in the afternoon ash.","","The harbor was changed. The dock was cracked. The Regrade's scaffolding was debris in the water. The forge district's slag-glass windows were shattered, the amber light they'd filtered now replaced by the grey of unfiltered volcanic sky. The settlement was intact \u2014 Brukka's boast about the shelters holding through four eruptions proved accurate for a fifth \u2014 but the character of the island had shifted. The mountain had spoken louder than usual, and the people on it were listening to the echo.","","Kovesse Thrallek was on the Regrade's deck.","","The Gorundai captain stood at the stern rail, watching the Sundered Wake pull away. She hadn't been on the dock during the eruption \u2014 she'd been in the shelters with the miners, doing what the miners did, waiting for the mountain to finish its sentence. She'd emerged to find her ship's scaffolding destroyed and a rival crew either helping with the wreckage or already preparing to leave.","","She didn't wave. She didn't shout. She stood at the rail and watched, the way Gorundai watched things they were committing to memory. Two green-brown hands on the rail. The volcanic ash settling on her shoulders.","","The harbor mouth opened. The Sundered Wake's sail caught the wind \u2014 the first clean wind since Brannach, carrying the ship south and away from the volcanic plume. The ash thinned. The air cleared by degrees. The temperature dropped from Brannach's geological heat to the ocean's ambient warmth, and the difference felt like surfacing from a depth.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne took the tiller. The Wardensea bearing was present but different now \u2014 the woman who'd revealed the scar's story standing at the helm with the relieved posture of someone who'd set down a weight she'd been carrying for four years.","","  \"Course: south-southwest. Kelvanni is two hundred miles. Two days with this wind. Three if it shifts.\"","","  She looked at the injured crew member. The assessment was medical and tactical simultaneously.","","  \"Oursseva Denn's clinic. The woman whose supplies I couldn't save.\" A pause. \"The debt comes due at Kelvanni. Mine and ours.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was propped against the mast. The splinted leg was elevated on a coil of rope. His face was drawn \u2014 the pain working through the Gorundai stoicism in the small ways, the tightness around the eyes, the careful stillness of someone who'd learned that movement was expensive. But his hands were busy. He'd asked for the galley supplies to be brought to him, and he was preparing dinner from the mast, sitting down, working with the stubborn determination of a cook who would not let a broken leg end a meal.","","  \"Gorrash. I bought the grain this morning before the mountain had its opinion.\" He worked the pot. \"Brannach's last gift. We eat it at sea and we carry the island with us.\"","","The Grimoire crackled.","","Veshanna Torc. The Kingsrun Watch frequency, the signal stronger now that the ship was south of Brannach's volcanic interference.","","\"Kingsrun Watch. Brannach eruption confirmed \u2014 lateral blast, northwest face, fissure collapse reported. Harbor intact. Settlement intact. The Inheritors remain docked \u2014 their repair timeline has been extended. The Kindling's Sundered Wake has departed Brannach heading south.\"","","A pause.","","\"Heading south with a crew member down. Sources say the injury was dock-related during the eruption. The nearest medical facility is Stop Five \u2014 Oursseva Denn's clinic at Kelvanni. Two days south.\"","","Another pause. Longer.","","\"Four stops in. First dock fight at Brannach. First volcanic event survived. First crew injury. The Kindling is learning what the Kingsrun teaches, which is that the ocean and the islands don't care about your plans. The only plan that matters is the next two hundred miles.\"","","The broadcast ended.","","*set broadcast_count + 1","*set latest_broadcast \"brannach_eruption\"","","*page_break","","The ocean opened south of Brannach.","","The volcanic plume was behind them \u2014 a dark column against the northern sky, still building, still venting. The island shrank on the horizon. The basalt ridge. The harbor. The forges. The fissures. The mountain's voice fading from a presence in the chest to a memory in the bones, the specific frequency stored in the body the way the Resonance blade's tone had stored itself in the rib wound.","","*if obtained_weapon","  The Brannach short sword was stowed in the tiller housing. Common grade. Cutting Tone. A weapon forged from the ore you had carried through a fissure too narrow for a six-seven Oni. The blade hummed when the hull vibrated \u2014 the Resonance responding to the ship's motion, the stored frequency alive in the metal. It was a tool. It was also a piece of the mountain.","","The Slag Gift was in the storm-leather coat's inner pocket. The volcanic glass, warm against the chest, the edges pressing through the cloth. Brukka Venn's words: I trust you enough to arm you. The glass was warm. The trust was heavier.","","The crew sailed south. The injured member was stable \u2014 splinted, elevated, fed. The ship was sound. The treasury was lighter. The mountain was behind them.","","Ahead: Kelvanni. Oursseva Denn. The free clinic. The Debt Ledger.","","Two hundred miles of open ocean between a volcanic island and a medical station. Two days with fair wind. The Kingsrun's next lesson.","","The Sundered Wake pointed south and ran.","","*goto_scene ch5_kelvanni_clinic",""], "labels":{"slag_gift":132,"departure":354}},
"ch5_kelvanni_clinic": {"crc":265421069, "lines":["*comment ===================================================","*comment  CHAPTER 5: KELVANNI \u2014 \"The Debt Stop\"","*comment  Scene 1: The Clinic","*comment  Oursseva Denn's free medical station. Overcrowded.","*comment  MC arrives with injured crew member. First","*comment  impression matters \u2014 carrying the wounded earns","*comment  respect. Neutral zone. Rival crews coexist.","*comment  2 real choices. Zero fake choices.","*comment ===================================================","","*set current_stop 5","*set current_stop_name \"Kelvanni\"","*set days_since_departure + 2","*if (sovereigns >= 1)","  *set sovereigns - 1","","The island appeared on the second day, and the crew needed it.","","A low shape on the southern horizon \u2014 flat, wide, sitting on the water the way Galluun's Tooth hadn't. No reef wall. No volcanic ridge. No elevation at all. Kelvanni was a shelf of raised coral twenty feet above sea level at its highest point, spread across a mile of ocean like a plate left on a table. The approach was gradual \u2014 the water shallowed in stages, the color shifting from deep blue to jade to a milky green that said the seabed was close and the coral was alive beneath the keel.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara adjusted the approach with her good hand. The broken wrist was splinted and bound against her chest \u2014 Sullavenne's field work, refined twice during the crossing when the swelling changed the geometry. The engineer navigated one-handed with the fluency of someone who'd been compensating for two days and had rebuilt the muscle memory around the limitation.","","  \"Shallow draft harbor. The coral here is living reef \u2014 the island is the reef, technically. The harbor is a carved channel through the reef plate, deep enough for light ships. The Sundered Wake draws four feet. We'll fit.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek had not moved from the mast in two days. The broken leg was splinted, elevated, the mooring-pin-and-rope field binding replaced on the first night with a proper splint made from a galley shelf and strips of sail canvas. He'd cooked every meal sitting down. He'd slept sitting up. The Gorundai tolerance for pain was not mythological \u2014 it was physiological, the denser bone structure and the mining-district constitution calibrated for impacts that would cripple other races. But a broken tibia was a broken tibia. The leg was swollen. The skin around the splint was dark with bruising. He needed a doctor.","","  \"I smell flowers.\" His voice was rough from two days of rationed water. \"The last island smelled like a forge. This one smells like a garden. I like this one better already.\"","","The harbor at Kelvanni was crowded.","","Eleven ships. You counted them through the approach channel \u2014 the masts visible above the low coral shoreline, the hulls packed into a harbor built for seven. The berthing was creative. Three ships rafted together at the main pier, hulls touching, fenders crushed between them. Two more anchored in the channel itself, blocking half the navigable width. The remaining six occupied every available foot of dock space, their mooring lines crossing and tangling in a web of rope that said the harbor master had stopped enforcing order and started enforcing survival.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne counted the flags.","","  \"Three Kingsrun crews. Two merchant vessels \u2014 Kolmari-flagged, medical supply runners. A Wardensea cutter \u2014 patrol class, light armament, here for crew medical treatment or intelligence gathering. Five unaffiliated. And \u2014\" She paused. \"The Kindling.\"","","  Suuba Mettani's ship. The Rathai-built vessel with the distinctive deep keel and the scorched bow section \u2014 the aftermath of the whale-oil incident that had earned Suuba seventy-five million in bounty and a permanent place on the Grimoire's highlight reels. The Kindling was at the inner pier, tied alongside a merchant vessel, the crew visible on deck.","","  \"They arrived yesterday. Maybe the day before. They're not injured \u2014 they're resupplying.\"","","The Sundered Wake found a berth at the channel's edge. Outer position \u2014 the escape berth, the pattern established at Brannach, the crew's instinct for the dock that allowed a fast departure.","","*page_break","","The dock at Kelvanni was different from every dock you had seen.","","At Selvaggio, the dock had been commerce \u2014 fish oil, ambition, departure permits. At Galluun's Tooth, coral and competition. At Merrenbach, the Khari and the reef. At Brannach, ore and iron and volcanic heat.","","At Kelvanni, the dock was triage.","","The wounded were everywhere. Sitting on the dock edge, legs hanging over the water. Leaning against bollards, bandaged arms held against chests. Lying on stretchers arranged in rows along the main pier, the stretchers made from ship timber and sail canvas, the patients covered in thin blankets that couldn't hide the shapes of splints and dressings beneath. A man with burns covering his left arm and shoulder sat next to a woman with a bandaged head, the two of them sharing a water jug with the casual proximity of people who had no energy for personal space.","","The smell was iodine and salt and the sweet, heavy undertone of infected wounds. The sound was low conversation, the occasional moan, the constant background of Grimoire static from a dozen devices tuned to different frequencies. The light was bright \u2014 Kelvanni's flat geography let the sun reach every surface, and the coral reflected it back, and the result was a clinic bathed in light so thorough that every wound was visible.","","The Khari of Warren Kaelith moved through the dock with the efficiency of a warren that had been doing this for decades. Canine Khari \u2014 shorter than you by two feet, compact, the fur-patterned skin and the wide dark eyes and the specific Khari physicality that said built for running, built for endurance, built for the sustained movement a medical station on a coral island demanded. They carried supplies. They guided patients. They spoke in the rapid, warm cadence of canine Khari \u2014 short sentences, forehead-press greetings between warren members, the constant low-level communication of a pack managing a crisis.","","One of them intercepted you at the dock.","","\"Crew. Injured?\" The Khari was young \u2014 early twenties, the canine features sharp, the eyes already assessing the ship's deck for stretchers or walking wounded. A cloth band on the upper arm, marked with a symbol that said medical runner.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was on deck. Visible. The splinted leg, the broad frame propped against the mast, the two days of pain and gorrash and sitting-down cooking written on his face. The Khari looked at him. The assessment was professional \u2014 fast, direct, the kind of triage that happened in seconds and sorted patients into categories that determined who got seen first.","","  \"Broken leg. Two days old?\" The Khari didn't wait for an answer. A whistle \u2014 a specific signal that produced two more warren members in under ten seconds. They arrived with a stretcher. One of them had a water jug. She offered it to Terrek before anyone asked. Terrek took it, drank, said \"thank you\" in a voice that cracked, and the Khari touched his shoulder briefly \u2014 a canine warren greeting, the forehead-press adapted to someone too big to reach \u2014 and moved on.","","*if (crew4_name != \"Terrek Ghaal\")","  *if (crew3_name = \"Kessara Veldt\")","    Kessara was on deck. The splinted wrist, the compensating posture, the two days of one-handed sailing written in the fatigue around her eyes. The Khari looked at the wrist.","","    \"Fracture. How old?\"","","    \"Two days. Volcanic eruption at Brannach. Dock tremor.\" Kessara's answer was Rathai-precise. No decoration. The engineer reporting damage.","","    \"Tier three \u2014 dock treatment first, clinic if \u2014\" The Khari looked at the wrist again. Reconsidered. \"No. Tier two. The swelling says it needs setting. I keep undergrading wrist fractures. Follow the blue markers.\"","","*page_break","","The clinic was a building.","","Not a tent. Not a converted warehouse. Not a repurposed anything. A building \u2014 stone walls on coral foundation, a flat roof designed for the flat island, windows on every side to catch the cross-breeze. The structure was Thalessi in design \u2014 the proportions, the window placement, the precise way the stone was cut to allow maximum light penetration. Highland descriptions of Thalessi engineering had mentioned exactly this. A Thalessi had designed this building to be a medical facility, and the building did what it was designed to do.","","The interior was controlled chaos.","","Beds lined both walls \u2014 forty beds in a room built for twenty, the additional cots crammed into the aisles and the alcoves and the spaces between structural columns. Every bed was full. Every cot was full. The floor held pallets \u2014 woven mats on stone, patients lying on them with the still patience of people who had been told the wait was long and had decided to wait anyway. The air was clean \u2014 the open windows let the ocean breeze through, and someone was burning something herbal near the east wall, a thin smoke that cut through the wound smell with a sharp, medicinal clarity.","","The staff moved with a discipline that was not military. It was medical \u2014 a different kind of precision, the kind that prioritized the bleeding over the complaining and the silent over the screaming because silence in a clinic often meant worse.","","Three Khari medics worked the floor. A human woman in a surgeon's apron was setting a fracture in the corner, her hands fast, the patient biting a leather strap. A Varrek \u2014 the only Varrek you had seen on the Kingsrun \u2014 was at a desk near the far wall, maintaining records with the methodical density that Varrek brought to everything.","","And at the center of the room, standing beside a bed where a Gorundai sailor was having chest bandages changed, was Oursseva Denn.","","She was tall. Thalessi tall \u2014 six feet, the lean angular frame, the tapered ears, the skin a warm bronze that caught the clinic's light. Her hair was silver-white, pulled back in a simple tie, the length reaching mid-back. She was 208 years old. The age showed in the way Thalessi age showed \u2014 not in decay but in economy. Every movement was calibrated. Every gesture served a purpose. The hands changing the Gorundai sailor's bandages moved with the precision of someone who had been doing this for longer than most of the patients had been alive.","","She wore a clinic coat. White, long-sleeved, stained at the cuffs with the accumulated evidence of a hundred treatments. A leather belt at the waist held instruments \u2014 scissors, forceps, a thin blade in a sheath. No jewelry. No insignia. Nothing that said authority except the way the room organized itself around her presence.","","*set met_oursseva true","","*if (crew4_name = \"Terrek Ghaal\")","  The stretcher team brought Terrek through the clinic door. Two Khari carriers and you \u2014 you had taken one end of the stretcher, carrying the cook from the dock through the clinic's triage path, through the overflow patients on the porch, through the corridor of waiting injured to the treatment floor.","","  Oursseva Denn looked up.","","  The assessment was instant. Her eyes went to Terrek \u2014 the splint, the swelling, the two-day-old injury and the field treatment. Then her eyes went to you. Not to the horns, the build, the ash-white skin, the storm-leather coat. To the hands. The hands that were holding the stretcher. The captain who had carried his crew member into the clinic instead of sending someone else.","","  \"Tibia fracture. Right leg. Splinted in the field \u2014 competent work. Two days without proper setting.\" She spoke the way Thalessi spoke \u2014 complete sentences, precise, the words chosen as if each one cost something. \"Set the stretcher here.\"","","  She pointed to a treatment area near the east wall. A space cleared by the Khari medics \u2014 two cots pushed apart to make room, the floor swept, instruments already laid on a cloth-covered tray.","","  \"The splint held.\" She examined the binding. Adjusted her spectacles \u2014 they had slid down from the heat. \"If it had been poorly done \u2014 which it wasn't \u2014 we'd be discussing amputation.\" She looked at you again. \"Who did the field work?\"","","*if (crew4_name != \"Terrek Ghaal\")","  *if (crew3_name = \"Kessara Veldt\")","    Kessara walked in under her own power. The broken wrist held against her chest, the splint visible, the two days of one-handed engineering written in her bearing. She walked to the triage desk and presented the injury with the directness of a Rathai who considered waiting in line a design flaw.","","    Oursseva Denn looked up from the Gorundai sailor's bandages. Her eyes went to the wrist. Then to you \u2014 standing beside Kessara, present, the captain who had walked his crew member into the clinic instead of staying on the ship.","","    \"Distal radius fracture. Splinted. How many days?\"","","    \"Two.\" Kessara. Direct.","","    \"The splint is adequate. The bone will need imaging and possible resetting.\" Oursseva's voice was Thalessi-measured. \"Who applied the field treatment?\"","","*if (crew5_name = \"Sullavenne Ohn\")","  \"Sullavenne Ohn.\" The former Wardensea officer was behind you, at the clinic doorway. \"Wardensea field medical training. Second \u2014\" She stopped. The word \"Division\" sat in her mouth for a half-second longer than it should have. \"Second Division.\"","","  Oursseva Denn's hands paused. The bandage she was wrapping went slack for a half-second. She retightened it. The adjustment was precise. The pause had not been.","","  \"Wardensea field training includes tibia splinting as standard curriculum.\" Her voice was level. Her hands resumed their work \u2014 but the left one had moved to the bandage scissors, and the scissors were already where they needed to be, and the hand stayed there an extra second before finding something else to do. \"The training is competent.\"","","  Sullavenne didn't respond. Her hand went to the scar on her jaw. She caught it. Put it down. Oursseva saw the movement. Oursseva saw everything.","","  She returned to the bandages. The clinic resumed around both of them.","","*page_break","","The treatment took two hours.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek's leg was reset. The procedure was precise and ugly \u2014 Oursseva's hands manipulating the bone through swollen tissue, the sound of cartilage adjusting, Terrek's face going grey and back. He didn't scream. The Gorundai determination held through the worst of it. He gripped the cot frame with both hands and the frame creaked under the pressure and the Khari medic holding his knee looked at the frame with the worried concern of someone who maintained the clinic's furniture.","","  The proper splint went on \u2014 molded resin over padded cloth, fitted to the leg's exact geometry. Oursseva shaped it herself. The Thalessi precision was physical here \u2014 her hands knew angles, knew bone architecture, knew the exact requirements of a Gorundai tibia that was denser than a human's and healed at a different rate.","","  \"Four weeks before weight-bearing. Six weeks before full use. If you walk on this before four weeks, you will re-fracture the tibia and the second break will be worse.\" She looked at Terrek with the expression of a physician who had said this sentence a thousand times and had watched patients ignore it seven hundred of those times. \"The bone knows what it needs. Your job is to not contradict it.\"","","  \"I can cook sitting down,\" Terrek said. He'd said it every day since the break. He would probably say it to anyone who'd listen until the bone healed.","","  \"I have no doubt.\" Oursseva adjusted the splint's final strap. \"You can cook sitting, standing, or inverted, provided the leg remains elevated and immobile.\" She paused. \"That was a joke. Thalessi humor is subtle. Don't cook inverted.\"","","  Terrek stared at her for a second. Then he laughed \u2014 loud, surprised, the sound bouncing off the clinic walls. Two patients looked over. A Khari medic dropped a tray.","","*if (crew4_name != \"Terrek Ghaal\")","  *if (crew3_name = \"Kessara Veldt\")","    Kessara's wrist was imaged \u2014 a Varrek-designed device that used low-frequency Dominion resonance to map bone structure through tissue. The image confirmed: clean break, distal radius, no displacement beyond what the field splint had prevented.","","    Oursseva reset the bone. Kessara watched her own wrist being manipulated with the focus of an engineer observing a mechanical procedure. She asked questions. \"The angle of the reset \u2014 is that compensating for the radius curvature or the ulnar deviation?\" Oursseva answered each one. Two professionals in adjacent fields recognizing each other's competence.","","    The proper cast went on. Kessara examined it with her good hand. \"Resin composite. Light. What's the compressive strength?\"","","    \"Sufficient to prevent you from destroying my work with your profession.\" Another fraction of Thalessi warmth.","","*page_break","","The clinic's porch was where the Kingsrun stopped pretending.","","Inside the clinic, people were patients. Outside, on the wide coral porch that wrapped the building's south and west faces, people were crews. And crews on the Kingsrun were competitors, rivals, enemies \u2014 people who would fight each other on any dock from Selvaggio to the Sundren. But at Kelvanni, they sat on the same porch, drank the same water, and waited for the same physician.","","You saw three other crews.","","A Morventhi captain with burns on both hands \u2014 the dark blue-black skin marked with the pale scarring of thermal injury, the fingers wrapped in individual dressings that made her hands look oversized. She sat against the porch rail with two crew members, one of them reading a Grimoire broadcast aloud in the low, rhythmic cadence of someone who'd grown up underground and still spoke with the echo-chamber instinct. They were from a ship called the Depthline. Freelancers, mid-route, running south on their own schedule.","","A human crew \u2014 four of them, young, early twenties, a crew that had formed at Selvaggio out of shared desperation and mutual ignorance. One had a bandaged shoulder. Another had the hollow look of someone who'd been seasick for days and hadn't fully recovered. They were quiet. The Kingsrun had already taught them that loud confidence died somewhere around Stop Three.","","And the Kindling.","","Suuba Mettani's crew occupied the porch's east section with the casual territorial confidence of a crew that had arrived first and knew it. Six of them were visible. The Kindling's crew was larger than the Sundered Wake's \u2014 eleven total, specialized, the kind of roster that a 275-million-bounty Rathai captain assembled through reputation rather than recruitment.","","Hollenne Goss was the first to see you. The human woman \u2014 thirty, dark hair, the black-market contacts in her eyes as much as in her network \u2014 looked up from a Grimoire device and tracked your approach across the porch.","","\"The half-Oni.\" She said it to the crew member beside her. The words carried. They were meant to. Hollenne Goss communicated in calculated volumes. \"Four stops in and already on the Kingsrun Watch twice. Brannach dock fight and a volcanic eruption. The mountain didn't like them and the recovery agents didn't like them either.\"","","Drossik Verath was at the porch rail. The Varrek analyst \u2014 the one who'd identified Sullavenne at Galluun's Tooth \u2014 turned his head. The assessment was Varrek: thorough, detached, filed.","","\"The Sundered Wake. Crew of \u2014 four, I think, assuming the injured one makes it. Ship\u2019s in rough shape. The ash from Brannach, the hull needs \u2014\" He waved a hand. \"Cleaning. Before Velundri. And the treasury. The treasury is \u2014\" He paused, calculating, then exhaled through his teeth. \"Not good. They're running lean.\"","","The Varrek's assessment hung in the air. Spoken at a volume that was either careless or deliberate \u2014 and nothing a Varrek did was careless. He'd read your crew like a ledger and announced the deficit to the porch. The Morventhi captain looked up. The human rookies glanced over. Hollenne Goss was watching with the expression of someone enjoying a show she hadn't paid for.","","*choice","  #Walk straight to Drossik's bench. Stand over him. Let the height and the horns and the ash-scarred coat do the talking that the silent protagonist rule says the MC can't.","    *set personality_aggression %+ 5","    *set rival_suuba + 5","","    Two hundred and sixty pounds of half-Oni crossed the porch in four strides. Drossik looked up from his Grimoire. The Varrek's grey-blue face didn't change \u2014 the race that measured everything had already measured the distance and the speed and the weight of what was approaching.","","    You stood over him. Six-seven to his seated five-ten. The shadow fell across his device. The screen dimmed under the eclipse.","","    Drossik held the gaze for three seconds. His fingers didn't move on the Grimoire. Then he adjusted his collar \u2014 the same concession-gesture you'd seen him make with Suuba \u2014 and returned to his screen.","","    \"Noted,\" he said. He typed something. You couldn't see what. But the typing was slower than before, and he didn't look up again while you were on the porch.","","    Hollenne whistled. Low. \"Bold move for a crew running lean.\" But she was grinning.","","    *goto porch_choice","","  #Ignore the assessment. Drossik can read numbers from a distance \u2014 let him. The crew's real condition isn't in the treasury. It's in the four people who've survived five stops that the Grimoire said would kill them.","    *set personality_loyalty %+ 3","","    The analysis slid off. Drossik's numbers were accurate and irrelevant. Accurate because the Varrek didn't guess \u2014 he calculated, and his calculations were probably right to the decimal. Irrelevant because the Kingsrun didn't run on treasury counts. It ran on crews that refused to quit, and the Grimoire couldn't weigh that.","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne caught your eye. The smallest nod. The intelligence officer's acknowledgment of a correct tactical decision: don't confirm the enemy's data by reacting to it.","","    *goto porch_choice","","*label porch_choice","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was on the porch. She heard Drossik's assessment and her expression didn't change. The Wardensea in her catalogued the intelligence leak \u2014 how much the Kindling's analyst had inferred from Grimoire broadcasts and observation \u2014 and filed it under threats that didn't require immediate response.","","  \"He's not wrong,\" she said to you. Quiet. \"We are running lean.\"","","*choice","  #Sit on the porch. The Kindling is here. The other crews are here. The porch is the Kingsrun's social space \u2014 the neutral ground where information flows and reputations are built face-to-face. Sitting down is a statement. It says you are here, present, and not hiding on the ship.","    *set personality_aggression %+ 3","","    You sat.","","    The porch adjusted. The way a room adjusts when someone new enters \u2014 the micro-shifts in attention, the recalculation of social geometry that happens below conscious thought. A half-Oni in a storm-leather coat, ash-white skin, ram-curved horns, the visible marks of a volcanic island and a dock fight \u2014 the cuts on the knuckles, the bandaged forearm, the held posture of someone whose body had been tested and had answered.","","    Hollenne Goss watched. The human black-market specialist had the eyes of someone who assessed value for a living \u2014 goods, people, information. She was assessing now.","","    \"You carried your crew member in.\" She said it like a fact. Because it was. \"Most captains send their first mate. Or a carrier. You carried the stretcher yourself.\"","","    She leaned back.","","    \"Suuba noticed.\"","","    The name dropped into the porch conversation. Suuba Mettani. The Kindling's captain. The Rathai with the 275-million bounty and the whale-oil stunt and the ship you had been chasing since the Grimoire first crackled with her name at Selvaggio.","","    Suuba was not on the porch. Suuba was inside the clinic \u2014 not as a patient, Hollenne clarified without being asked. As a visitor. The Kindling's captain was checking on the crews she'd passed on the way south. Kelvanni was where Suuba Mettani tracked the health of the Kingsrun's population and drew conclusions about who would still be sailing when the route got serious.","","    \"She'll want to talk to you,\" Hollenne said. \"She's been tracking your crew since Selvaggio. The Grimoire reports are interesting. A half-Oni Kingsrun captain with a Wardensea ex-officer and a Rathai engineer. That's an unusual composition. Unusual compositions either fail fast or survive everything.\"","","    *goto clinic_evening","","  #Return to the ship. The porch is social and the Sundered Wake needs work. The ash from Brannach coats every surface \u2014 the rigging, the deck, the sail. The hull needs cleaning. The supplies need inventory. The captain's job at a medical stop is not sitting on a porch. It's keeping the ship ready for the moment the crew member walks out.","    *set personality_loyalty %+ 3","","    The ship was waiting.","","    The ash from Brannach had settled into every crevice of the Sundered Wake during the two-day crossing \u2014 the volcanic particulate ground into the rope, embedded in the sail canvas, coating the deck in a fine grey layer that turned wet and gritty when the harbor water splashed over the rail. The tarp that had caught the worst of the eruption's debris was stiff with dried volcanic mud. The hull below the waterline had accumulated the mineral residue that Kessara had warned about \u2014 a film that increased drag and, if left untreated, would eat the copper sheathing.","","    The work was physical and necessary. Deck cleaning. Sail brushing \u2014 the canvas lifted and shaken, the particulate falling into the harbor in grey clouds. Rope inspection \u2014 the ash had abraded the surface fibers and weakened three of the primary sheets. The tarp replaced with the spare from the hold, the volcanic-damaged one folded for use as patching material.","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne worked beside you. The two of you cleaned the ship the way a two-person crew cleaned a ship \u2014 methodically, silently, the division of labor implicit. She took the rigging. You took the hull.","","      \"The other crews are on the porch.\" She said it while retying a halyard. \"The porch is where the Kingsrun does its social business. Intelligence, reputation, alliance. We're missing it.\"","","      She tied the knot. Checked it.","","      \"But the ship matters more. The porch will still be there when the ship is clean.\"","","    The Khari of Warren Kaelith came by twice. The first time, a young canine runner brought fresh water \u2014 a courtesy for crews at dock, the warren's contribution to the clinic's operation. The second time, an older Khari \u2014 forties, the fur-patterned face marked with the fine lines of a life spent outdoors \u2014 paused at the berth and looked at the Sundered Wake.","","    \"Ash ship. Brannach.\" The assessment was casual. The Khari could read a hull's history the way they read a path. \"The hull needs cleaning. We have coral brushes \u2014 designed for the reef, but they work on volcanic residue. Three Copper Bits for the set.\"","","    The brushes were worth it. Coral fiber, stiff and abrasive without being destructive \u2014 a tool that a Khari warren on a medical island would develop because ships arrived damaged and ships needed to leave functional and the warren's business was keeping the clinic running.","","    *if (sovereigns >= 1)","      *set sovereigns - 1","","    *goto clinic_evening","","*label clinic_evening","","*page_break","","The evening at Kelvanni was quiet.","","Not the quiet of an empty place. The quiet of a full place that had decided, collectively, to stop talking. The clinic's lights burned \u2014 oil lamps along the porch, the warm glow reaching the dock and the ships and the dark water of the harbor. The patients who could move sat outside. The patients who couldn't were visible through the windows, shapes in beds, the slow movement of the medical staff between them.","","The Grimoire broadcast came at dusk.","","Veshanna Torc. The Kingsrun Watch. The signal was strong at Kelvanni \u2014 the relay station on the island's north point boosted the frequency, and the broadcast came through clean and clear in a way it hadn't since Selvaggio.","","\"Kingsrun Watch. General update. Five crews confirmed at or past Stop Five. Standings: the Kindling leads \u2014 Suuba Mettani's crew is resupplying at Kelvanni, no injuries, strong position. The Sundered Wake \u2014 half-Oni captain \u2014 arrived at Kelvanni today with an injured crew member. Volcanic eruption at Brannach. They're getting treatment.\"","","A pause.","","\"The Inheritors remain docked at Brannach. The Regrade's repair timeline has been extended following the eruption \u2014 scaffolding collapse, hull work reset to zero. Kovesse Thrallek's crew is rebuilding. No confirmed departure date.\"","","Another pause. Longer. The quality of silence that said the next piece of information was different.","","\"News from the deep Kingsrun. Tomoe Gallacs \u2014 the Gannet Crew \u2014 has been confirmed at Stop Nine. Ossengaard. The Wardensea fortress. Details are scarce, but the Gannet Crew passed through Ossengaard's inspection without incident. That's significant. Ossengaard logs every ship. The Gannet Crew has been logged. The Wardensea now has Tomoe's position, her crew composition, and her heading. Whatever advantage anonymity gave her is gone.\"","","The broadcast continued:","","\"Bounty update from the MEAB: The Kindling's Suuba Mettani has been adjusted upward to 290 million following the Brannach approach incident. The Sundered Wake's captain \u2014\" A pause. \"\u2014 remains unregistered. Zero bounty. Four Kingsrun Watch appearances and no bounty means the MEAB hasn't decided what to do with the half-Oni yet. For the viewers at home: that's either very good or very bad, and I genuinely don't know which.\"","","*set broadcast_count + 1","*set latest_broadcast \"kelvanni_standings\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne listened to the broadcast from the ship's rail. When it ended, she looked south. The dark water. The ocean that continued past Kelvanni to Velundri and Durromakh and Ossengaard and the places where the Kingsrun stopped being a competition and started being a gauntlet.","","  \"Ossengaard. Stop Nine. The Wardensea fortress.\" She said it with the heavy weight of someone who had worn the white coat. \"Every ship logged. Every crew member identified. Every bounty cross-referenced. Ossengaard is where the Kingsrun's casual entries end and the serious runners begin.\"","","  She looked at you.","","  \"We have four stops before Ossengaard. Four stops to decide what kind of crew we are when the Wardensea reads our names.\"","","*if (crew4_name = \"Terrek Ghaal\")","  From the clinic, through the open window, the sound of Terrek's voice. He was talking to someone \u2014 the words indistinct, the tone warm, the Oni volume reduced to clinic-appropriate levels. He'd found another patient to talk to. Or another patient had found him. The cook who filled silences was filling them in a hospital bed, sitting up, his broken leg elevated, his voice reaching the dock in fragments that sounded like someone telling a story about food.","","The night settled on Kelvanni. The clinic's lights held. The harbor held its eleven ships. The porch held its wounded crews.","","Tomorrow: the Debt Ledger. Oursseva Denn's price for the healing. One favor, owed to the clinic, honored by every crew that had ever passed through. The debt was not money. The debt was a promise. And Kelvanni collected promises the way the mountain at Brannach collected pressure \u2014 patiently, thoroughly, and with the absolute certainty that the promise would eventually be needed.","","The Sundered Wake held its berth. The Kingsrun held its course. The ocean was dark and the clinic was lit and somewhere south of the horizon, Velundri waited with its weight-scales and its intelligence trade and the information that would decide what happened next.","","*goto_scene ch5_kelvanni_debts",""], "labels":{"porch_choice":216,"clinic_evening":276}},
"ch5_kelvanni_debts": {"crc":-1394157983, "lines":["*comment ===================================================","*comment  CHAPTER 5, SCENE 2 \u2014 KELVANNI: DEBTS","*comment  The Debt Ledger. Suuba face-to-face. Route intel.","*comment  Romance thread acceleration.","*comment ===================================================","","*comment ---------------------------------------------------","*comment  MORNING \u2014 THE DEBT LEDGER","*comment ---------------------------------------------------","","Morning at Kelvanni started with the smell of antiseptic and boiling linen.","","The clinic's laundry operation ran on the east porch \u2014 three Khari medics working through the overnight sheets, the fabric heavy with sweat and wound drainage, the water in the copper tubs going grey within minutes. The smell reached the harbor. The harbor had learned to ignore it.","","You woke on the Sundered Wake's deck. The ship held its berth at the outer pier \u2014 the berth they'd earned by arriving with an injured crew member, which at Kelvanni was both a priority marker and an announcement. Every crew in the harbor knew the Sundered Wake had someone in the clinic. Every crew in the harbor had done the same math: one member down, small crew, captain stretched thin.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was already awake. The broken wrist was splinted clean \u2014 Oursseva's work, the bandaging precise, the splint material a lightweight coral composite that the Thalessi physician had shaped to Kessara's forearm with the attention of someone who understood that an engineer's wrist was not a decorative appendage. Kessara was testing range of motion, her face tight with professional assessment.","","  \"Twelve degrees short of \u2014\" She rotated the wrist. Winced. Rotated it again. Winced again. \"Eleven. No. Twelve. I keep hoping the number will change if I check it enough.\" She flexed her fingers. \"Good enough for tiller work. Bad for rigging. Bad for everything that matters.\"","","*if (crew4_name = \"Terrek Ghaal\")","  From the clinic's open windows, Terrek's voice carried. The cook had spent the night in the treatment ward \u2014 the broken leg elevated, the proper cast set by Oursseva's staff, the pain managed with whatever the clinic used for pain management. Terrek's response to hospitalization had been to befriend every patient within earshot. The sound of his voice was warm, loud in the way Gorundai were loud even when they were being quiet, and punctuated with the rhythms of someone telling a story that involved food.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was at the ship's rail, watching the clinic's porch. She'd been there when you fell asleep. She might have been there all night. Her coat was buttoned \u2014 every button, the collar straight, the Wardensea dress regulation she couldn't stop following. She was watching the clinic door. Her notebook was in her hand, open to a blank page. She hadn't written anything on it. The page had been blank all night.","","*page_break","","The Debt Ledger ceremony happened at midmorning.","","It was not formal. It was not grand. Oursseva Denn sat at a desk on the clinic's west porch \u2014 the quieter side, away from the laundry, where the coral platform met the water and the sound of the harbor was muffled by the building's bulk. A leather-bound book lay open in front of her. The pages were dense with handwriting \u2014 names, dates, debts owed, debts honored. The book was thick. Two hundred years of entries. The ink at the bottom of the older pages had faded to the color of rust.","","Three crews had appointments before the Sundered Wake. You watched from the porch rail as each captain approached, sat across from Oursseva, and had the same conversation.","","The terms were simple. Oursseva spoke them with the economy of someone who had said them ten thousand times and meant every word:","","\"The clinic healed your crew member. The clinic does not charge.\" She turned a page. The page was already turned. She turned it back. \"One favor. Undefined. Called when I call it. No violence. No illegality beyond \u2014\" She paused. The corner of her mouth moved. It might have been amusement. \"Beyond your current status, which I understand is already somewhat flexible.\"","","Every captain accepted. The Debt Ledger had never been refused. Not because the terms were generous \u2014 they were fair \u2014 but because the alternative was arriving at Kelvanni next season with an injured crew member and finding the clinic door closed. Oursseva had never closed the door. The possibility that she might was enough.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne stood three steps behind you. Close enough to hear. Far enough to pretend she was just standing. Her hands were behind her back \u2014 the Wardensea rest position she defaulted to when her body needed something to do that wasn't visible.","","Your turn.","","Oursseva looked up from the ledger. The assessment was the same as yesterday \u2014 direct, unhurried, calibrated. She took in your height, the horns, the coat, the hands. The hands she'd noticed yesterday. The hands that had carried a crew member into the clinic.","","\"Captain.\" Her voice carried the Thalessi precision \u2014 every syllable earning its keep. \"Your crew member is responding well to treatment.","*if (crew4_name = \"Terrek Ghaal\")","  The tibia fracture will require four to six weeks of limited mobility. He will not be standing on that leg at Velundri. Possibly not at Durromakh.","*if (crew4_name != \"Terrek Ghaal\")","  *if (crew3_name = \"Kessara Veldt\")","    The wrist will require three to four weeks of restricted use. She is already exceeding the restrictions I set. This is predictable for a Rathai engineer. You may inform her that if she re-breaks the alignment I will splint her entire arm to her torso and she will spend Velundri learning to eat left-handed.\"","","She turned the ledger toward you.","","\"The terms are the same as every crew that has come before you. One favor. Undefined. Called when it is called. Within your capability. Without requiring violence or illegality beyond what the Kingsrun already provides.\" A pause. The specific Thalessi pause that meant the next words were chosen with care. \"I ask you to understand that I have been running this clinic for sixty-seven years and I have never called a favor that damaged the crew that owed it. I have called favors that were inconvenient. Inconvenience and damage are different categories.\"","","*set clinic_debt_owed true","","She wrote in the ledger. Your name, the date, the crew. The pen was a thin metal instrument \u2014 Thalessi craftsmanship, the kind that cost more than the book it wrote in. The handwriting was small, precise, and identical to the entries above it. Sixty-seven years of the same hand.","","\"You carried your crew member into the clinic yourself.\" She said it as she wrote. \"Captains who do that tend to honor their debts. Captains who send someone else tend to need reminding.\"","","*if (crew5_name = \"Sullavenne Ohn\")","","  Oursseva's pen stopped.","","  She looked past you. At Sullavenne. The gaze held for three seconds \u2014 long enough to be deliberate, short enough to be deniable. Then she returned to the ledger, wrote the final line, and closed the book.","","  \"Your crew is welcome to use the clinic's porch and water supply for the duration of your stay. The east side is for medical operations. The west side is for everyone. Please do not confuse the two.\"","","  She stood. She walked inside. She did not look at Sullavenne again.","","  Sullavenne's hands had not moved from behind her back. She stood there for thirty seconds after Oursseva left. Her jaw worked once, twice \u2014 the muscle jumping under the scar. She took out her notebook. Wrote one word. The pen pressed hard enough to dent the next page. She closed the notebook. Put it away. Straightened the collar of her coat, though the collar was already straight. Her hands, behind her back again, were fists.","","*page_break","","*comment ---------------------------------------------------","*comment  MIDDAY \u2014 SUUBA METTANI","*comment ---------------------------------------------------","","The porch at midday was full.","","Eleven ships in harbor meant eleven crews rotating through the clinic's neutral zone \u2014 the west porch, the water barrels, the benches that lined the coral-stone wall. The smell of the laundry operation had shifted from antiseptic to clean linen. The Khari medics had switched from washing to hanging \u2014 lines of white sheets across the porch supports, creating a maze of fabric that divided the space into accidental rooms.","","You were sitting on the porch's south bench when Suuba Mettani walked out of the clinic's front door.","","She was shorter than expected. Rathai short \u2014 five foot one, compact, the body of someone who'd grown up in the Nettleworks' assembly blocks and had never lost the density that came from carrying industrial equipment since childhood. Dark hair cut to jaw length, practical, the kind of cut that said hairdressing was a time expense she'd eliminated. Brown skin. Brown eyes that moved fast \u2014 Rathai fast, the processing speed of a species that thought in schematics and talked in comma splices.","","She was wearing a sleeveless work shirt, dock trousers rolled at the calf, and boots that had been resoled twice. No armor. No visible weapon. The only indication that this was a 290-million-bounty captain was the Grimoire device strapped to her left forearm \u2014 modified, the casing cracked and re-welded with improvised metalwork that said the user had been repairing their own equipment since before they could afford to pay someone else to do it.","","*set met_suuba true","","She saw you.","","\"You're the half-Oni.\"","","She said it already walking, already filling a clay cup at the water barrel, already drinking half of it. Rathai didn't pause between thoughts. The thoughts happened and the body happened and if the two overlapped that was everyone else's problem.","","\"Brannach eruption crew. Grimoire footage. Khellen says the lighting was terrible but the composition was dramatic, which is his way of saying he's jealous he didn't film it.\" She drank the rest of the water. Refilled. Drank again. Then she looked at the cup like she'd forgotten she was holding it.","","\"Sorry. I haven't eaten today. I keep drinking water instead because water doesn't require decisions and I've already made four hundred decisions since dawn.\" She set the cup down. Picked it up again. \"Five hundred.\"","","\"I'm Suuba. You know that. Everyone knows that. The bounty makes introductions redundant, which is the one advantage of having a number attached to your face.\" She refilled the cup. \"Your engineer's got a broken wrist or your cook's got a broken leg \u2014 I heard both versions. Either way you're running a crew of four with one compromised. Velundri's three hundred and ten miles south. Four to five days fair wind, seven to ten adverse. You can't make that run short-handed without pushing your ship past what the ash damage already did to the hull.\"","","She looked at your ship. The Sundered Wake, visible at the outer pier, the Brannach ash still visible in the hull seams.","","\"So either you stay here long enough to get your crew member functional, which costs you four to six weeks and the Kingsrun moves on without you. Or you leave Kelvanni with a compromised crew and hope the weather cooperates.\" She shrugged. \"Or there's a third thing, which is the thing I'd do, which is recruit someone here. Kelvanni's got overflow \u2014 injured crew members whose captains left without them, freelancers who came south looking for a ship and haven't found one. You could fill your roster.\"","","*choice","  #Let her talk. She's offering information freely \u2014 take it.","    You sat. Suuba talked. It was what Rathai did \u2014 they filled silence with data the way other races filled it with pleasantries, and Suuba's data was good.","","    She talked for twenty minutes. The porch traffic moved around them \u2014 crews coming and going, the Khari medics hauling laundry, a Morventhi sailor with a bandaged shoulder trying to flirt with the Varrek records clerk, failing measurably. Suuba talked through all of it.","","    *set personality_aggression %- 3","","    What she gave away:","","    Velundri was a weight-trade market. No currency. Goods weighed against each other on Varrek-calibrated scales. The system was precise, fair, and merciless \u2014 counterfeit weight meant ship seizure, full stop, no appeal. \"Don't try to cheat the scales. The Varrek who designed the system are still alive and they take it personally.\"","","    Beyond Velundri was Durromakh. Stop Seven. Cassara Vellune's toll gate. A Morventhi woman, 134 years old, 660-million bounty frozen under a negotiated tolerance with the Masqarat. She charged passage by tonnage. She'd destroyed six ships in sixty years and left the wreckage visible as advertising. \"Pay the toll. Everyone pays the toll. The people who don't pay the toll are the wreckage.\"","","    Beyond Durromakh was the stretch that killed crews \u2014 Shoalfields to Ossengaard. Wardensea patrol density peaked. The water cooled. The weather shifted from tropical to something harder. \"The Kingsrun stops being fun at Stop Seven. It stops being survivable at Stop Nine for anyone who hasn't prepared.\"","","    Ossengaard. The fortress. Every ship logged, every crew identified, every bounty cross-referenced. Three Commandants. A rotating High Command presence. And the Kingsrun Passage Log \u2014 every captain asked the same question by Belvaan Orech, the garrison commander: \"Where are you going, and is it worth dying for?\"","","    \"I'm going to lie to him,\" Suuba said. Then: \"Not about where I'm going. About the dying part. It's worth dying for. Obviously. But I'm not telling a Wardensea officer that because \u2014\" She drank water. \"Because he'd write it down and someone would use it against me later. That's how institutions work. You give them a true thing and they file it under 'leverage.'\"","","    She looked at you.","","    \"You've got an ex-Wardensea officer on your crew. That's either the best preparation for Ossengaard or the worst. Depends on whether the Wardensea considers her a defector or a wash-out. Defectors get special attention.\"","","    *goto suuba_end","","  #Match her pace. Trade information back \u2014 what was seen at Brannach.","    You leaned forward.","","    Suuba registered the shift. Her eyes sharpened \u2014 Rathai recognized transactional body language the way Khari recognized path markers. She sat down on the bench opposite, the water cup balanced on her knee.","","    *set personality_aggression %+ 3","    *set rival_suuba + 5","","    You had information she wanted. Brannach. The eruption. The Inheritors. Information traveled on the Kingsrun the way currency traveled in Velundri \u2014 by weight, and your Brannach experience had weight.","","    The trade happened in the way trades happened between Rathai and everyone else \u2014 fast, specific, reciprocal. Suuba gave route intelligence. You gave Brannach ground truth.","","    What you traded:","","    The eruption's lateral blast origin. The fissure network instability. The Regrade's scaffolding collapse and Kovesse Thrallek's repair timeline \u2014 not weeks, possibly a full season. The Inheritors were stuck. Your crew had helped them during the eruption, pulling scaffolding debris while dock crews ran.","","    What Suuba gave back:","","    \"Velundri's weight-trade is fair if you're honest and fatal if you're not. Counterfeit weight means ship seizure. The Varrek take it personally.\" Durromakh's toll \u2014 Cassara Vellune, 134, Morventhi, 660-million bounty, passage charged by tonnage, six ships destroyed in sixty years, wreckage left visible. \"Pay the toll. Don't negotiate. The negotiation is the wreckage.\" And Ossengaard \u2014 the fortress, the log, the three Commandants, and the question every captain answered: \"Where are you going, and is it worth dying for?\"","","    \"The Kovesse information is useful,\" Suuba said. She was already recalculating. Rathai recalculated constantly \u2014 new data in, updated model out, the process as automatic as breathing. \"The Inheritors stuck at Brannach changes the middle Kingsrun. Their absence opens a gap between Stop Five and Stop Nine that the rest of us will fill. The question is who fills it better.\"","","    She looked at you with the narrow Rathai expression that meant she was running a cost-benefit analysis on whether to say the next thing.","","    \"You helped them. During the eruption. That's interesting. Most captains would have cast off and counted the advantage.\" She paused. \"I would have cast off. Drossik would have told me to help. He'd have been right. I'd have cast off anyway.\" A small Rathai smile \u2014 fast, honest, gone. \"That's why he's my first mate. He's right about the things I'm wrong about. Which is approximately forty percent of things, according to his tracking spreadsheet, which he maintains and updates weekly.\"","","    *goto suuba_end","","*label suuba_end","","*if (crew5_name = \"Sullavenne Ohn\")","  Suuba looked past you toward the ship. Sullavenne was visible on the Sundered Wake's deck \u2014 she'd moved from the rail to the rigging, checking the lines with the focused attention of someone who didn't want to be on the porch while Suuba Mettani was holding court.","","  \"Sullavenne Ohn,\" Suuba said. \"Second Division intelligence. Discharged four years ago.\" She saw your reaction \u2014 or absence of reaction, which told her more. \"I know because Drossik identified her at Galluun's Tooth. Varrek memory for faces \u2014 he cross-referenced her against the Wardensea's public discharge records. Don't worry, the records don't say why she was discharged. They just say she was.\"","","  She stood up.","","  \"My crew's heading south tomorrow. The Kindling's resupplied and rested. You'll see us again at Velundri or you won't. Either way \u2014\" She tossed the clay cup in a short arc, catching it behind her back without looking, a piece of Nettleworks muscle memory that had nothing to do with combat and everything to do with growing up in a factory district where you caught what you could or it broke. \"\u2014 I'm glad you came through the eruption. The Kingsrun's better when the interesting crews survive.\"","","She walked away. Rathai-paced \u2014 fast, efficient, already onto the next thing before the current thing was finished. Drossik Verath was waiting at the porch steps. He had two cups of water \u2014 one for himself, one held out at the angle Suuba would be walking. She took it without looking. He'd known the angle. The water didn't spill.","","They argued before they reached the dock. The sound carried \u2014 Suuba's voice rapid and Drossik's measured, the words indistinct but the cadence unmistakable. Halfway down the pier, Drossik said something that made Suuba stop walking. She turned. Said something short. He adjusted his collar \u2014 the Varrek equivalent of conceding a point. They kept walking. Closer together than before.","","*page_break","","*comment ---------------------------------------------------","*comment  AFTERNOON \u2014 CREW AND MAINTENANCE","*comment ---------------------------------------------------","","The afternoon was practical.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara worked. The broken wrist limited her to left-handed operations, which meant she was running at sixty percent efficiency, which for Kessara was still faster than most engineers running at full. She assessed the Brannach ash damage \u2014 the hull seams, the rigging wear, the rudder chain that had been grinding since the eruption's lateral blast had shaken the ship from keel to masthead.","","  \"Fourteen items,\" she said. Her inventory voice \u2014 flat, technical, stripped of everything except data. \"Six I can fix here with one hand. Four I can fix if someone holds things. Four need materials I don't have.\" She looked at you. \"We need pitch, canvas, and two lengths of galvanized chain. The clinic's supply stores might have pitch. The chain I don't know.\"","","  *set ship_condition + 10","","*if (crew4_name = \"Terrek Ghaal\")","  *if (crew3_name != \"Kessara Veldt\")","    The ship needed work. The Brannach ash damage was visible in the hull seams and the rigging, and without a dedicated engineer you and the remaining crew spent the afternoon on basic maintenance \u2014 scrubbing ash from the deck seams, checking the rigging tension, inventorying the stores. The work was slower than it should have been. The absence of a full crew showed in the pace.","","    *set ship_condition + 5","","*if (crew4_name != \"Terrek Ghaal\")","  *if (crew3_name != \"Kessara Veldt\")","    The ship needed work. Without a dedicated engineer or a cook to share the labor, the afternoon's maintenance fell to you and Oursseva \u2014 the physician applying her precise hands to tasks she hadn't trained for, and you applying strength to problems that needed finesse. Ash scrubbed from seams. Rigging tightened by guesswork. The work was rough and slow.","","    *set ship_condition + 3","","The Warren Kaelith Khari were everywhere. The canine Khari medics ran the clinic's external operations with pack efficiency \u2014 triage, patient transport, supply runs, laundry, water distribution, and the particular brand of warm territorial management that characterized canine Khari social structure. They moved in pairs. They communicated in short barks of speech and hand signals that you had learned to read over the past day: palm up meant safe, fist meant priority, three taps on the shoulder meant incoming patient. The system was faster than words.","","One of the Khari medics \u2014 a young woman with the rust-brown fur and wide-set eyes of a coastal canine Warren \u2014 stopped by the Sundered Wake's berth. She brought a clay pot sealed with wax.","","\"Pitch compound,\" she said. Fast, warm, the path-metaphors lacing even technical speech. \"For your hull seams. The clinic keeps it for ship repair \u2014 crews that stay for treatment usually need it. The road breaks everything, including boats.\" She looked at the ship's waterline. \"You've got fissure damage in the \u2014 port side? Starboard.\" She squinted. Walked three steps to the right. \"Starboard. Sorry. I keep mixing those up. I'm a medic, not a \u2014\" She gestured at the harbor in general. \"Boat person.\" She closed her eyes. \"Sailor. The word is sailor. I know the word.\" A Khari medic at the next berth looked over. The young woman's ears had gone flat against her head. \"The point is your lower strakes. The volcanic grit works into the seam calking and eats it from inside. This compound will hold until Velundri. After Velundri \u2014\" She shrugged. \"After Velundri you're in cold water and the compound sets harder. Better seal in cold.\"","","*set supplies + 5","","The afternoon settled into the rhythm of a ship in port \u2014 work punctuated by rest, rest punctuated by the sounds of a crowded harbor doing the same. The Kindling's crew was visible on their ship two piers over, running their own maintenance with the coordinated efficiency of an eleven-person crew that had been doing this together for long enough that the choreography was unconscious. Suuba's crew worked like a machine. The Sundered Wake's crew worked like people \u2014 slower, messier, getting it done through effort instead of practice.","","*comment ---------------------------------------------------","*comment  EVENING \u2014 THE CONVERSATION","*comment ---------------------------------------------------","","*page_break","","The evening was different.","","The porch cleared after dusk. The day crews went to their ships or to the harbor's single tavern \u2014 a low stone building at the dock's north end that served warm grain spirit and fish stew and didn't ask questions. The night crews stayed: the patients who couldn't sleep, the medics on rotation, and the captains who had something on their mind that darkness made easier to carry.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne found you on the west porch.","","  She brought two cups of the clinic's tea \u2014 the herbal mixture that the Khari brewed in large batches and left in pots along the porch rail, available to anyone, the taste somewhere between medicinal and tolerable. She set one cup beside you and took the bench opposite, sitting with the careful posture of someone who wanted to appear casual and hadn't practiced it enough.","","  The clinic's oil lamps cast the porch in amber. The harbor was dark beyond the lamplight. The sound of water against coral \u2014 steady, patient, the sound that Kelvanni was built on.","","  \"She didn't recognize me.\" Sullavenne said it to the harbor. \"Or she did and it didn't matter. I'm not sure which is worse.\"","","  She drank. The tea was too hot. She drank it anyway.","","  \"Four years ago I intercepted a supply manifest for this clinic. A hundred and twenty crates of medical equipment \u2014 bandaging, surgical instruments, pharmaceutical compounds, sterilization materials. Routed through the Second Division's logistics chain because the direct shipping route was compromised by weather. My CO decided the supplies represented an unauthorized transfer of military assets to a civilian operation. They weren't military assets. They were medical supplies that happened to be on a military ship.\"","","  She set the cup down.","","  \"He dumped them. At sea. A hundred and twenty \u2014 I was on the bridge. I had the codes. The cargo hold codes, the manifest was \u2014 it was my operation. My name on it. I could have locked the hold. I could have just\u2026\" She stopped. Started again, quieter. \"I filed a complaint. Instead of locking the hold, I filed a fucking complaint.\"","","  The harbor was quiet.","","  \"Three patients at this clinic died that month from conditions that the supplies would have treated. I learned that later. After the discharge. After my CO made it clear that the complaint was received and the person who filed it was not valued.\" She touched the scar on her jaw \u2014 the one she'd shown the crew at Brannach. The reminder from someone who'd felt the complaint was personal. \"The Wardensea discharged me for insubordination. The supplies stayed at the bottom of the ocean. The three patients stayed dead.\"","","  She looked at you.","","  \"I came to Kelvanni because I owed her an explanation. I got a look and a sentence about porch etiquette.\" She almost smiled. \"Thalessi. They don't give you the satisfaction of your own guilt. They file it and move on.\"","","  *set crew5_loyalty + 5","","  *choice","    #Stay. The silence between them held what words wouldn't.","      You stayed on the bench. The tea cooled. The harbor moved its tides against the coral platform. The oil lamps shifted in the breeze \u2014 the shadows on the porch lengthened and shortened in slow alternation, the light touching Sullavenne's face, the scar, the hands that held an empty cup.","","      She didn't speak again. She didn't need to. The confession had been the purpose. The staying was the response. An hour passed in the specific silence of two people who understood that presence was a form of speech and the sentence being spoken was: I heard you.","","      *set personality_openness %+ 5","      *set crew5_romance + 10","      *set crew5_loyalty + 5","","      When Sullavenne stood, she picked up both cups. She walked to the porch rail and emptied them over the side \u2014 the tea into the dark water, a small gesture that closed a conversation without ending it.","","      \"Thank you.\" She said it with her back turned. \"For staying.\"","","      She walked to the ship. You watched her go. The porch held its lamplight. The clinic held its patients. The Kingsrun held its course.","","      *goto night_close","","    #Stand. Walk to the rail. The harbor is dark and there is work to do tomorrow.","      You stood. The bench shifted. Sullavenne watched the movement \u2014 the decision to leave registered in the set of her mouth, the small recalibration of someone who had offered something and received a boundary in return.","","      The boundary was not rejection. It was timing. You walked to the porch rail and looked south \u2014 the dark water, the harbor's edge, the open ocean that continued past Kelvanni to Velundri and the places where the Kingsrun stopped being about survival and started being about choices made under pressure.","","      *set personality_openness %- 3","      *set crew5_loyalty - 3","","      Sullavenne stayed on the bench. She finished her tea. She did not follow.","","      When you returned to the ship, Sullavenne was already in her bunk. The berth was quiet. The crew was asleep. The evening had deposited its conversation on the porch and the conversation would wait \u2014 the way conversations on ships always waited, carried forward by proximity and repetition until they found their moment or died of neglect.","","      *goto night_close","","*if (crew5_name != \"Sullavenne Ohn\")","  *if (crew3_name = \"Kessara Veldt\")","    Kessara found you on the west porch.","","    She'd finished working for the day. The broken wrist was wrapped in a clean bandage \u2014 Oursseva's staff had re-dressed it during an afternoon check, replacing the morning's wrapping with fresh material and a stern Thalessi reminder about overuse. Kessara had listened to the reminder with the expression of someone cataloguing technical feedback for later optimization.","","    She sat beside you without asking. Rathai didn't ask. They assessed available seating, calculated proximity preferences, and acted.","","    \"The ship needs four things I can't source here.\" She said it to the harbor. Rathai processed anxiety through work talk \u2014 if the hands couldn't be busy, the brain filled the gap. \"Galvanized chain for the rudder assembly. Canvas for the jib patch. Caulking fiber for the lower strakes. And someone who can climb the mainmast to check the cap fitting, because I can't climb one-handed and you're too heavy for the upper rigging.\"","","    She paused. The pause was unusual for a Rathai. Kessara in particular did not pause \u2014 she transitioned between topics with the seamless efficiency of someone who considered silence a design flaw.","","    \"I lied. The ship needs five things.\" She looked at you. \"The fifth thing is time. Three weeks of maintenance that we don't have. The hull took volcanic grit into the seam calking at Brannach. The compound the Khari gave us will hold until Velundri. After Velundri \u2014 cold water, higher seas, the kind of conditions that find every weakness in a ship and test it.\" She held up her broken wrist. \"I can't do the work this needs with this. And I won't pretend I can, because pretending leads to sinking, which is a design outcome I reject.\"","","    *set crew3_loyalty + 5","","    The harbor was quiet. The oil lamps gave the porch a warmth that the coral stone didn't hold \u2014 Kelvanni's nights were mild, the latitude and the ocean currents keeping the temperature stable, a maritime mildness that made it possible to sit outside in a sleeveless shirt and not think about it.","","    \"I was a yard engineer before this.\" She said it differently. The work voice was gone. Something underneath it \u2014 still Rathai in cadence, still direct, but the pitch shifted lower and the speed came down. \"Torval yards. North Orenthas. We built packet ships for the coastal trade \u2014 fast hulls, shallow draft, designed for the reef channels between the northern islands. I was good at it. I was very good at it.\"","","    She rotated the broken wrist. Slowly. Testing the edge of the pain the way she'd test the edge of a tool.","","    \"The yard closed. The Kolmari consolidated the northern routes and the packet trade dried up. Dessima Keth \u2014 the yard master, the woman who taught me how to read a hull by sound \u2014 she didn't survive the closure. Not in the way that matters.\" Kessara's voice was even. Rathai didn't decorate grief. They reported it. \"I came south because the Kingsrun was the only place where a shipwright without a yard could still build something.\"","","    She looked at you.","","    \"This ship is not what I would have built. It's what I have. And I will keep it sailing until the ocean takes it or I do.\" She stood up. \"That's not a speech. That's a maintenance report. Goodnight.\"","","    *set crew3_romance + 10","    *set crew3_loyalty + 5","","    She walked to the ship. Her left hand \u2014 the good one \u2014 trailed along the hull as she passed it. The gesture was automatic. An engineer touching her ship. The contact lasted three seconds. It said everything her speech hadn't.","","    *goto night_close","","*label night_close","","*comment ---------------------------------------------------","*comment  NIGHT CLOSE \u2014 KELVANNI SECOND NIGHT","*comment ---------------------------------------------------","","The second night at Kelvanni settled with the weight of a place that had heard too many confessions to be surprised by any of them.","","The clinic's lights held. The harbor held its eleven ships. The porch held its medics and its insomniacs and the settled gravity of a neutral zone where people told the truth because the alternative was carrying it across three hundred miles of open ocean to Velundri and arriving heavier than they'd left.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek's voice carried from the clinic. Quieter now. The late-night voice \u2014 the one that told stories slowly, the words spaced for listeners who were falling asleep and wanted something warm to carry them into it. The cook who fed people had found another way to feed them. The broken leg kept him in bed. The bed couldn't keep him quiet.","","*set days_since_departure + 1","*if (food_days > 0)","  *set food_days - 1","*if (sovereigns >= 1)","  *set sovereigns - 1","","The Kindling would leave tomorrow. Suuba's crew, resupplied, rested, uninjured \u2014 the contrast with the Sundered Wake was a comparison the Grimoire broadcasts loved and captains hated. Two crews. One running clean and one running ragged. The ocean would decide which approach held.","","*if (crew5_name = \"Sullavenne Ohn\")","  Tomorrow you would decide: stay for the crew member's recovery, or leave and push south with what you had. The conversation on the porch had not changed the calculation. But it had changed the weight. Sullavenne's debt to Oursseva was older than the Kingsrun. Your debt to the clinic was fresh. Two debts, stacked. The Kingsrun collected them.","","The night was warm. The harbor was still. The Kingsrun held its course, south and south and south, toward Velundri and the weight-trade and the toll gate and the fortress and the ocean that didn't care about debts or confessions or crews that stayed on porches too long.","","Tomorrow: the decision. Stay or go. Heal or risk. The Kingsrun didn't wait.","","*goto_scene ch5_kelvanni_crisis",""], "labels":{"suuba_end":165,"night_close":321}},
"ch5_kelvanni_crisis": {"crc":-55456302, "lines":["*comment ===================================================","*comment  CHAPTER 5, SCENE 3 \u2014 KELVANNI: CRISIS","*comment  Wardensea patrol. Neutral zone tested.","*comment  Moral choice. Grimoire cliffhanger.","*comment ===================================================","","*comment ---------------------------------------------------","*comment  MORNING \u2014 THE THIRD DAY","*comment ---------------------------------------------------","","The third morning at Kelvanni began with a sail on the northern horizon.","","White canvas. Single mast. The shape was wrong for a merchant \u2014 too narrow, too upright, the hull cutting the water instead of riding it. The kind of ship built for speed and jurisdiction. The kind of ship that flew a flag with a word written on the back.","","The Kindling had left at dawn. Suuba's crew had cast off in the grey light, the eleven-person operation moving with the coordinated silence of people who had done this together enough times that departure was muscle memory. Drossik Verath had been at the helm. Suuba had been at the bow, facing south, already moving past Kelvanni in her head before the mooring lines cleared the water. The Sundered Wake's crew had watched from their berth. The gap between the two crews \u2014 one running clean, one running injured \u2014 had widened by the length of a ship and the distance of a heading.","","Now the gap was a sail, and the sail was Wardensea.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne saw it first. She was on the ship's deck, coiling lines \u2014 the hands-busy work that ex-intelligence officers defaulted to when their brain needed something to process. She stopped mid-coil. Her eyes were on the sail. The line went slack in her hands.","","  \"Second Division cutter.\" She said it flat. Professional. Then her voice caught. \"Twelve crew. One \u2014 no. Thirteen. Twelve and an officer.\" She corrected herself the way she corrected everything \u2014 immediately, annoyed at the error. \"Patrol range \u2014 they're out of Ossengaard's southern circuit, which means they've been running the Kingsrun stops for provisioning or personnel recovery.\" She paused. \"Or both.\"","","  She looked at you.","","  \"Personnel recovery means they're looking for someone. The Second Division doesn't send cutters to resupply \u2014 they use cargo runners. A cutter at Kelvanni means they have a name and they think the name is here.\"","","The cutter was twenty minutes from the dock. Twenty minutes to decide how the Sundered Wake would meet the Wardensea at a medical station.","","*choice","  #Stay visible. On the porch. On the dock. Let the Wardensea see exactly who's here \u2014 a half-Oni captain with no bounty, no charges, and no reason to hide. Visibility is its own kind of armor.","    *set personality_aggression %+ 3","","    You stayed on the porch. The bench. The open posture of someone who had nothing to conceal and the size to make concealment pointless anyway. The horns were visible from the harbor approach. Good. Let the white coats count them.","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne's eyes cut to the harbor approach, then back. \"You're making yourself a landmark.\" She adjusted her coat collar. \"Fine. If they're focused on you, they're not scanning the deck for me.\" She moved toward the ship. Casual. The walk of someone going nowhere in particular, at the exact pace of someone going somewhere specific.","","    *goto harbor_shifts","","  #Pull the crew together. Secure the ship. Whatever the Wardensea wants, the Sundered Wake should look like a crew with discipline and a captain who's been paying attention.","    *set personality_loyalty %+ 4","","    *if (crew3_name = \"Kessara Veldt\")","      Kessara closed the cargo hatch. Secured the tool kit. Stowed the loose rigging that had been drying on the rail since yesterday. In three minutes the Sundered Wake looked like a ship that expected company and had dressed for it.","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne went below deck without being told. The motion was fluid \u2014 one moment on the rail, the next gone, the hatch closing behind her with the practiced silence of someone who had been disappearing from Wardensea sight lines for four years.","","      Her voice came through the deck boards. Muffled. \"If they board, tell them I'm seasick. They'll check the crew manifest \u2014 if they have one \u2014 and find three names instead of four. Seasick explains the absence.\"","","    *goto harbor_shifts","","  #Go to the clinic. Find Oursseva. Whatever's coming, the Thalessi physician has been handling the Wardensea at her door for sixty-seven years. She should know before the cutter docks.","    *set personality_mercy %+ 3","    *set personality_openness %+ 3","","    Oursseva was in the east wing. You found her changing a dressing on a Gorundai patient's shoulder \u2014 the same precise hands, the same instrument belt, the same clinical focus that treated everything as a medical problem regardless of what else it was.","","    She looked up when you entered. The Thalessi eyes \u2014 two hundred and eight years of reading people \u2014 took in your expression and did not ask what was wrong. She already knew. The clinic had windows. The windows faced the harbor.","","    \"I saw the sail.\" She returned to the dressing. \"A cutter. Second Division markings. They dock in fifteen minutes.\"","","    She tied off the bandage. Adjusted her spectacles.","","    \"I have been meeting the Wardensea at my door since before you were born, Captain. Possibly before your mother was born.\" She straightened. \"Thank you for the warning. It was unnecessary and therefore appreciated.\"","","    *if (crew5_name = \"Sullavenne Ohn\")","      You returned to the ship. Sullavenne was already below deck. She'd read the cutter's approach and made her own decision about visibility.","","    *goto harbor_shifts","","*label harbor_shifts","","The harbor shifted. Eleven ships and the crews that sailed them \u2014 the calculus changed when a Wardensea cutter entered a neutral zone. The clinic's porch, which had spent three days as a space where rivals coexisted, tightened. Conversations dropped. Crews that had been sitting in the open moved to their ships. The Morventhi freelancers on the Depthline pulled their ensign \u2014 the flag that identified their ship as a registered vessel \u2014 and replaced it with a plain pennant. The human rookies did nothing, because they had no bounty and nothing to hide. The Warren Kaelith Khari continued their work with the deliberate calm of a medical operation that did not recognize military jurisdiction.","","*page_break","","The cutter docked at the clinic's main pier.","","It was a clean vessel \u2014 narrow beam, shallow draft, the hull painted Wardensea grey with a white stripe at the waterline. The word JUSTICE was painted across the stern in the blocky font that the Wardensea used for everything: sans-serif, the kind of lettering that said the institution did not negotiate with serifs. The crew was twelve \u2014 eight sailors and four in officer's white. The coats were the standard cut: long, buttoned, the weight of authority in the fabric.","","The lead officer stepped onto the dock.","","She was Human. Mid-thirties. Brown hair pulled back tight, the style that said regulation and meant it. A Lieutenant's insignia at the collar \u2014 two silver bars, the Wardensea crest between them. She carried a leather document case under her left arm and nothing in her right hand. The right hand was deliberate \u2014 empty, visible, a signal that said this was administrative, not combative. Behind her, the three junior officers spread across the dock in the pattern that Wardensea officers spread in: casual, spaced, covering exits without appearing to cover exits.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was below deck. She'd gone below the moment the cutter's heading confirmed it was making for the pier. You could hear her moving \u2014 the berth's boards creaking as she settled into the position of someone who intended to stay out of sight for as long as sight was dangerous.","","Oursseva Denn met the Lieutenant on the porch.","","The Thalessi physician had changed nothing about her appearance or her schedule. The clinic coat. The instrument belt. The silver-white hair in its simple tie. She stood at the porch entrance \u2014 the boundary between the dock and the neutral zone \u2014 with the rigid posture of a woman who had been meeting Wardensea officers at her door for sixty-seven years and had not once offered them tea.","","\"Lieutenant.\" Oursseva's voice carried. The Thalessi precision \u2014 audible at distance without being raised. \"Kelvanni is a medical facility operating under the Oursseva Accord. Your crew is welcome to receive treatment. Your authority to inspect this facility does not extend past the porch threshold without a medical emergency or a signed warrant from a Division Commander.\"","","The Lieutenant stopped. She opened the document case.","","\"Doctor Denn. Lieutenant Revenne Kassik, Second Division, Ossengaard Circuit.\" Her voice was Wardensea-professional \u2014 rank-aware, procedure-laden, the cadence of someone who lived inside regulations and found them comfortable. \"I have a signed recovery order for a specific individual believed to be receiving treatment at this \u2014\" She glanced at the document. Back up. \"\u2014 at this facility. The order is from High Commandant Belvaan Orech. I am not here to inspect. I am here to recover a member of the Wardensea who has been absent from duty for thirty-one days.\"","","She held out the document.","","Oursseva did not take it. She read it from where she stood \u2014 Thalessi eyes, 208 years of reading, the distance between them irrelevant.","","\"Ensign Vellic Marr. Third Division. Absent without authorization from Ossengaard garrison, thirty-one days.\" Oursseva said it aloud. The porch heard it. The harbor heard it. She was making the name public, which meant she was establishing the scope \u2014 one name, one person, one specific claim of jurisdiction. \"Ensign Marr is a patient at this clinic. He arrived eleven days ago with a fractured collarbone and secondary infection. He is receiving treatment.\"","","\"I'm aware he's injured, Doctor. The recovery order accounts for medical transport.\"","","\"The recovery order accounts for your authority. It does not account for his condition.\" Oursseva's voice did not change. The precision was the weapon. \"Ensign Marr is in treatment. Moving him before the infection resolves risks sepsis. Sepsis in a patient with a compromised immune response \u2014 his Third Division medical records indicate chronic Dominion burnout from sustained Armoring overuse \u2014 has an eighteen percent mortality rate. I will not discharge a patient into conditions that carry an eighteen percent chance of killing him.\"","","The Lieutenant's stylus stopped.","","\"Doctor, the recovery order is legally binding.\"","","\"And my clinical assessment is medically binding. The law and the body rarely agree on timeline. I have found, in sixty-seven years, that the body wins.\"","","Oursseva turned to a Khari medic who'd been hovering with a tray of instruments. \"The sutures for bed four need re-sterilizing. The left-hand drawer, third cabinet.\" She turned back to the Lieutenant. \"Apologies. You were explaining the law to me.\"","","*page_break","","*comment ---------------------------------------------------","*comment  THE COMPLICATION","*comment ---------------------------------------------------","","The standoff held for an hour.","","The Lieutenant stationed her junior officers at the dock \u2014 two at the pier, one at the harbor approach, one on the cutter. Administrative positioning. The message was clear: the Wardensea was here, the Wardensea was staying, and the Wardensea would wait. Lieutenant Kassik remained on the porch, the document case on the bench beside her, her posture the trained patience of an institution that had never been in a hurry in its existence.","","The clinic continued to operate. The Khari medics moved through the porch traffic with the deliberate indifference of people who dealt with injuries, not politics. Patients were treated. Bandages were changed. The laundry operation ran its cycle. The Wardensea cutter at the dock was a fact, and Kelvanni's medical staff treated facts the way they treated patients \u2014 acknowledged them, assessed their severity, and moved on to the next one.","","But the harbor was wrong.","","The crews that had spent three days coexisting on the porch were gone. Ships that had been open \u2014 hatches up, crew on deck, the casual posture of vessels in a safe harbor \u2014 were closed. The Morventhi Depthline had rigged for departure, their crew pulling anchor chain through the capstan in the slow, deliberate rhythm of people who wanted to leave without looking like they were fleeing. Two of the smaller ships \u2014 the human rookies and a Varrek trading vessel \u2014 had already moved to the harbor's outer edge, increasing the distance between themselves and the Wardensea cutter by two hundred yards.","","The neutral zone was intact. Nobody had drawn a weapon. Nobody had raised a voice. But the space that Oursseva's sixty-seven years had built \u2014 the space where Wardensea and Renegade sat on the same porch \u2014 was emptying. The Lieutenant's presence was doing what her orders hadn't: breaking the clinic's neutrality by existing near it.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne emerged at midmorning. She came up from below deck the way she came up from everything \u2014 vertical, controlled, her bearing reset to the trained neutrality that hid everything underneath.","","  \"Revenne Kassik.\" She said it to you, standing at the ship's rail, watching the porch. \"I served with her. She was a year behind me in the Second \u2014\" She stopped. Started again. \"She follows orders because she believes in the system they come from. That makes her dangerous in a way that corrupt officers aren't \u2014 you can buy a corrupt officer. You can't buy \u2014\" She gestured at the cutter. \"That.\"","","  She was quiet for a moment.","","  \"Vellic Marr.\" She said the name like she was checking it against something. \"Don't know him. Third Division \u2014 that's Zuharro's, not Merrique's. An Ensign, so he's \u2014 young. Has to be young.\" She looked at the cutter. \"Thirty-one days. He deserted at Ossengaard and worked his way south, or caught a ride, or \u2014 doesn't matter. The point is they sent a full cutter for him. A cutter. For one Ensign.\" She shook her head. \"AWOL Ensigns are paperwork. You don't send thirteen people for paperwork. Either Marr knows something he shouldn't, or somebody wants him back for reasons that aren't anywhere in that order.\"","","You could see Vellic Marr through the clinic's east window. A young man \u2014 twenty, maybe twenty-two \u2014 lying in a bed near the wall, his left arm strapped across his chest, the collarbone splint visible beneath the clinic gown. He was Human. Pale. Thin in the way that illness makes people thin, the body consuming itself in the slow arithmetic of infection. He was awake. He was watching the porch through the window, and his good hand was pulling at the edge of the clinic blanket \u2014 small repetitive tugs, the fabric already frayed where he'd been pulling it for eleven days. His mouth was moving. Not speaking. Counting, maybe, or rehearsing something he'd never get to say.","","*page_break","","*comment ---------------------------------------------------","*comment  THE CHOICE","*comment ---------------------------------------------------","","The decision arrived at noon.","","Lieutenant Kassik stood from the bench. She straightened her coat. She walked to the clinic's front door. Oursseva Denn was inside \u2014 visible through the doorway, attending to a patient, her back to the entrance. The Lieutenant's hand was on the door frame.","","\"Doctor Denn. I have waited the courtesy hour. The recovery order is legally binding. I am entering the facility to recover Ensign Marr. Any obstruction of a lawful recovery operation is \u2014\"","","\"Obstruction is a legal term. Patient care is a medical term. I will not repeat which one takes precedence in this building.\"","","The Lieutenant's hand stayed on the door frame. The junior officer behind her shifted \u2014 a half-step forward, the instinctive support movement that Wardensea officers trained into their bodies. The Khari medic at the doorway \u2014 a large male, canine, rust-brown fur, the same warren as the woman who'd brought the pitch compound \u2014 moved into the doorway. He didn't speak. He stood in the frame. The position said everything his voice didn't.","","The porch had five people on it. You. The Lieutenant. The junior officer. The Khari medic. And Oursseva Denn, inside, her back still turned, her hands still working.","","*choice","  #Step between the Lieutenant and the doorway. The clinic's neutrality holds.","    You moved.","","    Two hundred and sixty pounds of half-Oni filled the doorway beside the Khari medic. The Lieutenant looked up \u2014 she had to look up, you were a foot taller and the horns added three inches beyond that. The storm-leather coat. The ash-white skin. The ram-curved horns. The hands that had carried a crew member into this clinic two days ago and were now placed flat on either side of the door frame, blocking it.","","    The Lieutenant assessed. Wardensea officers were trained to assess \u2014 threat level, Dominion presence, escalation probability. She read your Armoring. The Tempered-tier density in the skin was visible if you knew what to look for, and Wardensea officers knew what to look for.","","    \"Civilian obstruction of a Wardensea recovery operation.\" She said it the way she said everything \u2014 procedure, regulation, the manual. \"This will be noted.\"","","    \"Note it.\" Oursseva's voice came from inside the clinic. She had not turned around. \"Note everything. Your Division has always been thorough with its records and selective with its conscience.\"","","    *set personality_aggression %+ 3","    *set personality_mercy %+ 5","    *set rep_wardensea - 10","    *set rep_renegade + 10","","    The Lieutenant held your gaze for five seconds. Then she stepped back. The junior officer stepped back. The half-step they'd gained was surrendered to a half-Oni in a doorway and a Thalessi physician who hadn't bothered to turn around.","","    \"We will remain docked until the patient is discharged.\" Kassik's voice was level. Professional. The anger was administrative \u2014 buried in future paperwork, future reports, future consequences that would arrive at Ossengaard in Lieutenant Kassik's handwriting. \"The recovery order stands. When Doctor Denn's medical assessment changes, we will be here.\"","","    She returned to the bench. She sat. She opened the document case and began writing.","","    *if (crew5_name = \"Sullavenne Ohn\")","      You returned to the ship. Sullavenne was at the rail. She had watched the entire exchange from the deck \u2014 close enough to see, far enough to stay unrecognized. She was gripping the rail with one hand. The other was at her side, opening and closing. She saw you and the hand stopped.","","      \"You stood in a doorway against a Wardensea Lieutenant.\" She said it evenly. \"The last person who did that at a medical facility was me. I filed a complaint. You used your body.\" She looked at the clinic. \"Yours worked better.\"","","    *set kelvanni_favor \"protected_clinic\"","","    Oursseva Denn did not come to the porch. She did not acknowledge you. She continued treating her patient \u2014 the Gorundai sailor with the chest bandages, the one she'd been working on when the Lieutenant had reached for the door. The acknowledgment, if it existed, was in the silence. In the continued operation. In the clinic that kept running because someone had stood in its doorway.","","    *goto crisis_aftermath","","  #Stay at the rail. This is between the Wardensea and the clinic \u2014 not your fight.","    You stayed.","","    The Lieutenant entered the clinic. The Khari medic stepped aside \u2014 he was medical staff, not security, and the recovery order was a legal document backed by a Division Commander's signature. Oursseva Denn turned. She watched Lieutenant Kassik walk to Vellic Marr's bed. She watched the young man's face collapse \u2014 the eleven days of waiting compressed into the five seconds of confirmation.","","    \"Ensign Marr. You are ordered to return to Ossengaard garrison under escort. Medical transport has been arranged. You will be treated en route.\" Kassik said it with the trained compassion of an institution that had a procedure for everything, including the delivery of bad news.","","    Marr didn't speak. His good hand \u2014 the one not strapped across his chest \u2014 gripped the bed frame hard enough to bow the wood. He was twenty-two. He was afraid. He was going back.","","    *set personality_aggression %- 3","    *set personality_mercy %- 3","","    Oursseva supervised the transfer. Her clinical standards did not bend for jurisdiction \u2014 she insisted on medical handover protocols, a written condition summary, a transport brace for the collarbone, and a three-day supply of pharmaceutical compounds. The transfer took forty minutes. The Lieutenant waited through every minute with the patience of someone who understood that Oursseva Denn's cooperation was worth more than Oursseva Denn's enmity.","","    Vellic Marr was carried to the cutter on a stretcher. He passed the porch. He passed your ship. His eyes found you \u2014 the half-Oni at the rail, the captain who had been on the porch for three days and had stayed at the rail while a twenty-two-year-old was carried back to the institution he'd run from.","","    The look lasted two seconds. It said nothing. It said everything.","","    *set kelvanni_favor \"stayed_neutral\"","","    The cutter departed at midafternoon. The white sail shrank against the northern horizon. The harbor exhaled. The crews that had retreated to their ships emerged. The porch filled. The neutral zone reformed around the absence \u2014 the way water fills a hole, the way silence fills a room after a door closes.","","    Oursseva stood on the porch. She watched the sail disappear. Then she looked at your ship. The gaze held for one second. Then she turned and went inside.","","    The one second was not neutral. It was a Thalessi physician's clinical assessment of a captain who had been present during a crisis and had chosen to be absent from it. The diagnosis was filed. The record was permanent.","","    *goto crisis_aftermath","","  #Move to the dock. Place yourself where the Lieutenant's junior officers can see you clearly \u2014 every horn, every inch. Draw their attention. Draw their count. Make the Wardensea calculate you instead of the clinic.","    You walked to the dock.","","    The movement was deliberate. Two hundred and sixty pounds of half-Oni walking past the clinic, past the porch, past the Lieutenant's position \u2014 walking toward the pier where the Wardensea cutter was docked and the junior officers were stationed. You stopped ten feet from the nearest officer. Stood. The full height. The horns. The coat. The Tempered Armoring visible in the light \u2014 the dark sheen on the forearms, the density that said this body had been in fights and had developed the physical response that the Wardensea trained its officers to recognize and classify.","","    The junior officer looked at you. Then looked at his partner. The partner looked at you. The assessment was automatic \u2014 Wardensea officers catalogued. Height, build, race, visible Dominion expression, estimated threat level. A half-Oni with Tempered Armoring standing ten feet from their vessel was a data point that required attention.","","    \"Identify your \u2014\" The junior officer's hand went to his belt, missed the signal device, found it on the second try. \"Identify yourself.\" His voice was young. Twenty-five, maybe. He'd rehearsed this. The rehearsal hadn't included someone your size.","","    *set personality_aggression %+ 5","    *set rep_wardensea - 5","","    You stood. The silence was your voice \u2014 the choice not to answer, not to identify, not to cooperate, not to resist. Just to exist, visibly, at the Wardensea's perimeter, drawing resources away from the clinic door and toward the dock.","","    The junior officer's hand moved to his belt. The signal device. A small copper tube connected to the cutter's communication array. He pressed it once \u2014 the short pulse that said attention needed. The second junior officer moved from the harbor approach to the pier. The positioning shifted: two officers now focused on you, one at the harbor, one with the Lieutenant on the porch. The clinic door was unmonitored.","","    *if (crew5_name = \"Sullavenne Ohn\")","      You didn't see what happened next. But Sullavenne saw it from the ship's deck, and she would describe it later with the trained precision of someone who had run intelligence operations and recognized one when she saw it.","","      While the junior officers calculated you, the Khari medic at the doorway moved Vellic Marr. The transfer was medical \u2014 a stretcher carried by two Warren Kaelith members from the treatment floor to the clinic's west wing, through the recovery ward, through the back corridor that connected to the supply rooms. The supply rooms had a door that opened onto the coral platform's south face. The south face was below the dock's sightline.","","      By the time Lieutenant Kassik entered the clinic to recover Ensign Marr, the bed was empty and the chart was filed under a different name.","","    *if (crew5_name != \"Sullavenne Ohn\")","      What happened inside the clinic happened without your awareness. But the result was visible an hour later: Lieutenant Kassik emerged from the clinic with an expression that had lost its professional calm. The patient she'd come to recover was not in the bed. The chart was filed under a different name. The Khari medics expressed polite confusion. Oursseva Denn expressed clinical regret.","","    The Lieutenant searched the clinic for two hours. She did not find Vellic Marr. The Warren Kaelith's warren system \u2014 the network of paths and tunnels that canine Khari maintained across every island they operated on \u2014 had channels that the Wardensea's patrol manual did not map.","","    Kassik returned to the dock. She looked at you \u2014 the half-Oni who had stood at her officers' perimeter and drawn their attention at the exact moment the clinic had needed it drawn. The look was not friendly. The look was the Wardensea's institutional memory logging a face, a name, a decision.","","    \"Your ship. The Sundered Wake.\" She read it from the hull. \"This will be in my report.\"","","    She boarded the cutter. The cutter departed. The sail shrank north.","","    *set kelvanni_favor \"distracted_wardensea\"","    *set rep_wardensea - 15","    *set rep_renegade + 15","","    *if (crew5_name = \"Sullavenne Ohn\")","      Sullavenne met you on the dock after the cutter cleared the harbor.","","      \"That was an intelligence operation. You didn't plan it. The Khari planned it \u2014 they were waiting for someone to draw the perimeter. You drew it.\" She looked at you with an expression you had not seen from her before. Respect without calculation. \"The Wardensea will have your name in their Kingsrun file now. Lieutenant Kassik is thorough. She'll write the report at Ossengaard and Belvaan Orech will read it.\"","","      She paused.","","      \"At Ossengaard. Stop Nine. Where we'll be sitting in front of the man who signed the recovery order, and he'll know your face.\"","","    *goto crisis_aftermath","","*label crisis_aftermath","","*page_break","","*comment ---------------------------------------------------","*comment  EVENING \u2014 THE BROADCAST","*comment ---------------------------------------------------","","The afternoon passed in the fragile quiet of a harbor recovering from a held breath.","","The porch refilled. The crews returned. The neutral zone reassembled itself from the pieces the Wardensea had scattered by existing near it \u2014 slower than before, the edges rougher, the trust rebuilt in the way that broken things are rebuilt: functional but aware of the break. The Khari medics resumed their rotations. The laundry operation hung its final sheets. The clinic's lights came on at dusk, and the amber glow reached the harbor the way it always did, the way it had for sixty-seven years.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek's voice carried from the clinic. He was telling a patient about the gorrash \u2014 the highland bread \u2014 and getting the recipe wrong. You could tell because he kept correcting himself: \"Ash flour, not barley \u2014 wait, ash flour and barley \u2014 no, my mother would kill me.\" The patients laughed. Terrek laughed. The laughter sounded like something he was giving them because nobody else had thought to bring any. The cook who couldn't walk had found the one thing he could do from a bed, and he'd been doing it all day.","","The Grimoire broadcast came at dusk.","","Veshanna Torc. The Kingsrun Watch. The signal was strong \u2014 the relay station on Kelvanni's north point, the same clean frequency as the previous nights. The broadcast tone was different. The intro was shorter. Veshanna's voice had the clipped edge it got when the news outweighed the format.","","\"Kingsrun Watch. Priority broadcast.\"","","Conversations dropped mid-word along the dock. Someone's cup clinked against stone in the silence.","","\"Confirmed report from the mid-Kingsrun relay network. Kuldhara Mabaan \u2014 the Living Storm \u2014 has moved.\"","","*set broadcast_count + 1","*set latest_broadcast \"kuldhara_movement\"","","\"Thunderhead warband vessels confirmed south of the Sennaku Highlands, moving along the mid-Kingsrun corridor between Stops Eight and Eleven. Three patrol ships \u2014 Gorreth Mabaan's Thunder's Son command, Shavellen Durr's Seabreak, and one unidentified vessel. The warband has not engaged any Kingsrun traffic. Repeat: no engagements. But the Thunderhead's patrol pattern has shifted. They're wider. Further south than usual. The Storm is watching more water than she normally watches.\"","","A pause. The broadcast quality of pause that meant the next information changed the frame.","","\"For the Kingsrun crews currently between Stops Five and Eight: Kuldhara Mabaan's expanded patrol means you will pass through her observation range. The Living Storm watches passing crews. If she likes what she sees, they pass. If she doesn't \u2014\"","","Veshanna let the silence hold for three seconds.","","\"\u2014 the weather changes. That's not metaphor. Her Raiju Fruit's Awakened state links the atmospheric conditions within a ten-mile radius to her emotional state. If Kuldhara is interested in your crew, you will know because the sky will tell you.\"","","Another pause. Shorter.","","\"The Wardensea's Second Division has not responded to the Thunderhead's shift. Merrique Sevaine is maintaining standard patrol density at Ossengaard. This is either strategic patience or resource limitation. The Kingsrun Watch does not speculate. The Kingsrun Watch reports.\"","","The broadcast ended.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was at the rail. Her hands were on the wood \u2014 both of them, flat, the knuckles white. Her face was still. But the hands had moved before the face had decided what to do.","","  \"Kuldhara Mabaan. The Oni Conqueror. Sennaku Highlands.\" She said the words the way she said everything tactical \u2014 clean, sorted, each piece laid out for analysis. \"Her territory includes the waters between Stops Eight and Twelve. Normal patrol range is Stops Nine through Eleven. She's expanded south \u2014 Stops Eight through Eleven \u2014 which puts her observation range directly across our path after Velundri.\"","","  She looked at you.","","  \"You're from the Sennaku Highlands.\"","","  It was a fact she'd known since your unfinished tattoos had told her at Selvaggio. The highland ink. The festival lines that stopped halfway \u2014 either the money ran out or the welcome did.","","  \"Kuldhara Mabaan controls the territory you were exiled from. When we pass through her waters, she will see an Oni ship \u2014 or a ship with Oni crew. She will look closer. And when she looks closer, she will see a half-Oni captain with Sennaku tattoos who left the highlands and hasn't been back.\"","","  She let that settle.","","  \"That's either the most dangerous thing about the next five stops or the most valuable. It depends on why you left and whether Kuldhara cares about the reason.\"","","The night settled on Kelvanni. The third night. The last night \u2014 you could feel it in the harbor's rhythm, the way the ships were positioning for departure, the way the crews were running final supply checks in the lamplight. The Wardensea cutter was gone. The Kindling was gone. The neutral zone had held, or cracked, or been proven \u2014 depending on what had happened at the clinic door \u2014 and the harbor was processing the aftermath the way harbors processed everything: with work, and silence, and the specific gravity of people who lived on the water and understood that every port was temporary.","","*set days_since_departure + 1","*if (food_days > 0)","  *set food_days - 1","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne's final report of the night was delivered at the rail, facing south.","","  \"Velundri is four to five days south. Fair wind. The weight-trade market. After Velundri \u2014 Durromakh, Cassara Vellune's toll gate. After Durromakh \u2014 Shoalfields. After Shoalfields \u2014\" She paused. \"Ossengaard. Where the Wardensea logs every ship and Lieutenant Kassik's report will be waiting.\"","","  She looked at you.","","  \"And between Durromakh and Ossengaard, Kuldhara Mabaan's expanded patrol. The Storm. The Oni Conqueror. The woman who controls the highlands you left.\"","","  The ocean was dark. The relay station's light pulsed on the north point \u2014 a slow amber flash, the Grimoire signal that connected Kelvanni to the world and the world to the Kingsrun.","","  \"We leave tomorrow. We leave with a debt to the clinic, a name in the Wardensea's file, and a Conqueror between us and the halfway point.\" She almost smiled. \"The Kingsrun gets harder from here. That's not a warning. That's a navigation report.\"","","The night held. The clinic held. The harbor emptied its breath into the dark water and the dark water carried it south, toward Velundri and the weight-trade and the toll gate and the fortress and the storm.","","The Sundered Wake held its berth. Tomorrow it would leave. Tomorrow the ocean would take them south, past the weight-scales and through the toll and under the eyes of a Conqueror who watched the water with the patience of a woman who had been born in the highlands and never left.","","You had been born in the highlands and had left.","","The Kingsrun would decide if that mattered.","","*comment --- Consolidated faction standing updates ---","*if (rep_wardensea >= 50)","  *set wardensea_standing \"Ally\"","*if (rep_wardensea >= 20)","  *if (rep_wardensea < 50)","    *set wardensea_standing \"Favorable\"","*if (rep_wardensea > 0)","  *if (rep_wardensea < 20)","    *set wardensea_standing \"Noticed\"","*if (rep_wardensea = 0)","  *set wardensea_standing \"Unknown\"","*if (rep_wardensea > (0 - 20))","  *if (rep_wardensea < 0)","    *set wardensea_standing \"Suspicious\"","*if (rep_wardensea > (0 - 50))","  *if (rep_wardensea <= (0 - 20))","    *set wardensea_standing \"Hostile\"","*if (rep_wardensea <= (0 - 50))","  *set wardensea_standing \"Enemy\"","","*if (rep_renegade >= 50)","  *set renegade_standing \"Legend\"","*if (rep_renegade >= 20)","  *if (rep_renegade < 50)","    *set renegade_standing \"Respected\"","*if (rep_renegade > 0)","  *if (rep_renegade < 20)","    *set renegade_standing \"Known\"","*if (rep_renegade = 0)","  *set renegade_standing \"Nobody\"","*if (rep_renegade < 0)","  *set renegade_standing \"Distrusted\"","","*if (rep_khari_warrens >= 50)","  *set khari_standing \"Honored\"","*if (rep_khari_warrens >= 20)","  *if (rep_khari_warrens < 50)","    *set khari_standing \"Welcome\"","*if (rep_khari_warrens > 0)","  *if (rep_khari_warrens < 20)","    *set khari_standing \"Tolerated\"","*if (rep_khari_warrens = 0)","  *set khari_standing \"Outsider\"","*if (rep_khari_warrens < 0)","  *set khari_standing \"Unwelcome\"","","*goto_scene ch6_velundri_market",""], "labels":{"harbor_shifts":72,"crisis_aftermath":275}},
"ch6_velundri_market": {"crc":-1303438300, "lines":["*comment ===================================================","*comment  CHAPTER 6, SCENE 1 \u2014 VELUNDRI: WEIGHT-TRADE MARKET","*comment  Arrival at Velundri. Weight-trade market (no","*comment  currency \u2014 goods weighed against goods). Resupply.","*comment  Information overload \u2014 planted intelligence.","*comment ===================================================","","*comment ---------------------------------------------------","*comment  APPROACH \u2014 THE FLAT HORIZON","*comment ---------------------------------------------------","","*set current_stop 6","*set current_stop_name \"Velundri\"","*set days_since_departure + 4","*if (food_days >= 4)","  *set food_days - 4","*if (food_days < 4)","  *set food_days 0","*set total_sea_days + 4","","The ocean was flat in a way you had never seen flat before.","","Four days south of Kelvanni, the Bastion Sea stopped pretending to have features. No swells. No whitecaps. No current lines visible in the surface. The water was a single shade of blue-black that stretched in every direction, and the horizon was a perfect circle, and the ship sat at the center of that circle like a coin on a plate.","","*if (crew3_name = \"Kessara Veldt\")","  \"Doldrums window,\" Kessara said. She was at the helm, reading the anemometer \u2014 the wind gauge she'd built from scrap brass and a piece of sail linen at Brannach. The spinner wasn't spinning. \"Zero wind. The technical term is 'becalmed.' The practical term is \u2014\" She tapped the spinner. Tapped it again. \"\u2014 we're stuck.\"","","  She looked at the water. At the glass-smooth surface that reflected the sky so perfectly the ship appeared to be floating between two skies.","","  \"The Velundri corridor is \u2014 this is a known thing. The Gannavar charts have a doldrums belt marked between 5 and 6. Dead air, dead water, two to three days depending on \u2014 or four. Four, sometimes. The Bastion Sea does this thermal \u2014 warm surface, cold deep, and the vertical mixing just...\" She waved her hand. Waved it again, harder, like she could push the explanation out of the air. \"The wind is gone. That's the short version. The long version involves thermodynamics and I'm too angry for thermodynamics.\"","","The crew rowed. Two hours on, two hours off. Kessara and you on the oars \u2014 the Rathai was half your size and pulled three-quarters your stroke, the efficiency of a body that had been lifting engine parts since childhood. Terrek cooked and rowed. Sullavenne rowed and watched the horizon through a spyglass she'd acquired at Kelvanni, scanning south for the first sign of land or current.","","The rowing was brutal. Not because of the effort \u2014 your highland body was built for effort, the arms and shoulders and back that had hauled iron in the Sennaku mines \u2014 but because of the emptiness. The ocean offered nothing to look at. No birds. No fish jumping. No other sails. The world had been reduced to a circle of water and a sky that was the same color as the water and a ship that wasn't moving fast enough to feel it.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek rationed. The food days were counted \u2014 he'd told you the number that morning, the same way he'd told the number every morning since Selvaggio. A Gorundai accounting of what was left and what it cost and how long it would hold. The number was low. Not desperate. But the margin between \"enough\" and \"not enough\" had been shrinking since Brannach, and four days of minimal progress on the open ocean hadn't helped.","","  He cooked smaller portions. The crew noticed. Nobody said anything. The ship food was still better than what most crews ate at full ration \u2014 Terrek's skill stretched ingredients the way Kessara's skill stretched hull integrity. But the gap between quality and quantity was widening.","","*page_break","","*comment ---------------------------------------------------","*comment  VELUNDRI \u2014 FIRST SIGHT","*comment ---------------------------------------------------","","On the fifth morning, Sullavenne saw it.","","\"Land.\" One word. She was at the bow with the spyglass. \"South-southwest. Low profile. Flat.\"","","The crew came forward. The spyglass passed from hand to hand. Through the lens: a white line on the horizon. Thin. Barely visible against the blue-white sky. No elevation. No trees. No structure. A line.","","Velundri.","","The island resolved over the next three hours as the current \u2014 finally, mercifully, a current \u2014 carried the Sundered Wake south. What had been a line became a shape. What had been a shape became a platform. The word \"island\" was generous. Velundri was a coral shelf \u2014 flat, white, roughly oval, less than a mile across at its widest point. No natural elevation above fifteen feet. No vegetation taller than salt-grass. The entire surface had been engineered: drainage channels carved into the coral, stone platforms for the market stalls, a harbor basin cut from the reef's southern edge with the precision of someone who understood water flow at a level that was closer to art than engineering.","","Varrek work. You could tell from the dock.","","*if (crew3_name = \"Kessara Veldt\")","  \"Varrek drainage system,\" Kessara confirmed. She was studying the channels as the ship entered the harbor approach. \"The gradient is engineered \u2014 the water flows from the interior to the ocean at a controlled rate. Without the drainage, every storm would flood the market platform. With it, the water exits faster than it enters.\" She shook her head \u2014 the Rathai gesture of reluctant admiration. \"The channels were cut by hand. Limestone chisel work. The tolerance is within a quarter inch over a hundred feet. That's not construction. That's clockwork.\"","","The harbor held eight berths. Five were occupied. The Sundered Wake took the sixth \u2014 an open berth on the south side, facing the ocean, the mooring posts carved from the same coral as the island itself. The water was shallow \u2014 eight feet at high tide, visible to the bottom, the coral sand white and undisturbed. Fish swam between the hulls. Small, silver, indifferent to the ships that came and went.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was already reading the harbor. The five occupied berths: the Morventhi freelancers from the Depthline, who had been at Kelvanni; two merchant haulers from the northern coast; a ship she didn't recognize; and \u2014 in the east berth, the largest berth, with the best approach angle \u2014 the Regrade.","","  \"Kovesse Thrallek.\" Sullavenne said the name like a navigation marker \u2014 a fact of the terrain. \"The Inheritors arrived ahead of us. By at least two days, judging by their supply offload.\"","","  *if met_kovesse","    The legacy heir was not on deck. The Regrade's crew was present \u2014 eight people moving with the coordinated ease of a well-funded operation. The ship was clean, well-maintained, the hull painted in the deep blue that Kovesse's mother had chosen forty years ago and her daughter had not changed.","","    The contrast with the Sundered Wake was visible from fifty feet. One ship funded by legacy. One ship held together by Kessara's stubbornness and Terrek's food and the stubborn gravity of people who refused to stop.","","*page_break","","*comment ---------------------------------------------------","*comment  THE WEIGHT-TRADE MARKET","*comment ---------------------------------------------------","","The market was the island.","","Not beside it, not on it \u2014 the market WAS the island's purpose. Velundri produced nothing. No food, no water, no materials. The coral shelf existed because it was positioned at the geographic center of the Kingsrun's first half \u2014 equidistant from the last comfortable stop and the first dangerous one. Location. That was Velundri's product. Everything else was imported, traded, and carried away.","","The weight-trade.","","No currency. You put what you had on one pan of a brass scale. The trader put what you wanted on the other. When the scale balanced, the trade was done.","","At the first stall you passed, a Gorundai woman was trading a coil of anchor chain for salt pork. The chain was heavy. The pork was light. She added a copper fitting. The scale tipped the wrong way \u2014 she'd overshot. She pulled the fitting back, put a smaller one on. Still too much. She exhaled through her nose. The Varrek trader added a second slab of pork and a clay jar of rendered fat. The scale balanced. The Gorundai woman looked at the extra pork like she hadn't expected it. Both parties walked away without speaking.","","At the second stall, a human man was arguing. He'd been arguing for a while, judging by the crowd. He wanted the Varrek to accept a Kolmari letter of credit. The Varrek stared at him the way a scale stares at an empty pan.","","*comment The exception, per the bible: counterfeit weight = ship seized.","","A sign at the market's entrance, carved in Varrek lettering:","","COUNTERFEIT WEIGHT \u2014 SHIP SEIZED. NO APPEAL.","","The consequence was not theoretical. Two hulls were visible on the reef edge, half-submerged, the remains of crews who had tried to cheat the scales. The Varrek who administered Velundri's market did not employ guards, did not threaten, did not raise their voices. They weighed. And the weight was law.","","*choice","  #Walk the market. See what's being traded, what's available, what the crew needs. Information first, then decisions.","    *set personality_aggression %- 2","    *goto market_walk","","  #Go straight to the provision stalls. The food supply is low and the next stretch is the longest yet. Resupply is the priority.","    *set personality_aggression %+ 2","    *goto market_provisions","","  #Find the information traders. At Velundri, intelligence is weighed by the word. The revelation \u2014 whatever Sullavenne is chasing \u2014 might be for sale here.","    *set personality_openness %+ 5","    *goto market_intelligence","","*label market_walk","","The market was arranged in concentric rings around the primary weight-scale \u2014 a massive brass instrument, waist-high, its pans wide enough to hold a crate. The outer ring held provision traders: food, rope, canvas, caulking compound, medical supplies. The middle ring held specialty goods: weapons, navigation instruments, Grimoire repair kits, ship fittings. The inner ring \u2014 closest to the primary scale \u2014 held information.","","You walked the rings. The stalls were staffed by every race. A Gorundai woman sold weapon-grade ore from Brannach, weighed against whatever the buyer had. A human couple from the northern coast offered dried provisions \u2014 fish, grain, salt \u2014 at weights that favored the buyer because they were carrying too much and needed to lighten before the next stretch. A Khari trader from a warren you didn't recognize sold maps. Hand-drawn. The quality varied. The price was always weight.","","The smells shifted as you moved inward. Outer ring: salt, fish oil, the mineral tang of iron and bronze. Middle ring: weapon oil, varnish, the acrid bite of Grimoire repair compounds. Inner ring: paper. Old paper. The specific smell of documents that had been stored in sealed containers and opened for the market.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was in the outer ring. The cook had gone straight to the provision stalls with the single-minded focus of a professional who understood that his domain was under threat. He was weighing. A sack of grain on one pan. Three lengths of Brannach sulfur-cord \u2014 the trade item the crew had carried from Stop 4 \u2014 on the other. The trader was Varrek. The negotiation was conducted in grams and millimeters. The Gorundai cook and the Varrek trader spoke the same language: precision.","","  He looked up as you passed. Held out a twist of something \u2014 dried fruit, dark, the smell sweet and unfamiliar. He didn't explain. He'd bought it with his own trade-weight, the personal supplies he'd carried since Brannach. He put it in your hand and went back to the scale.","","  *set food_days + 8","  *comment Terrek handles provisioning automatically on the walk path","","*if (crew4_name != \"Terrek Ghaal\")","  *comment No dedicated cook \u2014 MC buys basic provisions directly","  *set food_days + 4","","*goto market_continues","","*label market_provisions","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was already there. The Gorundai had beaten you to the provision stalls by the simple expedient of not stopping to look at anything else. He'd assessed the available stock, identified the three stalls with the best quality-to-weight ratio, and was in the middle of a transaction with a Varrek grain trader that involved micro-adjustments to the brass weights and the kind of concentrated silence that two professionals share when the work is the conversation.","","  \"I need four things,\" he said, not looking up from the scale. \"Grain. Dried protein \u2014 fish, meat, whatever's available at weight. Spice. And \u2014\" He stopped. Counted on his fingers. \"Three things. I said four. It's three.\" He adjusted a weight. \"The spice is the luxury. Everything else is survival. I can make survival edible. I can't make survival interesting without spice.\"","","  The Varrek trader produced four paper twists \u2014 the Velundri spice packets the bible described. Mixed spices from a dozen trade origins, contents unpredictable. Terrek opened one. Smelled it. Closed it. Opened the second. His nostrils flared \u2014 the Gorundai equivalent of a wine taster finding a vintage.","","  \"This one.\" He put it on the scale. You put what the crew could spare on the other pan.","","  *set food_days + 8","  *comment No Sovereigns spent \u2014 weight-trade uses goods, not currency","","*if (crew4_name != \"Terrek Ghaal\")","  The provision stalls were simple. Grain, dried fish, salt \u2014 the basics. Without a dedicated cook to assess quality, you traded by weight and hoped the goods were what the traders said they were. The spice packets sat in rows. You picked one at random.","","  *set food_days + 4","  *comment No cook \u2014 MC gets less efficient provisioning","","*goto market_continues","","*label market_intelligence","","The inner ring of the market was different. The stalls here didn't have physical goods on display \u2014 instead, they had people. Individuals sitting behind scales with nothing on the pans. The weight-trade for information was conceptual: you offered what you knew, weighed against what you wanted to know. The scale was metaphorical. The exchange was real.","","An old Thalessi man sat behind the primary stall. He was thin, precise, the features of a race that aged slowly and maintained their faculties long past the point where other races would have retired. His eyes tracked you \u2014 tracked the horns, the height, the highland coat. The assessment took less than a second.","","\"Kingsrun crew. Four stops \u2014 no, five. Six.\" He squinted at your coat. Recounted something in his head. \"Six. The coat's been salt-washed to the point of bleaching, which means extended sea exposure. Half-Oni, highland origin, which means you're either running from something or toward something.\" He paused. \"Both, probably. I always say 'both, probably.' I'm always right.\"","","He gestured to the empty pan.","","\"So. You tell me something. I tell you something. The quality \u2014 that's what matters. Not the quantity. I get people who come here and talk for twenty minutes and say nothing. That's worth nothing.\" He scratched behind his ear. \"I don't cheat. I don't lie. I also don't \u2014 what's the word \u2014 curate. What I sell you is raw. Some of it's good. Some of it's horseshit that someone planted because they want you sailing the wrong direction. That's your problem, not mine.\"","","He looked at you.","","\"Welcome to Velundri. Half the people here are lying. The other half think they're telling the truth, which is worse.\"","","*if (crew4_name = \"Terrek Ghaal\")","  *comment Terrek handles provisioning independently while MC trades for info","  *set food_days + 8","","*if (crew4_name != \"Terrek Ghaal\")","  *comment No cook \u2014 MC grabs basic provisions after intelligence trading","  *set food_days + 4","","*goto market_continues","","*label market_continues","","*page_break","","*comment ---------------------------------------------------","*comment  THE MARKET \u2014 MIDDAY","*comment ---------------------------------------------------","","The market's rhythm became clear by midday. The weight-scales operated continuously \u2014 the brass clink of pans settling, the murmur of traders calling adjustments, the sound of goods being weighed and exchanged and carried away. The system worked because the rules were simple and the consequences were visible. The two hulls on the reef edge were the only enforcement the market needed.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara found you at the middle ring. The Rathai was carrying a sack \u2014 small, heavy, the contents clinking with the sound of metal on metal.","","  \"Ship fittings. Bronze. Three cleats, a new halyard hook, and a ring bolt for the anchor rode.\" She hefted the sack. \"I traded the damaged rudder bracket from the Galluun's Tooth repair \u2014 the old one, the one I replaced. The Varrek fittings trader weighed it and offered these.\" She hefted the sack again. She'd already hefted it. She was holding it the way she'd held the bronze fitting at Galluun's Tooth \u2014 close, like it might leave. \"First fair trade since Selvaggio.\"","","  She looked at the ship from the market. The Sundered Wake in her berth, salt-stained and patched and floating level. The ship they'd sailed from the start. The ship Kessara had kept alive through five stops and an ocean that tested everything she knew about hulls and water and the physics of not sinking.","","  \"I need two more hours in the market. The canvas stall has sail-grade linen at a good weight ratio. And there's a Varrek toolmaker in the inner ring who's selling a calibrated wrench set that would cut my repair time by a third.\" She paused. The pause was financial. \"I have nothing left to trade for the wrench set. The rudder bracket was everything.\"","","  *choice","    #Trade the storm-leather coat. The highland coat has been on your back since Selvaggio. It's the last piece of the highlands. It's also the most valuable thing you own by weight.","      *set personality_aggression %+ 5","      *set coat_traded true","      *goto coat_trade","","    #Find something else. The ship has cargo, salvage, items from previous stops. There's always something to trade.","      *set personality_openness %+ 3","      *goto alternate_trade","","    #The wrench set can wait. Kessara has managed five stops with the tools she has. The tools she needs are a future problem.","      *set personality_aggression %- 3","      *goto no_trade","","*label coat_trade","","The storm-leather coat weighed six pounds. Highland Oni leather \u2014 tanned in volcanic springs, weather-treated with Sennaku highland oil, the stitching done by a skin-singer whose name you had never learned. It had been a gift. Or a possession. Or the last thing the highlands had given before the highlands had stopped giving.","","The Varrek toolmaker weighed it. Ran her fingers across the leather \u2014 feeling the grain, the treatment, the density. Her expression changed. The coat was rare. Storm-leather was not traded often because Oni did not give up their leather often, and the Sennaku process for treating it was not available outside the highlands.","","The wrench set went on the other pan. Precision tools. Varrek-made. The kind of equipment that turned a good engineer into an excellent one.","","The scale balanced.","","Kessara took the wrench set. Looked at you standing in the market in a salt-bleached shirt, the coat gone, the shoulders bare. The horns visible. The highland tattoos visible \u2014 the incomplete lines, the festival marks that stopped halfway. Everything that the coat had covered was now exposed.","","She didn't say thank you. Rathai didn't. She put the wrench set in the sack with the fittings and said, \"I'll have the cleats installed by sundown.\"","","That was Kessara's thank you. Work. Immediate, specific, measurable work.","","*set crew3_loyalty %+ 8","","*goto afternoon","","*label alternate_trade","","The crew searched the hold. The Sundered Wake's cargo was lean \u2014 they'd been running light since Selvaggio, carrying only what they needed and what they could trade. But six stops had accumulated things. The modified Grimoire casing from the Galluun's Tooth wreck \u2014 if they still had it. A bolt of Merrenbach reef-silk that Terrek had accepted as payment for cooking a meal at the Khari market. Small items. Trade goods.","","*if (galluuns_tooth_challenge = \"took_box\")","  The chart folio from the Galluun's Tooth wreck was an option. Old, valuable, containing navigation data from a pre-Kingsrun era. The Varrek would weigh it by the vellum \u2014 but the information inside would be recognized.","","The crew scraped together enough. The wrench set went into Kessara's hands. The cost was distributed \u2014 a piece from everyone, a shared expenditure that reminded you that a crew's resources were collective, not individual.","","*set crew3_loyalty %+ 5","","*goto afternoon","","*label no_trade","","Kessara nodded. The nod was professional \u2014 the acceptance of a command decision, filed without complaint, the Rathai instinct for operational hierarchy. She would work with what she had. She always had.","","\"I'll make do.\" She hefted the sack with the fittings. \"I've been making do since Selvaggio. The ship hasn't sunk yet.\" She turned to leave. Stopped. Turned back. Opened her mouth. Closed it. Turned again and walked toward the ship, her free hand tapping against her thigh in the rhythm of someone running calculations she didn't like the answer to.","","*goto afternoon","","*label afternoon","","*page_break","","*comment ---------------------------------------------------","*comment  AFTERNOON \u2014 THE HARBOR","*comment ---------------------------------------------------","","*if met_kovesse","  Kovesse Thrallek found you at the market's edge.","","  She didn't approach the way Suuba had \u2014 fast, talking, already three sentences ahead of the conversation. Kovesse moved the way money moves: slowly, with the gravity of something that doesn't need to hurry because it owns the space it enters.","","  Tall for a Human. Five-ten. Dark skin, close-cropped hair, the posture of someone who had been taught to stand correctly and had never questioned the instruction. She wore a coat that cost more than the Sundered Wake. The fabric was Rathai-woven \u2014 treated, the weave tight enough to be waterproof, the cut tailored. She looked like what she was: the inherited captain of a funded legacy operation, raised to run the Kingsrun the way her family had run it for two generations.","","  She was also tired. The kind of tired that money couldn't fix. The kind that came from watching a volcanic eruption destroy three weeks of repair work and then sailing south with a ship that wasn't ready.","","  \"Akkan.\" She used the surname. The formality was Thrallek \u2014 the legacy family's style, learned from her mother, applied to everyone. \"You pulled scaffolding at Brannach. My first mate tells me your crew was on the dock when the tremor hit, hauling debris while most captains were casting off.\"","","  She looked at the Sundered Wake. At the Regrade. The two ships in the same harbor, one patched and salt-bleached, the other funded and still damaged.","","  \"I wanted to say that in person. The Grimoire doesn't carry gratitude very well.\"","","  *choice","    #Accept the acknowledgment. Nod. The Brannach dock was chaos and you did what the ground needed. Kovesse's thanks is noted \u2014 and so is the fact that the Inheritors owe a debt.","      *set personality_aggression %+ 3","      *set met_kovesse true","","      The nod was enough. Kovesse read it \u2014 the economy of a response that didn't need words. She was a legacy captain. She understood that transactions didn't require decoration.","","      \"I'll remember it.\" She turned to leave. Stopped. The stop was calculated \u2014 the Thrallek instinct for dramatic punctuation that she'd inherited with the ship. \"The Kingsrun south of here changes. Durromakh. The toll gate. Cassara Vellune doesn't care about legacy or money or gratitude. She cares about tonnage.\" She looked at the Sundered Wake. \"Your ship is light. That's an advantage at the toll. Maybe the only one you have.\"","","      She left. The Inheritors' crew closed around her the way funded crews close around their captains \u2014 with competence and proximity and the specific gravity of people who were paid to be present.","","      *goto market_evening","","    #Trade information. Kovesse was at Brannach longer \u2014 she knows the harbor, the Gorundai, the eruption's aftermath. Information from a funded crew is worth more than a thank-you.","      *set personality_openness %+ 4","      *set met_kovesse true","","      The exchange was brief. Kovesse traded like a legacy captain \u2014 aware of what she had, aware of what it was worth, aware that sharing intelligence with a rival was a calculated investment in future reciprocity.","","      What she gave: Durromakh's toll structure \u2014 tonnage-based, paid in goods or sovereignty markers. Cassara Vellune's temperament \u2014 \"She's Morventhi. She's 134 years old. She's been running the toll for sixty years and she's killed six crews who tried to run it. The wreckage is visible from the channel.\" The Gorundai at Brannach had mentioned the weather south of Velundri \u2014 volcanic monitoring showed atmospheric disturbance that wasn't volcanic. \"They said 'the sky is wrong.' I don't know what that means. The Gorundai always know what it means.\"","","      She left with what you gave her \u2014 Kelvanni's clinic capacity, the Wardensea cutter incident, whatever intelligence the crew had gathered at the medical stop. The trade was weighted in her favor. She had more to give. But the transaction itself \u2014 the willingness to exchange \u2014 was the point.","","      *goto market_evening","","    #Walk past. Kovesse's gratitude is real and irrelevant. The Inheritors are funded, crewed, and running the Kingsrun with resources the Sundered Wake will never have. Gratitude between unequal ships is decorative. Keep moving.","      *set personality_aggression %- 3","      *set personality_loyalty %+ 3","","      Kovesse watched the walk-past. Her expression didn't change \u2014 the Thrallek composure held. But the first mate behind her \u2014 Sureth Kellane, lean and watchful \u2014 shifted his weight. The shift said: *noted*.","","      The market continued. The scales balanced. The Inheritors went their way and the Sundered Wake's captain went the other and the coral platform held them both without comment.","","      *goto market_evening","","*label market_evening","","The market closed at sunset. The Varrek administrators covered the scales with canvas, locked the stall frames, and swept the coral platform with brooms made from reef-grass. The efficiency was automated \u2014 a routine performed daily for however many years the market had been running. Decades. Centuries. The drainage channels continued to run. The platform was dry within an hour of the last rain. The system worked.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had spent the day in the inner ring. You had seen her once \u2014 seated across from the Thalessi information trader, the two of them in a conversation that was conducted in low voices with long pauses and the guarded body language of people who were trading dangerous things. Sullavenne had offered something \u2014 you didn't see what \u2014 and the Thalessi had placed something on the scale in return. A rolled document. Small. The exchange had lasted less than a minute.","","  She'd disappeared after that. Into the market crowd. Into the harbor. Into whatever network of contacts and sources she'd built during the day \u2014 the former intelligence officer operating in her element, gathering data from a market that traded information by the gram.","","  You would hear what she'd found. Tonight. On the ship. In the dark, where the crew assembled and the Grimoire glowed and the Kingsrun's secrets were weighed against the crew's willingness to carry them.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek had provisioned well. The galley was stocked \u2014 eight days of food at full ration, longer if he stretched. The Velundri spice packets were stored in the dry locker. The grain was sealed. The dried fish was hung in the hold where the air circulated. The Gorundai cook had done what the Gorundai cook always did: ensured that the crew would eat, and eat well, for as long as the journey continued.","","  He was cooking now. The first proper meal in five days \u2014 the doldrums had limited the galley to cold provisions, and the arrival at Velundri had meant provisioning before eating. Now, at anchor, with the stove lit and the evening warm and the harbor quiet, Terrek was in his element. The smell rose from the galley hatch: rice, Brannach sulfur-salt, the first of the Velundri spice packets.","","  The crew gathered. On the stern. Sitting on rope coils and deck crates. Four people. One ship. Six stops.","","  The food was good. The food was always good. But tonight it tasted like more than food. It tasted like arrival. Six stops of the Kingsrun. The halfway point \u2014 the place where the route shifted from \"getting started\" to \"committed.\" The place where turning back stopped being a possibility and became a fantasy. The crew had crossed something. The scales at Velundri had weighed what they carried, and the weight had balanced, and the balance meant they belonged here.","","*comment ---------------------------------------------------","*comment  GRIMOIRE \u2014 EVENING BROADCAST","*comment ---------------------------------------------------","","*set broadcast_count + 1","","The Grimoire lit up during dinner.","","Kingsrun Watch. Veshanna Torc.","","\"Velundri market close. Fourteen crews docked at Stop 6 in the last three days. Three departures southbound. One reversal \u2014 a human crew from the eastern coast, their captain citing supply exhaustion and crew injury. They turned north this morning. By the time they reach Selvaggio, the season will be half over.\"","","*if (bounty >= 30000000)","  \"The Sundered Wake arrived today. Merdou Akkan \u2014 the half-Oni cold entry from Selvaggio. Six stops. The Watch is noting this because cold entries don't usually make it past Stop 4. The attrition rate for unfunded crews is seventy-three percent by Stop 4 and eighty-nine percent by Stop 6. The Sundered Wake is in the eleven percent.\"","","  *set grimoire_followers + 400","","*if (bounty < 30000000)","  \"Among today's arrivals: the Sundered Wake. Low-profile crew out of Selvaggio. The Watch has them listed but not featured \u2014 minimal bounty, no major incidents on public record. That said, they've made it to Stop 6, which puts them ahead of most of the season's entrants.\"","","  *set grimoire_followers + 150","","\"Also at Velundri: the Inheritors. Kovesse Thrallek's crew, carrying the Thrallek legacy and enough funding to buy half the market. The betting board has them at twelve to one \u2014 down from eight to one at Selvaggio. The odds are getting worse because the Kingsrun is getting harder, and money doesn't buy wind or luck or the specific thing that separates crews who make it from crews who don't.\"","","\"Ahead of everyone: the Kindling. Suuba Mettani's crew passed through Velundri three days ago and didn't stop. Didn't dock. Didn't trade. They sailed through the harbor without dropping anchor and continued south. Either they're fully provisioned or they're running from something. The Watch is watching.\"","","A pause. The editorial pause. Veshanna's signature.","","\"And south of Velundri \u2014 weather. The Wardensea's Bastion Sea forecast is calling for anomalous conditions in the Velundri-Durromakh corridor. Localized. Non-seasonal. The kind of weather that makes meteorologists nervous and Kingsrun crews very, very quiet.\"","","The Grimoire dimmed. Dinner continued. The crew ate in the heavy silence of people who had heard a weather warning and were choosing not to discuss it yet.","","The harbor held its breath. The drainage channels ran. The stars came out over Velundri \u2014 the flat island, the engineered platform, the place where weight was law and the scales balanced and the Kingsrun's secrets were sold by the gram to anyone willing to pay.","","Tomorrow. The second day at Velundri. The market would open again and the scales would balance again and the information that Sullavenne had bought would find its way to the crew. And south of here \u2014 south of the flat water and the doldrums and the white coral shelf \u2014 the ocean was getting darker and the weather was getting wrong and something was building that wasn't on any chart the Gannavar had published.","","The Kingsrun continued. It always did. The question was whether the crew continued with it.","","*goto_scene ch6_velundri_revelation",""], "labels":{"market_walk":112,"market_provisions":134,"market_intelligence":156,"market_continues":182,"coat_trade":215,"alternate_trade":235,"no_trade":248,"afternoon":256,"market_evening":314}},
"ch6_velundri_revelation": {"crc":-611005946, "lines":["*comment ===================================================","*comment  CHAPTER 6, SCENE 2 \u2014 VELUNDRI: REVELATION","*comment  Intelligence reveals the Kingsrun is a selection","*comment  mechanism. Terrek's personal-stakes scene.","*comment  Crew reckons with what the journey means.","*comment ===================================================","","*comment ---------------------------------------------------","*comment  EVENING \u2014 THE SECOND NIGHT AT VELUNDRI","*comment ---------------------------------------------------","","The market was closed for the night. The weight-scales had been locked and covered \u2014 heavy canvas stretched over the stone platforms, tied with Varrek precision knots. Without the market, Velundri was quiet in a way that other stops hadn't been. Galluun's Tooth had the reef. Merrenbach had the path-songs. Brannach had the volcano. Kelvanni had the clinic. Velundri had the market. When the market closed, Velundri closed with it.","","The harbor held six ships. The Sundered Wake, the Inheritors' Regrade, a Morventhi freelance crew on a sloop called the Depthline, two merchant haulers from the northern coast, and a single-masted ketch flying Rekkvald colors \u2014 the northern compact's iron-grey ensign, rarely seen this far south.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had been gone since midday.","","  That was unusual. The former Wardensea officer did not vanish \u2014 she repositioned. She told you where she'd be and she went there and she came back. Today she'd said \"the market\" and gone. Six hours ago. The market had closed four hours ago.","","  You had noticed. The crew had noticed. Kessara had said nothing about it, which for Kessara meant she was waiting to see what the silence produced.","","The night was warm. The Bastion Sea held its heat longer at this latitude \u2014 the water temperature hadn't dropped below seventy since Brannach, and at Velundri the heat was a constant, something the body stopped tracking because it never changed. The coral platform radiated the day's warmth back into the air, and the harbor smelled of limestone and brine and the residual spice-oil from a thousand market transactions.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek had set dinner at the stern. Rice. Reef-kelp broth from the Merrenbach supply. Galluun's Tooth salted fish, the last of it \u2014 the strips hard and concentrated, the flavor locked in by the lagoon salt that Terrek had treated with sulfur-dust from Brannach. He'd stretched the provisions from Stop 2 to Stop 6 through a rotation system he'd never explained and the crew had never questioned. The man understood supply lines the way Kessara understood hull integrity: as a problem that existed to be solved with precision and no complaint.","","  He ate with the crew. Sat on the stern locker. The Gorundai was comfortable in a way the others weren't \u2014 not relaxed, not careless, but settled. Terrek occupied space the way Gorundai occupied space: fully, without apology, his body an honest statement of who he was and where he'd decided to be.","","  He looked at the harbor. At the six ships. At the dark water between them.","","  \"The Rekkvald crew offered me a contract.\"","","  The words came without preamble. Gorundai. Direct.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara's hands stopped moving. She'd been re-stitching a sail patch \u2014 the needle and thread work that she did at anchor the way other people did crossword puzzles, the fingers busy while the brain processed something else. The needle stopped.","","*if (crew4_name = \"Terrek Ghaal\")","  \"They came to the market this morning. The Rekkvald cook left at Stop 4 \u2014 seasickness. Four stops without a proper cook. The crew's been eating dried provisions and getting \u2014\" He stopped. Started again. \"They offered double what I could earn on the Sundered Wake.\" He looked at the bowl in his hands. \"Which is double nothing, so the math isn't \u2014 I practiced this and it sounded better in my head.\"","","  He set the bowl down. It caught the edge of the stern locker and tipped. Rice on the deck. A single strip of salted fish slid toward the scupper. Terrek stared at the spilled food \u2014 the cook who had just finished talking about rationing, watching his own dinner crawl across the planking. He picked up the fish strip. Blew on it. Put it back in the bowl.","","  \"I said no.\"","","  *if (crew3_name = \"Kessara Veldt\")","    Kessara's needle moved again. She pulled the thread too tight. The stitch puckered. She stared at it for two seconds \u2014 a bad stitch, from a woman who didn't make bad stitches \u2014 and then carefully unpicked it and started over. Her hands were steadier the second time.","","  \"I said no because they want a cook. I want the Kingsrun. There's a difference.\" He looked at you. The look was Gorundai \u2014 direct, physical, the weight of a person who meant what they said and expected the same in return.","","  \"The Rekkvald crew is going south because they have a contract to fill. I'm going south because the south has food nobody's tasted. Different reasons. Different kitchens.\" He picked the bowl back up. \"I'm not staying because this is the only berth. I'm staying because this is the right berth. You should know that. A captain should know why their crew is here.\"","","  *set crew4_loyalty %+ 5","  *set crew4_trust \"earned\"","","*page_break","","*comment ---------------------------------------------------","*comment  SULLAVENNE RETURNS","*comment ---------------------------------------------------","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne came back at the first watch.","","  The crew was on deck \u2014 the night was too warm for the hold, and the harbor was quiet enough that sleeping on deck was viable. Kessara was at the helm, not steering but present, the tiller within reach. Terrek was cleaning the galley \u2014 the sounds of organization, metal on wood, the familiar rhythm of someone putting things where they belonged.","","  Sullavenne's boots hit the deck. She crossed to you without stopping, without greeting, without the careful social calibration she usually maintained. She was carrying something. A rolled chart. Old. The vellum was dark with age, the edges stiff.","","  \"I need the crew on deck.\"","","  Her voice was different. Not louder. Tighter. She kept adjusting her grip on the rolled chart \u2014 left hand, right hand, both hands, left hand again. Her jaw was working like she was chewing something that wouldn't break down.","","  Kessara came forward. Terrek came up from the galley, a cloth in his hands. The crew assembled at the stern \u2014 four people on a ship that the world's betting boards gave two hundred to one.","","  Sullavenne unrolled the chart on the deck.","","  The chart showed the Kingsrun. Not the standard Gannavar-published route \u2014 not the version the Grimoire displayed, with its clean waypoints and estimated transit times. This was older. The vellum was real animal skin, not the pressed-plant paper the modern charts used. The ink was iron-gall \u2014 the kind that ate into the surface and became part of the material. The stops were marked, but the names were different.","","  *if (galluuns_tooth_challenge = \"took_box\")","    \"I found this in the Rekkvald trader's hold. She was selling it \u2014 not on the open market, not at the weight-scales. Private sale. I paid with the chart folio from the Galluun's Tooth wreck. The wreck chart for this one. A trade of navigation for navigation.\"","","  *if (galluuns_tooth_challenge != \"took_box\")","    \"I found this in the Rekkvald trader's hold. She was selling it \u2014 not on the open market, not at the weight-scales. Private sale. I paid with the barometer and my Wardensea navigation credential. Everything I had that was worth something.\"","","  She pointed.","","  \"Look at the stops. Count them.\"","","  *if (crew3_name = \"Kessara Veldt\")","    Kessara leaned in. The Rathai's eyes were good \u2014 the low-light acuity that came from growing up in Nettleworks assembly halls where the lighting was industrial and the detail work was micron-scale. She counted.","","    \"Seventeen stops.\" She counted again. Her finger moved across the vellum, tapping each mark. \"Eighteen \u2014 no. Seventeen. I counted that island twice. The standard Kingsrun chart shows sixteen.\" She looked up. \"There's an extra stop. Between Stop 9 and Stop 10.\"","","  \"The modern charts don't show it because the modern charts are \u2014 they're based on the Sovereign King's route. His log. The Gannavar standardized it and everyone just... followed.\" Sullavenne's finger traced the older route. It trembled. She steadied it with her other hand. \"This chart is older than him. Older than \u2014 by centuries. Centuries.\" She said the word like she was biting it. \"I keep saying it and it keeps being true. The route was here before the man who bloody named it.\"","","  Nobody spoke. Kessara's tool harness clinked once in the harbor swell. The sound was small and familiar and wrong \u2014 too ordinary for what they were looking at.","","  \"The stops aren't random,\" Sullavenne said. \"They're placed. The distances between them scale geometrically \u2014 each stretch is longer than the last by a consistent ratio. The gradient \u2014 the way the ocean gets deeper and the currents get stronger the further south you go \u2014 isn't natural erosion. The seabed was shaped. The currents were channeled. Someone built this corridor.\"","","  She looked at the crew. At Kessara. At Terrek. At you.","","  \"The Kingsrun is a selection mechanism. The stops are checkpoints. Each one tests something different \u2014 Selvaggio tests ambition, Galluun's Tooth tests resourcefulness, Merrenbach tests trust, Brannach tests endurance, Kelvanni tests mercy. Velundri tests judgment. The order matters. The tests compound. A crew that passes Stop 1 but fails Stop 3 is filtered out. A crew that passes all six has been \u2014\"","","  She stopped. Chose her next word with the care of someone who understood that words, once spoken, became real.","","  \"\u2014 evaluated.\"","","*page_break","","*comment ---------------------------------------------------","*comment  THE CREW REACTS","*comment ---------------------------------------------------","","*choice","  #Let the silence hold. The crew needs to process this without the captain steering their reaction.","    *set personality_aggression %- 3","    *set personality_openness %+ 3","    *goto crew_reaction_silence","","  #Spread the chart flat. Look at the twenty-first stop. If the Kingsrun has a hidden checkpoint, knowing where it is changes everything.","    *set personality_aggression %+ 3","    *goto crew_reaction_chart","","  #Look at Sullavenne. She paid everything she had for this chart. The question is why. The question is what she already knew before she found it.","    *set personality_openness %+ 5","    *goto crew_reaction_sullavenne","","*label crew_reaction_silence","","The crew was quiet. The harbor lapped at the hull. Somewhere on the Regrade, a watch-bell rang \u2014 Kovesse Thrallek's crew marking the hour.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara spoke first. \"Selection for what?\"","","  Three words. The question that mattered. Everything before it was architecture \u2014 who built the corridor, when, why the stops were placed. Kessara cut past the structure to the function. The Rathai engineer's instinct: what does the machine do?","","  Sullavenne shook her head. \"The chart doesn't \u2014\" She pressed her thumb against the vellum. Hard. \"I don't know. The annotations reference a destination \u2014 the Sundren \u2014 but the language is Second Age script. I can read fragments. Most of it is beyond me. I spent six hours today pretending that wasn't true.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek had not moved. The Gorundai sat with the cloth in his hands and his eyes on the chart and his body perfectly still. The stillness was not shock. Gorundai processed large information the way they processed large forces \u2014 by absorbing it, letting the impact distribute through the body's mass until it became bearable.","","  \"My grandmother,\" he said. His voice was low. Gorundai low \u2014 the rumble that came from the chest, not the throat. \"She told me that the Kingsrun was older than the Sovereign King. I was twelve. She said the route was drawn in the stone before anyone sailed it. I thought she meant the currents.\"","","  He looked at the chart. At the seventeen stops.","","  \"She didn't mean the currents.\"","","*goto revelation_continues","","*label crew_reaction_chart","","The seventeenth stop was between the modern Stops 9 and 10. On the standard charts: Ossengaard (the Wardensea fortress) and the Thornwaters (open ocean, no established port). On this chart, between the two: a mark. A small circle with a symbol inside it.","","The symbol was not any language currently in use.","","*if (crew5_name = \"Sullavenne Ohn\")","  \"Second Age glyph,\" Sullavenne said. \"I recognize the script family. The Wardensea archives had fragments \u2014 classified, restricted access. I read them during my service. This symbol means 'threshold' or 'gate.' The translation is imprecise \u2014 Second Age concepts don't map cleanly onto modern language.\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was measuring. She'd produced a straight-edge \u2014 the drafting tool she kept with her engineering kit \u2014 and was calculating distances on the chart. Her lips moved. The math was automatic.","","  \"The ratio holds. If the geometric scaling is consistent, the twenty-first stop is approximately one hundred and twenty miles south of Ossengaard. That's deep water. Open ocean. No islands, no reefs, no natural anchorage.\" She looked up. \"There's nothing there.\"","","  \"Something was there,\" Sullavenne said. \"Something that warranted a stop on a chart older than our civilization.\"","","*goto revelation_continues","","*label crew_reaction_sullavenne","","Sullavenne met your eyes. She held the look.","","\"I knew.\" Two words. The professional distance collapsed entirely. Beneath it: a woman who had served the Wardensea and left it and had been carrying a reason that was bigger than a scar and a notebook.","","\"I knew the Kingsrun was older than the official record. I knew the route was pre-charted. I learned this during my service \u2014 fragments, classified reports, intelligence briefings that were above my clearance that I read anyway because reading things I wasn't supposed to read was my job.\"","","She touched the scar. The thin line from ear to jaw. Displayed.","","\"The Wardensea discharged me because I filed a report. A formal intelligence assessment connecting the Kingsrun route geometry to Second Age survey data. The report went up the chain. Two days later, my clearance was revoked. Three days after that, I was discharged. No tribunal. No charges. Just \u2014 out.\"","","She dropped her hand.","","\"The scar happened on the way out. A reminder. From someone who wanted me to understand that the discharge was the gentle option.\"","","*if (crew3_name = \"Kessara Veldt\")","  Kessara had stopped stitching. The Rathai looked at Sullavenne the way she looked at hull damage that she'd missed during an inspection \u2014 the stunned expression of someone recalculating everything they thought they knew.","","  \"You joined this crew because of the Kingsrun.\" Not a question.","","  \"I joined this crew because the Kingsrun goes where the answers are.\" Sullavenne looked at the chart. \"And because the captain is a half-Oni from the Sennaku Highlands with unfinished tattoos and a reason for leaving that nobody has asked about. That combination \u2014 highland exile, Kingsrun route, the selection mechanism \u2014 is not a coincidence. I don't think it's an accident that you're here.\"","","  She looked at you.","","  \"I think you were supposed to be here.\"","","*set velundri_revelation true","*set revelation_type \"sullavenne\"","","*goto revelation_continues","","*label revelation_continues","","*page_break","","*comment ---------------------------------------------------","*comment  THE SECOND AGE QUESTION","*comment ---------------------------------------------------","","The chart lay on the deck. Seventeen stops. Geometric scaling. A route older than the civilization that used it. The crew of the Sundered Wake \u2014 four people, one salvage-claim ketch, a bounty that the world's betting boards dismissed \u2014 sat with information that the Wardensea had discharged an officer for finding.","","*if (crew5_name = \"Sullavenne Ohn\")","  \"The Masqarat knows.\" Sullavenne said it flat. Not an accusation \u2014 a fact. \"The Wardensea knows. The Gannavar cartographers know. The Kolmari know \u2014 their insurance models for Kingsrun crews don't match natural-hazard projections because the hazards aren't natural. Everyone who has access to the data has reached the same conclusion I reached. The Kingsrun is artificial. The route is designed. The selection is intentional.\"","","  \"And they suppress it. The Second Age research ban \u2014 the 'ontological hazard' justification \u2014 covers this. Researching the Kingsrun's origin is a capital offense under the same statute that bans Second Age archaeology.\"","","  She rolled the chart. The vellum curled back into its tube with the ease of something that had been rolled and unrolled many times by many hands.","","  \"We are carrying a capital offense on this ship. Every crew member who has seen this chart is, under Masqarat law, guilty of possessing suppressed Second Age material.\"","","*choice","  #Keep the chart. The information changes what the journey means. The risk is real. The value is higher.","    *set personality_aggression %+ 5","    *set revelation_type \"kept_chart\"","    *goto after_revelation","","  #Hide the chart. Not destroyed \u2014 hidden. Somewhere on the ship that a Wardensea inspection wouldn't find. The information survives, but the crew has plausible deniability.","    *set personality_aggression %+ 2","    *set revelation_type \"hidden_chart\"","    *goto after_revelation","","  #Give the chart to Sullavenne. She found it. She paid for it. She understands what it means better than anyone on this crew. Let her carry the risk.","    *set personality_loyalty %+ 3","    *set revelation_type \"sullavenne_chart\"","    *goto after_revelation","","*label after_revelation","","*comment ---------------------------------------------------","*comment  TERREK'S REACTION \u2014 THE PERSONAL STAKES","*comment ---------------------------------------------------","","*if (crew4_name = \"Terrek Ghaal\")","  The crew dispersed. Kessara went to the helm \u2014 the default position when the world required processing. Sullavenne went below with the chart or without it, depending on the captain's decision. The harbor was quiet. The Rekkvald ketch's watch-lamp burned yellow on the north berth.","","  Terrek didn't move.","","  The Gorundai sat at the stern and looked at the water for a long time. The cloth was still in his hands. He was wringing it. He didn't seem to know he was wringing it. The knuckles were white, then loose, then white again \u2014 the rhythm of someone whose body was processing something his mouth hadn't found words for yet.","","  When he spoke, his voice was different. Lower. The rumble that came from deep in a Gorundai chest, where the words lived before they became sound.","","  \"Selection mechanism.\" He repeated it. Tasting the words the way he tasted ingredients \u2014 rolling them, testing them, looking for the note that would tell him what the dish was about. \"The Kingsrun tests people. Sorts them. Finds the ones who \u2014 what? Survive? Deserve? Qualify?\"","","  He shook his head.","","  \"My grandmother didn't just tell me the route was old. She told me something else. She said: 'The ocean remembers who feeds it.' I didn't understand. I was twelve. She died the next year. The soul-bar was hammered. I carried it until I couldn't carry it anymore.\"","","  He looked at you.","","  \"If the Kingsrun is selecting for something, I want to know if it's selecting for the people who are willing to go all the way. Not the strongest. Not the fastest. The ones who refuse to turn around.\" His jaw set \u2014 Gorundai granite, a decision locking into place behind his eyes. \"Because that's what I am. I'm the one who refuses to turn around. I left the mining district. I left the soul-bar. I left every kitchen that told me I was good enough to stay and never good enough to matter. And I came here \u2014 to a ship that's falling apart with a crew of four and a bounty the world laughs at \u2014 because here, what I do matters. The food I make keeps this crew alive. Not metaphorically. Actually. Every bowl of rice and every strip of fish and every spice I traded for at the weight-scales is the difference between a crew that functions and a crew that falls apart.\"","","  He stood. The full height \u2014 shorter than you, broader, the mass of a Gorundai who had spent his youth hauling ore before he'd spent his adulthood hauling provisions. His face was set.","","  \"I am not cargo. I am not a passenger. I am the cook of the Sundered Wake and I am here because I chose to be and I want you to remember that when the storm comes. Because the storm is coming. Kuldhara Mabaan is south of us and the weather is wrong and we are sailing toward a Conqueror who will decide what we're worth.\" He put his hand on the rail. \"When she looks at this ship, I want her to see a crew. Not four people sharing a deck. A crew.\"","","  *set crew4_loyalty %+ 10","","*page_break","","*comment ---------------------------------------------------","*comment  NIGHT \u2014 THE HARBOR","*comment ---------------------------------------------------","","The night held Velundri. The six ships in the harbor breathed with the tide \u2014 the slow rise and fall of vessels at rest, the creak of wood against mooring lines, the restless music of ships waiting to leave.","","*if met_kovesse","  On the Regrade, a light burned in the captain's cabin. Kovesse Thrallek was awake. The legacy heir \u2014 Ghorvenne Thrallek's daughter, carrying a dead woman's ship and a dead woman's question and a forty-year-old route that had ended in \"Not the one\" \u2014 was reading something. A chart, a log. Whatever it was, she held it to the cabin lamp and studied it with the focus of someone who had inherited a puzzle and was running out of stops to solve it.","","  You and Kovesse had never spoken at length. You'd exchanged gestures \u2014 the raised hand at Galluun's Tooth, the nod at Merrenbach. Two captains orbiting the same route, aware of each other the way ships are aware of ships: by wake, by silhouette, by the particular way a vessel sits in the water and announces what it is.","","  Tomorrow you would leave. Kovesse would stay, or follow, or turn back. The Kingsrun would decide.","","The stars were different here. The constellations that had been overhead at Selvaggio had shifted south \u2014 the Shipwright's Crown was at the horizon now, and new patterns had risen from the south: the Morventhi Deep-Light, the Gorundai Crucible, star-groups you had never seen from the highlands. The sky was telling a story about distance. Six stops. Hundreds of miles. A world that kept getting larger and older and stranger the further south they went.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne took the first watch. She sat at the bow with the Grimoire dark in her lap and the notebook open in her hands \u2014 the first time you had seen the notebook open. She was writing. Small, precise handwriting. The pen moved fast.","","  She closed it when she felt your attention. The reflex was automatic \u2014 the notebook shut, the cover turned, the contents invisible. But you'd seen the page. The handwriting was different. Smaller. Faster. The letters leaned forward \u2014 not the upright Wardensea script she used for notes, but something looser, less controlled. The handwriting of someone writing for themselves.","","  \"Tomorrow,\" she said. \"Departure at first light. The Rekkvald crew is leaving at dawn \u2014 we go with them or after them. Not before. A second ship on the corridor gives us a reference point and divides any attention.\"","","  The professional was back. The woman who had shown the scar's origin was stored away, the vulnerability filed in the same place as the chart \u2014 present, acknowledged, operational.","","  \"Sleep,\" she said. \"I'll wake the captain at the change.\"","","*comment ---------------------------------------------------","*comment  GRIMOIRE CHECK \u2014 OVERNIGHT","*comment ---------------------------------------------------","","*set broadcast_count + 1","","The Grimoire woke you in the dark. A pulse \u2014 the notification rhythm that meant Kingsrun Watch, the channel that never slept because the Kingsrun never slept.","","Veshanna Torc's voice, low and measured:","","\"Overnight update. Bounty adjustments for three crews passing through the Velundri corridor. The Sundered Wake \u2014 adjusted upward. The Wardensea's southern command has added a notation to their file. Classification: 'Observation Priority.' That's not an arrest warrant. It's worse. It means they're watching and waiting for a reason to escalate.\"","","*set bounty + 2000000","*if (bounty >= 1000000000)","  *set bounty_tier \"Conqueror-Class Threat\"","*if (bounty >= 100000000)","  *if (bounty < 1000000000)","    *set bounty_tier \"Major Threat\"","*if (bounty >= 10000000)","  *if (bounty < 100000000)","    *set bounty_tier \"Regional Threat\"","*if (bounty >= 1000000)","  *if (bounty < 10000000)","    *set bounty_tier \"Known\"","*if (bounty > 0)","  *if (bounty < 1000000)","    *set bounty_tier \"Minor\"","","\"In other news: weather. The southern Bastion Sea between Stops 6 and 8 has been experiencing anomalous conditions for the past seventy-two hours. Localized pressure drops. Static interference on civilian broadcast bands. The pattern is familiar to anyone who's followed the Kingsrun for more than a year.\"","","A pause. The pause was editorial.","","\"The Living Storm hasn't been seen in the Kingsrun corridor for eleven months. If the weather reports are accurate, she's back. Kuldhara Mabaan is in the water. And every crew heading south from Velundri just got a new variable in their math.\"","","The Grimoire dimmed. You lay in the dark of the hold and listened to the ship breathe and the harbor lap and the distant sound of Sullavenne's pen on paper.","","Tomorrow. South. The weight-scales were closed. The revelation was open. The Kingsrun was older than the name they called it, and the ocean was watching, and somewhere between here and Durromakh a woman made of storm was deciding who deserved to pass.","","*goto_scene ch6_velundri_cliffhanger",""], "labels":{"crew_reaction_silence":127,"crew_reaction_chart":149,"crew_reaction_sullavenne":167,"revelation_continues":199,"after_revelation":234}},
"ch6_velundri_cliffhanger": {"crc":2138958791, "lines":["*comment ===================================================","*comment  CHAPTER 6, SCENE 3 \u2014 VELUNDRI: CLIFFHANGER","*comment  Departure from Velundri. The storm intercept.","*comment  Kuldhara Mabaan. Grimoire broadcast cuts.","*comment  Game 1 finale. Build backward from the ending.","*comment  Final line: \"The storm was watching them.","*comment  And the storm was smiling.\"","*comment ===================================================","","*comment ---------------------------------------------------","*comment  DEPARTURE \u2014 MORNING","*comment ---------------------------------------------------","","The weight-scales were closed. The coral platform was empty except for the drainage channels \u2014 Varrek-engineered, precise, the water still flowing through the stone grooves even after the market had packed and gone. Velundri without its traders was a flat white shelf under a flat white sky. The island produced nothing. Without the market, it was nothing.","","The Sundered Wake was loaded. Supplies in the hold \u2014 food, rope, caulking compound, a crate of Velundri spice packets that Terrek had weighed against three lengths of Brannach sulfur-cord. The ship rode lower in the water than she had at Kelvanni. Weight was good. Weight meant days.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara ran final checks with the focus of someone who understood that the next stretch of open water was the longest yet. Velundri to Durromakh: one hundred and eighty miles. Two to three days in fair wind. Four to five if the Bastion Sea decided to sit on them.","","  \"Hull: holding. Rudder: responding. Mast stays: tight.\" She ran her good hand along the port rail. The broken wrist had healed enough that she'd stopped splinting it \u2014 the bone had set crooked, Oursseva had warned, and would ache in cold weather for the rest of her life. Kessara had filed this information the way she filed all information about permanent damage: acknowledged, compensated for, irrelevant to current operations.","","  \"We're carrying more weight than we've carried since Selvaggio. That's good for stability. Bad for speed.\" She looked at the sky. \"Wind's from the northeast. That's \u2014\" She licked her finger. Held it up. Frowned at it the way she frowned at instruments that gave her numbers she didn't want. \"That's favorable. Ask me again in an hour.\"","","  The conditional. Kessara's favorite word. Every statement came with one. The Kingsrun had taught her that.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was in the galley. The sound of a knife on a board \u2014 the steady rhythm of someone preparing food with the attention of a professional and the care of someone who understood that a crew's morale lived in the pot as much as in the wind. The Velundri spice packets were open. He was sorting them by smell, separating the good from the ground bark, building a flavor profile out of a gamble.","","  He'd been quieter since the revelation. Not silent \u2014 Terrek was never silent when there was a galley to run. But the jokes had stopped. The humming had stopped. The knife rhythm was the only sound, and it was precise in a way that his cooking usually wasn't. Terrek cooked loose. Terrek cooked by feel. This was Terrek cooking the way his mother had probably cooked on the bad nights in the Kethrun district \u2014 mechanical, controlled, the food getting made because the food was the one thing that still made sense.","","  The smell of gorrash drifted up from the pot. He'd brought a bag of it from Brannach. It was running low.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne was at the bow. Facing south. The notebook was in her coat pocket \u2014 the leather edge visible, the pages that held whatever Sullavenne held close to her chest. She'd spoken more at Velundri than she had at any previous stop. The revelation had done that \u2014 cracked the seal on something she'd been carrying since before Selvaggio.","","  She turned as you came on deck. Her hands were in her coat pockets. She took them out. Put them on the rail. Took them off the rail. Put them back in her pockets. It was the most indecisive you had ever seen her body.","","  \"Durromakh is the toll gate. Cassara Vellune. Morventhi. A hundred and thirty-four years old. Six ships destroyed over sixty years \u2014 the wreckage is still visible from the approach as advertising.\" She paused. \"After Durromakh, the Shoalfields. After the Shoalfields, Ossengaard \u2014 the Wardensea fortress where Lieutenant Kassik's report is waiting.\"","","  She looked at you. Looked away. Looked back. The second look held longer than the first, and the first had held longer than she'd intended.","","  \"And between Velundri and Durromakh \u2014 Kuldhara Mabaan's patrol range.\"","","  The name sat in the salt air.","","  \"The Living Storm. Raiju Fruit. Awakened. Weather within ten miles mirrors her emotional state. She watches Kingsrun crews from the highlands. If she likes what she sees, they pass. If she doesn't \u2014\"","","  She didn't finish that sentence. She didn't need to. Every crew on the Kingsrun knew how that sentence ended.","","*page_break","","*comment ---------------------------------------------------","*comment  THE LAST HOUR AT VELUNDRI","*comment ---------------------------------------------------","","The harbor was emptying. Three crews had departed since dawn \u2014 the Morventhi freelancers first, silent as they'd arrived, their dark hull cutting south with the outgoing tide. Then a human crew from the northern coast, young, sailing a converted fishing boat they'd bought at Selvaggio. Their odds on the betting board had been three hundred to one. They'd made it to Stop 6. The odds hadn't improved.","","The Inheritors were still at dock. Kovesse Thrallek's ship \u2014 larger, better-equipped, crewed by people who had been born into the Kingsrun's mythology \u2014 sat in the east berth with its sails furled. Kovesse hadn't departed. The legacy heir was waiting for something, and whatever it was had kept her at Velundri for an extra day.","","*if met_kovesse","  Kovesse was on her deck. She saw you. The distance between the ships was forty feet of harbor water. She raised one hand \u2014 palm out, fingers spread. The gesture was her mother's. Ghorvenne Thrallek had raised that same hand to the crews she passed on the Kingsrun forty years ago. The gesture meant: I see you. I acknowledge you. The sea will decide what happens next.","","  You raised a hand back. Forty feet of water and the accumulated weight of six stops and a revelation that had changed what the Kingsrun meant.","","  Kovesse turned away first. Back to her crew. Back to whatever calculation was keeping her at dock while the Sundered Wake pulled anchor.","","*comment ---------------------------------------------------","*comment  DEPARTURE CHOICE","*comment ---------------------------------------------------","","*choice","  #Cast off. South. Durromakh and whatever waits between here and there.","    *set personality_aggression %+ 3","    *goto departure_south","","  #Take one more hour. Walk the empty market. The weight-scales are closed, but the drainage channels are still running. Velundri has something left to say.","    *set personality_aggression %- 2","    *goto final_walk","","  #Find Terrek before departure. He's been cooking since the revelation, and cooking is how Terrek talks. The galley might have answers the market didn't.","    *set personality_openness %+ 5","    *goto terrek_departure","","*label final_walk","","The coral platform was different empty. The drainage channels murmured \u2014 water from the morning rain, filtered through Varrek stonework, running in precise gradients toward the ocean. The market stalls were gone. The weight-scales were locked in their stone housings. The ground was scored with boot-marks and trade-marks \u2014 the temporary geography of a thousand transactions, already fading.","","A single Varrek woman remained. Old. Thin. She sat beside the primary drainage channel with a slate board and a stylus, recording the water flow. Her work was not the market \u2014 it was the platform. The engineering that made Velundri possible.","","She looked up as your shadow crossed her work.","","\"The drainage hasn't changed in two hundred years.\" She spoke without being asked. Varrek precision: the information was relevant, so she provided it. \"The channels were cut by my grandmother's crew. The gradient is seven-point-three degrees per hundred \u2014 seven-point-four.\" She corrected herself, looked annoyed at the correction, wrote it down. \"Per hundred feet. Optimal for coral substrate drainage at this latitude.\" She returned to her slate. \"I've been measuring this channel for thirty years and it still surprises me.\"","","You stood on the empty platform. South, the ocean stretched \u2014 darker than it had been at Selvaggio, darker than it had been at any stop. The Kingsrun gradient. The water deepened by degrees, and the color tracked the depth, and the depth tracked the distance from the world you had known.","","*goto departure_south","","*label terrek_departure","","*if (crew4_name = \"Terrek Ghaal\")","  The galley was warm. The spice packets were sorted \u2014 four piles, smallest to largest, the ground bark separated into a discard bowl and the real spices arranged by heat profile. Terrek was cutting something. Root vegetable, local \u2014 bought at the weight-trade for a coil of rope the crew couldn't spare but Terrek had insisted on.","","  \"Sit,\" he said. He didn't look up from the board. \"Eat.\"","","  A bowl was already set. Rice, salted, with a layer of Brannach sulfur-salt fish and a sprig of something green from Merrenbach's reef-dried kelp stock. Ship food. Terrek's ship food \u2014 which meant it was better than most port restaurants and was delivered without ceremony or expectation.","","  He cooked while you ate. The galley moved with the harbor swell \u2014 small, rhythmic, motion that had become invisible over six stops and fifty-something days at sea.","","  \"My mother was Gorundai.\" He said it to the cutting board. The knife rhythm didn't change. \"From the Kethrun mining district. My father was Gorundai. From the same district. They made soul-bars when my grandmother died \u2014 mixed her ashes with iron dust and hammered them at the clan forge. I carried one until I was nineteen.\"","","  The knife paused.","","  \"I left the bar at a shrine in Kallenport. I was nineteen. I'd been cooking in port kitchens for three years and I was good at it and I was tired of being good at something nobody in the mining district cared about.\" He resumed cutting. \"Gorundai respect for craft is real. Gorundai respect for cooking specifically is \u2014 conditional. If you cook for soldiers, you're essential. If you cook because the food matters to you, because the flavor is worth getting right, because feeding people well is a thing that changes them \u2014 that's soft work. Soft work in a mining district is tolerated. Tolerated isn't respected.\"","","  He looked up. The face was Gorundai \u2014 the tusked jaw and the heavy brow and the skin that was grey-green in the galley's lamplight. The expression was Terrek's own.","","  \"I'm not on this ship because I had nowhere else to go. I'm on this ship because the Kingsrun goes somewhere nobody's cooked before. Durromakh. The Shoalfields. The deep stops where the ingredients are different and the crews have been eating the same salt-fish for months and they've forgotten what food can do.\" He set down the knife. \"I want to cook at the Sundren. I want to stand on a continent nobody's built a kitchen on and make something from whatever grows there. That's my Kingsrun.\"","","  He picked the knife back up.","","  \"Now eat. We're leaving in an hour and I need the bowl back.\"","","  *set crew4_loyalty %+ 8","","*goto departure_south","","*label departure_south","","*comment ---------------------------------------------------","*comment  DEPARTURE FROM VELUNDRI","*comment ---------------------------------------------------","","*set current_stop 7","*set current_stop_name \"At Sea \u2014 Toward Durromakh\"","*set days_since_departure + 1","*if (food_days > 0)","  *set food_days - 1","","The mooring lines came in. The anchor broke free from the coral shelf with a sound like a tooth being pulled \u2014 grit and suction and then the sudden weightlessness of a ship that belonged to the ocean again.","","The Sundered Wake turned south.","","*if (crew3_name = \"Kessara Veldt\")","  \"Heading one-seven-five. Wind northeast, steady. Making six knots.\" Kessara at the helm, the tiller in her good hand, the chart pinned beside her. The engineer-turned-navigator who had kept this ship alive since Selvaggio was doing the math she always did \u2014 wind against current, speed against supply, distance against the body's willingness to keep going.","","  \"Four days to Durromakh. If the wind holds.\"","","  The conditional.","","Velundri shrank behind them. The flat coral platform, the drainage channels, the single Varrek woman with her slate \u2014 all of it compressed to a white line on the northern horizon and then to nothing. Gone. The sixth stop. The last stop where the Kingsrun was still a race, still a test of endurance and luck and crew cohesion. After Velundri, the Kingsrun became something else. The revelation had told them that.","","The crew knew. The weight of it showed in how they moved \u2014 not slower, not faster. Differently. The way people moved when the rules had changed and the new rules hadn't been written yet.","","*page_break","","*comment ---------------------------------------------------","*comment  TWO DAYS SOUTH \u2014 OPEN WATER","*comment ---------------------------------------------------","","*set days_since_departure + 2","*if (food_days >= 2)","  *set food_days - 2","*if (food_days < 2)","  *set food_days 0","*set total_sea_days + 2","","Two days of open water. The longest unbroken stretch since Selvaggio to Galluun's Tooth, and the ocean was different here. The color had shifted \u2014 from the bright blue of the northern Bastion to a deeper shade, almost indigo \u2014 a color that meant depth. Real depth. The charts showed nothing below them for twelve hundred feet. The water was warm at the surface and cold at the keel, and the differential made the hull sweat \u2014 condensation on the inner planking that dripped in the darkness of the hold.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek cooked. Twice a day. The spice packets held. The sulfur-salt from Brannach made the difference \u2014 the way it transformed the base ingredients from survival to sustenance. The crew ate together at the stern, sitting on coiled rope and deck crates, and the meals were the scaffold that held the days together.","","*if (crew3_name = \"Kessara Veldt\")","  Kessara tracked the distance. One hundred miles south of Velundri. Two hundred. The wind held \u2014 northeast, steady, the kind of cooperative weather that made experienced sailors nervous because the Bastion Sea didn't cooperate without a reason.","","  \"Barometric pressure's been dropping since yesterday.\" She said it on the morning of the second day, reading the instrument Sullavenne had traded for at the weight-market. A glass tube filled with liquid, marked with Varrek notation. \"Down three \u2014 no, wait. I'm reading the wrong mark.\" She tilted the tube. Squinted. \"Down two points. Slow drop. Consistent. Not a squall pattern \u2014 squalls drop fast and recover. This is a system.\" She looked at the tube again. \"I think. I've never used Varrek notation before and the increments are in base twelve.\"","","  She looked south.","","  \"Something's building.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had not slept well. You could tell because the former intelligence officer's discipline included managing visible fatigue, and the management was showing \u2014 the extra care with which she moved, the deliberate steadiness that replaced the natural kind.","","  Her Grimoire was active. She'd been monitoring broadcasts \u2014 the Green-band civilian frequencies, the scraps of Grey-band military traffic that the modified Grimoire from Galluun's Tooth could receive.","","  \"Wardensea patrol traffic has decreased.\" She said it at midday, standing at the rail. \"In the last twelve hours, four patrol broadcast check-ins were expected. Two occurred. The other two \u2014 silence.\"","","  She let you process that.","","  \"Patrols don't go silent unless they're ordered to. Or unless something in their patrol area is making broadcast a bad idea.\"","","*page_break","","*comment ---------------------------------------------------","*comment  THE GRIMOIRE BROADCAST \u2014 FINAL","*comment ---------------------------------------------------","","*set broadcast_count + 1","","The Grimoire lit up at sunset.","","The broadcast was Kingsrun Watch \u2014 the independent Grimoire channel that tracked crew movements, bounty updates, and the ongoing drama of people trying to sail to the end of the world. The host was the same voice that had followed you since Selvaggio: Veshanna Torc, the Khari commentator whose audience had grown alongside the Cursed Generation crews she covered.","","The broadcast played on the deck. The crew gathered \u2014 not by decision but by gravity. The Grimoire's glow was the only light besides the stars.","","*comment Dynamic bounty based on player actions across 6 chapters","*if (bounty >= 50000000)","  \"Merdou Akkan, the Sundered Wake. Six stops. Bounty at ${bounty} Sovereigns and climbing.\" Veshanna's voice was measured, precise, Khari \u2014 the cadence of someone who used height and silence as spatial metaphors because she'd grown up in the warrens. \"The half-Oni from the Sennaku Highlands has gone from cold entry at Selvaggio to a name the Watch can't ignore. The betting board has adjusted \u2014 current odds on reaching Stop 10: forty-five to one. Better than where they started. Worse than where they need to be.\"","*if (bounty < 50000000)","  \"Merdou Akkan, the Sundered Wake. Six stops. Bounty still minimal \u2014 the Wardensea hasn't flagged them high-priority, which means they're either very clean or very lucky.\" Veshanna's voice was the same it had been since Selvaggio \u2014 measured, Khari, the cadence of someone who documented other people's ambition for a living. \"The betting board has them at two hundred to one. Long odds. But they're still sailing, which is more than sixty percent of the season's crews can say.\"","","\"Ahead of them: Durromakh. Cassara Vellune's toll gate. The Morventhi has tripled the passage fee this season \u2014 crews are turning back at Stop 7 because they can't afford to go through. The Kingsrun Watch has confirmed twelve crew reversals at Durromakh in the last month.\"","","A pause. The broadcast shifted tone \u2014 the clipped register that meant breaking news, the kind that moved bounty markets and changed crew calculations.","","\"And in the last six hours \u2014 weather. South of Velundri, between Stops 6 and 7, a storm system has formed. Rapid onset. No natural precursor \u2014 satellite barometry shows clear conditions twelve hours ago. The system is concentrated, localized, and moving along the Kingsrun corridor.\"","","Another pause. The Grimoire hummed with signal processing.","","\"Wardensea patrols in the area have gone dark. Two cutters, one frigate. All three ceased broadcasting at 14:00 hours. The Wardensea's southern command has issued a navigation warning for all vessels in the Velundri-Durromakh corridor.\"","","Veshanna's voice dropped. The precision didn't waver, but the space between words widened \u2014 the Khari instinct for letting silence carry weight.","","\"The Kingsrun Watch recognizes the pattern. A localized storm with no natural origin, Wardensea patrols going silent, and weather that moves along the Kingsrun route instead of across it.\"","","\"Kuldhara Mabaan is in the water.\"","","The Grimoire hissed with signal static \u2014 the comment section erupting. Hundreds of responses per second. The name did that. The Living Storm. The youngest Conqueror. The Oni woman who controlled the highlands and watched the Kingsrun from above, and when she came down to the ocean, the weather came with her.","","*page_break","","*comment ---------------------------------------------------","*comment  THE STORM","*comment ---------------------------------------------------","","*choice","  #Hold course. The Sundered Wake is south of Velundri and north of Durromakh. There is no port between. There is no turning back. The only direction is through.","    *set personality_aggression %+ 5","    *goto storm_approach","","  #Reduce sail. Slow the ship. Give the storm time to pass, or to find whatever it's looking for. A Conqueror's attention is a resource you don't spend unless you choose to.","    *set personality_aggression %- 3","    *goto storm_approach","","  #Wake the crew. Battle stations \u2014 not for a fight, but for survival. Secure everything. Tie down the hold. Prep for heavy weather. Whatever Kuldhara Mabaan is doing out there, the Sundered Wake will be ready for the ocean she brings with her.","    *set personality_loyalty %+ 3","    *goto storm_approach","","*label storm_approach","","The wind changed.","","It happened in a line \u2014 a visible boundary in the water, the surface texture shifting from the steady northeast chop they'd been sailing for two days to something else. South of the line, the water was flat. Unnaturally flat. Oiled. The swells that had been pushing the ship in rhythmic sets simply stopped, as if someone had laid a hand on the ocean and said *enough*.","","The temperature dropped. Not gradually \u2014 in a step. Warm to cold. The condensation on the hull reversed \u2014 the metal fittings went dry and then wet again with a different kind of moisture. The air tasted of copper and salt and something sharper. Static. The hair on your forearms lifted.","","*if (crew3_name = \"Kessara Veldt\")","  \"Barometric free-fall.\" Kessara was at the instrument. The liquid in the glass tube was dropping \u2014 visibly, measurably, the kind of pressure change that didn't happen in open ocean without a major cyclonic system. But there was no cyclone. The sky above was clear. Stars. The Southern Cross at the horizon. Clear air \u2014 except to the south, where the stars ended.","","  A wall. Dark. Rising from the waterline to a height that swallowed the horizon. No gradual cloud-build. No leading edge of cirrus or advancing grey. A wall of weather, standing across the Kingsrun like a door.","","  \"That's not a storm system.\" Kessara's voice was steady. The steadiness was effort. \"That's a Fruit event. That's someone's power written on the sky.\"","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne had the Grimoire open. The Green-band was static \u2014 civilian broadcasts overwhelmed by interference. The Grey-band was worse. Military frequencies that had been carrying patrol traffic twelve hours ago were silent, replaced by a low, rhythmic pulse that the modified Grimoire registered as signal but couldn't decode.","","  \"The pulse is regular.\" She held the device toward you. The screen showed a waveform \u2014 peaks and valleys at consistent intervals. \"Point-eight seconds between peaks. Consistent amplitude. It's not random interference.\"","","  She looked at the wall of weather.","","  \"It's a heartbeat.\"","","The first lightning struck.","","Not from the wall \u2014 from the water. A column of white-blue light erupted from the ocean's surface a quarter mile south, climbing into the dark sky and vanishing. No thunder. The light came and went in silence, and the afterimage burned a line across your vision.","","The second strike was closer. Two hundred yards. The water where it hit glowed \u2014 phosphorescent, the charge dispersing across the surface in branching veins that pulsed once and faded.","","The third strike hit the water between the Sundered Wake and the storm wall. A hundred yards. The sound arrived late \u2014 a crack that wasn't thunder. Sharper. More focused. The sound of something breaking the air apart with precision rather than force.","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek was on deck. The Gorundai had come up from the galley carrying two things: a knife he'd forgotten to put down and a clay bowl with a lid. He pressed the bowl into your hands without a word \u2014 warm, the lid rattling, the smell of rice and sulfur-salt leaking from the seal. He'd been cooking when the lightning started and his first response had been to bring you food. He stood at the starboard rail, gripping the wood with both hands, the knife still in his belt where he'd shoved it, and his face was turned south toward the lightning.","","  He was Gorundai. He'd grown up in mines where the mountain shook and the ore glowed and the fissure walls hummed with a frequency you felt in the teeth. He knew the vocabulary of forces larger than a person.","","  But this was different. The lightning walked the water in a pattern \u2014 not random, not scattered. Rhythmic. Point-eight seconds between strikes. A heartbeat. Something alive was writing on the ocean with electricity, and the handwriting was steady, and the handwriting was coming closer.","","  \"Kessuura,\" he whispered. The Oni storm-goddess. The name the Oni gave to weather that had intent. The Gorundai knew the name because the Gorundai lived near the Oni highlands, and when Kessuura spoke, even the mines went quiet.","","*page_break","","*comment ---------------------------------------------------","*comment  THE INTERCEPT","*comment ---------------------------------------------------","","The storm wall moved.","","Not like weather. Weather drifted, built, dissipated. This moved with intention \u2014 a lateral shift, the entire wall of cloud and lightning and impossible pressure sliding east along the Kingsrun corridor, closing the gap between the weather and the ship. The wind changed again \u2014 not northeast anymore. From the south. From inside the storm. Warm wind. Hot. The kind of heat that came off skin, off a body running at full temperature, off someone whose Dominion ran so hot that the air around them shimmered.","","The Grimoire broadcast cut.","","Mid-sentence. Veshanna Torc's voice \u2014 she'd been providing live updates, the Kingsrun Watch's signal boosted by the relay stations that dotted the corridor \u2014 stopped. The Grimoire screen flickered. Static. The signal bars dropped to zero. The relay stations south of Velundri had gone dark. The signal north \u2014 back toward Velundri, back toward Kelvanni, back toward the world \u2014 was still there. But the world ahead was silent.","","The lightning reached the ship.","","A pass \u2014 exploratory. A bolt of white-blue fire arced from the water thirty feet to starboard, climbed into the air above the ship, and crossed to port \u2014 tracing a line over the Sundered Wake from east to west. The heat was immediate. The wood of the rail steamed. The metal fittings sang \u2014 a harmonic vibration, the iron resonating with the charge that had just passed through the air above it.","","Nothing was damaged. Nothing was hit. The bolt had crossed over the ship the way a hand crosses over a table \u2014 surveying. Looking.","","The crew was still. The ocean was flat. The storm wall held, five hundred yards south, lightning walking its surface in that rhythm \u2014 point-eight seconds, point-eight seconds, point-eight seconds. A heartbeat. Alive.","","*if dominion_vision >= 10","  And something else. At the edge of the storm wall \u2014 a shape. Your Vision, unreliable and growing, caught it for a half-second before the lightning wash blanked the read. A figure. Standing on the water's surface. Tall. Horned. The outline of someone whose body was wreathed in electricity, whose hair stood with static, whose feet rested on the ocean as if the ocean were floor.","","  The figure was facing the ship.","","  The Vision read one thing before it burned out: joy. Wild, enormous, delighted joy \u2014 the emotional signature of someone who had found something in the water and was thrilled by it.","","*if dominion_vision < 10","  From the storm wall \u2014 light. Not lightning. Steadier. A glow at the base of the cloud, where the dark wall met the water. Something was there. Something that burned hot enough to illuminate the storm from inside. The shape was indistinct \u2014 distance and charge interference reduced it to a silhouette. Tall. Broad.","","  Watching.","","*page_break","","*comment ---------------------------------------------------","*comment  FINAL GRIMOIRE \u2014 BOUNTY AND STATUS","*comment ---------------------------------------------------","","The Grimoire flickered back to life. A burst \u2014 three seconds of signal, the last relay station before the dead zone catching a fragment of the Watch broadcast and throwing it forward.","","Veshanna's voice, mid-sentence:","","\"\u2014 confirmed. Kuldhara Mabaan's patrol fleet has been sighted south of Velundri. Three ships. The Living Storm herself is \u2014\"","","Static. Gone.","","The Grimoire held the last frame of the broadcast. Your profile. The bounty number.","","*if (bounty >= 50000000)","  ${bounty} Sovereigns. The number meant something now. Six stops ago it had been zero. Six stops ago you had been a highland exile with twelve coins and no ship and no crew and no name the world cared about.","","  The Grimoire followers: ${grimoire_followers}. People were watching. People who would not see what happened next, because the signal was dead and the storm was between you and the audience, and whatever Kuldhara Mabaan wanted with the Sundered Wake, she wanted it private.","","*if (bounty < 50000000)","  ${bounty} Sovereigns. Low. Unremarkable. A number that said the Masqarat hadn't noticed.","","  But someone had noticed. The storm that stood across the Kingsrun was not the Masqarat's. The weather that closed the corridor was not official, not jurisdictional, not a function of law or order. It was a woman in the water. An Oni from the highlands. A Conqueror who watched Kingsrun crews and chose \u2014 chose \u2014 which ones passed.","","  The Grimoire followers: ${grimoire_followers}. However many they were, they couldn't see this. The relay was dead. What happened next was between the crew and the storm.","","*comment ---------------------------------------------------","*comment  FINAL CREW STATUS","*comment ---------------------------------------------------","","*if (crew3_name = \"Kessara Veldt\")","  Kessara was at the helm. Her hands were on the tiller. Her eyes were on the wall.","","  \"I can't \u2014\" She swallowed. Started over. \"The ship can't outrun weather. If she wants us stopped, we're stopped.\"","","  She looked at you. Her hand was still on the tiller. The knuckles hadn't relaxed since the first bolt.","","  \"But the lightning didn't hit us. It went over us. If she wanted us \u2014\" She blinked. \"We'd know.\"","","*if (crew4_name = \"Terrek Ghaal\")","  Terrek stood at the rail. The Gorundai's hands were at his sides \u2014 fists. Then open. Then fists again. His weight kept shifting forward, toward the storm, the way his body leaned toward a pot when the smell changed. One hand came up and gripped the rail. The other stayed at his side, fingers moving \u2014 reaching for a knife that wasn't there, or a spoon, or whatever his hands reached for when the world went sideways.","","  He wiped his mouth with the back of his hand. Did it again. His lips were dry and he kept licking them and they kept drying. He couldn't stop looking south.","","*if (crew5_name = \"Sullavenne Ohn\")","  Sullavenne closed the Grimoire. The signal was dead. The former intelligence officer who had spent her career inside the Wardensea's information network was, for the first time since you had met her, operating without data.","","  She looked at the storm. She looked at you.","","  \"She's Oni,\" Sullavenne said. Quiet. \"You're Oni. Half-Oni. Sennaku tattoos. Ram horns.\" A pause. \"If she has Vision \u2014 and she does, Conquerors always do \u2014 she's already read you. She knows your heart rate. She knows your Armoring potential. She knows where you're from.\"","","  The notebook was in her pocket. Her hand was on it.","","  \"The question isn't whether she sees you. The question is what she does with what she sees.\"","","*page_break","","*comment ---------------------------------------------------","*comment  THE ENDING","*comment ---------------------------------------------------","","The Sundered Wake held its position. The ocean was flat. The storm wall stood at five hundred yards, lightning walking its face in that steady rhythm \u2014 point-eight, point-eight, point-eight. A heartbeat. The Conqueror's heartbeat, written on the weather, broadcast to the ocean.","","The crew of the Sundered Wake stood on the deck of a ship that had been a salvage claim at Selvaggio, that had been patched and patched again and declared \"not good, better\" by an engineer who'd rebuilt it with a broken wrist. The ship that had carried them past six stops. The ship whose name was carved on the reef wall at Galluun's Tooth.","","South of them: a Conqueror. A storm. A toll gate and a fortress and a ocean that got darker and deeper and older the further you went. The Kingsrun \u2014 the real Kingsrun, the one that existed before the Sovereign King gave it a name, the corridor that selected and tested and watched \u2014 stretched ahead into water no chart fully mapped.","","North of them: Velundri and Kelvanni and Brannach and Merrenbach and Galluun's Tooth and Selvaggio and the highland where you had been born and the bell that had rung once or twice and the world you'd left behind.","","*if (bell_rings = 1)","  One ring. Safe journey. No promise to return. The bell's echo had faded five stops ago. The journey had not been safe.","*if (bell_rings = 2)","  Two rings. A promise to return. The bell's echo had faded five stops ago. The promise had not.","","The storm was watching them.","","And the storm was smiling.","","*page_break","","*comment ---------------------------------------------------","*comment  GAME 1 \u2014 FINAL STATS AND CHECKPOINT","*comment ---------------------------------------------------","","*set velundri_revelation true","","[b]KINGSRUN: THE DEPARTURE[/b]","[b]End of Game 1[/b]","","[b]Captain:[/b] ${mc_name}","[b]Ship:[/b] ${ship_name}","[b]Crew:[/b] ${crew_count}","[b]Bounty:[/b] ${bounty} Sovereigns","[b]Grimoire Followers:[/b] ${grimoire_followers}","[b]Dominion \u2014 Armoring:[/b] ${armoring_tier} | [b]Vision:[/b] ${vision_tier} | [b]King:[/b] ${king_tier}","[b]Kingsrun Position:[/b] South of Stop 6 \u2014 Approaching Durromakh","[b]Days Since Departure:[/b] ${days_since_departure}","","*page_break","","*comment ---------------------------------------------------","*comment  CHECKPOINT CODE GENERATION","*comment  Encode ~30 key variables for Game 2 import","*comment ---------------------------------------------------","","*comment ---------------------------------------------------","*comment  CHECKPOINT CODE \u2014 Positional Encoding","*comment  Each variable maps to a fixed character(s).","*comment  Delimiter: dash (-) between sections.","*comment  Player copies the full string.","*comment  Game 2 decodes by splitting on dashes.","*comment ---------------------------------------------------","","*comment Build the code in sections, concatenating into save_code","*temp save_code \"\"","","*comment === SECTION 1: MC IDENTITY (8 single chars) ===","*temp id_parent \"X\"","*if (mc_parent = \"oni_mother\")","  *set id_parent \"O\"","*if (mc_parent = \"human_father\")","  *set id_parent \"H\"","","*temp id_height \"X\"","*if (mc_height = \"human_passing\")","  *set id_height \"1\"","*if (mc_height = \"noticeable\")","  *set id_height \"2\"","*if (mc_height = \"imposing\")","  *set id_height \"3\"","*if (mc_height = \"towering\")","  *set id_height \"4\"","","*temp id_horns \"X\"","*if (mc_horns = \"swept_back\")","  *set id_horns \"S\"","*if (mc_horns = \"single_central\")","  *set id_horns \"C\"","*if (mc_horns = \"ram_curved\")","  *set id_horns \"R\"","*if (mc_horns = \"broken\")","  *set id_horns \"B\"","","*temp id_skin \"X\"","*if (mc_skin = \"bronze_red\")","  *set id_skin \"R\"","*if (mc_skin = \"blue_grey\")","  *set id_skin \"B\"","*if (mc_skin = \"muted_violet\")","  *set id_skin \"V\"","*if (mc_skin = \"ash_white\")","  *set id_skin \"W\"","","*temp id_build \"X\"","*if (mc_build = \"lean\")","  *set id_build \"L\"","*if (mc_build = \"broad\")","  *set id_build \"B\"","*if (mc_build = \"wiry\")","  *set id_build \"W\"","*if (mc_build = \"balanced\")","  *set id_build \"D\"","","*temp id_hair \"X\"","*if (mc_hair = \"white_long\")","  *set id_hair \"W\"","*if (mc_hair = \"black_cropped\")","  *set id_hair \"C\"","*if (mc_hair = \"dark_red_tied\")","  *set id_hair \"R\"","*if (mc_hair = \"silver_wild\")","  *set id_hair \"S\"","*if (mc_hair = \"black_mane\")","  *set id_hair \"M\"","","*temp id_back \"X\"","*if (mc_backstory = \"debt\")","  *set id_back \"D\"","*if (mc_backstory = \"name_on_wall\")","  *set id_back \"N\"","*if (mc_backstory = \"exile\")","  *set id_back \"E\"","*if (mc_backstory = \"broadcast\")","  *set id_back \"B\"","","*temp id_motive \"X\"","*if (mc_motivation = \"prove_wrong\")","  *set id_motive \"P\"","*if (mc_motivation = \"find_father\")","  *set id_motive \"F\"","*if (mc_motivation = \"see_the_end\")","  *set id_motive \"S\"","*if (mc_motivation = \"build_something\")","  *set id_motive \"B\"","","*set save_code id_parent","*set save_code (save_code & id_height)","*set save_code (save_code & id_horns)","*set save_code (save_code & id_skin)","*set save_code (save_code & id_build)","*set save_code (save_code & id_hair)","*set save_code (save_code & id_back)","*set save_code (save_code & id_motive)","","*comment === SECTION 2: DOMINION + POWER (separated by dash) ===","*temp d_arm round(dominion_armoring)","*temp d_vis round(dominion_vision)","*temp d_king round(dominion_king)","*set save_code (save_code & \"-\")","*set save_code (save_code & d_arm)","*set save_code (save_code & \"-\")","*set save_code (save_code & d_vis)","*set save_code (save_code & \"-\")","*set save_code (save_code & d_king)","","*temp id_korvaan 0","*if (korvaan_stage = \"callus\")","  *set id_korvaan 1","*if (korvaan_stage = \"ironset\")","  *set id_korvaan 2","*if (korvaan_stage = \"fleshweave\")","  *set id_korvaan 3","*if (korvaan_stage = \"nerveburn\")","  *set id_korvaan 4","*if (korvaan_stage = \"reforged\")","  *set id_korvaan 5","","*temp id_fruit 0","*if has_god_fruit","  *set id_fruit 1","*if god_fruit_awakened","  *set id_fruit 2","","*set save_code (save_code & \"-\")","*set save_code (save_code & id_korvaan)","*set save_code (save_code & id_fruit)","","*comment === SECTION 3: BOUNTY + FOLLOWERS ===","*set save_code (save_code & \"-\")","*set save_code (save_code & bounty)","*set save_code (save_code & \"-\")","*set save_code (save_code & grimoire_followers)","","*comment === SECTION 4: CREW ROSTER ===","*comment Each crew slot: E(xists)A(live)L(oyalty) \u2014 e.g., \"YY75\" = exists, alive, loyalty 75","*comment \"NN00\" = doesn't exist","","*temp cl1 round(crew1_loyalty)","*temp cl2 round(crew2_loyalty)","*temp cl3 round(crew3_loyalty)","*temp cl4 round(crew4_loyalty)","*temp cl5 round(crew5_loyalty)","","*temp c1_code \"NN00\"","*if crew1_exists","  *if crew1_alive","    *set c1_code (\"YY\" & cl1)","  *if (crew1_alive = false)","    *set c1_code (\"YN\" & cl1)","","*temp c2_code \"NN00\"","*if crew2_exists","  *if crew2_alive","    *set c2_code (\"YY\" & cl2)","  *if (crew2_alive = false)","    *set c2_code (\"YN\" & cl2)","","*temp c3_code \"NN00\"","*if crew3_exists","  *if crew3_alive","    *set c3_code (\"YY\" & cl3)","  *if (crew3_alive = false)","    *set c3_code (\"YN\" & cl3)","","*temp c4_code \"NN00\"","*if crew4_exists","  *if crew4_alive","    *set c4_code (\"YY\" & cl4)","  *if (crew4_alive = false)","    *set c4_code (\"YN\" & cl4)","","*temp c5_code \"NN00\"","*if crew5_exists","  *if crew5_alive","    *set c5_code (\"YY\" & cl5)","  *if (crew5_alive = false)","    *set c5_code (\"YN\" & cl5)","","*set save_code (save_code & \"-\")","*set save_code (save_code & c1_code)","*set save_code (save_code & \"-\")","*set save_code (save_code & c2_code)","*set save_code (save_code & \"-\")","*set save_code (save_code & c3_code)","*set save_code (save_code & \"-\")","*set save_code (save_code & c4_code)","*set save_code (save_code & \"-\")","*set save_code (save_code & c5_code)","","*comment === SECTION 5: CREW NAMES ===","*comment Encode crew names by first 3 chars or \"EMP\" for empty","*temp cn1 \"EMP\"","*if crew1_exists","  *set cn1 crew1_name","","*temp cn2 \"EMP\"","*if crew2_exists","  *set cn2 crew2_name","","*temp cn3 \"EMP\"","*if crew3_exists","  *set cn3 crew3_name","","*temp cn4 \"EMP\"","*if crew4_exists","  *set cn4 crew4_name","","*temp cn5 \"EMP\"","*if crew5_exists","  *set cn5 crew5_name","","*set save_code (save_code & \"-\")","*set save_code (save_code & cn1)","*set save_code (save_code & \"-\")","*set save_code (save_code & cn2)","*set save_code (save_code & \"-\")","*set save_code (save_code & cn3)","*set save_code (save_code & \"-\")","*set save_code (save_code & cn4)","*set save_code (save_code & \"-\")","*set save_code (save_code & cn5)","","*comment === SECTION 6: CREW RACES ===","*temp cr1 \"XX\"","*if crew1_exists","  *set cr1 crew1_race","","*temp cr2 \"XX\"","*if crew2_exists","  *set cr2 crew2_race","","*temp cr3 \"XX\"","*if crew3_exists","  *set cr3 crew3_race","","*temp cr4 \"XX\"","*if crew4_exists","  *set cr4 crew4_race","","*temp cr5 \"XX\"","*if crew5_exists","  *set cr5 crew5_race","","*set save_code (save_code & \"-\")","*set save_code (save_code & cr1)","*set save_code (save_code & \"-\")","*set save_code (save_code & cr2)","*set save_code (save_code & \"-\")","*set save_code (save_code & cr3)","*set save_code (save_code & \"-\")","*set save_code (save_code & cr4)","*set save_code (save_code & \"-\")","*set save_code (save_code & cr5)","","*comment === SECTION 7: CREW ROLES ===","*temp rl1 \"XX\"","*if crew1_exists","  *set rl1 crew1_role","","*temp rl2 \"XX\"","*if crew2_exists","  *set rl2 crew2_role","","*temp rl3 \"XX\"","*if crew3_exists","  *set rl3 crew3_role","","*temp rl4 \"XX\"","*if crew4_exists","  *set rl4 crew4_role","","*temp rl5 \"XX\"","*if crew5_exists","  *set rl5 crew5_role","","*set save_code (save_code & \"-\")","*set save_code (save_code & rl1)","*set save_code (save_code & \"-\")","*set save_code (save_code & rl2)","*set save_code (save_code & \"-\")","*set save_code (save_code & rl3)","*set save_code (save_code & \"-\")","*set save_code (save_code & rl4)","*set save_code (save_code & \"-\")","*set save_code (save_code & rl5)","","*comment === SECTION 8: CREW TRUST LEVELS ===","*temp ct1 \"XX\"","*if crew1_exists","  *set ct1 crew1_trust","","*temp ct2 \"XX\"","*if crew2_exists","  *set ct2 crew2_trust","","*temp ct3 \"XX\"","*if crew3_exists","  *set ct3 crew3_trust","","*temp ct4 \"XX\"","*if crew4_exists","  *set ct4 crew4_trust","","*temp ct5 \"XX\"","*if crew5_exists","  *set ct5 crew5_trust","","*set save_code (save_code & \"-\")","*set save_code (save_code & ct1)","*set save_code (save_code & \"-\")","*set save_code (save_code & ct2)","*set save_code (save_code & \"-\")","*set save_code (save_code & ct3)","*set save_code (save_code & \"-\")","*set save_code (save_code & ct4)","*set save_code (save_code & \"-\")","*set save_code (save_code & ct5)","","*comment === SECTION 9: CREW ROMANCE ===","*temp rm1 0","*if crew1_romance_active","  *set rm1 crew1_romance","","*temp rm2 0","*if crew2_romance_active","  *set rm2 crew2_romance","","*temp rm3 0","*if crew3_romance_active","  *set rm3 crew3_romance","","*temp rm4 0","*if crew4_romance_active","  *set rm4 crew4_romance","","*temp rm5 0","*if crew5_romance_active","  *set rm5 crew5_romance","","*set save_code (save_code & \"-\")","*set save_code (save_code & rm1)","*set save_code (save_code & \"-\")","*set save_code (save_code & rm2)","*set save_code (save_code & \"-\")","*set save_code (save_code & rm3)","*set save_code (save_code & \"-\")","*set save_code (save_code & rm4)","*set save_code (save_code & \"-\")","*set save_code (save_code & rm5)","","*comment === SECTION 10: PERSONALITY AXES (rounded to int) ===","*temp pa_agg round(personality_aggression)","*temp pa_loy round(personality_loyalty)","*temp pa_opn round(personality_openness)","*temp pa_mer round(personality_mercy)","*set save_code (save_code & \"-\")","*set save_code (save_code & pa_agg)","*set save_code (save_code & \"-\")","*set save_code (save_code & pa_loy)","*set save_code (save_code & \"-\")","*set save_code (save_code & pa_opn)","*set save_code (save_code & \"-\")","*set save_code (save_code & pa_mer)","","*comment === SECTION 11: PLOT FLAGS ===","*temp pf_bell bell_rings","*temp pf_fight 0","*if selvaggio_fight_won","  *set pf_fight 1","*temp pf_reef 0","*if completed_reef_walk","  *set pf_reef 1","*temp pf_slag 0","*if received_slag_gift","  *set pf_slag 1","*temp pf_erupt 0","*if brannach_eruption_survived","  *set pf_erupt 1","*temp pf_weapon 0","*if obtained_weapon","  *set pf_weapon 1","*temp pf_clinic 0","*if clinic_debt_owed","  *set pf_clinic 1","*temp pf_coat 0","*if coat_traded","  *set pf_coat 1","*temp pf_2age 0","*if second_age_fragment","  *set pf_2age 1","*temp pf_king 0","*if king_manifested","  *set pf_king 1","*temp pf_carved 0","*if carved_name_reef","  *set pf_carved 1","*temp pf_khari 0","*if khari_trust_earned","  *set pf_khari 1","*temp pf_oursseva 0","*if met_oursseva","  *set pf_oursseva 1","","*set save_code (save_code & \"-\")","*set save_code (save_code & pf_bell)","*set save_code (save_code & pf_fight)","*set save_code (save_code & pf_reef)","*set save_code (save_code & pf_slag)","*set save_code (save_code & pf_erupt)","*set save_code (save_code & pf_weapon)","*set save_code (save_code & pf_clinic)","*set save_code (save_code & pf_coat)","*set save_code (save_code & pf_2age)","*set save_code (save_code & pf_king)","*set save_code (save_code & pf_carved)","*set save_code (save_code & pf_khari)","*set save_code (save_code & pf_oursseva)","","*comment === SECTION 12: SHIP + RESOURCES ===","*temp sc_cond round(ship_condition)","*temp sc_sov round(sovereigns)","*temp sc_sup round(supplies)","*set save_code (save_code & \"-\")","*set save_code (save_code & ship_name)","*set save_code (save_code & \"-\")","*set save_code (save_code & sc_cond)","*set save_code (save_code & \"-\")","*set save_code (save_code & sc_sov)","*set save_code (save_code & \"-\")","*set save_code (save_code & sc_sup)","*set save_code (save_code & \"-\")","*set save_code (save_code & days_since_departure)","","*comment === SECTION 13: FACTION REPS ===","*comment Offset by 100 to avoid negative numbers (range becomes 0-200)","*comment Game 2 decodes by subtracting 100","*temp fr_ward (rep_wardensea + 100)","*temp fr_kolm (rep_kolmari + 100)","*temp fr_ren (rep_renegade + 100)","*temp fr_khar (rep_khari_warrens + 100)","*temp fr_oni (rep_oni_highlands + 100)","*set save_code (save_code & \"-\")","*set save_code (save_code & fr_ward)","*set save_code (save_code & \"-\")","*set save_code (save_code & fr_kolm)","*set save_code (save_code & \"-\")","*set save_code (save_code & fr_ren)","*set save_code (save_code & \"-\")","*set save_code (save_code & fr_khar)","*set save_code (save_code & \"-\")","*set save_code (save_code & fr_oni)","","*comment === SECTION 14: RIVAL CAPTAINS ===","*comment Offset by 100 to avoid negatives. Game 2 subtracts 100.","*temp rv_mav 100","*if met_mavrokka","  *set rv_mav (rival_mavrokka + 100)","*temp rv_cael 100","*if met_caelmund","  *set rv_cael (rival_caelmund + 100)","*temp rv_tom 100","*if met_tomoe","  *set rv_tom (rival_tomoe + 100)","*temp rv_suu 100","*if met_suuba","  *set rv_suu (rival_suuba + 100)","*temp rv_kov 100","*if met_kovesse","  *set rv_kov (rival_kovesse + 100)","","*set save_code (save_code & \"-\")","*set save_code (save_code & rv_mav)","*set save_code (save_code & \"-\")","*set save_code (save_code & rv_cael)","*set save_code (save_code & \"-\")","*set save_code (save_code & rv_tom)","*set save_code (save_code & \"-\")","*set save_code (save_code & rv_suu)","*set save_code (save_code & \"-\")","*set save_code (save_code & rv_kov)","","*comment === SECTION 15: WEAPON + MISC ===","*set save_code (save_code & \"-\")","*set save_code (save_code & weapon_name)","*set save_code (save_code & \"-\")","*set save_code (save_code & weapon_grade)","*set save_code (save_code & \"-\")","*set save_code (save_code & god_fruit_name)","*set save_code (save_code & \"-\")","*set save_code (save_code & god_fruit_type)","","*comment === SECTION 16: DOMINION LEAN + MISC FLAGS ===","*temp id_lean \"B\"","*if (dominion_lean = \"armoring\")","  *set id_lean \"A\"","*if (dominion_lean = \"vision\")","  *set id_lean \"V\"","","*set save_code (save_code & \"-\")","*set save_code (save_code & id_lean)","*set save_code (save_code & \"-\")","*set save_code (save_code & galluuns_tooth_challenge)","*set save_code (save_code & \"-\")","*set save_code (save_code & merrenbach_deal)","*set save_code (save_code & \"-\")","*set save_code (save_code & kelvanni_favor)","*set save_code (save_code & \"-\")","*set save_code (save_code & revelation_type)","","*page_break","","*comment ---------------------------------------------------","*comment  DISPLAY CHECKPOINT CODE","*comment ---------------------------------------------------","","[b]YOUR KINGSRUN CHECKPOINT[/b]","[b]\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501[/b]","","Copy this code exactly. You will need it to continue your journey in [b]Kingsrun: The Deep Water[/b].","","[b]Code:[/b]","${save_code}","","[b]\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501[/b]","","[i]Select the code above and copy it to your clipboard. Store it somewhere safe \u2014 a text file, a note on your phone, anywhere you won't lose it. When Kingsrun: The Deep Water launches, you will paste this code at the start to restore your captain, your crew, your choices, and everything the Kingsrun remembers about you.[/i]","","[i]If you lose this code, The Deep Water will offer a \"Story So Far\" sequence where you can make the key decisions again \u2014 but it won't be the same. The Kingsrun remembers specifics. Approximations don't carry the same weight.[/i]","","*page_break","","[i]Thank you for playing.[/i]","","[i]Merdou Akkan sailed south. The ocean got darker. The crew got quieter. The Kingsrun was not what they thought it was.[/i]","","[i]It never had been.[/i]","","[i]\u2014 Continue in KINGSRUN: THE DEEP WATER \u2014[/i]","","[i]Kingsrun v${game_version} \u2014 \u00a9 Mert Akhan[/i]","","*ending",""], "labels":{"final_walk":84,"terrek_departure":98,"departure_south":127,"storm_approach":249}}}</script><script>
;
//
// Copyright (c) 2008, 2009 Paul Duncan (paul@pablotron.org)
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
//


/* 
 * The contents of gears_init.js; we need this because Chrome supports
 * Gears out of the box, but still requires this constructor.  Note that
 * if you include gears_init.js then this function does nothing.
 */
(function() {
  // We are already defined. Hooray!
  if (window.google && google.gears)
    return;

  // factory 
  var F = null;

  // Firefox
  if (typeof GearsFactory != 'undefined') {
    F = new GearsFactory();
  } else {
    // IE
    try {
      F = new ActiveXObject('Gears.Factory');
      // privateSetGlobalObject is only required and supported on WinCE.
      if (F.getBuildInfo().indexOf('ie_mobile') != -1)
        F.privateSetGlobalObject(this);
    } catch (e) {
      // Safari
      if ((typeof navigator.mimeTypes != 'undefined')
           && navigator.mimeTypes["application/x-googlegears"]) {
        F = document.createElement("object");
        F.style.display = "none";
        F.width = 0;
        F.height = 0;
        F.type = "application/x-googlegears";
        document.documentElement.appendChild(F);
      }
    }
  }

  // *Do not* define any objects if Gears is not installed. This mimics the
  // behavior of Gears defining the objects in the future.
  if (!F)
    return;

  // Now set up the objects, being careful not to overwrite anything.
  //
  // Note: In Internet Explorer for Windows Mobile, you can't add properties to
  // the window object. However, global objects are automatically added as
  // properties of the window object in all browsers.
  if (!window.google)
    google = {};

  if (!google.gears)
    google.gears = {factory: F};
})();

/**
 * Persist - top-level namespace for Persist library.
 * @namespace
 */
Persist = (function() {
  var VERSION = '0.2.0', P, B, esc, init, empty, ec;

  // easycookie 0.2.1 (pre-minified)
  // (see http://pablotron.org/software/easy_cookie/)
  ec = (function(){var EPOCH='Thu, 01-Jan-1970 00:00:01 GMT',RATIO=1000*60*60*24,KEYS=['expires','path','domain'],esc=escape,un=unescape,doc=document,me;var get_now=function(){var r=new Date();r.setTime(r.getTime());return r;}
var cookify=function(c_key,c_val){var i,key,val,r=[],opt=(arguments.length>2)?arguments[2]:{};r.push(esc(c_key)+'='+esc(c_val));for(i=0;i<KEYS.length;i++){key=KEYS[i];if(val=opt[key])
r.push(key+'='+val);}
if(opt.secure)
r.push('secure');return r.join('; ');}
var alive=function(){var k='__EC_TEST__',v=new Date();v=v.toGMTString();this.set(k,v);this.enabled=(this.remove(k)==v);return this.enabled;}
me={set:function(key,val){var opt=(arguments.length>2)?arguments[2]:{},now=get_now(),expire_at,cfg={};if(opt.expires){cfg.expires=new Date(now.getTime()+opt.expires*RATIO);cfg.expires=cfg.expires.toGMTString();}
var keys=['path','domain','secure'];for(i=0;i<keys.length;i++)
if(opt[keys[i]])
cfg[keys[i]]=opt[keys[i]];var r=cookify(key,val,cfg);doc.cookie=r;return val;},has:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+'='),len=ofs+key.length+1,sub=c.substring(0,key.length);return((!ofs&&key!=sub)||ofs<0)?false:true;},get:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+'='),len=ofs+key.length+1,sub=c.substring(0,key.length),end;if((!ofs&&key!=sub)||ofs<0)
return null;end=c.indexOf(';',len);if(end<0)
end=c.length;return un(c.substring(len,end));},remove:function(k){var r=me.get(k),opt={expires:EPOCH};doc.cookie=cookify(k,'',opt);return r;},keys:function(){var c=doc.cookie,ps=c.split('; '),i,p,r=[];for(i=0;i<ps.length;i++){p=ps[i].split('=');r.push(un(p[0]));}
return r;},all:function(){var c=doc.cookie,ps=c.split('; '),i,p,r=[];for(i=0;i<ps.length;i++){p=ps[i].split('=');r.push([un(p[0]),un(p[1])]);}
return r;},version:'0.2.1',enabled:false};me.enabled=alive.call(me);return me;}());

  // wrapper for Array.prototype.indexOf, since IE doesn't have it
  var index_of = (function() {
    if (Array.prototype.indexOf)
      return function(ary, val) { 
        return Array.prototype.indexOf.call(ary, val);
      };
    else
      return function(ary, val) {
        var i, l;

        for (i = 0, l = ary.length; i < l; i++)
          if (ary[i] == val)
            return i;

        return -1;
      };
  })();


  // empty function
  empty = function() { };

  /**
   * Escape spaces and underscores in name.  Used to generate a "safe"
   * key from a name.
   *
   * @private
   */
  esc = function(str) {
    return 'PS' + str.replace(/_/g, '__').replace(/ /g, '_s');
  };

  C = {
    /* 
     * Backend search order.
     * 
     * Note that the search order is significant; the backends are
     * listed in order of capacity, and many browsers
     * support multiple backends, so changing the search order could
     * result in a browser choosing a less capable backend.
     */ 
    search_order: [
      // TODO: air
      'steamworksStorage',
      'cefStorage',
      'winOldStorage',
      'winStoreStorage',
      'macStorage',
      'iosStorage',
      'localChromeStorage',
      'androidStorage',
      'indexed_db',
      'whatwg_db', 
      'localstorage',
      'globalstorage', 
      'cookie',
      'gears',
      'ie', 
      'flash'
    ],

    // valid name regular expression
    name_re: /^[a-z][a-z0-9_ -]+$/i,

    // list of backend methods
    methods: [
      'init', 
      'get', 
      'set', 
      'remove', 
      'load', 
      'save'
      // TODO: clear method?
    ],

    // sql for db backends (gears and db)
    sql: {
      version:  '1', // db schema version

      // XXX: the "IF NOT EXISTS" is a sqlite-ism; fortunately all the 
      // known DB implementations (safari and gears) use sqlite
      create:   "CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",
      get:      "SELECT v FROM persist_data WHERE k = ?",
      set:      "INSERT INTO persist_data(k, v) VALUES (?, ?)",
      remove:   "DELETE FROM persist_data WHERE k = ?" 
    },

    // default flash configuration
    flash: {
      // ID of wrapper element
      div_id:   '_persist_flash_wrap',

      // id of flash object/embed
      id:       '_persist_flash',

      // default path to flash object
      path: 'persist.swf',
      size: { w:1, h:1 },

      // arguments passed to flash object
      args: {
        autostart: true
      }
    } 
  };

  // built-in backends
  B = {
    // gears db backend
    // (src: http://code.google.com/apis/gears/api_database.html)
    gears: {
      // no known limit
      size:   -1,

      test: function() {
        // test for gears
        return (window.google && window.google.gears) ? true : false;
      },

      methods: {
        transaction: function(fn) {
          var db = this.db;

          // begin transaction
          db.execute('BEGIN').close();

          // call callback fn
          fn.call(this, db);

          // commit changes
          db.execute('COMMIT').close();
        },

        init: function() {
          var db;

          // create database handle (TODO: add schema version?)
          db = this.db = google.gears.factory.create('beta.database');

          // open database
          // from gears ref:
          //
          // Currently the name, if supplied and of length greater than
          // zero, must consist only of visible ASCII characters
          // excluding the following characters:
          //
          //   / \ : * ? " < > | ; ,
          //
          // (this constraint is enforced in the Store constructor)
          db.open(esc(this.name));

          // create table
          db.execute(C.sql.create).close();
        },

        get: function(key, fn, scope) {
          var r, sql = C.sql.get;

          // if callback isn't defined, then return
          if (!fn)
            return;

          // begin transaction
          this.transaction(function (t) {
            var is_valid, val;
            // exec query
            r = t.execute(sql, [key]);

            // check result and get value
            is_valid = r.isValidRow();
            val = is_valid ? r.field(0) : null;

            // close result set
            r.close();

            // call callback
            fn.call(scope || this, is_valid, val);
          });
        },

        set: function(key, val, fn, scope) {
          var rm_sql = C.sql.remove,
              sql    = C.sql.set, r;

          // begin set transaction
          this.transaction(function(t) {
            // exec remove query
            t.execute(rm_sql, [key]).close();

            // exec set query
            t.execute(sql, [key, val]).close();
            
            // run callback (TODO: get old value)
            if (fn)
              fn.call(scope || this, true, val);
          });
        },

        remove: function(key, fn, scope) {
          var get_sql = C.sql.get;
              sql = C.sql.remove,
              r, val = null, is_valid = false;

          // begin remove transaction
          this.transaction(function(t) {
            // if a callback was defined, then get the old
            // value before removing it
            if (fn) {
              // exec get query
              r = t.execute(get_sql, [key]);

              // check validity and get value
              is_valid = r.isValidRow();
              val = is_valid ? r.field(0) : null;

              // close result set
              r.close();
            }

            // exec remove query if no callback was defined, or if a
            // callback was defined and there was an existing value
            if (!fn || is_valid) {
              // exec remove query
              t.execute(sql, [key]).close();
            }

            // exec callback
            if (fn)
              fn.call(scope || this, is_valid, val);
          });
        } 
      }
    }, 

    steamworksStorage: {
      size:   -1,

      test: function() {
        try {
          return (typeof require !== "undefined" && require('steamworks.js'));
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {

        },

        get: function(key, fn, scope) {
          key = this.key(key);

          // if callback isn't defined, then return
          if (!fn)
            return;

          // get callback scope
          scope = scope || this;

          try {
            results = steamworks.cloud.readFile("store" + key);
            // steamworks.js fails with "" when the file doesn't exist
            if (results === "") return fn.call(scope, !"ok");
            var fixedResults = results.replace(/^.*\n/, "");
            if (!fixedResults.length) return fn.call(scope, !"ok");
            fn.call(scope, "ok", results.replace(/^.*\n/, ""));
          } catch (e) {
            fn.call(scope, !"ok");
          }
        },

        set: function(key, val, fn, scope) {
          key = this.key(key);
          scope = scope || this;
          var ok = steamworks.cloud.writeFile("store" + key, key+"\n"+val);
          if (fn) fn.call(scope, ok);
          return val;
        },

        // begin remove transaction
        remove: function(key, fn, scope) {
          key = this.key(key);
          scope = scope || this;
          var ok = steamworks.cloud.deleteFile("store" + key);
          if (fn) fn.call(scope, ok);
        }
      }
    },

    cefStorage: {
      size:   -1,

      test: function() {
        return !!window.cefQuery;
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {

        },

        query: function(method, paramString, callback) {
          cefQuery({request:method+" "+paramString,
            onSuccess: function(response) {
              callback(true, response);
            },
            onFailure: function(error_code, error_message) {
              console.error(method + " error: " + error_message);
              callback(false);
            }
          });
        },

        get: function(key, fn, scope) {
          key = this.key(key);

          // if callback isn't defined, then return
          if (!fn)
            return;

          // get callback scope
          scope = scope || this;

          this.query("StorageGet", key, function(ok, results) {
            fn.call(scope, ok, results);
          });
        },

        set: function(key, val, fn, scope) {
          key = this.key(key);
          scope = scope || this;
          this.query("StorageSet", key + " " + val, function(ok){
            if (fn) fn.call(scope, ok, val);
          });
          return val;
        },

        // begin remove transaction
        remove: function(key, fn, scope) {
          key = this.key(key);
          scope = scope || this;
          this.query("StorageRemove", key, function(ok) {
            // return original value? meh
            if (fn) fn.call(scope, ok);
          });
        }
      }
    },

    indexed_db: {
      size: -1,
      test: function() {
        return window.indexedDB;
      },
      methods: {
        promisifyRequest: function (request) {
          return new Promise(function(resolve, reject) {
            request.oncomplete = request.onsuccess = function() { resolve(request.result) };
            request.onabort = request.onerror = function() { reject(request.error) };
          });
        },

        init: function() {
          var request = indexedDB.open(this.name);
          request.onupgradeneeded = function () { return request.result.createObjectStore('PersistJS'); };
          var dbp = this.promisifyRequest(request);
          this.getStore = function (txMode, callback) {
            return dbp.then(function (db) {
              return callback(db.transaction('PersistJS', txMode).objectStore('PersistJS'));
            });
          };
        },

        get: function (key, fn, scope) {
          scope = scope || this;
          var self = this;
          this.getStore('readonly', function(store) {
            self.promisifyRequest(store.get(key)).then(function (val) {
              fn.call(scope, true, val);
            })
          }).catch(function(error) {
            console.error(error);
            fn.call(scope, false);
          })
        },

        set: function (key, val, fn, scope) {
          scope = scope || this;
          var self = this;
          this.getStore('readwrite', function (store) {
            store.put(val, key);
            self.promisifyRequest(store.transaction).then(function () {
              if (fn) fn.call(scope, true, val);
            })
          }).catch(function (error) {
            console.error(error);
            if (fn) fn.call(scope, false);
          })
        },

        remove: function (key, val, fn, scope) {
          scope = scope || this;
          var self = this;
          this.getStore('readwrite', function (store) {
            store.delete(key);
            self.promisifyRequest(store.transaction).then(function () {
              if (fn) fn.call(scope, true);
            })
          }).catch(function (error) {
            console.error(error);
            if (fn) fn.call(scope, false);
          })
        },

      },
    },

    // whatwg db backend (webkit, Safari 3.1+)
    // (src: whatwg and http://webkit.org/misc/DatabaseExample.html)
    whatwg_db: {
      // size based on DatabaseExample from above (should I increase
      // this?)
      size:   200 * 1024,

      test: function() {
        var name = 'PersistJS Test', 
            desc = 'Persistent database test.';

        // test for openDatabase
        if (!window.openDatabase)
          return false;

        // make sure openDatabase works
        // XXX: will this leak a db handle and/or waste space?
        if (!window.openDatabase(name, C.sql.version, desc, B.whatwg_db.size))
          return false;

        // return true
        return true;
      },

      methods: {
        transaction: function(fn) {
          // lazy create database table;
          // this is done here because there is no way to
          // prevent a race condition if the table is created in init()
          if (!this.db_created) {
            this.db.transaction(function(t) {
              // create table
              t.executeSql(C.sql.create, [], function() {
                this.db_created = true;
              });
            }, empty); // trap exception
          } 

          // execute transaction
          this.db.transaction(fn);
        },

        init: function() {
          // create database handle
          this.db = openDatabase(
            this.name, 
            C.sql.version, 
            this.o.about || ("Persistent storage for " + this.name),
            this.o.size || B.whatwg_db.size 
          );
        },

        get: function(key, fn, scope) {
          var sql = C.sql.get;

          // if callback isn't defined, then return
          if (!fn)
            return;

          // get callback scope
          scope = scope || this;

          // begin transaction
          this.transaction(function (t) {
            t.executeSql(sql, [key], function(t, r) {
              if (r.rows.length > 0)
                fn.call(scope, true, r.rows.item(0)['v']);
              else
                fn.call(scope, false, null);
            });
          });
        },

        set: function(key, val, fn, scope) {
          var rm_sql = C.sql.remove,
              sql    = C.sql.set;

          // begin set transaction
          this.transaction(function(t) {
            // exec remove query
            t.executeSql(rm_sql, [key], function() {
              // exec set query
              t.executeSql(sql, [key, val], function(t, r) {
                // run callback
                if (fn)
                  fn.call(scope || this, true, val);
              });
            });
          });

          return val;
        },

        // begin remove transaction
        remove: function(key, fn, scope) {
          var get_sql = C.sql.get;
              sql = C.sql.remove;

          this.transaction(function(t) {
            // if a callback was defined, then get the old
            // value before removing it
            if (fn) {
              // exec get query
              t.executeSql(get_sql, [key], function(t, r) {
                if (r.rows.length > 0) {
                  // key exists, get value 
                  var val = r.rows.item(0)['v'];

                  // exec remove query
                  t.executeSql(sql, [key], function(t, r) {
                    // exec callback
                    fn.call(scope || this, true, val);
                  });
                } else {
                  // key does not exist, exec callback
                  fn.call(scope || this, false, null);
                }
              });
            } else {
              // no callback was defined, so just remove the
              // data without checking the old value

              // exec remove query
              t.executeSql(sql, [key]);
            }
          });
        } 
      }
    }, 
    
    // globalstorage backend (globalStorage, FF2+, IE8+)
    // (src: http://developer.mozilla.org/en/docs/DOM:Storage#globalStorage)
    // https://developer.mozilla.org/En/DOM/Storage
    //
    // TODO: test to see if IE8 uses object literal semantics or
    // getItem/setItem/removeItem semantics
    globalstorage: {
      // (5 meg limit, src: http://ejohn.org/blog/dom-storage-answers/)
      size: 5 * 1024 * 1024,

      test: function() {
        try {
          if (window.globalStorage && window.globalStorage[this.o.domain]) return true;
        } catch (e) {}
        return false;
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = globalStorage[this.o.domain];
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.getItem(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.setItem(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store[key];

          // delete value
          this.store.removeItem(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 
    
    // localstorage backend (globalStorage, FF2+, IE8+)
    // (src: http://www.whatwg.org/specs/web-apps/current-work/#the-localstorage)
    // also http://msdn.microsoft.com/en-us/library/cc197062(VS.85).aspx#_global
    localstorage: {
      // (unknown?)
      // ie has the remainingSpace property, see:
      // http://msdn.microsoft.com/en-us/library/cc197016(VS.85).aspx
      size: -1,

      test: function() {
        try {
          return window.localStorage ? true : false;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = localStorage;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.getItem(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.setItem(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store.getItem(key);

          // delete value
          this.store.removeItem(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 

    // chrome packaged app storage
    // http://developer.chrome.com/stable/apps/storage.html
    localChromeStorage: {
      // (unknown?)
      // ie has the remainingSpace property, see:
      // http://msdn.microsoft.com/en-us/library/cc197016(VS.85).aspx
      size: -1,

      test: function() {
        try {
          return window.chrome && window.chrome.storage && window.chrome.storage.local;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = chrome.storage.local;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          scope = scope || this;
          this.store.get(key, function(val){
            if (fn) fn.call(scope, true, val[key]);
          });
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          var out = {};
          out[key] = val;
          if (fn) {
            scope = scope || this;  
            this.store.set(out, function(){
              fn.call(scope, true, val);
            });
          } else {
            this.store.set(out);
          }
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          if (fn) {
            // get value first
            scope = scope || this;
            this.store.get(key, function(val){
              this.store.remove(key, function(){
                fn.call(scope, (val[key] !== null), val[key]);
              });
            });
          } else {
            this.store.remove(key);
          }
        } 
      }
    }, 
    
    // DGF Fake local storage
    androidStorage: {
      // (unknown?)
      // ie has the remainingSpace property, see:
      // http://msdn.microsoft.com/en-us/library/cc197016(VS.85).aspx
      size: -1,

      test: function() {
        try {
          return window.androidStorage ? true : false;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = androidStorage;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          var val = this.store.getItem(key);
          if (val === undefined) val = null;

          if (fn)
            fn.call(scope || this, true, val);
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.setItem(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store.getItem(key);
          if (val === undefined) val = null;

          // delete value
          this.store.removeItem(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 

    // DGF iOS managed storage
    iosStorage: {
      size: -1,

      test: function() {
        try {
          var userAgent = navigator.userAgent;
          return (window.isIosApp || (/CoGnibus/.test(userAgent) && !/Android/.test(userAgent))) ? true : false;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {

        },

        callIos: function(scheme, path) {
          if (typeof webkit !== "undefined" && webkit.messageHandlers) {
            return webkit.messageHandlers.choicescript.postMessage([scheme, path]);
          }
          path = encodeURIComponent(path).replace(/[!~*')(]/g, function(match) {
            return "%" + match.charCodeAt(0).toString(16);
          });

          var url = scheme + "://" + path;
          setTimeout(function() {
            var iframe = document.createElement("IFRAME");
            iframe.setAttribute("src", url);
            iframe.setAttribute("style", "display:none");
            document.documentElement.appendChild(iframe);
            iframe.parentNode.removeChild(iframe);
            iframe = null;
          }, 0);
        },

        get: function(key, fn, scope) {
          if (!fn) return;
          // expand key
          key = this.key(key);

          var nonce = "storageget" + key + (+new Date);
          var i = 0;
          while (window[nonce]) {
            nonce = "storageget" + key + (+new Date) + String(i++);
          }
          window[nonce] = function(value) {
            delete window[nonce];
            fn.call(scope || this, true, value);
          }
          this.callIos("storageget", key + " " + nonce);
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          var nonce = "storageset" + key + (+new Date);
          var i = 0;
          while (window[nonce]) {
            nonce = "storageget" + key + (+new Date) + String(i++);
          }
          window[nonce] = function() {
            delete window[nonce];
            if (fn) fn.call(scope || this, true, val);
          }
          this.callIos("storageset", key + " " + nonce + " " + encodeURIComponent(val));
        },

        remove: function(key, fn, scope) {
          if (fn) {
            this.get(key, function(val) {
              this._remove(key, fn, scope, val);
            }, this);
          } else {
            this._remove(key, fn, scope);
          }
        },

        _remove: function(key, fn, scope, val) {
          var val;

          // expand key
          key = this.key(key);

          // delete value
          var nonce = "storagerem" + key + (+new Date);
          var i = 0;
          while (window[nonce]) {
            nonce = "storageget" + key + (+new Date) + String(i++);
          }
          window[nonce] = function() {
            delete window[nonce];
            if (fn) fn.call(scope || this, (val !== null), val);
          }
          this.callIos("storagerem", key + " " + nonce);
        } 
      }
    }, 

    // DGF macOS managed storage
    macStorage: {
      size: -1,

      test: function () {
        return !!window.isMacApp;
      },

      methods: {
        key: function (key) {
          return esc(this.name) + esc(key);
        },

        init: function () {

        },

        callMac: function (scheme, path) {
          if (typeof webkit !== "undefined" && webkit.messageHandlers) {
            return webkit.messageHandlers.choicescript.postMessage([scheme, path]);
          }
        },

        get: function (key, fn, scope) {
          if (!fn) return;
          // expand key
          key = this.key(key);

          var nonce = "storageget" + key + (+new Date);
          var i = 0;
          while (window[nonce]) {
            nonce = "storageget" + key + (+new Date) + String(i++);
          }
          window[nonce] = function (value) {
            delete window[nonce];
            fn.call(scope || this, true, value);
          }
          this.callMac("storageget", key + " " + nonce);
        },

        set: function (key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          var nonce = "storageset" + key + (+new Date);
          var i = 0;
          while (window[nonce]) {
            nonce = "storageget" + key + (+new Date) + String(i++);
          }
          window[nonce] = function () {
            delete window[nonce];
            if (fn) fn.call(scope || this, true, val);
          }
          this.callMac("storageset", key + " " + nonce + " " + encodeURIComponent(val));
        },

        remove: function (key, fn, scope) {
          if (fn) {
            this.get(key, function (val) {
              this._remove(key, fn, scope, val);
            }, this);
          } else {
            this._remove(key, fn, scope);
          }
        },

        _remove: function (key, fn, scope, val) {
          var val;

          // expand key
          key = this.key(key);

          // delete value
          var nonce = "storagerem" + key + (+new Date);
          var i = 0;
          while (window[nonce]) {
            nonce = "storageget" + key + (+new Date) + String(i++);
          }
          window[nonce] = function () {
            delete window[nonce];
            if (fn) fn.call(scope || this, (val !== null), val);
          }
          this.callMac("storagerem", key + " " + nonce);
        }
      }
    }, 

    // DGF Old win app managed storage
    winOldStorage: {
      size: -1,

      test: function() {
        try {
          return window.external.IsWinOldApp();
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = window.external;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.GetValue(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.SetValue(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store.GetValue(key)

          // delete value
          this.store.DeleteValue(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 

      // DGF WinStore managed storage
    winStoreStorage: {
        size: -1,

        test: function () {
            try {
                return Windows.Storage.ApplicationData.current.roamingFolder;
            } catch (e) {
                return false;
            }
        },

        methods: {
            key: function (key) {
                return esc(this.name) + esc(key);
            },

            init: function () {
                var self = this;
                function doneLoadingWinStore() {
                  self.loaded = true;
                  for (var i = self.loadListeners.length - 1; i >= 0; i--) {
                    setTimeout(self.loadListeners[i], 0);
                  }
                }
                this.loaded = false;
                this.loadListeners = [];

                Windows.Storage.ApplicationData.current.roamingFolder
                  .createFileAsync("data.txt", Windows.Storage.CreationCollisionOption.openIfExists)
                  .then(function (file) {
                    self.file = file;
                    return Windows.Storage.FileIO.readTextAsync(file);
                  }).done(function (data) {
                    self.store = {};
                    if (data && typeof data == "string") {
                      var rows = data.split("\n");
                      for (var i = rows.length - 1; i >= 0; i--) {
                        var row = rows[i].split("\t");
                        self.store[row[0]] = decodeURIComponent(row[1]);
                      }
                    }
                    doneLoadingWinStore();
                  },
                  function(){
                    self.store = {};
                    doneLoadingWinStore();
                  });
            },

            get: function (key, fn, scope) {
                if (!this.loaded) {
                  var self = this;
                  this.loadListeners.push(function() {self.get(key, fn, scope)});
                  return;
                }
                // expand key
                key = this.key(key);

                if (fn)
                    fn.call(scope || this, true, this.store[key]);
            },

            set: function (key, val, fn, scope) {
                if (!this.loaded) {
                  var self = this;
                  this.loadListeners.push(function() {self.set(key, val, fn, scope)});
                  return;
                }
                // expand key
                key = this.key(key);

                // set value
                this.store[key] = val;
                this.writeAsync();

                if (fn)
                    fn.call(scope || this, true, val);
            },

            remove: function (key, fn, scope) {
                if (!this.loaded) {
                  var self = this;
                  this.loadListeners.push(function() {self.remove(key, fn, scope)});
                  return;
                }
                var val;

                // expand key
                key = this.key(key);

                // get value
                val = this.store[key];

                // delete value
                delete this.store[key];
                this.writeAsync();

                if (fn)
                    fn.call(scope || this, (val !== null), val);
            },

            writeAsync: function() {
              var output = [];
              for (var key in this.store) {
                output.push(key, '\t', encodeURIComponent(this.store[key]), '\n');
              }
              Windows.Storage.FileIO.writeTextAsync(this.file, output.join(''));
            }
        }
    },

    // IE backend
    ie: {
      prefix:   '_persist_data-',
      // style:    'display:none; behavior:url(#default#userdata);',

      // 64k limit
      size:     64 * 1024,

      test: function() {
        // make sure we're dealing with IE
        // (src: http://javariet.dk/shared/browser_dom.htm)
        return window.ActiveXObject ? true : false;
      },

      make_userdata: function(id) {
        var el = document.createElement('div');

        // set element properties
        // http://msdn.microsoft.com/en-us/library/ms531424(VS.85).aspx 
        // http://www.webreference.com/js/column24/userdata.html
        el.id = id;
        el.style.display = 'none';
        el.addBehavior('#default#userdata');

        // append element to body
        document.body.appendChild(el);

        // return element
        return el;
      },

      methods: {
        init: function() {
          var id = B.ie.prefix + esc(this.name);

          // save element
          this.el = B.ie.make_userdata(id);

          // load data
          if (this.o.defer)
            this.load();
        },

        get: function(key, fn, scope) {
          var val;

          // expand key
          key = esc(key);

          // load data
          if (!this.o.defer)
            this.load();

          // get value
          val = this.el.getAttribute(key);

          // call fn
          if (fn)
            fn.call(scope || this, val ? true : false, val);
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = esc(key);
          
          // set attribute
          this.el.setAttribute(key, val);

          // save data
          if (!this.o.defer)
            this.save();

          // call fn
          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = esc(key);

          // load data
          if (!this.o.defer)
            this.load();

          // get old value and remove attribute
          val = this.el.getAttribute(key);
          this.el.removeAttribute(key);

          // save data
          if (!this.o.defer)
            this.save();

          // call fn
          if (fn)
            fn.call(scope || this, val ? true : false, val);
        },

        load: function() {
          this.el.load(esc(this.name));
        },

        save: function() {
          this.el.save(esc(this.name));
        }
      }
    },

    // cookie backend
    // uses easycookie: http://pablotron.org/software/easy_cookie/
    cookie: {
      delim: ':',

      // 4k limit (low-ball this limit to handle browser weirdness, and 
      // so we don't hose session cookies)
      size: 4000,

      test: function() {
        // XXX: use easycookie to test if cookies are enabled
        return P.Cookie.enabled ? true : false;
      },

      methods: {
        key: function(key) {
          return this.name + B.cookie.delim + key;
        },

        get: function(key, fn, scope) {
          var val;

          // expand key 
          key = this.key(key);

          // get value
          val = ec.get(key);

          // call fn
          if (fn)
            fn.call(scope || this, val != null, val);
        },

        set: function(key, val, fn, scope) {
          // expand key 
          key = this.key(key);

          // save value
          ec.set(key, val, this.o);

          // call fn
          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, val, fn, scope) {
          var val;

          // expand key 
          key = this.key(key);

          // remove cookie
          val = ec.remove(key)

          // call fn
          if (fn)
            fn.call(scope || this, val != null, val);
        } 
      }
    },

    // flash backend (requires flash 8 or newer)
    // http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_16194&sliceId=1
    // http://livedocs.adobe.com/flash/8/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00002200.html
    flash: {
      test: function() {
        // TODO: better flash detection
        if (!window.deconcept || !window.deconcept.SWFObjectUtil)
          return false;

        // get the major version
        var major = deconcept.SWFObjectUtil.getPlayerVersion().major;

        // check flash version (require 8.0 or newer)
        return (major >= 8) ? true : false;
      },

      methods: {
        init: function() {
          if (!B.flash.el) {
            var o, key, el, cfg = C.flash;

            // create wrapper element
            el = document.createElement('div');
            el.id = cfg.div_id;

            // FIXME: hide flash element
            // el.style.display = 'none';

            // append element to body
            document.body.appendChild(el);

            // create new swf object
            o = new deconcept.SWFObject(this.o.swf_path || cfg.path, cfg.id, cfg.size.w, cfg.size.h, '8');

            // set parameters
            for (key in cfg.args)
              o.addVariable(key, cfg.args[key]);

            // write flash object
            o.write(el);

            // save flash element
            B.flash.el = document.getElementById(cfg.id);
          }

          // use singleton flash element
          this.el = B.flash.el;
        },

        get: function(key, fn, scope) {
          var val;

          // escape key
          key = esc(key);

          // get value
          val = this.el.get(this.name, key);

          // call handler
          if (fn)
            fn.call(scope || this, val !== null, val);
        },

        set: function(key, val, fn, scope) {
          var old_val;

          // escape key
          key = esc(key);

          // set value
          old_val = this.el.set(this.name, key, val);

          // call handler
          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // get key
          key = esc(key);

          // remove old value
          val = this.el.remove(this.name, key);

          // call handler
          if (fn)
            fn.call(scope || this, true, val);
        }
      }
    }
  };

  /**
   * Test for available backends and pick the best one.
   * @private
   */
  var init = function() {
    var i, l, b, key, fns = C.methods, keys = C.search_order;

    // set all functions to the empty function
    for (i = 0, l = fns.length; i < l; i++) 
      P.Store.prototype[fns[i]] = empty;

    // clear type and size
    P.type = null;
    P.size = -1;

    // loop over all backends and test for each one
    for (i = 0, l = keys.length; !P.type && i < l; i++) {
      b = B[keys[i]];

      // test for backend
      try {
        if (b.test()) {
          // found backend, save type and size
          P.type = keys[i];
          P.size = b.size;

          // extend store prototype with backend methods
          for (key in b.methods)
            P.Store.prototype[key] = b.methods[key];
        }
      } catch (e) {}
    }

    // mark library as initialized
    P._init = true;
  };

  // create top-level namespace
  P = {
    // version of persist library
    VERSION: VERSION,

    // backend type and size limit
    type: null,
    size: 0,

    // XXX: expose init function?
    // init: init,

    add: function(o) {
      // add to backend hash
      B[o.id] = o;

      // add backend to front of search order
      C.search_order = [o.id].concat(C.search_order);

      // re-initialize library
      init();
    },

    remove: function(id) {
      var ofs = index_of(C.search_order, id);
      if (ofs < 0)
        return;

      // remove from search order
      C.search_order.splice(ofs, 1);

      // delete from lut
      delete B[id];

      // re-initialize library
      init();
    },

    // expose easycookie API
    Cookie: ec,

    // store API
    Store: function(name, o) {
      // verify name
      if (!C.name_re.exec(name))
        throw new Error("Invalid name");

      // XXX: should we lazy-load type?
      // if (!P._init)
      //   init();

      if (!P.type)
        throw new Error("No suitable storage found");

      o = o || {};
      this.name = name;

      // get domain (XXX: does this localdomain fix work?)
      o.domain = o.domain || location.host || 'localhost';
      
      // strip port from domain (XXX: will this break ipv6?)
      o.domain = o.domain.replace(/:\d+$/, '')

      // append localdomain to domains w/o '."
      // (see https://bugzilla.mozilla.org/show_bug.cgi?id=357323)
      // (file://localhost/ works, see: 
      // https://bugzilla.mozilla.org/show_bug.cgi?id=469192)
/* 
 *       if (!o.domain.match(/\./))
 *         o.domain += '.localdomain';
 */ 

      this.o = o;

      // expires in 2 years
      o.expires = o.expires || 365 * 2;

      // set path to root
      o.path = o.path || '/';

      // call init function
      this.init();
    } 
  };

  // init persist
  init();

  // return top-level namespace
  return P;
})();

;
/**
 * alertify
 * An unobtrusive customizable JavaScript notification system
 *
 * @author Fabien Doiron <fabien.doiron@gmail.com>
 * @copyright Fabien Doiron 2012
 * @license MIT <http://opensource.org/licenses/mit-license.php>
 * @link http://fabien-d.github.com/alertify.js/
 * @module alertify
 * @version 0.3.0
 */
(function(e,t){"use strict";var n=e.document,r;r=function(){var r={},i={},s=!1,o={ENTER:13,ESC:27,SPACE:32},u=[],a,f,l,c,h;return i={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok" />{{ok}}</button>',ok:'<a href="#" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</a>',cancel:'<a href="#" class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</a>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},a=function(e){return n.getElementById(e)},r={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,addListeners:function(r){var i=a("alertify-resetFocus"),s=a("alertify-ok")||t,u=a("alertify-cancel")||t,f=a("alertify-text")||t,l=a("alertify-form")||t,c=typeof s!="undefined",h=typeof u!="undefined",p=typeof f!="undefined",d="",v=this,m,g,y,b,w;m=function(e){typeof e.preventDefault!="undefined"&&e.preventDefault(),y(e),typeof f!="undefined"&&(d=f.value),typeof r=="function"&&r(!0,d)},g=function(e){typeof e.preventDefault!="undefined"&&e.preventDefault(),y(e),typeof r=="function"&&r(!1)},y=function(e){v.hide(),v.unbind(n.body,"keyup",b),v.unbind(i,"focus",w),p&&v.unbind(l,"submit",m),c&&v.unbind(s,"click",m),h&&v.unbind(u,"click",g)},b=function(e){var t=e.keyCode;t===o.SPACE&&!p&&m(e),t===o.ESC&&h&&g(e)},w=function(e){p?f.focus():h?u.focus():s.focus()},this.bind(i,"focus",w),c&&this.bind(s,"click",m),h&&this.bind(u,"click",g),this.bind(n.body,"keyup",b),p&&this.bind(l,"submit",m),e.setTimeout(function(){f?(f.focus(),f.select()):s.focus()},50)},bind:function(e,t,n){typeof e.addEventListener=="function"?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},build:function(e){var t="",n=e.type,r=e.message,s=e.cssClass||"";t+='<div class="alertify-dialog">',n==="prompt"&&(t+='<form id="alertify-form">'),t+='<article class="alertify-inner">',t+=i.message.replace("{{message}}",r),n==="prompt"&&(t+=i.input),t+=i.buttons.holder,t+="</article>",n==="prompt"&&(t+="</form>"),t+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',t+="</div>";switch(n){case"confirm":t=t.replace("{{buttons}}",i.buttons.cancel+i.buttons.ok),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":t=t.replace("{{buttons}}",i.buttons.cancel+i.buttons.submit),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":t=t.replace("{{buttons}}",i.buttons.ok),t=t.replace("{{ok}}",this.labels.ok);break;default:}return c.className="alertify alertify-show alertify-"+n+" "+s,l.className="alertify-cover",t},close:function(e,t){var n=t&&!isNaN(t)?+t:this.delay;this.bind(e,"click",function(){h.removeChild(e)}),setTimeout(function(){typeof e!="undefined"&&e.parentNode===h&&h.removeChild(e)},n)},dialog:function(e,t,r,i,o){f=n.activeElement;var a=function(){if(c&&c.scrollTop!==null)return;a()};if(typeof e!="string")throw new Error("message must be a string");if(typeof t!="string")throw new Error("type must be a string");if(typeof r!="undefined"&&typeof r!="function")throw new Error("fn must be a function");return typeof this.init=="function"&&(this.init(),a()),u.push({type:t,message:e,callback:r,placeholder:i,cssClass:o}),s||this.setup(),this},extend:function(e){if(typeof e!="string")throw new Error("extend method must have exactly one paramter");return function(t,n){return this.log(t,e,n),this}},hide:function(){u.splice(0,1),u.length>0?this.setup():(s=!1,c.className="alertify alertify-hide alertify-hidden",l.className="alertify-cover alertify-hidden",f?f.focus():null)},init:function(){n.createElement("nav"),n.createElement("article"),n.createElement("section"),l=n.createElement("div"),l.setAttribute("id","alertify-cover"),l.className="alertify-cover alertify-hidden",n.body.appendChild(l),c=n.createElement("section"),c.setAttribute("id","alertify"),c.className="alertify alertify-hidden",n.body.appendChild(c),h=n.createElement("section"),h.setAttribute("id","alertify-logs"),h.className="alertify-logs",n.body.appendChild(h),n.body.setAttribute("tabindex","0"),delete this.init},log:function(e,t,n){var r=function(){if(h&&h.scrollTop!==null)return;r()};return typeof this.init=="function"&&(this.init(),r()),this.notify(e,t,n),this},notify:function(e,t,r){var i=n.createElement("article");i.className="alertify-log"+(typeof t=="string"&&t!==""?" alertify-log-"+t:""),i.innerHTML=e,h.insertBefore(i,h.firstChild),setTimeout(function(){i.className=i.className+" alertify-log-show"},50),this.close(i,r)},set:function(e){var t;if(typeof e!="object"&&e instanceof Array)throw new Error("args must be an object");for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},setup:function(){var e=u[0];s=!0,c.innerHTML=this.build(e),typeof e.placeholder=="string"&&e.placeholder!==""&&(a("alertify-text").value=e.placeholder),this.addListeners(e.callback)},unbind:function(e,t,n){typeof e.removeEventListener=="function"?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}},{alert:function(e,t,n){return r.dialog(e,"alert",t,"",n),this},confirm:function(e,t,n){return r.dialog(e,"confirm",t,"",n),this},extend:r.extend,init:r.init,log:function(e,t,n){return r.log(e,t,n),this},prompt:function(e,t,n,i){return r.dialog(e,"prompt",t,n,i),this},success:function(e,t){return r.log(e,"success",t),this},error:function(e,t){return r.log(e,"error",t),this},set:function(e){r.set(e)},labels:r.labels}},typeof define=="function"?define([],function(){return new r}):typeof e.alertify=="undefined"&&(e.alertify=new r)})(this);
;
/*
 * Copyright 2010 by Dan Fabulich.
 * 
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License. 
 * You may obtain a copy of the License at
 * 
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 * 
 * See the License for the specific language governing
 * permissions and limitations under the License.
 * 
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */

_global = typeof globalThis !== "undefined" ? globalThis : this;

(function() {
  var userAgent, url, protocol, appMeta;
  if (typeof window !== "undefined") {
    userAgent = navigator.userAgent;
    url = window.location.href;
    protocol = window.location.protocol;
    appMeta = window.document.querySelector("meta[name=apple-itunes-app]");
  }
  _global.isWebOS = /webOS/.test(userAgent);
  _global.isMobile = _global.isWebOS || /Mobile/.test(userAgent);
  _global.isFile = /^file:/.test(url);
  _global.isXul = /^chrome:/.test(url);
  try {
    _global.steamworksApi = require('steamworks.js');
    _global.isSteamworks = true;
  } catch (ignored) {}
  _global.isWinOldApp = false;
  try {
    isWinOldApp = window.external.IsWinOldApp();
  } catch (ignored) {}
  _global.isAndroid = /Android/.test(userAgent);
  _global.isOmnibusApp = /CoGnibus/.test(userAgent);
  _global.isIosApp = _global.isIosApp || (_global.isOmnibusApp && !_global.isAndroid);
  _global.isAndroidApp = _global.isAndroidApp || (_global.isOmnibusApp && _global.isAndroid);
  _global.isAmazonAndroidApp = _global.isAmazonAndroidApp || (_global.isAndroidApp && _global.flavor && _global.flavor.isAmazon());
  _global.isWeb = !_global.isIosApp && !_global.isAndroidApp && !_global.isWinOldApp && /^https?:/.test(url);
  _global.isSecureWeb = /^https:?$/.test(protocol);
  _global.isSafari = /Safari/.test(userAgent);
  _global.isIE = /(MSIE|Trident)/.test(userAgent);
  _global.isIPad = /iPad/.test(userAgent);
  _global.isIPhone = /iPhone/.test(userAgent);
  _global.isKindleFire = /Kindle Fire/.test(userAgent);
  _global.isWinStoreApp = "ms-appx:" == protocol;
  _global.isCef = !!_global.cefQuery;
  _global.isNode = typeof process !== "undefined";
  _global.isHeartsChoice = appMeta && /1487052276/.test(appMeta.getAttribute("content"))
})();

_global.loadTime = new Date().getTime();

function callIos(scheme, path) {
  if (!_global.isIosApp) return;
  if (typeof webkit !== "undefined" && webkit.messageHandlers) {
    return webkit.messageHandlers.choicescript.postMessage([scheme, path]);
  }
  if (path) {
    path = encodeURIComponent(path).replace(/[!~*')(]/g, function(match) {
      return "%" + match.charCodeAt(0).toString(16);
    });
  } else {
    path = "";
  }
  setTimeout(function() {
    var iframe = document.createElement("IFRAME");
    iframe.setAttribute("src", scheme + "://" + path);
    iframe.setAttribute("style", "display:none");
    document.documentElement.appendChild(iframe);
    iframe.parentNode.removeChild(iframe);
    iframe = null;
  }, 0);
}

function callMac(scheme, path) {
  if (typeof webkit !== "undefined" && webkit.messageHandlers) {
    return webkit.messageHandlers.choicescript.postMessage([scheme, path]);
  }
}

function safeCall(obj, fn) {
    if (!fn) return;
    var isHeadless = typeof window == "undefined";
    var debug = false || (!isHeadless && window.debug);
    if (isIE || isHeadless) {
        // just call through; onerror will be called and debugger will handle it
        if (typeof MSApp != "undefined") {
            if (obj) {
                MSApp.execUnsafeLocalFunction(function () { fn.call(obj); });
            } else {
                MSApp.execUnsafeLocalFunction(fn);
            }
        } else if (obj) {
            fn.call(obj);
        } else {
            fn.call();
        }
    } else {
        try {
            if (obj) {
                fn.call(obj);
            } else {
                fn.call();
            }
        } catch (e) {
            if (e.message) {
              window.reportError(e.message, e.fileName, e.lineNumber, e.columnNumber, e);
            } else if (e.stack) {
              window.reportError(e.stack, e.fileName, e.lineNumber, e.columnNumber, e);
            } else {
              window.reportError(toJson(e, '\n'));
            }

            if (window.console) {
              window.console.error(e);
              if (e.message) window.console.error("Message: " + e.message);
              if (e.stack) window.console.error("Stack: " + e.stack);
            }
            // Rethrow here so the debugger can handle it
            // On Firefox this causes a second prompt.  Meh!
            if (debug) throw e;
        }
    }
}

function safeCallback(callback) {
  return function() {
    safeCall(null, callback);
  };
}

function safeTimeout(fn, time) {
  setTimeout(function() {
    safeCall(null, fn);
  }, time);
}

function isDefined(x) {
    return "undefined" !== typeof x;
}

function jsonStringifyAscii(obj) {
  var output = JSON.stringify(obj).replace(/(.)/g, function(x) {
    var code = x.charCodeAt(0);
    if (code > 127 || code < 32) {
     var outCode = code.toString(16);
     switch (outCode.length) {
       case 4:
         return "\\u" + outCode;
       case 3:
         return "\\u0" + outCode;
       case 2:
         return "\\u00" + outCode;
       case 1:
         return "\\u000" + outCode;
       default:
         return x;
     }
    }
    return x;
  });
  return output;
}

function toJson(obj, standardized) {
 if (typeof JSON != "undefined" && JSON.stringify) {
  return jsonStringifyAscii(obj);
 }
 switch (typeof obj) {
  case 'object':
   if (obj) {
    var list = [];
    if (obj instanceof Array) {
     for (var i=0;i < obj.length;i++) {
      list.push(toJson(obj[i], standardized));
     }
     return '[' + list.join(',') + ']';
    } else {
     for (var prop in obj) {
      if (prop == "scene") continue;
      if (!standardized && /^[a-zA-Z][a-zA-Z_0-9]\w+$/.test(prop) && !/\b(abstract|boolean|break|byte|case|catch|char|class|comment|const|continue|debugger|default|delete|do|double|else|enum|export|extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|interface|label|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|this|throws|transient|true|try|typeof|var|void|volatile|while|with)\b/.test(prop)) {
        list.push(prop + ':' + toJson(obj[prop], standardized));
      } else {
        list.push('"' + prop + '":' + toJson(obj[prop], standardized));
      }
     }
     return '{' + list.join(',') + '}';
    }
   } else {
    return 'null';
   }
   break;
  case 'string':
   var encoded = obj.replace(/(.)/g, function(x) {
     if (x == "'" || x == '"' || x == '\\') {
       return "\\" + x;
     }
     var code = x.charCodeAt(0);
     if (code > 127 || code < 32) {
       var outCode = code.toString(16);
       switch (outCode.length) {
         case 4:
           return "\\u" + outCode;
         case 3:
           return "\\u0" + outCode;
         case 2:
           return "\\u00" + outCode;
         case 1:
           return "\\u000" + outCode;
         default:
           return x;
       }
     }
     return x;
   });
   return '"' + encoded + '"';
  case 'number':
  case 'boolean':
   return String(obj);
  case 'function':
   return 'badfunction';
  case 'undefined':
    return 'undefined';
  default:
   throw new Error("invalid type: " + typeof obj);
 }
}

var loginUrlBase = "https://www.choiceofgames.com/api/";
function xhrAuthRequest(method, endpoint, callback) {
  var paramBuilder = new Array(arguments.length*3);
  for (var i = 3; i < arguments.length; i=i+2) {
    if (i > 3) paramBuilder.push("&");
    paramBuilder.push(arguments[i]);
    paramBuilder.push("=");
    paramBuilder.push(arguments[i+1]);
  }
  var params = paramBuilder.join("");
  var xhr = findXhr();
  if (method == "POST") {
    xhr.open(method, loginUrlBase + endpoint + ".php", true);
    xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  } else {
    xhr.open(method, loginUrlBase + endpoint + ".php?" + params, true);
  }

  var done = false;

  xhr.onreadystatechange = function() {
    if (done) return;
    if (xhr.readyState != 4) return;
    done = true;
    var ok = xhr.status == 200;
    var response = {};
    try {
      if (xhr.responseText) response = JSON.parse(xhr.responseText);
    } catch (e) {
      ok = false;
    }
    if (!ok) {
      if (!response.error) response.error = "unknown error";
      response.status = xhr.status;
    }
    if (callback) safeCall(null, function() {callback(ok, response);});
  };
  xhr.send(params);
}

function login(email, password, register, subscribe, callback) {
  xhrAuthRequest("POST", "login", callback, "email", encodeURIComponent(email), "password", encodeURIComponent(password), "register", register, "subscribe", subscribe);
}

function forgotPassword(email, callback) {
  xhrAuthRequest("POST", "forgot", callback, "email", encodeURIComponent(email));
}

function logout(callback) {
  document.cookie = 'login=0;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
  xhrAuthRequest("GET", "logout", callback);
  recordLogin(false);
  window.knownPurchases = null;
  window.registered = false;
  if (typeof FB != "undefined" && FB.logout) FB.logout();
  if (typeof gapi != "undefined" && gapi.auth && gapi.auth.signOut) gapi.auth.signOut();
}

function recordLogin(registered, loginId, email, callback) {
  if (initStore()) {
    if (registered) recordEmail(email);
    window.store.set("login", loginId || 0, function() {safeCall(null, callback);});
    window.registered = registered;
  } else {
    safeTimeout(callback, 0);
  }
}

function getRemoteEmail(callback) {
  xhrAuthRequest("GET", "getuser", callback);
}

function saveCookie(callback, slot, stats, temps, lineNum, indent, deleted, undeleted) {
    var value = computeCookie(stats, temps, lineNum, indent, deleted, undeleted);
    return writeCookie(value, slot, callback);
}

function computeCookie(stats, temps, lineNum, indent, deleted, undeleted) {
  var scene = stats.scene;
  delete stats.scene;
  if (scene) stats.sceneName = scene.name;
  var version = "UNKNOWN";
  if (typeof(window) != "undefined" && window && window.version) version = window.version;
  var obj = { version: version, stats: stats, temps: temps, lineNum: lineNum, indent: indent };
  if (deleted) obj.deleted = deleted;
  if (undeleted) obj.undeleted = undeleted;
  var value = toJson(obj);
  stats.scene = scene;
  return value;
}

function writeCookie(value, slot, callback) {
  if (!_global.pseudoSave) _global.pseudoSave = {};
  if (!slot) {
    slot = "";
  }
  _global.pseudoSave[slot] = value;
  if (!initStore()) {
    if (callback) safeTimeout(callback, 0);
    return;
  }
  window.store.set("state"+slot, value, safeCallback(callback));
}

function clearCookie(callback, slot) {
    writeCookie('', slot, safeCallback(callback));
}

function areSaveSlotsSupported() {
  return !!(initStore() && window.Persist.type != "cookie");
}

function recordSave(slot, callback) {
  if (!areSaveSlotsSupported()) {
    safeTimeout(callback, 0);
    return;
  }
  restoreObject(initStore(), "save_list", [], function (saveList) {
    saveList.push(slot);
    window.store.set("save_list", toJson(saveList), safeCallback(callback));
  });
}

function recordDirtySlots(slots, callback) {
  if (!areSaveSlotsSupported()) {
    safeTimeout(callback, 0);
    return;
  }
  restoreObject(initStore(), "dirty_save_list", [], function (saveList) {
    saveSet = {};
    for (var i = 0; i < saveList.length; i++) {
      saveSet[saveList[i]] = 1;
    }
    for (i = 0; i < slots.length; i++) {
      if (!saveSet[slots[i]]) saveList.push(slots[i]);
    }
    window.store.set("dirty_save_list", toJson(saveList), safeCallback(callback));
  });
}

function recordEmail(email, callback) {
  if (initStore()) {
    window.recordedEmail = email;
    window.store.set("email", email, safeCallback(callback));
  } else {
    safeTimeout(callback, 0);
  }
}

function fetchEmail(callback) {
  if (!initStore()) {
    safeTimeout(function(){callback("");}, 0);
    return;
  }
  if (window.recordedEmail) {
    return safeTimeout(function() {
      callback(window.recordedEmail);
    })
  }
  if (window.isWeb) {
    var cookieEmail = getCookieByName("login");
    if (/@/.test(cookieEmail)) {
      return recordEmail(cookieEmail, function() {
        callback(cookieEmail);
      });
    }
  }
  // For some reason, this get seems to not respond sometimes
  // adding a fallback timeout
  window.store.get("email", function(ok, value) {
    safeCall(null, function() {
      if (ok) window.recordedEmail = value;
      if (!callback) return;
      var temp = callback;
      callback = null;
      if (ok && value) {
        temp(value);
      } else {
        temp("");
      }
    });
  });
  safeTimeout(function() {
    if (!callback) return;
    var temp = callback;
    callback = null;
    temp("");
  }, 1000);
}

function restoreObject(store, key, defaultValue, callback) {
  if (!store) {
    safeTimeout(function() {callback(defaultValue);}, 0);
    return;
  }
  store.get(key, function(ok, value) {
    var result = defaultValue;
    if (ok && value) {
      try{
        result = jsonParse(value);
      } catch (e) {}
    }
    safeCall(null, function() {callback(result);});
  });
}

function getDirtySaveList(callback) {
  restoreObject(initStore(), "dirty_save_list", [], function (slotList) {
    callback(slotList);
  });
}

function remoteSaveMerger(i, callback) {
  var remoteStore = new Persist.Store(window.remoteStoreNames[i]);
  restoreObject(remoteStore, "save_list", [], function (remoteSlotList) {
    fetchSavesFromSlotList(remoteStore, remoteSlotList, 0, [], function(remoteSaveList) {
      mergeRemoteSaves(remoteSaveList, 0/*recordDirty*/, function() {
        i++;
        if (i < window.remoteStoreNames.length) {
          remoteSaveMerger(i, callback);
        } else {
          callback.apply(null, arguments);
        }
      });
    });
  });
}

function getSaves(callback) {
  if (window.remoteStoreNames && window.remoteStoreNames.length) {
    remoteSaveMerger(0, callback);
  } else if (window.remoteStoreName && window.storeName != window.remoteStoreName) {
    var remoteStore = new Persist.Store(window.remoteStoreName);
    restoreObject(remoteStore, "save_list", [], function (remoteSlotList) {
      fetchSavesFromSlotList(remoteStore, remoteSlotList, 0, [], function(remoteSaveList) {
        mergeRemoteSaves(remoteSaveList, 0/*recordDirty*/, callback);
      });
    });
  } else {
    restoreObject(initStore(), "save_list", [], function (localSlotList) {
      fetchSavesFromSlotList(initStore(), localSlotList, 0, [], callback);
    });
  }
}

function fetchSavesFromSlotList(store, slotList, i, saveList, callback) {
  if (i >= slotList.length) {
    return safeCall(null, function() {callback(saveList);});
  }
  restoreObject(store, "state"+slotList[i], null, function(saveState) {
    if (saveState) {
      saveState.timestamp = slotList[i].substring(4/*"save".length*/);
      saveList.push(saveState);
    }
    fetchSavesFromSlotList(store, slotList, i+1, saveList, callback);
  });
}

function isWebSavePossible() {
  if (!initStore()) return false;
  if (!_global.isCogPublished) return false;
  if (/^http/.test(window.location.protocol)) {
    return document.domain == window.webSaveDomain || document.domain == "localhost";
  }
  // if it's a file URL with a valid store, either you're a 3rd party developer
  // who knows what you're doing, or you're a mobile app
  return true;
}


webSaveDomain = "www.choiceofgames.com";
webSaveUrl = "https://" + webSaveDomain + "/ajax_proxy.php/websave";

function submitRemoteSave(slot, email, subscribe, callback) {
  if (!isWebSavePossible()) return safeTimeout(function() { callback(false); });
  window.store.get("state"+slot, function(ok, value) {
    if (ok) {
      var timestamp = slot.substring(4/*"save".length*/);
      var xhr = findXhr();
      var gameName = window.remoteStoreName || window.storeName;
      var params = "email="+email+"&game="+gameName+"&realGame="+window.storeName+"&json="+encodeURIComponent(value)+"&timestamp="+ timestamp+"&subscribe="+subscribe;
      xhr.open("POST", webSaveUrl,true);
      xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
      var done = false;

      xhr.onreadystatechange = function() {
        if (done) return;
        if (xhr.readyState != 4) return;
        done = true;
        var ok = xhr.status == 200;
        if (ok) {
          safeCall(null, function() {callback(true);});
        } else {
          recordDirtySlots([slot], function() {
            safeCall(null, function() {callback(false);});
          });
        }
      };
      xhr.send(params);
    } else {
      recordDirtySlots([slot], function() {
        asyncAlert("There was a problem uploading the saved game. This is probably a bug; please contact support@choiceofgames.com with code 17891.", function() {
          safeCall(null, function() {callback(false);});
        });
      });
    }
  });
}

function submitDirtySaves(dirtySaveList, email, callback) {
  function submitDirtySave(i) {
    if (dirtySaveList[i]) {
      submitRemoteSave(dirtySaveList[i], email, false, function(ok) {
        if (ok) {
          submitDirtySave(i+1);
        } else {
          safeCall(null, function() {callback(false);});
        }
      });
    } else {
      window.store.remove("dirty_save_list", function() {
        safeCall(null, function() {callback(true);});
      });
    }
  }
  submitDirtySave(0);
}

function submitAnyDirtySaves(callback) {
  if (!callback) callback = function(ok) {};
  try {
    getDirtySaveList(function(dirtySaveList) {
      if (dirtySaveList && dirtySaveList.length) {
        try {
          fetchEmail(function(email) {
            if (email) {
              submitDirtySaves(dirtySaveList, email, callback);
            } else {
              callback(false);
            }
          });
        } catch (e) {
          callback(false);
        }
      }
    });
  } catch (e) {
    callback(false);
  }
}

function getRemoteSaves(email, callback) {
  if (!isWebSavePossible()) {
    safeTimeout(function() {callback([]);}, 0);
    return;
  }
  var xhr = findXhr();
  var gameName = window.remoteStoreName || window.storeName;
  xhr.open("GET", webSaveUrl + "?email="+email+"&game="+gameName, true);
  var done = false;
  xhr.onreadystatechange = function() {
    if (done) return;
    if (xhr.readyState != 4) return;
    done = true;
    if (xhr.status != 200) {
      if (window.console) console.log("Couldn't load remote saves. " + xhr.status + ": " + xhr.responseText);
      safeCall(null, function() {callback(null);});
    } else {
      var result = xhr.responseText;
      result = jsonParse(result);
      var remoteSaveList = [];
      for (var i = 0; i < result.length; i++) {
        if (!result[i]) continue;
        var save = result[i].json;
        if (!save) continue;
        save.timestamp = result[i].timestamp;
        remoteSaveList.push(save);
      }
      safeCall(null, function() {callback(remoteSaveList);});
    }
  };
  xhr.send();
}

function mergeRemoteSaves(remoteSaveList, recordDirty, callback) {
  if (!isWebSavePossible()) {
    safeTimeout(function() { callback([], 0, []); }, 0);
    return;
  }
  restoreObject(initStore(), "save_list", [], function (localSlotList) {
    fetchSavesFromSlotList(initStore(), localSlotList, 0, [], function(localSaveList) {
      var localSlotMap = {};
      for (var i = 0; i < localSlotList.length; i++) {
        localSlotMap[localSlotList[i]] = i;
      }
      var remoteSlotMap = {};
      for (i = 0; i < remoteSaveList.length; i++) {
        remoteSlotMap["save"+remoteSaveList[i].timestamp] = 1;
      }
      var newRemoteSaves = 0;
      for (i = 0; i < remoteSaveList.length; i++) {
        var remoteSave = remoteSaveList[i];
        var slot = "save"+remoteSave.timestamp;
        saveCookie(null, slot, remoteSave.stats, remoteSave.temps, remoteSave.lineNum, remoteSave.indent, remoteSave.deleted, remoteSave.undeleted);
        if (typeof localSlotMap[slot] !== 'undefined') {
          localSaveList[localSlotMap[slot]] = remoteSave;
        } else {
          localSlotList.push(slot);
          localSaveList.push(remoteSave);
          newRemoteSaves++;
        }
      }

      var dirtySaveList = [];
      for (i = 0; i < localSlotList.length; i++) {
        if (!remoteSlotMap[localSlotList[i]]) {
          dirtySaveList.push(localSlotList[i]);
        }
      }

      if (recordDirty) {
        window.store.set("dirty_save_list", toJson(dirtySaveList), finale);
      } else {
        finale();
      }

      function finale() {
        if (newRemoteSaves) {
          window.store.set("save_list", toJson(localSlotList), function() {
            safeCall(null, function() { callback(localSaveList, newRemoteSaves, dirtySaveList); });
          });
        } else {
          safeCall(null, function() {callback(localSaveList, newRemoteSaves, dirtySaveList);});
        }
      }
    });
  });
}

function getAppId() {
  if (window.isIosApp) {
    var appBanner = document.querySelector("meta[name=apple-itunes-app]");
    return /app-id=(\d+)/.exec(appBanner.getAttribute("content"))[1];
  } else if (window.isAndroidApp) {
    var androidLink = document.getElementById('androidLink');
    return /id=([\.\w]+)/.exec(androidLink.href)[1];
  }
}

function submitReceipts(receipts, callback) {
  console.log("submitReceipts: " + JSON.stringify(receipts));
  if (!callback) callback = function(error) {
    if (window.transferPurchaseCallback) {
      window.transferPurchaseCallback(error || "done");
    }
  };
  var appId = receipts.appId;
  var count = 0;
  var error;
  function submitCallback(product) {
    return function submitCallback(ok, response) {
      if (!ok) {
        console.log("failed: " + product + " " + JSON.stringify(response));
        if (!error) {
          var match = /^receipt transaction already processed: (\d+) current login (\d+)$/.exec(response.error);
          if (match) {
            callback("409-" + match[1] + "-" + match[2]);
          } else {
            callback("" + response.status + "r");
          }
        }
        error = true;
      }
      if (error) return;
      count--;
      if (!count) {
        if (!receipts.avoidOverrides) cacheKnownPurchases(response);
        callback();
      }
    }
  }

  if (window.isAndroidApp) {
    window.store.get("login", function(ok, loginId) {
      loginId = loginId || 0;
      var platform = window.isAmazonAndroidApp ? 'amazon' : 'google';
      if (receipts.prePurchased && platform === 'google') {
        for (var i = 0; i < receipts.prePurchased.length; i++) {
          var product = receipts.prePurchased[i];
          count++;
          xhrAuthRequest("POST", "submit-device-receipt", submitCallback(product),
            'platform', platform,
            'company', receipts.company,
            'game_id', window.storeName,
            'app_package', appId,
            'product_id', product,
            'signature', encodeURIComponent(receipts.signature),
            'receipt', encodeURIComponent(receipts.signedData),
            'login_id', loginId
          );
        }
      }
      if (receipts.iaps) {
        for (var product in receipts.iaps) {
          count++;
          xhrAuthRequest("POST", "submit-device-receipt", submitCallback(product),
            'platform', platform,
            'company', receipts.company,
            'game_id', window.storeName,
            'app_package', appId,
            'product_id', product,
            'receipt', encodeURIComponent(receipts.iaps[product]),
            'login_id', loginId
          );
        }
      }
      if (!count) safeTimeout(function () { callback(); }, 0);
    });
  } else {
    callback("error");
  }
}

function delayBreakStart(callback) {
  var nowInSeconds = Math.floor(new Date().getTime() / 1000);
  if (!initStore()) {
    safeTimeout(function() {callback(nowInSeconds);}, 0);
    return;
  }
  window.store.get("delayBreakStart", function(ok, value) {
    var valueNum = value*1;
    safeCall(null, function() {
      if (ok && value && !isNaN(valueNum)) {
        callback(valueNum);
      } else {
        window.store.set("delayBreakStart", nowInSeconds);
        callback(nowInSeconds);
      }
    });
  });
}

function delayBreakEnd() {
  if (initStore()) window.store.remove("delayBreakStart");
}

function initStore() {
  if (!window.storeName) return false;
  if (window.store) return window.store;
  try {
    window.store = new Persist.Store(window.storeName);
  } catch (e) {
    console.error(e);
  }
  return window.store;
}
function loadAndRestoreGame(slot, forcedScene, forcedStats, forcedTemps) {
  function valueLoaded(ok, value) {
    safeCall(null, function() {
      var state = null;
      if (ok && value && ""+value) {
        //console.log("successfully loaded slot " + slot);
        state = jsonParse(value);
      } else if (slot == "backup") {
        console.log("loadAndRestoreGame couldn't find backup");
        if (typeof alertify !== "undefined") alertify.log("Failed restarting chapter. Restarting the game from scratch.");
        return restartGame();
      }
      restoreGame(state, forcedScene, false, forcedStats, forcedTemps);
    });
  }
  if (!slot) slot = "";
  if (_global.pseudoSave && pseudoSave[slot]) return valueLoaded(true, pseudoSave[slot]);
  if (!initStore()) return restoreGame(null, forcedScene);
  window.store.get("state"+slot, valueLoaded);
}

function isStateValid(state) {
  if (!state) return false;
  if (!state.stats) return false;
  if (!state.stats.sceneName) return false;
  return true;
}

function restartGame(shouldPrompt) {
  if (_global.blockRestart) {
    asyncAlert("Please wait until the timer has run out.");
    return;
  }
  function actuallyRestart(result) {
    if (!result) return;
    delayBreakEnd();
    submitAnyDirtySaves();
    clearCookie(function() {}, 'temp');
    clearCookie(function() {
      _global.nav.resetStats(_global.stats);
      clearScreen(restoreGame);
    }, "");
  }
  if (shouldPrompt) {
    asyncConfirm("Start over from the beginning?", actuallyRestart);
  } else {
    actuallyRestart(true);
  }
}

function restoreGame(state, forcedScene, userRestored, forcedStats, forcedTemps) {
    var scene;
    var secondaryMode = null;
    var saveSlot = "";
    var forcedSceneLabel = null;
    if (/\|/.test(forcedScene)) {
      var parts = forcedScene.split("|");
      forcedScene = parts[0];
      forcedSceneLabel = parts[1];
    }
    if (forcedScene == "choicescript_stats") {
      secondaryMode = "stats";
      saveSlot = "temp";
    } else if (forcedScene == "choicescript_upgrade") {
      secondaryMode = "upgrade";
      saveSlot = "temp";
    }
    if (!isStateValid(state)) {
        var startupScene = forcedScene ? forcedScene : _global.nav.getStartupScene();
        scene = new Scene(startupScene, _global.stats, _global.nav, {debugMode:_global.debug, secondaryMode:secondaryMode, saveSlot:saveSlot});
        trackEvent('game_start');
    } else {
      if (forcedScene) state.stats.sceneName = forcedScene;
      if (forcedStats) {
        for (var stat in forcedStats) {
          state.stats[stat] = forcedStats[stat];
        }
      }
      if (forcedTemps) {
        for (var temp in forcedTemps) {
          state.temps[temp] = forcedTemps[temp];
        }
      }
      _global.stats = state.stats;
      // Someday, inflate the navigator using the state object
      scene = new Scene(state.stats.sceneName, state.stats, _global.nav, {debugMode:state.debug || _global.debug, secondaryMode:secondaryMode, saveSlot:saveSlot});
      if (!forcedScene) {
        scene.temps = state.temps;
        scene.lineNum = state.lineNum;
        scene.indent = state.indent;
      }
      if (userRestored) {
        scene.temps.choice_user_restored = true;
      }
    }
    if (forcedSceneLabel !== null) {
      scene.targetLabel = {label:forcedSceneLabel, origin:"url", originLine:0}
    }
    safeCall(scene, scene.execute);
}

function redirectScene(sceneName, label, originLine) {
  var scene = new Scene(sceneName, window.stats, window.nav, {debugMode:window.debug});
  if (label) scene.targetLabel = {label:label, origin:"choicescript_stats", originLine:originLine};
  scene.redirectingFromStats = true;
  clearScreen(function() {scene.execute();});
}

tempStatWrites = {};

function transferTempStatWrites() {
  if (!_global.isIosApp) return;
  callIos("transferwrites", JSON.stringify(tempStatWrites));
}

function getCookieByName(cookieName, ck) {
    if (!ck) ck = window.document.cookie;
    if (!ck) return null;
    var ckPairs = ck.split(/;/);
    for (var i = 0; i < ckPairs.length; i++) {
        var ckPair = trim(ckPairs[i]);
        var ckNameValue = ckPair.split(/=/);
        var ckName = decodeURIComponent(ckNameValue[0]);
        if (ckName === cookieName) {
            return decodeURIComponent(ckNameValue[1]);
        }
    }
    return null;
}

function parseQueryString(str) {
  if (!str) return null;
  str = String(str).substring(1);
  if (!str) return null;
  var map = {};
  var pairs = str.split("&");
  var i = pairs.length;
  while (i--) {
    var pair = pairs[i];
    var parts = pair.split("=");
    map[parts[0]] = parts[1];
  }
  return map;
}

function trim(str) {
    if (str === null || str === undefined) return null;
    var result = str.replace(/^\s+/g, "");
    // strip leading
    return result.replace(/\s+$/g, "");
    // strip trailing
}


function findOptimalDomain(docDomain) {
    if (!docDomain) docDomain = document.domain;
    // localhost and 127.0.0.1 will cause cookie not to be set; just omit them, it works fine
    if (docDomain == "localhost" || docDomain == "127.0.0.1") return null;
    // ip address
    if (/^\d+\.\d+\.\d+\.\d+$/.test(docDomain)) return null;
    // dotcom
    var result = docDomain.match(/(\w+\.\w{3}$)/);
    if (result) return result[1];
    return null;
}

function num(x, line, sceneName) {
    if (!line) line = "UNKNOWN";
    errorInfo = "line "+line;
    if (sceneName) errorInfo = sceneName + " " + errorInfo;
    var x_num = parseFloat(x);
    if (isNaN(x_num)) throw new Error(errorInfo+": Not a number: " + x);
    if (!isFinite(x_num)) throw new Error(errorInfo+": Not finite " + x);
    return x_num;
}

function bool(x, line, sceneName) {
  if (!line) line = "UNKNOWN";
  if ("boolean" == typeof x) {
    return x;
  } else if ("true" === x) {
    return true;
  } else if ("false" === x) {
    return false;
  }
  errorInfo = "line "+line;
  if (sceneName) errorInfo = sceneName + " " + errorInfo;
  throw new Error(errorInfo+": Neither true nor false: " + x);
}

function findXhr() {
  var ieFile = isIE && isFile;
  if (window.XMLHttpRequest && !ieFile) return new window.XMLHttpRequest();
  var ids = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];
  for (var i = 0; i < 3; i++) {
    try {
      return new ActiveXObject(ids[i]);
    } catch (e) {}
  }
  throw new Error("Couldn't create XHR object");
}

    crcTable = "00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";

    /* Number */
    function crc32( /* String */ str, /* Number */ crc ) {
        if( !crc ) crc = 0;
        var n = 0; //a number between 0 and 255 
        var x = 0; //an hex number 

        crc = crc ^ (-1);
        for( var i = 0, iTop = str.length; i < iTop; i++ ) {
            n = ( crc ^ str.charCodeAt( i ) ) & 0xFF;
            x = "0x" + crcTable.substr( n * 9, 8 );
            crc = ( crc >>> 8 ) ^ x;
        }
        return crc ^ (-1);
    }

function simpleDateFormat(date) {
  var day = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"][date.getDay()];
  var month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"][date.getMonth()];
  var minutes = date.getMinutes();
  if (minutes < 10) minutes = "0" + ("" + minutes);
  var oneYearInMillis = 1000 * 60 * 60 * 24 * 365;
  var millisAgo = new Date().getTime() - date.getTime();
  var yearString = ""
  if (millisAgo > oneYearInMillis) {
    yearString = ", " + date.getFullYear();
  }
  return day + ", " + month + " " + date.getDate() + yearString;
}

function simpleDateTimeFormat(date) {
  var minutes = date.getMinutes();
  if (minutes < 10) minutes = "0" + ("" + minutes);
  return simpleDateFormat(date) + ", " + date.getHours() + ":" + minutes;
}

function jsonParse(str) {
  if (typeof JSON != "undefined") {
    try {
      return JSON.parse(str);
    } catch (e) {
      // try to handle unquoted keys
      try {
        return eval('('+str+')');
      } catch (e2) {
        // that might have failed because eval is forbidden
        try {
          eval("1");
        } catch (e3) {
          // eval forbidden; let's try a hack to fix unquoted keys
          var str2 = (str+"").replace(/([,\{])\s*(\w+)\s*\:/g, '$1"$2":');
          try {
            return JSON.parse(str2);
          } catch (e4) {}
        }
        // at this point, just report a clear error
        return JSON.parse(str);
      }
    }
  } else {
    return eval('('+str+')');
  }
}

function cefQuerySimple(method) {
  cefQuery({
    request:method,
    onSuccess: function(response) {console.log(method + " success");},
    onFailure: function(error_code, error_message) {console.error(method + " error: " + error_message);}
  });
}

shortMonthStrings = [null, "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/parse
// "Given a date string of "March 7, 2014", parse() assumes a local time zone, but given an
// ISO format such as "2014-03-07" it will assume a time zone of UTC for ES5 or local for
// ECMAScript 2015."
function parseDateStringInCurrentTimezone(YYYY_MM_DD, line) {
  var result = /^(\d{4})-(\d{2})-(\d{2})$/.exec(YYYY_MM_DD);
  if (!result) throw new Error("line "+line+": invalid date string " + YYYY_MM_DD);
  var fullYear = result[1];
  var oneBasedMonthNumber = parseInt(result[2],10);
  var dayOfMonth = parseInt(result[3],10);
  var shortMonthString = shortMonthStrings[oneBasedMonthNumber];
  return new Date(shortMonthString + " " + dayOfMonth + ", " + fullYear);
}

function matchBracket(line, brackets, startIndex) {
  var openBracket = brackets[0];
  var closeBracket = brackets[1];
  var brackets = 0;
  for (var i = startIndex; i < line.length; i++) {
    var c = line.charAt(i);
    if (c === openBracket) {
      brackets++;
    } else if (c === closeBracket) {
      if (brackets) {
        brackets--;
      } else {
        return i;
      }
    }
  }
  return -1;
}

function isStoreSceneCacheRequired() {
  if (!(initStore() &&
    _global.purchases &&
    _global.checkPurchase &&
    _global.hashes &&
    !(_global.isOmnibusApp && _global.isIosApp) &&
    hashes.scenes
  )) return false;
  var empty = true;
  for (var scene in purchases) {
    if (/^fake:/.test(scene)) continue;
    empty = false;
    break;
  }
  return !empty;
}

function updateSinglePaidSceneCache(sceneName, callback) {
  sceneName = sceneName.replace(/ /g, "_");
  var fileName = sceneName + ".txt.json";
  if (initStore() && _global.hashes && hashes.scenes && hashes.scenes[fileName]) {
    function actualRequest(receiptsSent) {
      var xhr = new XMLHttpRequest();
      var canonical = document.querySelector("link[rel=canonical]");
      var canonicalHref = canonical && canonical.getAttribute("href");
      if (window.beta) {
        canonicalHref = canonicalHref.replace('https://www.choiceofgames.com/', 'https://www.choiceofgames.com/beta/');
      }
      var url = canonicalHref + "scenes/" + fileName + "?hash="+hashes.scenes[fileName];
      xhr.open("GET", url);
      xhr.withCredentials = true;
      xhr.onload = function() {
        var error;
        if (xhr.status !== 200) {
          try {
            error = JSON.parse(xhr.responseText).error;
          } catch (e) {}
        }
        if (xhr.status === 404) {
          try {
            if (error === "hash doesn't match") {
              return awaitAppUpdate(function() {
                callback("strange");
              })
            }
          } catch (e) {
            if (window.console) console.error(e, e.stack);
          }
        }
        if (xhr.status == 403 && _global.isOmnibusApp && _global.isAndroidApp) {
          if (!receiptsSent) {
            window.receiptRequestCallback = function(receipts) {
              window.receiptRequestCallback = null;
              submitReceipts(receipts, function(error) {
                if (error) {
                  return callback(error);
                } else {
                  actualRequest("receiptsSent");
                }
              });
            }
            androidBilling.requestReceipts();
            return;
          } else if (error === "not registered" || error == "not purchased") {
            return callback(error);
          }
        } else if (xhr.status !== 200) {
          return callback(xhr.status);
        }
        var result;
        try {
          result = jsonParse(xhr.responseText);
        } catch (e) {
          if (window.console) console.error(e, e.stack);
        }
        var ok = result && result.crc && result.lines && result.labels;
        if (!ok) return callback("network");
        window.store.set("cache_scene_"+sceneName, xhr.responseText, function() {
          window.store.set("cache_scene_hash_"+sceneName, hashes.scenes[fileName], function() {
            callback(null, result);
          });
        });
      };
      xhr.onerror = function() {
        callback("network");
      }
      console.log("updateSinglePaidSceneCache " + url);
      xhr.send();
    }
    actualRequest();
  }
}

function updateAllPaidSceneCaches(receiptsSent) {
  if (!isStoreSceneCacheRequired()) {
    if (window.isOmnibusApp && window.isAndroidApp) {
      window.receiptRequestCallback = submitReceipts;
      androidBilling.requestReceipts();
    }
    return;
  }
  if (_global.isOmnibusApp && _global.isAndroidApp && !receiptsSent) {
    window.receiptRequestCallback = function(receipts) {
      submitReceipts(receipts, function() {updateAllPaidSceneCaches("receiptsSent");});
    };
    androidBilling.requestReceipts();
    return;
  }
  var flipped = {};
  for (var scene in purchases) {
    if (/^fake:/.test(scene)) continue;
    scene = scene.replace(/ /g, "_");
    if (!flipped[purchases[scene]]) flipped[purchases[scene]] = [];
    flipped[purchases[scene]].push(scene);
  }
  var products = [];
  for (var product in flipped) {
    products.push(product);
  }
  if (!products.length) return;
  checkPurchase(products.join(" "), function(ok, result) {
    if (!ok || !result) return;
    var sceneList = [];
    var push = Array.prototype.push;
    for (var product in flipped) {
      if (result[product]) {
        push.apply(sceneList, flipped[product]);
      }
    }
    if (!sceneList.length) return;
    for (var i = 0; i < sceneList.length; i++) {
      (function(i) {
        var scene = sceneList[i];
        var fileName = scene + ".txt.json";
        window.store.get("cache_scene_hash_"+scene, function(ok, result) {
          if (!ok || result !== hashes.scenes[fileName]) {
            updateSinglePaidSceneCache(scene, function() {});
          }
        });
      })(i);
    }
  })
}

function checkForAppUpdates() {
  if (navigator.serviceWorker) {
    navigator.serviceWorker.getRegistration().then(function(reg) {
      if (reg) reg.update();
    });
  }
}

function refreshIfAppUpdateReady() {
  if (navigator.serviceWorker) {
    if (window.controllerchanged) {
      return window.location.reload();
    }
    navigator.serviceWorker.getRegistration().then(function(reg) {
      if (reg.waiting) {
        reg.waiting.postMessage('skipWaiting');
        return window.location.reload();
      }
    });
  }
}

function awaitAppUpdate(callback) {

  var serviceWorkerExists = (navigator.serviceWorker && navigator.serviceWorker.controller);
  if (!serviceWorkerExists) return callback();

  var calledBack = false;
  var maybeCallback = function() {
    if (calledBack) return;
    calledBack = true;
    callback();
  }

  if (window.controllerchanged) return maybeCallback();
  setTimeout(maybeCallback, 10000);
  navigator.serviceWorker.getRegistration().then(function(reg) {
    if (!reg) return maybeCallback();
    if (reg.waiting) {
      reg.waiting.postMessage('skipWaiting');
      return maybeCallback();
    }
    var watchStateChange = function() {
      if (this.state == 'installed') {
        if (reg.waiting) reg.waiting.postMessage('skipWaiting');
        maybeCallback();
      }
    };
    if (reg.installing) reg.installing.addEventListener('statechange', watchStateChange);
    reg.update();
    reg.addEventListener('updatefound', function() {
      reg.installing.addEventListener('statechange', watchStateChange);
    })
  });
}

function remoteConfig(variable, callback) {
  if (!_global.isOmnibusApp) {
    safeTimeout(function() {callback(null);}, 0);
    return;
  }
  if (_global.isIosApp) {
    var nonce = "remoteConfig" + variable + (+new Date);
    window[nonce] = function(value) {
      delete window[nonce];
      callback(value);
    }
    callIos("remoteconfig", variable + " " + nonce);
  } else {
    var result = (_global.androidRemoteConfig && androidRemoteConfig.remoteConfig(variable)) || null;
    return safeTimeout(function() {callback(result);}, 0);
  }
}

function trackEvent(name, params) {
  try {
    //console.log('trackEvent', name, params);
    if (!params) params = {};
    params.game_id = _global.storeName;
    params.game_version = _global.version;
    if (typeof nativeTrackEvent !== "undefined") {
      window.nativeTrackEvent(name, params);
    } else if (typeof gtag !== "undefined") {
      gtag('event', name, params);
    }
  } catch (e) {
    console.error("Error tracking event", e);
  }
}

;
/*
 * Copyright 2010 by Dan Fabulich.
 *
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 *
 * See the License for the specific language governing
 * permissions and limitations under the License.
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */

;(function() {
  var lastTime = 0;
  if (!window.requestAnimationFrame)
    window.requestAnimationFrame = function(callback, element) {
        var currTime = new Date().getTime();
        var timeToCall = Math.max(0, 16 - (currTime - lastTime));
        var id = window.setTimeout(function() { callback(currTime + timeToCall); },
          timeToCall);
        lastTime = currTime + timeToCall;
        return id;
    };
})();

function printx(msg, parent) {
    if (msg === null || msg === undefined || msg === "") return;
    if (!parent) parent = document.getElementById('text');
    if (msg == " ") {
      // IE7 doesn't like innerHTML that's nothing but " "
      parent.appendChild(document.createTextNode(" "));
      return;
    }
    msg = replaceBbCode(msg);
    var frag = document.createDocumentFragment();
    temp = document.createElement('div');
    temp.innerHTML = msg;
    while (temp.firstChild) {
        frag.appendChild(temp.firstChild);
    }
    parent.appendChild(frag);
}

function replaceBbCode(msg) {
  return msg = String(msg).replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/\[url\=(.*?)\]/g, '<a href="$1">')
      .replace(/\[\/url\]/g, '</a>')
      .replace(/\[n\/\]/g, '<br>')
      .replace(/\[c\/\]/g, '')
      .replace(/\[b\]/g, '<b>')
      .replace(/\[\/b\]/g, '</b>')
      .replace(/\[i\]/g, '<i>')
      .replace(/\[\/i\]/g, '</i>')
      .replace(/\u2022([\s\S]*)/, '<ul>â€¢$1</ul>')
      .replace(/\u2022([^\u2022]*)/g, '<li>$1</li>')
}

function println(msg, parent) {
    if (!parent) parent = document.getElementById('text');
    printx(msg, parent);
    var br = window.document.createElement("br");
    parent.appendChild(br);
}

function printParagraph(msg, parent) {
  if (msg === null || msg === undefined || msg === "") return;
  if (!parent) parent = document.getElementById('text');
  msg = replaceBbCode(msg);
  p = document.createElement('p');
  p.innerHTML = msg;
  parent.appendChild(p);
  return p;
}

function showStats() {
    if (document.getElementById('loading')) return;
    var button = document.getElementById("statsButton");
    if (button && button.getAttribute("data-return")) {
      return clearScreen(function() {
        setButtonTitles();
        loadAndRestoreGame();
      });
    }
    var currentScene = window.stats.scene;
    var scene = new Scene("choicescript_stats", window.stats, this.nav, {secondaryMode:"stats", saveSlot:"temp"});
    clearScreen(function() {
      setButtonTitles();
      scene.execute();
    })
}

function redirectFromStats(scene, label, originLine, callback) {
  if (window.isIosApp) {
    if (!label) label = "";
    callIos("redirectfromstats", scene + " " +label  + " " + originLine);
  } else if (window.isAndroidApp) {
    statsMode.redirectFromStats(scene, label || "", originLine);
  } else {
    safeTimeout(callback, 0);
  }
}

function returnFromStats() {
  if (window.isIosApp && !window.isIPad) {
    callIos("returntogame");
  } else if (window.isAndroidApp && window.statsMode.get()) {
    statsMode.returnToGame();
  } else {
    clearScreen(loadAndRestoreGame);
  }
}

function restoreCheckpointFromStats(callback) {
  safeTimeout(callback, 0);
}

function showAchievements(hideNextButton) {
  if (document.getElementById('loading')) return;
  var button = document.getElementById("achievementsButton");
  if (!button) return;
  if (button.getAttribute("data-return")) {
    return clearScreen(function() {
      setButtonTitles();
      loadAndRestoreGame();
    });
  }
  clearScreen(function() {
    setButtonTitles();
    var button = document.getElementById("achievementsButton");
    button.innerHTML = "Return to the Game";
    button.setAttribute("data-return", "true");
    checkAchievements(function() {
      printAchievements(document.getElementById("text"));
      if (!hideNextButton) printButton("Next", main, false, function() {
        clearScreen(function() {
          setButtonTitles();
          loadAndRestoreGame();
        });
      });
      curl();
    });
  });
}

function showMenu() {
  if (document.getElementById('loading')) return;
  var button = document.getElementById("menuButton");
  if (!button) return;
  if (button.getAttribute("data-return")) {
    return clearScreen(function() {
      setButtonTitles();
      loadAndRestoreGame();
    });
  }
  function menu() {
    setButtonTitles();
    var button = document.getElementById("menuButton");
    button.innerHTML = "Return to the Game";
    button.setAttribute("data-return", "true");
    options = [{name:"Return to the game.", group:"choice", resume:true}];
    if (window.isSteamworks) {
      options.push(
        {name:"Quit the game.", group:"choice", quit:true}
      )
    }
    if (nav.achievementList.length) options.push(
      { name: "View achievements.", group: "choice", achievements: true }
    );
    options.push(
      {name:"Restart the game.", group:"choice", restart:true},
      {name:"Change settings.", group:"choice", settings:true},
      /* moreGames removed */
    );
    /* removed CoG-specific menu items for indie release */;
    if (document.getElementById("aboutLink")) {
      options.push({name:"View the credits.", group:"choice", credits:true});
    }
    var logoutLink = document.getElementById("logout");
    if (logoutLink && logoutLink.style.display !== "none") {
      options.push({ name: "Sign out.", group: "choice", logout: true });
    }
    printOptions([""], options, function(option) {
      if (option.resume) {
        return clearScreen(function() {
          setButtonTitles();
          loadAndRestoreGame();
        });
      } else if (option.quit) {
        require('electron').ipcRenderer.invoke('quit');
      } else if (option.achievements) {
        return showAchievements();
      } else if (option.restart) {
        if (_global.blockRestart) {
          asyncAlert("Please wait until the timer has run out.");
          return;
        }
        return clearScreen(function() {
          var text = document.getElementById('text');
          text.innerHTML = "Start over from the beginning?";
          var options = [
            {name: "Restart the game.", group:"choice", restart: true},
            {name: "Cancel.", group: "choice", restart: false },
          ]
          printOptions([""], options, function(option) {
            if (option.restart) {
              clearScreen(function() {
                setButtonTitles();
                restartGame();
              })
            } else {
              clearScreen(function() {
                setButtonTitles();
                loadAndRestoreGame();
              })
            }
          })
          curl();
        });
      } else if (option.settings) {
        textOptionsMenu({ size: 1, color: 1, family: 1, animation: window.animationProperty, sliding: window.isMobile });
      } else if (option.credits) {
        absolutizeAboutLink();
        aboutClick();
      } else if (option.moreGames) {
        moreGames();
        curl();
      } else if (option.share) {
        clearScreen(function() {
          printShareLinks(document.getElementById("text"), "now");
          menu();
        });
      } else if (option.subscribe) {
        setButtonTitles();
        subscribeLink();
      } else if (option.contactUs) {
        window.location.href="mailto:"+getSupportEmail();
      } else if (option.reportBug) {
        clearScreen(function() {
          reportBug();
          showMenu();
        });
      } else if (option.shortcuts) {
        var dialog = document.getElementById('keyboardShortcuts');
        if (dialog && dialog.showModal) dialog.showModal();
      } else if (option.logout) {
        clearScreen(function() {
          logout();
          loginDiv();
          printParagraph("You have been signed out.");
          menu();
        })
      }
    });
    // show title and author on menu screen
    // this will be hidden on desktop web, but visible elsewhere
    changeTitle(document.title);
    changeAuthor(document.getElementById("author").innerText.substring(3));
    if (window.isSteamApp) {
      printParagraph("Need help? Email us at " + getSupportEmail() + ".");
    }
    curl();
  }
  clearScreen(menu);
}

function setButtonTitles() {
  var button;
  button = document.getElementById("menuButton");
  if (button) {
    button.innerHTML = "Menu";
    button.removeAttribute("data-return");
  }
  button = document.getElementById("statsButton");
  if (button) {
    button.innerHTML = "Show Stats";
    button.removeAttribute("data-return");
  }
  button = document.getElementById("achievementsButton");
  if (button) {
    if (nav.achievementList.length) {
      button.style.display = "";
      button.innerHTML = "Achievements";
      button.removeAttribute("data-return");
    } else {
      button.style.display = "none";
    }
  }
}


function textOptionsMenu(categories) {
  if (!categories) {
    categories = {size:1, color:1, family:1, animation:window.animationProperty, sliding: window.isMobile};
  }
  clearScreen(function() {
    var button = document.getElementById("menuButton");
    if (button) button.innerHTML = "Return to the Game";
    button.setAttribute("data-return", "true");
    var text = document.getElementById("text");
    var oldZoom = getZoomFactor();
    var oldFontFamily = getFontFamily();
    if (categories.settings) {
      text.innerHTML = "<p>Change the game's settings.</p>";
    } else if (categories.size && categories.color) {
      text.innerHTML = "<p>Change the game's appearance.</p>";
    } else if (categories.size) {
      text.innerHTML = "<p>Make the text bigger or smaller.</p>";
    } else if (categories.color) {
      text.innerHTML = "<p>Change the background color.</p>";
    } else if (categories.animation) {
      text.innerHTML = "<p>Change the animation between pages.</p>";
    } else if (categories.sliding) {
      text.innerHTML = "<p>Enable or disable touch slide controls.</p>";
    }
    options = [
      {name:"Return to the game.", group:"choice", resume:true},
    ];
    if (categories.size) {
      options.push(
        {name:"Make the text bigger.", group:"choice", bigger:true},
        {name:"Make the text smaller.", group:"choice", smaller:true}
      );
      if (oldZoom <= 0.5) {
        options[options.length-1].unselectable = true;
      }
      if (oldZoom !== 1) {
        options.push({name:"Reset the text to its original size.", group:"choice", reset:true});
      }
    }
    if (categories.family) {
      if (oldFontFamily !== "serif") options.push({ name: "Use a serif font.", group: "choice", family: "serif" });
      if (oldFontFamily !== "sans") options.push({ name: "Use a sans-serif font.", group: "choice", family: "sans" });
      if (oldFontFamily !== "dyslexia") options.push({ name: "Use a dyslexia-friendly font.", group: "choice", family: "dyslexia" });
    }
    if (categories.color) options.push(
      {name:"Use a black background.", group:"choice", color:"black"},
      {name:"Use a sepia background.", group:"choice", color:"sepia"},
      {name:"Use a white background.", group:"choice", color:"white"}
    );
    if (categories.animation) {
      if (window.animateEnabled) {
        options.push({ name: "Don't animate between pages.", group: "choice", animation: 2 });
      } else {
        options.push({ name: "Animate between pages.", group: "choice", animation: 1 });
      }
    }
    if (categories.sliding) {
      if (window.slidingEnabled !== false) {
        options.push({ name: "Disable touch slide controls.", group: "choice", sliding: 1 });
      } else {
        options.push({ name: "Enable touch slide controls.", group: "choice", sliding: 2 });
      }
    }
    printOptions([""], options, function(option) {
      if (option.resume) {
        return clearScreen(function() {
          setButtonTitles();
          loadAndRestoreGame();
        });
      } else if (option.color) {
        changeBackgroundColor(option.color);
      } else if (option.reset) {
        setZoomFactor(1);
      } else if (option.animation) {
        window.animateEnabled = option.animation !== 2;
        if (initStore()) store.set("preferredAnimation", parseFloat(option.animation));
      } else if (option.sliding) {
        window.slidingEnabled = option.sliding == 2;
        if (initStore()) store.set("preferredSliding", window.slidingEnabled);
      } else if (option.family) {
        changeFontFamily(option.family);
      } else {
        changeFontSize(option.bigger);
      }
      textOptionsMenu(categories);
    })
    curl();
  });
}

function getZoomFactor() {
  if (document.documentElement.style.fontSize === undefined) {
    return window.zoomFactor || 1;
  } else {
    var fontSize = parseFloat(document.documentElement.style.fontSize);
    if (isNaN(fontSize)) fontSize = 100;
    return fontSize / 100;
  }
}

function setZoomFactor(zoomFactor) {
  document.documentElement.style.fontSize = Math.round(100*zoomFactor) + "%";
  window.zoomFactor = zoomFactor;
  if (initStore()) store.set("preferredZoom", String(zoomFactor));
}

function changeFontSize(bigger) {
  var oldZoom = getZoomFactor();
  if (bigger) {
    setZoomFactor(oldZoom + 0.1);
  } else {
    setZoomFactor(oldZoom - 0.1);
  }
}

function getFontFamily() {
  if (document.body.classList.contains("sans")) {
    return "sans";
  } else if (document.body.classList.contains("dyslexia")) {
    return "dyslexia";
  } else {
    return "serif";
  }
}

function changeFontFamily(family) {
  document.body.classList.remove("sans", "dyslexia");
  if (family !== "serif") {
    document.body.classList.add(family);
  }
  if (initStore()) store.set("preferredFamily", family);
}

function changeBackgroundColor(color) {
  if (color === "sepia") {
    document.body.classList.remove("nightmode");
    document.body.classList.remove("whitemode");
  } else if (color === "black") {
    document.body.classList.remove("whitemode");
    document.body.classList.add("nightmode");
  } else if (color === "white") {
    document.body.classList.remove("nightmode");
    document.body.classList.add("whitemode");
  }
  if (initStore()) store.set("preferredBackground", color);
}

function isNightMode() {
  return document.body.classList.contains("nightmode");
}

function spell(num) {
  if (num > 99) return num;
  var smallNumbers = ["zero", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen"];
  var tens = ["zero", "ten", "twenty", "thirty", "forty", "fifty", "sixty", "seventy", "eighty", "ninety"];
  if (num < 20) {
    return smallNumbers[num];
  }
  var onesDigit = num % 10;
  if (onesDigit === 0) {
    return tens[num / 10];
  }
  var tensDigit = (num - onesDigit) / 10;
  return tens[tensDigit]+"-"+smallNumbers[onesDigit];
}

function printAchievements(target) {
  var unlockedBuffer = [];
  var lockedBuffer = [];
  var achievedCount = 0, hiddenCount = 0, score = 0, totalScore = 0;
  var totalAchievements = nav.achievementList.length;
  var buffer;
  for (var i = 0; i < totalAchievements; i++) {
    var name = nav.achievementList[i];
    var achievement = nav.achievements[name];
    var points = achievement.points;
    totalScore += points;

    var description;

    if (nav.achieved[name]) {
      achievedCount++;
      score += points;
      buffer = unlockedBuffer;
      description = achievement.earnedDescription;
    } else {
      if (achievement.visible) {
        buffer = lockedBuffer;
        description = achievement.preEarnedDescription;
      } else {
        hiddenCount++;
        continue;
      }
    }

    if (buffer.length) buffer.push("<br>");
    buffer.push("<b>");
    buffer.push(achievement.title.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;'));
    buffer.push(":");
    buffer.push("</b> ");
    buffer.push(description.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;')
      .replace(/\[b\]/g, '<b>')
      .replace(/\[\/b\]/g, '</b>')
      .replace(/\[i\]/g, '<i>')
      .replace(/\[\/i\]/g, '</i>')
    );
    buffer.push(" (");
    buffer.push(points);
    buffer.push(" points)");
  }

  // What if there's exactly one achievement worth exactly one point?
  if (achievedCount === 0) {
    if (hiddenCount === 0) {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" possible achievements, worth a total of "+totalScore+" points.<p>"];
    } else if (hiddenCount == 1) {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" possible achievements (including one hidden achievement), worth a total of "+totalScore+" points.<p>"];
    } else if (hiddenCount == totalAchievements) {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" hidden achievements, worth a total of "+totalScore+" points.<p>"];
    } else {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" possible achievements (including "+spell(hiddenCount)+" hidden achievements), worth a total of "+totalScore+" points.<p>"];
    }
    if (lockedBuffer.length) {
      buffer.push.apply(buffer, lockedBuffer);
      buffer.push("<p>");
    }
  } else if (score == totalScore) {
    if (totalAchievements == 2) {
      buffer = ["Congratulations! You have unlocked both achievements, earning a total of "+score+" points, a perfect score.<p>"];
    } else {
      buffer = ["Congratulations! You have unlocked all "+spell(totalAchievements)+" achievements, earning a total of "+score+" points, a perfect score.<p>"];
    }
    buffer.push.apply(buffer, unlockedBuffer);
    buffer.push("<p>");
  } else {
    buffer = ["You have unlocked "+spell(achievedCount)+" out of "+spell(totalAchievements)+" possible achievements, earning you a score of "+score+" out of a possible "+totalScore+" points.<p>"];
    buffer.push.apply(buffer, unlockedBuffer);
    var remaining = totalAchievements-achievedCount;
    if (remaining == hiddenCount) {
      if (remaining == 1) {
        buffer.push("<p>There is still one hidden achievement remaining.<p>");
      } else {
        buffer.push("<p>There are still " + spell(remaining) + " hidden achievements remaining.<p>");
      }
    } else if (hiddenCount > 1) {
      buffer.push("<p>There are still "+spell(remaining)+" achievements remaining, including "+spell(hiddenCount)+" hidden achievements.<p>");
    } else if (hiddenCount == 1) {
      buffer.push("<p>There are still "+spell(remaining)+" achievements remaining, including one hidden achievement.<p>");
    } else if (remaining == 1) {
      buffer.push("<p>There is still one achievement remaining.<p>");
    } else {
      buffer.push("<p>There are still "+spell(remaining)+" achievements remaining.<p>");
    }
    if (lockedBuffer.length) {
      buffer.push.apply(buffer, lockedBuffer);
      buffer.push("<p>");
    }
  }

  target.innerHTML = buffer.join("");
}

function asyncAlert(message, callback) {
  if (!callback) callback = function(){};
  if (window.isIosApp) {
    window.alertCallback = callback;
    callIos("alert", message);
  } else if (window.isAndroidApp) {
    setTimeout(function() {
      alert(message);
      if (callback) callback();
    }, 0);
  } else if (window.isWinOldApp) {
    setTimeout(function() {
      window.external.Alert(message);
      if (callback) callback();
    }, 0);
  } else {
    alertify.alert(message, function() {safeCall(null, callback);});
  }
}

function asyncConfirm(message, callback) {
  if (false/*window.isIosApp*/) {
    // TODO asyncConfirm
    window.confirmCallback = callback;
    callIos("confirm", message);
  } else if (window.isAndroidApp) {
    setTimeout(function() {
      var result = confirm(message);
      if (callback) callback(result);
    }, 0);
  } else if (window.isWinOldApp) {
    setTimeout(function() {
      var result = window.external.Confirm(message);
      if (callback) callback(result);
    }, 0);
  } else {
    alertify.confirm(message, function(result) {safeCall(null, callback(result));});
  }
}


function clearScreen(code) {
    var text = document.getElementById("text");
    var container1 = document.getElementById("container1");
    if (!container1) throw new Error("<div id=container1> is missing from index.html");

    if (window.animateEnabled && window.animationProperty && (!window.isIosApp || window.newIosCurl) && !document.getElementById('container2')) {
      var container2 = document.createElement("div");
      container2.setAttribute("id", "container2");
      container2.classList.add('container');
      document.body.classList.add('frozen');
      container2.style.opacity = 0;


      // get the vertical scroll position as pageYOffset
      // translate up by pageYOffset pixels, then scroll to the top
      // now we're scrolled up, but the viewport *looks* like it has retained its scroll position
      var pageYOffset = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
      var extraScroll = 0;
      if (window.isMobile && window.isWeb && window.isAndroid && !/Chrome/.test(navigator.userAgent)) {
        extraScroll = 1; // try to hide url bar
      }
      pageYOffset -= extraScroll;
      container1.style.transform = "translateY(-"+pageYOffset+ "px)";
      container1.style.webkitTransform = "translateY(-"+pageYOffset+ "px)";
      window.scrollTo(0,extraScroll);

      container2.innerHTML = container1.innerHTML;
      [].forEach.call(container1.querySelectorAll('input,button,a,textarea,label'), function(element) {
        element.setAttribute("tabindex", "-1");
        element.removeAttribute("accesskey");
      });

      document.body.insertBefore(container2, container1);
      main = document.getElementById("main");
      main.innerHTML = "";
      text = document.createElement("div");
      text.setAttribute("id", "text");
      main.appendChild(text);
      if (window.isChromeApp) fixChromeLinks();
    } else {
      main = document.getElementById("main");
      main.innerHTML = "";
      text = document.createElement("div");
      text.setAttribute("id", "text");
      main.appendChild(text);

      window.scrollTo(0,1);
    }


    var useAjax = true;
    if (isWeb && window.noAjax) {
      useAjax = false;
    }

    if (useAjax) {
      doneLoading();
      safeCall(null, code);
    } else {
      if (!initStore()) alert("Your browser has disabled cookies; this game requires cookies to work properly.  Please re-enable cookies and refresh this page to continue.");
      startLoading();
      var form = window.document.createElement("form");
      var axn = window.location.protocol + "//" + window.location.host + window.location.pathname;
      form.setAttribute("action", axn);
      form.setAttribute("method", "POST");
      main.appendChild(form);
      form.submit();
    }
}

function focusFirst() {
  var text = document.getElementById("text");
  if (text && text.firstElementChild) {
    var focusable = text.firstElementChild;
    if (/^img$/i.test(focusable.tagName) && focusable.complete === false) {
      focusable.addEventListener("load", focusFirst);
      return;
    }
    focusable.setAttribute("tabindex", "-1");
    focusable.classList.add("tempfocus");
    focusable.focus();
    focusable.blur();
    requestAnimationFrame(function () {
      focusable.focus();
      requestAnimationFrame(function () {
        focusable.blur();
        focusable.removeAttribute("tabindex");
        focusable.classList.remove("tempfocus");
      });
    });
  }
}

// in the iOS app, display a page curl animation
function curl() {
  // TODO force a reflow before curling the page
  var container2 = document.getElementById('container2');
  if (!container2) {
    focusFirst();
    return window.animateEnabled ? callIos("curl") : callIos("unfreeze");
  }

  var container1 = document.getElementById('container1');
  var onContainer1Disappeared = function(e) {
    if (container1.parentElement) container1.parentElement.removeChild(container1);
  };
  var onContainer2Appeared = function(e) {
    document.body.classList.remove('frozen');
    focusFirst();
    container2.removeEventListener('transitionend', onContainer2Appeared);
    container2.removeEventListener('webkitTransitionEnd', onContainer2Appeared);
  };

  if (!window.isIosApp && window.animationProperty) {
    var slideoutStyle = document.getElementById('slideoutStyle');
    if (!slideoutStyle) {
      slideoutStyle = document.createElement("style");
      slideoutStyle.setAttribute("id", "slideoutStyle");
      document.head.appendChild(slideoutStyle);
    }

    var shouldSlide = true;

    var timingFunction = "\n.container { transition-timing-function: ease-in; };";
    if (shouldSlide) timingFunction = "";

    slideoutStyle.innerHTML = "@keyframes containerslideout { "+
      "from { transform: "+container1.style.transform+"; } " +
      "to   { transform: "+container1.style.transform+" translateX(-105%); } }\n"+
      "@-webkit-keyframes containerslideout { "+
      "from { -webkit-transform: "+container1.style.webkitTransform+"; } " +
      "to   { -webkit-transform: "+container1.style.webkitTransform+" translateX(-105%); } }"+
      timingFunction;

    // double rAF so we start after container1 is transformed and scrolled to the top
    // minimizes flicker on iOS
    requestAnimationFrame(function() {
      requestAnimationFrame(function() {
        if (shouldSlide) {
          var fastApple = window.isIPad || window.isIPhone || window.isMacApp;
          var slowAndroid = window.isAndroidApp && /Android 4/.test(navigator.userAgent);
          var useCssAnimations = true; // fastApple || slowAndroid;
          if (useCssAnimations) {
            container1.style[window.animationProperty] = 'containerslideout';
            container2.style[window.animationProperty] = 'containerslidein';
          } else {
            var frames = 0;
            var durationInSeconds = 0.5;
            var framesPerSecond = 60;
            var totalSteps = framesPerSecond * durationInSeconds;
            var oldContainer1Transform = container1.style.transform;
            var rafSlide = function(stamp) {
              var fraction = frames / totalSteps;
              // ease approximation https://github.com/mietek/ease-tween/blob/master/src/index.js
              fraction = 1.0042954579734844 * Math.exp(
                -6.4041738958415664 * Math.exp(
                  -7.2908241330981340 * fraction));
              container1.style.transform = container1.style.webkitTransform =
                oldContainer1Transform + " translateX(-" + (105 * fraction) + "%)";
              container2.style.transform = container2.style.webkitTransform =
                "translateX(" + (100 - 100 * fraction) + "%)";
              if (frames < totalSteps) {
                frames++;
                requestAnimationFrame(rafSlide);
              }
            }
            requestAnimationFrame(rafSlide);
          }
        }
        container1.style.opacity = 0;
        container2.style.opacity = 1;
        container1.addEventListener('transitionend', onContainer1Disappeared);
        container2.addEventListener('transitionend', onContainer2Appeared);
        container1.addEventListener('webkitTransitionEnd', onContainer1Disappeared);
        container2.addEventListener('webkitTransitionEnd', onContainer2Appeared);
      })
    })
  } else {
    onContainer2Appeared();
    onContainer1Disappeared();
    window.animateEnabled ? callIos("curl") : callIos("unfreeze");
  }

  container1.removeAttribute("id");
  container2.setAttribute("id", "container1");
}

function safeSubmit(code) {
    return function safelySubmitted() {
        safeCall(code);
        return false;
    };
}

function startLoading() {
    var loading = document.getElementById('loading');
    if (!loading) {
      safeCall(null, function() {
        loading = document.createElement('div');
        loading.setAttribute("id", "loading");
        loading.innerHTML = (/MSIE [67]/.test(navigator.userAgent)?"":"<img src=\"data:image/gif;base64,R0lGODlhgAAPAPEAAPf08WJhYMvJx2JhYCH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAgAAPAAACo5QvoIC33NKKUtF3Z8RbN/55CEiNonMaJGp1bfiaMQvBtXzTpZuradUDZmY+opA3DK6KwaQTCbU9pVHc1LrDUrfarq765Ya9u+VRzLyO12lwG10yy39zY11Jz9t/6jf5/HfXB8hGWKaHt6eYyDgo6BaH6CgJ+QhnmWWoiVnI6ddJmbkZGkgKujhplNpYafr5OooqGst66Uq7OpjbKmvbW/p7UAAAIfkECQoAAAAsAAAAAIAADwAAArCcP6Ag7bLYa3HSZSG2le/Zgd8TkqODHKWzXkrWaq83i7V5s6cr2f2TMsSGO9lPl+PBisSkcekMJphUZ/OopGGfWug2Jr16x92yj3w247bh6teNXseRbyvc0rbr6/x5Ng0op4YSJDb4JxhI58eliEiYYujYmFi5eEh5OZnXhylp+RiaKQpWeDf5qQk6yprawMno2nq6KlsaSauqS5rLu8cI69k7+ytcvGl6XDtsyzxcAAAh+QQJCgAAACwAAAAAgAAPAAACvpw/oIC3IKIUb8pq6cpacWyBk3htGRk1xqMmZviOcemdc4R2kF3DvfyTtFiqnPGm+yCPQdzy2RQMF9Moc+fDArU0rtMK9SYzVUYxrASrxdc0G00+K8ruOu+9tmf1W06ZfsfXJfiFZ0g4ZvEndxjouPfYFzk4mcIICJkpqUnJWYiYs9jQVpm4edqJ+lkqikDqaZoquwr7OtHqAFerqxpL2xt6yQjKO+t7bGuMu1L8a5zsHI2MtOySVwo9fb0bVQAAIfkECQoAAAAsAAAAAIAADwAAAsucP6CAt9zSErSKZyvOd/KdgZaoeaFpRZKiPi1aKlwnfzBF4jcNzDk/e7EiLuLuhzwqayfmaNnjCCGNYhXqw9qcsWjT++TqxIKp2UhOprXf7PoNrpyvQ3p8fAdu82o+O5w3h2A1+Nfl5geHuLgXhEZVWBeZSMnY1oh5qZnyKOhgiGcJKHqYOSrVmWpHGmpauvl6CkvhaUD4qejaOqvH2+doV7tSqdsrexybvMsZrDrJaqwcvSz9i9qM/Vxs7Qs6/S18a+vNjUx9/v1TAAAh+QQJCgAAACwAAAAAgAAPAAAC0Zw/oIC33NKKUomLxct4c718oPV5nJmhGPWwU9TCYTmfdXp3+aXy+wgQuRRDSCN2/PWAoqVTCSVxilQZ0RqkSXFbXdf3ZWqztnA1eUUbEc9wm8yFe+VguniKPbNf6mbU/ubn9ieUZ6hWJAhIOKbo2Pih58C3l1a5OJiJuflYZidpgHSZCOnZGXc6l3oBWrE2aQnLWYpKq2pbV4h4OIq1eldrigt8i7d73Ns3HLjMKGycHC1L+hxsXXydO9wqOu3brPnLXL3C640sK+6cTaxNflEAACH5BAkKAAAALAAAAACAAA8AAALVnD+ggLfc0opS0SeyFnjn7oGbqJHf4mXXFD2r1bKNyaEpjduhPvLaC5nJEK4YTKhI1ZI334m5g/akJacAiDUGiUOHNUd9ApTgcTN81WaRW++Riy6Tv/S4dQ1vG4ps4NwOaBYlOEVYhYbnplexyJf3ZygGOXkWuWSZuNel+aboV0k5GFo4+qN22of6CMoq2kr6apo6m5fJWCoZm+vKu2Hr6KmqiHtJLKebRhuszNlYZ3ncewh9J9z8u3mLHA0rvetrzYjd2Wz8bB6oNO5MLq6FTp2+bVUAACH5BAkKAAAALAAAAACAAA8AAALanD+ggLfc0opS0XeX2Fy8zn2gp40ieHaZFWHt9LKNO5eo3aUhvisj6RutIDUZgnaEFYnJ4M2Z4210UykQ8BtqY0yHstk1UK+/sdk63i7VYLYX2sOa0HR41S5wi7/vcMWP1FdWJ/dUGIWXxqX3xxi4l0g4GEl5yOHIBwmY2cg1aXkHSjZXmbV4uoba5kkqelbaapo6u0rbN/SZG7trKFv7e6savKTby4voaoVpNAysiXscV4w8fSn8fN1pq1kd2j1qDLK8yYy9/ff9mgwrnv2o7QwvGO1ND049UgAAIfkECQoAAAAsAAAAAIAADwAAAticP6CAt9zSilLRd2d8onvBfV0okp/pZdamNRi7ui3yyoo4Ljio42h+w6kgNiJt5kAaasdYE7D78YKlXpX6GWphxqTT210qK1Cf9XT2SKXbYvv5Bg+jaWD5ekdjU9y4+PsXRuZHRrdnZ5inVidAyCTXF+nGlVhpdjil2OE49hjICVh4qZlpibcDKug5KAlHOWqqR8rWCjl564oLFruIucaYGlz7+XoKe2wsIqxLzMxaxIuILIs6/JyLbZsdGF063Uu6vH2tXc79LZ1MLWS96t4JH/rryzhPWgAAIfkECQoAAAAsAAAAAIAADwAAAtWcP6CAt9zSilLRd2fEe4kPCk8IjqTonZnVsQ33arGLwLV8Kyeqnyb5C60gM2LO6MAlaUukwdbcBUspYFXYcla00KfSywRzv1vpldqzprHFoTv7bsOz5jUaUMer5vL+Mf7Hd5RH6HP2AdiUKLa41Tj1Acmjp0bJFuinKKiZyUhnaBd5OLnzSNbluOnZWQZqeVdIYhqWyop6ezoquTs6O0aLC5wrHErqGnvJibms3LzKLIYMe7xnO/yL7TskLVosqa1aCy3u3FrJbSwbHpy9fr1NfR4fUgAAIfkECQoAAAAsAAAAAIAADwAAAsqcP6CAt9zSilLRd2fEW7cnhKIAjmFpZla3fh7CuS38OrUR04p5Ljzp46kgMqLOaJslkbhbhfkc/lAjqmiIZUFzy2zRe5wGTdYQuKs9N5XrrZPbFu94ZYE6ms5/9cd7/T824vdGyIa3h9inJQfA+DNoCHeomIhWGUcXKFIH6RZZ6Bna6Zg5l8JnSamayto2WtoI+4jqSjvZelt7+URKpmlmKykM2vnqa1r1axdMzPz5LLooO326Owxd7Bzam4x8pZ1t3Szu3VMOdF4AACH5BAkKAAAALAAAAACAAA8AAAK/nD+ggLfc0opS0XdnxFs3/i3CSApPSWZWt4YtAsKe/DqzXRsxDqDj6VNBXENakSdMso66WzNX6fmAKCXRasQil9onM+oziYLc8tWcRW/PbGOYWupG5Tsv3TlXe9/jqj7ftpYWaPdXBzbVF2eId+jYCAn1KKlIApfCSKn5NckZ6bnJpxB2t1kKinoqJCrlRwg4GCs4W/jayUqamaqryruES2b72StsqgvsKlurDEvbvOx8mzgazNxJbD18PN1aUgAAIfkECQoAAAAsAAAAAIAADwAAArKcP6CAt9zSilLRd2fEWzf+ecgjlKaQWZ0asqPowAb4urE9yxXUAqeZ4tWEN2IOtwsqV8YkM/grLXvTYbV4PTZpWGYU9QxTxVZyd4wu975ZZ/qsjsPn2jYpatdx62b+2y8HWMTW5xZoSIcouKjYePeTh7TnqFcpabmFSfhHeemZ+RkJOrp5OHmKKapa+Hiyyokaypo6q1CaGDv6akoLu3DLmLuL28v7CdypW6vsK9vsE1UAACH5BAkKAAAALAAAAACAAA8AAAKjnD+ggLfc0opS0XdnxFs3/nkISI2icxokanVt+JoxC8G1fNOlm6tp1QNmZj6ikDcMrorBpBMJtT2lUdzUusNSt9qurvrlhr275VHMvI7XaXAbXTLLf3NjXUnP23/qN/n8d9cHyEZYpoe3p5jIOCjoFofoKAn5CGeZZaiJWcjp10mZuRkaSAq6OGmU2lhp+vk6iioay3rpSrs6mNsqa9tb+ntQAAA7AAAAAAAAAAAA\">");
        document.body.appendChild(loading);
      });
    }
    callIos('startspinner');
}

function doneLoading() {
    var loading = document.getElementById('loading');
    if (loading) loading.parentNode.removeChild(loading);
    // TODO update header?
    callIos('stopspinner');
    if (window.doneLoadingCallback) {
      var callback = doneLoadingCallback;
      delete window.doneLoadingCallback;
      // long delay to ensure the spinner is fully stopped before continuing
      setTimeout(callback, 10);
    }
}

function setClass(element, classString) {
  element.setAttribute("class", classString);
  element.setAttribute("className", classString);
}

function printFooter() {
  // var footer = document.getElementById('footer');
  // We could put anything we want in the footer here, but perhaps we should avoid it.
  var statsButton = document.getElementById("statsButton");
  if (statsButton) {
    if (window.stats && stats.scene && stats.scene.secondaryMode == "stats") {
      statsButton.innerHTML = "Return to the Game";
      statsButton.setAttribute("data-return", "true");
    } else {
      statsButton.innerHTML = "Show Stats";
      if (window.isAndroidApp && window.statsMode.get()) {
        showStats();
      }
    }
  }
  curl();
}

// retrieve value of HTML form
function getFormValue(name) {
    var field = document.forms[0][name];
    if (!field) return "";
    // may return either one field or an array of fields
    if (field.checked) return field.value;
    for (var i = 0; i < field.length; i++) {
        var element = field[i];
        if (element.checked) return element.value;
    }
    return null;
}

function printCheckboxes(options, submitButtonNameFunction, callback) {
  var form = document.createElement("form");
  main.appendChild(form);
  var self = this;
  form.action = "#";
  form.onclick = function () {
    var count = 0;
    var checkboxes = optionsDiv.querySelectorAll('input[type=checkbox]');
    for (var i = 0; i < options.length; i++) {
      if (checkboxes[i].checked) count++;
    }
    var button = form.querySelector('input[type=submit]');
    button.value = button.name = submitButtonNameFunction(count);
  }
  form.onsubmit = function () {
    var results = [];
    var checkboxes = optionsDiv.querySelectorAll('input[type=checkbox]');
    for (var i = 0; i < options.length; i++) {
      results[i] = checkboxes[i].checked;
    }
    callback(results);
    return false;
  };
  var checked = false;
  var massSelections = document.createElement("div");
  var selectAll = document.createElement("button");
  selectAll.setAttribute("type", "button");
  massSelections.appendChild(selectAll);
  selectAll.innerHTML = "Select All";
  selectAll.addEventListener("click", function() {
    var checkboxes = optionsDiv.querySelectorAll('input[type=checkbox]');
    for (var i = 0; i < checkboxes.length; i++) {
      checkboxes[i].checked = true;
    }
  });
  massSelections.appendChild(document.createTextNode(' '));
  var selectNone = document.createElement("button");
  selectNone.setAttribute("type", "button");
  massSelections.appendChild(selectNone);
  selectNone.innerHTML = "Select None";
  selectNone.addEventListener("click", function () {
    var checkboxes = optionsDiv.querySelectorAll('input[type=checkbox]');
    for (var i = 0; i < checkboxes.length; i++) {
      checkboxes[i].checked = false;
    }
  });
  form.appendChild(massSelections);
  var optionsDiv = document.createElement("div");
  form.appendChild(optionsDiv);
  setClass(optionsDiv, "choice");
  for (var i = 0; i < options.length; i++) {
    var option = options[i];
    var isLast = (i == options.length - 1);
    printOptionButton(optionsDiv, "checkbox", null, option, i, i, isLast, checked);
  }
  printButton(submitButtonNameFunction(checked ? options.length : 0), form, true);
}

function printOptions(groups, options, callback) {
  var form = document.createElement("form");
  main.appendChild(form);
  var self = this;
  form.action="#";
  form.onsubmit = function() {
      safeCall(self, function() {
        var currentOptions = options;
        var option, group;
        for (var i = 0; i < groups.length; i++) {
            if (i > 0) {
                currentOptions = option.suboptions;
            }
            group = groups[i];
            if (!group) group = "choice";
            var value = getFormValue(group);
            if (value === null || value === undefined) {
              if (groups.length == 1) {
                asyncAlert("Please choose one of the available options first.");
              } else {
                var article = "a";
                if (/^[aeiou].*/i.test(group)) article = "an";
                asyncAlert("Please choose " + article + " " + group + " first.");
              }
              return;
            }
            option = currentOptions[value];
        }

        if (groups.length > 1 && option.unselectable) {
          asyncAlert("Sorry, that combination of choices is not allowed. Please select a different " + groups[groups.length-1] + ".");
          return;
        }
        safeCall(null, function() {callback(option);});
      });
      return false;
  };

  if (!options) throw new Error("undefined options");
  if (!options.length) throw new Error("no options");
  // global num will be used to assign accessKeys to the options
  var globalNum = 1;
  var currentOptions = options;
  for (var groupNum = 0; groupNum < groups.length; groupNum++) {
      var group = groups[groupNum];
      if (group) {
          var textBuilder = ["Select "];
          textBuilder.push(/^[aeiou]/i.test(group)?"an ":"a ");
          textBuilder.push(group);
          textBuilder.push(":");

          var p = document.createElement("p");
          p.appendChild(document.createTextNode(textBuilder.join("")));
          form.appendChild(p);
      }
      var div = document.createElement("div");
      form.appendChild(div);
      setClass(div, "choice");
      var checked = null;
      for (var optionNum = 0; optionNum < currentOptions.length; optionNum++) {
          var option = currentOptions[optionNum];
          if (!checked && !option.unselectable) checked = option;
          var isLast = (optionNum == currentOptions.length - 1);
          printOptionButton(div, "radio", group, option, optionNum, globalNum++, isLast, checked == option);
      }
      // for rendering, the first options' suboptions should be as good as any other
      currentOptions = currentOptions[0].suboptions;
  }

  var touchStartHandler = function (e) {
    if (e.touches.length > 1) return;
    var target = e.target;
    var rect = target.getBoundingClientRect();
    var shuttle;
    var shuttleWidth = rect.width * 0.2;
    //console.log(rect);
    var lastMouse = e.touches[0];
    var draw = function () {
      var transformX = rect.width + rect.left - lastMouse.clientX - (shuttleWidth/2);
      if (transformX < 0) transformX = 0;
      var maxX = rect.width - shuttleWidth - 2;
      if (transformX > maxX) transformX = maxX;
      if (target.parentElement) {
        if (transformX >= maxX * 0.8) {
          target.parentElement.classList.add('selected');
        } else {
          target.parentElement.classList.remove('selected');
        }
      }
      if (shuttle) {
        shuttle.style.transform = "translateX(-" + transformX + "px)"
        shuttle.style.webkitTransform = "translateX(-" + transformX + "px)"
      }
    };
    var outsideTimeout = null;
    var moveTracker = function(e) {
      e.preventDefault();
      lastMouse = e.touches[0];
      // on iPad app, touchend doesn't fire outside webview (touchmove does)
      // so, fire a fake touchend 300 ms after touchmove outside webview
      if (window.isIosApp && window.isIPad) {
        if (outsideTimeout) {
          clearTimeout(outsideTimeout);
          outsideTimeout = null;
        }
        if (lastMouse.pageY < 0 || lastMouse.pageX < 0) {
          outsideTimeout = setTimeout(function() {
            document.body.dispatchEvent(new Event('touchend'));
          }, 300);
        }
      }
      window.requestAnimationFrame(draw);
    }
    if ((e.touches[0].clientX - rect.left) > rect.width - shuttleWidth) {
      shuttle = document.createElement("div");
      shuttle.classList.add("shuttle");
      target.appendChild(shuttle);
      shuttle.style.width = shuttleWidth + "px";
      document.body.addEventListener('touchmove', moveTracker, {passive: false});
      var touchEnd = function(e) {
        document.body.removeEventListener('touchmove', moveTracker, {passive: false});
        document.body.removeEventListener('touchend', touchEnd);
        if (target.parentElement && target.parentElement.classList.contains('selected')) {
          if (target.click) {
            target.click();
          } else {
            var event = document.createEvent('Events');
            event.initEvent("click", true, true);
            target.dispatchEvent(event);
          }
          if (window.isIosApp) {
            window.freezeCallback = function() {
              window.freezeCallback = null;
              form.onsubmit();
            };
            callIos("freeze");
          } else {
            safeCall(null, function() {form.onsubmit();});
          }
        } else {
          if (shuttle.style.opacity !== "0") {
            shuttle.style.opacity = 0;
            var removeShuttle = function(e) {
              if (shuttle.parentElement) shuttle.parentElement.removeChild(shuttle);
            };
            shuttle.addEventListener('transitionend', removeShuttle);
            shuttle.addEventListener('webkitTransitionEnd', removeShuttle);
          } else {
            if (shuttle.parentElement) shuttle.parentElement.removeChild(shuttle);
          }
        }
      };
      document.body.addEventListener('touchend', touchEnd);
    }
    //console.log(e);
  };

  var slidingEnabled = true;
  if (window.slidingEnabled === false || groups.length > 1) slidingEnabled = false;

  if (slidingEnabled) [].forEach.call(document.querySelectorAll('.choice > div'), function(label) {
    label.addEventListener('touchstart', touchStartHandler);
    if (window.isMobile) label.addEventListener('click', function(e) {
      var target = e.currentTarget;
      if (document.body.querySelector(".shuttle.discovery")) return;
      var shuttle = document.createElement("div");
      shuttle.classList.add("shuttle");
      shuttle.classList.add("discovery");
      target.appendChild(shuttle);
      var animationEnd = function(e) {
        if (e.animationName === 'shuttlefadeout') {
          if (shuttle.parentElement) shuttle.parentElement.removeChild(shuttle);
        }
      };
      shuttle.addEventListener('animationend', animationEnd);
      shuttle.addEventListener('webkitAnimationEnd', animationEnd);
    })
  });

  var useRealForm = false;
  if (useRealForm) {
    printButton("Next", form, false);
  } else {
    printButton("Next", main, false, function() {
      form.onsubmit();
    });
  }
}

function printOptionButton(div, type, name, option, localChoiceNumber, globalChoiceNumber, isLast, checked) {
    var line = option.name;
    var unselectable = false;
    if (!name) unselectable = option.unselectable;
    var disabledString = unselectable ? " disabled" : "";
    var id = name + localChoiceNumber + "-" + Math.random().toString(36).substring(2);
    if (!name) name = "choice";
    var radio;
    var div2 = document.createElement("div");
    var label = document.createElement("label");
    // IE doesn't allow you to dynamically specify the name of radio buttons
    if (!/^\w+$/.test(name)) throw new Error("invalid choice group name: " + name);
    label.innerHTML = "<input type='"+type+"' name='"+name+
            "' value='"+localChoiceNumber+"' id='"+id+
            "' "+(checked?"checked":"")+disabledString+">";

    label.setAttribute("for", id);
    if (localChoiceNumber === 0) {
      if (isLast) {
        setClass(label, "onlyChild"+disabledString);
      } else {
        setClass(label, "firstChild"+disabledString);
      }
    } else if (isLast) {
      setClass(label, "lastChild"+disabledString);
    } else if (unselectable) {
      setClass(label, "disabled");
    }
    label.setAttribute("accesskey", globalChoiceNumber);
    if (!unselectable) {
      if (type === "radio" && window.Touch) { // Make labels clickable on iPhone
          label.onclick = function labelClick(evt) {
              try {
                var target = evt.target;
                if (!/label/i.test(target.tagName)) return;
                var button = document.getElementById(target.getAttribute("for"));
                button.checked = true;
              } catch (e) {}
          };
      } else if (/MSIE 6/.test(navigator.userAgent)) {
        label.onclick = function labelClick() {
          try {
            var target = window.event.srcElement;
            if (!/label/i.test(target.tagName)) return;
            var button = document.getElementById(target.getAttribute("for"));
            button.checked = true;
          } catch (e) {}
        };
      }
    }
    printx(line, label);
    
    div2.appendChild(label);
    div.appendChild(div2);
}

function printImage(source, alignment, alt, invert) {
  var img = document.createElement("img");
  if (typeof hashes != 'undefined' && hashes[source]) {
    source += "?hash=" + hashes[source];
  }
  img.src = source;
  if (alt !== null && String(alt).length > 0) img.setAttribute("alt", alt);
  var zoomFactor = getZoomFactor();
  if (zoomFactor !== 1) {
    var size = (zoomFactor * 100) + '%';
    img.style.height = size;
    img.style.width = size;
  }
  if (invert) {
    setClass(img, "invert align"+alignment);
  } else {
    setClass(img, "align"+alignment);
  }
  document.getElementById("text").appendChild(img);
}

function playSound(source) {
  for (var existingAudios = document.getElementsByTagName("audio"); existingAudios.length;) {
    existingAudios[0].parentNode.removeChild(existingAudios[0]);
  }
  if (typeof hashes != 'undefined' && hashes[source]) {
    source += "?hash=" + hashes[source];
  }
  var audio = document.createElement("audio");
  if (audio.play) {
    audio.setAttribute("src", source);
    document.body.appendChild(audio);
    audio.play();
  }
}

function printYoutubeFrame(slug) {
  var wrapper = document.createElement("div");
  setClass(wrapper, "videoWrapper");
  var iframe = document.createElement("iframe");
  iframe.width="560";
  iframe.height="315";
  iframe.src="https://www.youtube.com/embed/"+slug;
  iframe.setAttribute("frameborder", 0);
  iframe.setAttribute("allowfullscreen", true);
  wrapper.appendChild(iframe);
  document.getElementById("text").appendChild(wrapper);
}

function moreGames() {
    if (window.isIosApp) {
      window.location.href = "https://choiceofgames.app.link/jBm199qZXL/";
    } else if (window.isAndroidApp) {
      if (window.isNookAndroidApp) {
        asyncAlert("Please search the Nook App Store for \"Choice of Games\" for more games like this!");
        return;
      }
      if (window.isAmazonAndroidApp) {
        window.location.href = "https://www.amazon.com/gp/mas/dl/android?p=com.choiceofgames.omnibus&t=choofgam-20&ref=moreGames";
      } else {
        window.location.href = "https://play.google.com/store/apps/details?id=com.choiceofgames.omnibus&referrer=utm_medium%3Dweb%26utm_source%3Dmoregames";
      }
    } else if (window.isSteamApp) {
      window.location.href = "https://store.steampowered.com/curator/7026798-Choice-of-Games/";
    } else {
      try {
        if (window.isChromeApp) {
          window.open("https://www.choiceofgames.com/category/our-games/");
        } else if (window.isHeartsChoice) {
          window.location.href = "https://www.heartschoice.com/shop/";
        } else {
          window.location.href = "https://www.choiceofgames.com/category/our-games/";
        }
      } catch (e) {
        // in xulrunner, this will be blocked, but it will trigger opening the external browser
      }
    }
}

function printShareLinks(target, now) {
  if (!target) target = document.getElementById('text');
  var msgDiv = document.createElement("div");
  if (window.isIosApp) {
    if (now) {
      callIos("share");
      return;
    }
    var button = document.createElement("button");
    button.appendChild(document.createTextNode("Share This Game"));
    button.onclick = function() {
      callIos("share");
    };
    msgDiv.appendChild(button);
    target.appendChild(msgDiv);
    return;
  }

  var mobileMesg = "";
  if (window.isAndroidApp) {
    var androidLink = document.getElementById('androidLink');
    var androidUrl;
    if (window.isNookAndroidApp) {
      if (window.nookEan && nookEan != "UNKNOWN") {
        mobileMesg = "  <li><a href='choiceofgamesnook://"+window.nookEan+"'>Rate this app</a> in the Nook App Store</li>\n";
      }
    } else if (androidLink) {
      androidUrl = getAndroidReviewLink();
      if (androidUrl) {
        mobileMesg = "  <li><a href='"+androidUrl+"'>Rate this app</a> in the Google Play Store</li>\n";
      }
    }
  } else if (/webOS/.test(navigator.userAgent) && window.isFile) {
    var palmLink = document.getElementById('palmLink');
    var palmUrl;
    if (palmLink) {
      palmUrl = palmLink.href;
      if (palmUrl) {
        mobileMesg = "  <li><a href='"+palmUrl+"'>Rate this app</a> in the Palm App Catalog</li>\n";
      }
    }
  } else if (window.isChromeApp) {
    var chromeLink = document.getElementById('chromeLink');
    var chromeUrl;
    if (chromeLink) {
      chromeUrl = chromeLink.href;
      if (chromeUrl) {
        mobileMesg = "  <li><a href='"+chromeUrl+"/reviews'>Rate this app</a> in the Chrome Web Store</li>\n";
      }
    }
  }

  var url = window.location.href;
  var links = document.getElementsByTagName("link");
  for (var i = links.length - 1; i >= 0; i--) {
    if (links[i].getAttribute("rel") == "canonical") {
      url = links[i].getAttribute("href") || url;
      break;
    }
  }

  if (/^\//.test(url)) {
    if (window.isWeb) {
      url = window.location.protocol + "//" + window.location.hostname + url;
    } else {
      url = "https://www.choiceofgames.com" + url;
    }
  }

  url = encodeURIComponent(url);
  var title = encodeURIComponent(document.title);
  var dataUriSupported = !/MSIE [67]/.test(navigator.userAgent);

  var twitterHandle = window.isHeartsChoice ? "heartschoice" : "choiceofgames";

  var shareLinkText =
        '<li>'+(dataUriSupported?'<img height="16" width="16" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsklEQVQ4EWNgoBAwgvQnVq75f+vBG5KMUlMQYZjfHsLIBNJFqmZkPSzEWKsqL8zQXebJICLIDVZuEzUTrg3sAjgPBwNZM7oSolyAzWaYQUS5AKYYG43XBUeWpaPogfGRwwCvAW/efwUbAPMCjI9sKl4DArKXgNXCbIbxkQ2gOAwoNgDsBS5ONgYNJTFkl2FlG2nLwMVv3HsFZlPHBTLifAznrj6Bm47OQI42mBwoM1EFAAAnVCliRFKHdQAAAABJRU5ErkJggg==">':"")+
        ' <a href="http://www.facebook.com/sharer.php?u='+url+'&amp;t='+title+'"'+
        'onclick="if (window.isFile || window.isXul) return true; '+
        'window.open(&quot;http://www.facebook.com/sharer.php?u='+url+'&amp;t='+title+
        '&quot;,&quot;sharer&quot;,&quot;toolbar=0,status=0,width=626,height=436&quot;);return false;" class="spacedLink">Facebook</a></li>'+

        '<li>'+(dataUriSupported?'<img height="16" width="16" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/ElEQVQ4EYVTO24UQRB9/dmZkdfCIK0QBhMACQdwgDgMN4AEiYALcAFy7kNABkYkGzhAWMa2DHg9n+7iVfXMaAmAknp7tuvVq1dV3Q6j9SlJlzLEOXgIPPcmRjf5/7ZHdWQRaVPCOjucDYJlcHi8AFLOErz/J4kRQASXGfjYDmhIeDwAKx9xBzz8jxUCgjqSfE8CPWi5EpeTjOu+F36CVcGxrEBBMVDiaDOB5vqVBQu6WAU+dQmnwZuGwkACstxlRDckqWIhMQLPOtfXvfw0AmfA95thqwBNWGg04PktLbTYrEAlXxJTEciemtd+KdvZf7ESTjipEyaazAgyu/2lTTjP2ZpICZZQYSp7gg8kelh5PFj4Kd56ZvhE2IUSMOMVm/niZoPDOqJl0FSAYlYhoNoabSmBiI5pVNouv39w32G3l05wIwaqKRq00XErWGWYFvXz3uAbA4+51lyf+wy9h0JVRqAgfmehc8vmJt7n/CrKP6J81fzqfIPTVOOAo+S9soko+GkzhxgNocUkDfLmosPrsyvwtpTDP5KRWBz2Of4PB3vYr8o9mNuZncfLvRrPdmveJJVNDn0G8yKUMV/pO+p16MVmAn00yvnu9g7erpZ4xAbUrFtXMy42AE9YwmHNxo42lzAd6AtMQ48NgjVVOz+BVNQ9Zql4UI9P/TehBOJIi+EJIAAAAABJRU5ErkJggg==">':"")+
        ' <a href="https://twitter.com/intent/tweet?related='+twitterHandle+'&amp;text='+title+'&amp;url='+url+'&amp;via='+twitterHandle+'" class="spacedLink">Twitter</a></li>';

  var nowMsg = "";
  if (now) nowMsg = "<p>Please support our work by sharing this game with friends!  The more people play, the more resources we'll have to work on the next game.</p>";
  msgDiv.innerHTML = nowMsg + "<ul id='sharelist'>\n"+
    mobileMesg+
    shareLinkText+
    "</ul>\n";
  target.appendChild(msgDiv);
}

function isShareConfigured() {
  return !!document.getElementById("share");
}

function shareAction(e) {
  clearScreen(function() {
    var target = document.getElementById('text');
    printShareLinks(target, "now");
    printButton("Next", target, false, function () {
      clearScreen(loadAndRestoreGame);
    });
    curl();
  });
}

function isReviewSupported() {
  return !!(window.isIosApp || window.isAndroidApp);
}

function prepareReviewPrompt() {
  if (window.isAndroidApp && window.reviewManagerBridge) {
    window.reviewManagerBridge.requestReviewFlow();
  }
}

function promptForReview() {
  var store;
  target = document.getElementById('text');
  function printMessage(store) {
    println("Great! Please post a review of this game on "+store+". It really helps.[n/]", target);
  }
  var anchorText = "Review This Game";
  var href;
  if (window.isSteamApp) {
    printMessage("Steam");
    printLink(target, "#", anchorText, function(e) {
      preventDefault(e);
      try {
        purchase("adfree", function() {});
      } catch (x) {}
      return false;
    });
    return true;
  } else if (window.isIosApp) {
    println("Great! Please post a review of this version of the game on the App Store. It really helps.[n/]", target);
    printLink(target, "#", anchorText, function(e) {
      preventDefault(e);
      try {
        callIos("reviewapp");
      } catch (x) {}
      return false;
    });
    return true;
  } else if (window.isAndroidApp) {
    if (window.reviewManagerBridge) {
      window.reviewManagerBridge.launchReviewFlow();
      return false;
    }
    href = getAndroidReviewLink();
    if (window.isAmazonAndroidApp) {
      printMessage("Amazon's Appstore");
    } else {
      printMessage("the Google Play Store");
    }
    return true;
  } else if (window.isChromeApp) {
    href = document.getElementById('chromeLink').href;
  }
  
  printLink(target, href, anchorText);
  return true;
}

function getAndroidReviewLink() {
  var href = document.getElementById('androidLink').href;
  var package = /id=([\.\w]+)/.exec(href)[1];
  // TODO legacy hosted
  if (window.isOmnibusApp) {
    var omnibus;
    if (/^org\.hostedgames/.test(package)) {
      omnibus = "org.hostedgames.omnibus";
    } else if (/^com\.heartschoice/.test(package)) {
      omnibus = "com.heartschoice.o";
    } else {
      omnibus = "com.choiceofgames.omnibus";
    }
    if (window.isAmazonAndroidApp) {
      return "http://www.amazon.com/gp/mas/dl/android?p="+omnibus+"&t=choofgam-20&ref=rate"
    } else {
      return "https://play.google.com/store/apps/details?id="+omnibus+"&referrer=utm_medium%3Dweb%26utm_source%3D"+window.storeName+"Game";
    }
  } else if (window.isAmazonAndroidApp) {
    return "http://www.amazon.com/gp/mas/dl/android?p="+package+"&t=choofgam-20&ref=rate";
  } else {
    return href;
  }
}

function isFollowEnabled() {
  return false;
  if (!window.isWeb) return false;
  // iOS add to homescreen seems not to like these iframes
  if (window.navigator.standalone) return false;
  if ("localhost" != window.location.hostname && !/\.?choiceofgames\.com$/.test(window.location.hostname)) return false;
  return true;
}

function printFollowButtons() {
  if (!isFollowEnabled()) return;
  // Just FB Like, for now
  var target = document.getElementById('text');
  var iframe = document.createElement('iframe');
  var width = 300;
  var height = 66;
  iframe.setAttribute("src", "//www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Fchoiceofgames"+
    "&amp;send=false&amp;layout=standard&amp;width="+width+"&amp;show_faces=true&amp;font&amp;colorscheme=light&amp;"+
    "action=like&amp;height="+height+"&amp;appId=190439350983878");
  iframe.setAttribute("scrolling", "no");
  iframe.setAttribute("frameborder", "0");
  iframe.setAttribute("style", "border:none; overflow:hidden; width:"+width+"px; height:"+height+"px;");
  iframe.setAttribute("allowTransparency", "true");
  target.appendChild(iframe);
}

function subscribeLink(e) {
  clearScreen(function() {
    subscribe(document.getElementById('text'), {now:1}, function() {
      clearScreen(loadAndRestoreGame);
    });
    curl();
  });
}

function subscribeByMail(target, options, callback, code) {
  if (options.now) {
    code();
    if (options.allowContinue) safeTimeout(function() {callback("now");}, 0);
  } else {
    println("Click here to subscribe to our mailing list; " + options.message);
    println("");
    printButton("Subscribe", target, false, function() {
        code();
      });
    if (options.allowContinue) {
      printButton("No, Thanks", target, false, function() {
        safeTimeout(function() {callback();}, 0);
      });
    }
    // why is this timeout necessary?
    safeTimeout(function() {printFooter();}, 0);
  }
}

function subscribe(target, options, callback) {
  if (!options.message) options.message = "we'll notify you when our next game is ready!";
  if (typeof options.allowContinue === "undefined") options.allowContinue = 1;
  if (!target) target = document.getElementById('text');
  if (window.isIosApp) {
    subscribeByMail(target, options, callback, function() {
      callIos("subscribe");
    });
    return;
  }
  var mailToSupported = isMobile && !window.isMacApp;
  if (window.isAndroidApp) mailToSupported = urlSupport.isSupported("mailto:support@choiceofgames.com");
  var domain = window.isHeartsChoice ? "heartschoice.com" : "choiceofgames.com";
  if (mailToSupported) {
    subscribeByMail(target, options, callback, function() {
      window.location.href = "mailto:subscribe-"+window.storeName+"-"+platformCode() + "@"+domain+"?subject=Sign me up&body=Please notify me when the next game is ready.";
    });
    return;
  }
  println("Type your email address below; " + options.message);
  println("");
  fetchEmail(function(defaultEmail) {
    promptEmailAddress(target, defaultEmail, options.allowContinue, function(cancel, email) {
      if (cancel) {
        return safeCall(null, callback);
      }
      var head= document.getElementsByTagName('head')[0];
      var script = document.createElement('script');
      script.type = 'text/javascript';
      var timestamp = new Date().getTime();
      var timeout = setTimeout(function() {
        window["jsonp"+timestamp]({
          result:"error", msg:"Couldn't connect. Please try again later."
        });
      }, 10000);
      window["jsonp"+timestamp] = function(response) {
        clearTimeout(timeout);
        if (response.result == "error") {
          var errElement = document.getElementById("errorMessage");
          if (errElement) errElement.innerHTML = response.msg;
        } else {
          clearScreen(function() {
            target = document.getElementById('text');
            println(response.msg, target);
            println("", target);
            if (options.allowContinue) {
              printButton("Next", target, false, function() {
                safeCall(null, callback);
              });
            }
            curl();
          });
        }
      };
      var listId = window.isHeartsChoice ? "fa4134344b" : "e9cdee1aaa";
      var mailParams = "u=eba910fddc9629b2810db6182&id="+listId+"&SIGNUP="+window.storeName+"-"+platformCode()+"&EMAIL="+encodeURIComponent(email);
      if (window.isChromeApp) {
        chrome.permissions.contains({origins: ["http://choiceofgames.us4.list-manage.com/"]},function(isXhrAllowed) {
          if (isXhrAllowed) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", 'http://choiceofgames.us4.list-manage.com/subscribe/post-json?'+mailParams, true);
            xhr.onreadystatechange = function() {
              if (xhr.readyState != 4) return;
              if (xhr.status == 200) {
                var response = JSON.parse(xhr.responseText);
                window["jsonp"+timestamp](response);
              } else if (xhr.status === 0) {
                window["jsonp"+timestamp]({result:"error", msg:"There was a network error submitting your registration. Please try again later, or email subscribe@choiceofgames.com instead."});
              } else {
                window["jsonp"+timestamp]({result:"error", msg:"Sorry, our mail server had an error. It's our fault. Please try again later, or email subscribe@choiceofgames.com instead."});
              }
            };
            xhr.send();
          } else {
            window.addEventListener('message', function(event) {
              if (window["jsonp"+timestamp]) {
                var jsonpt = window["jsonp"+timestamp];
                window["jsonp"+timestamp] = null;
                if (jsonpt) jsonpt(event.data);
              }
            });
            var iframe = document.createElement("IFRAME");
            iframe.setAttribute("src", "sandbox.html");
            iframe.setAttribute("name", "sandbox");
            iframe.onload = function() {
              iframe.contentWindow.postMessage({email:email, game:window.storeName, platform:platformCode()}, "*");
            };
            document.documentElement.appendChild(iframe);
            return;
          }
        });
      } else {
        if (isWinStoreApp || window.location.protocol == "https:") {
          var xhr = findXhr();
          xhr.open("GET", 'https://www.choiceofgames.com/mailchimp_proxy.php/subscribe/post-json?'+mailParams, true);
          var done = false;
          xhr.onreadystatechange = function() {
            if (done) return;
            if (xhr.readyState != 4) return;
            done = true;
            if (xhr.status == 200) {
              var response = JSON.parse(xhr.responseText);
              window["jsonp"+timestamp](response);
            } else if (xhr.status === 0) {
                window["jsonp"+timestamp]({result:"error", msg:"There was a network error submitting your registration. Please try again later, or email subscribe@choiceofgames.com instead."});
            } else {
              window["jsonp"+timestamp]({result:"error", msg:"Sorry, our mail server had an error. It's our fault. Please try again later, or email subscribe@choiceofgames.com instead."});
            }
          };
          xhr.send();
        } else {
          script.src = 'https://choiceofgames.us4.list-manage.com/subscribe/post-json?'+mailParams+'&c=jsonp' + timestamp;
          head.appendChild(script);
        }
      }
    });
  });
}

function downloadLink(e) {
  if (e && e.preventDefault) e.preventDefault();
  if (isPrerelease()) {
    return asyncAlert("You'll need to wait until after the game is released on " + window.releaseDate);
  }
  clearScreen(function() {
    var text = document.getElementById("text");
    if (window.knownPurchases && window.knownPurchases.adfree) {
      println("You can download the game using the links below.");
      println("");
      var files = {
        Windows: window.downloadName + " Setup " + window.downloadVersion + "-ia32.exe",
        Mac: window.downloadName + "-" + window.downloadVersion + ".dmg",
        Linux: window.downloadPackage + "-" + window.downloadVersion + "-ia32.deb"
      }
      var detectedOs;
      if (/Windows/.test(navigator.userAgent)) {
        detectedOs = "Windows";
      } else if (/Mac OS X/.test(navigator.userAgent)) {
        detectedOs = "Mac";
      } else if (/Linux/.test(navigator.userAgent)) {
        detectedOs = "Linux";
      }
      if (detectedOs) {
        printDownloadLink(detectedOs);
      }
      for (var os in files) {
        if (detectedOs != os) printDownloadLink(os);
      }
      function printDownloadLink(os) {
        var link = document.createElement("a");
        if (detectedOs == os) {
          setClass(link, "next linkButton");
        } else {
          link.style.display = "block";
        }
        link.innerHTML = "Download for " + os;
        link.href = "scenes/"+files[os];
        text.appendChild(link);
      }
      println("");
      printButton("Next", text, false, function() {
        safeCall(null, function() { clearScreen(loadAndRestoreGame); });
      });
    } else {
      println("To download this game for Windows, Mac, or Linux, you'll need to purchase it first.");
      println("");
      printOptions([""], [{name:"Purchase it now.", purchase:1}, {name:"No, thanks.", cancel:1}], function(option) {
        if (option.purchase) {
          purchase("adfree", downloadLink);
        } else {
          safeCall(null, function() { clearScreen(loadAndRestoreGame); });
        }
      });
    }
    curl();
  });
}

function cacheKnownPurchases(knownPurchases) {
  if (!knownPurchases) return;
  var output = {billingSupported:true};
  for (i = 0; i < knownPurchases.length; i++) {
    var parts = knownPurchases[i].split(/\./);
    if (parts[0] != window.storeName) continue;
    output[parts[1]] = true;
  }
  window.knownPurchases = output;
  fetchEmail(function(email) {
    if (email) window.store.set("knownPurchases"+email.replace(/[^A-z0-9]/g, "_"), JSON.stringify(window.knownPurchases));
  })
  if (window.isIosApp) {
    callIos("cachepurchases", knownPurchases);
  } else if (window.isAndroidApp) {
    if (window.isOmnibusApp) {
      androidBilling.cachePurchases(JSON.stringify(knownPurchases));
    }
    androidBilling.updateAdfree(!!output.adfree);
  }
}

// Callback expects a map from product ids to booleans
function checkPurchase(products, callback) {
  function publishPurchaseEvents(purchases) {
    if (purchases && window.purchaseSubscriptions) {
      for (var key in purchaseSubscriptions) {
        if (purchases[key]) purchaseSubscriptions[key].call();
      }
    }
  }

  function checkWebPurchases(callback) {
    isRegistered(function (registered) {
      if (!registered) return callback("ok", {billingSupported: true});
      if (window.knownPurchases) {
        safeTimeout(function() {
          callback("ok", window.knownPurchases);
          publishPurchaseEvents(knownPurchases);
        }, 0);
      } else {
        startLoading();
        xhrAuthRequest("GET", "get-purchases", function(ok, response) {
          doneLoading();
          if (ok) {
            cacheKnownPurchases(response);
            callback(ok, window.knownPurchases);
          } else {
            fetchEmail(function(email) {
              if (!email) return callback(ok, window.knownPurchases);
              window.store.get("knownPurchases"+email.replace(/[^A-z0-9]/g, "_"), function(ok, value) {
                if (ok) {
                  window.knownPurchases = JSON.parse(value);
                }
                callback(ok, window.knownPurchases);
                publishPurchaseEvents(window.knownPurchases);
              })
            });
          }
        });
      }
    });
  }

  function mergeKnownPurchases(purchases) {
    window.checkPurchaseCallback = null;
    checkWebPurchases(function(ok, knownPurchases) {
      if (knownPurchases) {
        var productList = products.split(/ /);
        for (i = 0; i < productList.length; i++) {
          if (knownPurchases[productList[i]]) purchases[productList[i]] = knownPurchases[productList[i]];
        }
      }
      callback("ok", purchases);
      publishPurchaseEvents(purchases);
    });
  }

  var i, oldCallback;
  if (window.isIosApp) {
    oldCallback = window.checkPurchaseCallback;
    window.checkPurchaseCallback = function (purchases) {
      if (oldCallback) oldCallback(purchases);
      mergeKnownPurchases(purchases);
    }
    if (!oldCallback) callIos("checkpurchase", products);
  } else if (window.isAndroidApp && !window.isNookAndroidApp) {
    oldCallback = window.checkPurchaseCallback;
    window.checkPurchaseCallback = function (purchases) {
      if (oldCallback) oldCallback(purchases);
      mergeKnownPurchases(purchases);
    }
    if (!oldCallback) androidBilling.checkPurchase(products);
  } else if (window.isWinOldApp) {
    safeTimeout(function() {
      var purchases = eval(window.external.CheckPurchase(products));
      callback("ok",purchases);
      publishPurchaseEvents(purchases);
    }, 0);
  } else if (window.isMacApp) {
    oldCallback = window.checkPurchaseCallback;
    window.checkPurchaseCallback = function (purchases) {
      if (oldCallback) oldCallback(purchases);
      window.checkPurchaseCallback = null;
      callback("ok",purchases);
      publishPurchaseEvents(purchases);
    }
    if (!oldCallback) callMac("checkpurchase", products);
  } else if (window.isCef) {
    cefQuery({
      request:"CheckPurchases " + products,
      onSuccess: function(response) {
        console.log("cp response " + response);
        var purchases = JSON.parse(response);
        callback("ok",purchases);
        publishPurchaseEvents(purchases);
      },
      onFailure: function(error_code, error_message) {
        console.error("CheckPurchases error: " + error_message);
        callback(!"ok");
      }
    });
  } else if (window.isSteamworks) {
    var steamworksApps = require('../package.json').products;
    var purchases = {};
    var productList = products.split(/ /);
    for (i = 0; i < productList.length; i++) {
      var appId = steamworksApps[productList[i]];
      var purchased = false;
      try {
        purchased = steamworks.apps.isSubscribedApp(appId);
      } catch (e) {
        // we pre-checked adfree on startup
        if (productList[i] === 'adfree') {
          purchased = !window.isTrial;
        } else {
          return safeTimeout(function () { callback(!"ok"); }, 0);
        }
      }
      purchases[productList[i]] = purchased;
    }
    purchases.billingSupported = true;
    publishPurchaseEvents(purchases);
    safeTimeout(function() {callback("ok", purchases);}, 0);
  } else if (window.beta === "beta") {
    var productList = products.split(/ /);
    var purchases = {};
    for (i = 0; i < productList.length; i++) {
      purchases[productList[i]] = true;
    }
    purchases.billingSupported = true;
    publishPurchaseEvents(purchases);
    safeTimeout(function () { callback("ok", purchases); }, 0);
  } else if (isWebPurchaseSupported()) {
    checkWebPurchases(function(ok, knownPurchases) {
      callback(ok, knownPurchases);
      publishPurchaseEvents(window.knownPurchases);
    });
  } else {
    var productList = products.split(/ /);
    var purchases = {};
    for (i = 0; i < productList.length; i++) {
      purchases[productList[i]] = !!window.isChromeApp;
    }
    purchases.billingSupported = false;
    publishPurchaseEvents(purchases);
    safeTimeout(function() {callback("ok", purchases);}, 0);
  }
}

function isWebPurchaseSupported() {
  var enableBilling = (typeof window.enableBilling === 'undefined' || window.enableBilling)
  return enableBilling && isWebSavePossible() && !!window.stripeKey;
}

function isRestorePurchasesSupported() {
  return !!window.isIosApp || !!window.isAndroidApp || isWebPurchaseSupported();
}

function restorePurchases(product, callback) {
  function webRestoreCallback() {
    var purchased = window.knownPurchases && window.knownPurchases[product];
    if (!purchased) {
      if (window.isAndroidApp) {
        return asyncAlert("Restore completed. This product is not yet purchased. "+
          "Sometimes purchases can fail to restore for reasons outside our control. "+
          "If you have already purchased this product, try uninstalling and reinstalling the app. "+
          "If that doesn't work, please email a copy of your receipt to " + getSupportEmail() + " "+
          "and we'll find a way to help you.", function() {
            callback(purchased);
          });
      } else {
        asyncAlert("Restore completed. This product is not yet purchased.");
      }
    } else {
      refreshIfAppUpdateReady();
      updateAllPaidSceneCaches();
    }
    callback(purchased);
  }
  function secondaryRestore(error) {
    window.restoreCallback = null;
    if (product) {
      checkPurchase(product, function(ok, purchases) {
        if (purchases[product]) {
          return callback("purchased");
        }

        if (window.isOmnibusApp && (window.purchaseTransfer || window.omnibusSupportsTransfer)) {
          var appId = getAppId();
          if (window.isAndroidApp || (window.isIosApp && (appId !== "1363309257" && appId !== "1302297731"))) {
            return omnibusRestore(appId);
          }
        }

        clearScreen(function() {
          isRegistered(function (registered) {
            if (registered) {
              startLoading();
              xhrAuthRequest("GET", "get-purchases", function(ok, response) {
                doneLoading();
                if (ok) {
                  cacheKnownPurchases(response);
                  webRestoreCallback();
                } else {
                  if (response.error === "not registered") {
                    logout();
                    secondaryRestore("error");
                  } else {
                    asyncAlert("There was an error restoring purchases. (Your network connection may be down.) Please try again later.");
                    callback();
                  }
                }
              });
            } else {
              var target = document.getElementById('text');
              if (error) {
                target.innerHTML="<p>Restore failed. Please try again later, or sign in to choiceofgames.com to restore purchases.</p>";
              } else {
                target.innerHTML="<p>Restore completed. This product is not yet purchased. You may also sign in to choiceofgames.com to restore purchases.</p>";
              }
              loginForm(document.getElementById('text'), /*optionality*/1, /*err*/null, webRestoreCallback);
              curl();
            }
          })
        });
      });
    } else {
      callback();
    }
  }
  function omnibusRestore(appId) {
    var omnibus = "Choice of Games";
    var canonical = document.querySelector("link[rel=canonical]");
    var canonicalHref = canonical && canonical.getAttribute("href");
    if (/\/user-contributed\//.test(canonicalHref)) {
      omnibus = "Hosted Games";
    }
    var appStore = window.isIosApp ? "App Store"
      : window.isAmazonAndroidApp ? "Amazon Appstore"
      : "Google Play Store";
    var gameTitle = document.getElementById("title").textContent;

    clearScreen(function() {
      printParagraph("Restore completed. "+appStore+" records indicate that "+
        "you have not purchased this product using the \""+omnibus+"\" app, "+
        "but you may have purchased the product in the \""+gameTitle+"\" app, "+
        "or on our website at choiceofgames.com.");

      options = [
        {name:"Restore purchases from choiceofgames.com.", group:"choice", webRestore:true},
        {name:"Restore purchases using the \""+gameTitle+"\" app.", group:"choice", transfer:true},
      ];

      printOptions([""], options, function(option) {
        if (option.webRestore) {
          clearScreen(function() {
            isRegistered(function (registered) {
              if (registered) {
                startLoading();
                xhrAuthRequest("GET", "get-purchases", function(ok, response) {
                  doneLoading();
                  if (ok) {
                    cacheKnownPurchases(response);
                    webRestoreCallback();
                  } else {
                    if (response.error === "not registered") {
                      logout();
                      printParagraph("Sign in to choiceofgames.com to restore purchases.");
                      loginForm(document.getElementById('text'), /*optionality*/1, /*err*/null, webRestoreCallback);
                    } else {
                      asyncAlert("There was an error restoring purchases. (Your network connection may be down.) Please try again later.");
                      callback();
                    }
                  }
                });
              } else {
                printParagraph("Sign in to choiceofgames.com to restore purchases.");
                loginForm(document.getElementById('text'), /*optionality*/1, /*err*/null, webRestoreCallback);
              }
            });
          });
        } else {
          var transferAttempted = false;
          var transferPurchaseCallback = function(result) {
            window.transferPurchaseCallback = null;
            clearScreen(function() {
              var transferPlatform = window.isIosApp ? "ios" : "android";

              if (result === "launch_failed") {
                if (!transferAttempted) {
                  transferAttempted = true;
                  printParagraph(
                    "The \""+gameTitle+"\" app is not installed on your current device. To transfer "+
                    "purchases from another app, you'll need to install the \""+gameTitle+"\" app and "+
                    "this \""+omnibus+"\" app at the same time."
                  );
                } else {
                  printParagraph(
                    "The \""+gameTitle+"\" app is not responding. Try uninstalling and reinstalling "+
                    "the \""+gameTitle+"\" app and trying again.");
                  printParagraph("Sometimes purchases can fail to "+
                    "restore for reasons outside our control. If you have already purchased "+
                    "this product, please email a copy of your receipt to "+
                    "[url=mailto:"+transferPlatform+"-transfer-"+storeName+"-missing@choiceofgames.com]"+transferPlatform+"-transfer-"+storeName+"-missing@choiceofgames.com[/url] and we'll find a way to help "+
                    "you."
                  );
                }

                var appLink = window.isIosApp ? "https://itunes.apple.com/app/id"+appId
                  : window.isAmazonAndroidApp ? "https://www.amazon.com/gp/mas/dl/android?p="+appId
                  : "https://play.google.com/store/apps/details?id="+appId;
                printParagraph("[url="+appLink+"]Download "+gameTitle+" from the "+appStore+"[/url]");

                printOptions([""], [
                  {name:"I've installed the \""+gameTitle+
                    "\" app. Try restoring purchases again.", group:"choice", retry:true},
                  {name:"Cancel.", group:"choice"},
                ], function (option) {
                  if (option.retry) {
                    window.transferPurchaseCallback = transferPurchaseCallback;
                    startLoading();
                    window.isIosApp ? callIos("transferpurchase") : purchaseTransfer.requestTransfer(appId);
                  } else {
                    callback(!"purchased");
                  }
                });
                curl();
              } else if (result === "done") {
                checkPurchase(product, function(ok, purchases) {
                  if (purchases[product]) {
                    callback("purchased");
                  } else {
                    printParagraph("Restore completed. "+appStore+" records indicate that you have not purchased "+
                    "this product in the \""+gameTitle+"\" app.");
                    printParagraph("Sometimes purchases can fail to restore for reasons outside our control. If you "+
                    "have already purchased this product, please email a copy of your receipt "+
                    "to [url=mailto:"+transferPlatform+"-transfer-"+storeName+"-failed@choiceofgames.com]"+transferPlatform+"-transfer-"+storeName+"-failed@choiceofgames.com[/url] and we'll find a "+
                    "way to help you.");
                    var target = document.getElementById('text');
                    printButton("Next", target, false, function() {
                      callback(!"purchased");
                    });
                    curl();
                  }
                });
              } else { // result === "error"
                printParagraph("Restore failed. Please try again later. If this error "+
                  "persists, please contact [url=mailto:"+transferPlatform+"-transfer-"+storeName+"-error@choiceofgames.com]"+transferPlatform+"-transfer-"+storeName+"-error@choiceofgames.com[/url] "+
                  "and we'll find a way to help you.")
                printOptions([""], [
                  {name:"Try again now.", group:"choice", retry:true},
                  {name:"Cancel.", group:"choice"},
                ], function(option) {
                  if (option.retry) {
                    window.transferPurchaseCallback = transferPurchaseCallback;
                    clearScreen(function() {
                      startLoading();
                      window.isIosApp ? callIos("transferpurchase") : purchaseTransfer.requestTransfer(appId);
                    });
                  } else {
                    callback(!"purchased");
                  }
                });
                curl();
              }
            });
          }
          if (window.isIosApp) {
            startLoading();
            window.transferPurchaseCallback = transferPurchaseCallback;
            callIos("transferpurchase");
          } else {
            isRegistered(function(registered) {
              if (registered) {
                window.transferPurchaseCallback = transferPurchaseCallback;
                clearScreen(function() {
                  startLoading();
                  purchaseTransfer.requestTransfer(appId);
                });
              } else {
                clearScreen(function() {
                  printParagraph("To restore purchases in the "+omnibus+" app using the "+gameTitle+" app, you'll first need to sign in using a choiceofgames.com account.");
                  loginForm(document.getElementById('text'), /*optionality*/1, /*err*/null, function(ok) {
                    if (ok) {
                      window.transferPurchaseCallback = transferPurchaseCallback;
                      clearScreen(function() {
                        startLoading();
                        purchaseTransfer.requestTransfer(appId);
                      });
                    } else {
                      webRestoreCallback();
                    }
                  });
                });
              }
            });
          }
        }
      });
      curl();
    });
  }

  if (window.isIosApp) {
    window.restoreCallback = secondaryRestore;
    callIos("restorepurchases");
  } else if (window.isAndroidApp) {
    window.restoreCallback = secondaryRestore;
    androidBilling.forceRestoreTransactions();
  } else if (isWebPurchaseSupported()) {
    isRegistered(function(registered) {
      if (registered) {
        startLoading();
        xhrAuthRequest("GET", "get-purchases", function(ok, response) {
          doneLoading();
          if (ok) {
            cacheKnownPurchases(response);
          } else {
            if (response.error != "not registered") {
              alertify.error("There was an error downloading your purchases from choiceofgames.com. "+
                "Please refresh this page to try again, or contact " + getSupportEmail() + " for assistance.", 15000);
            }
          }
          logout();
          restorePurchases(product, callback);
        });
      } else {
        clearScreen(function() {
          var target = document.getElementById('text');
          target.innerHTML="<p>Please sign in to choiceofgames.com to restore purchases.</p>";
          var steamRestore = false;
          var steamLink = document.getElementById('steamLink');
          if (steamLink && steamLink.href && !/INSERTINSERTINSERT/.test(steamLink.href)) {
            steamRestore = true;
          }
          if (steamRestore) {
            window.steamRestoreCallback = function(response) {
              window.steamRestoreCallback = null;
              if (response) cacheKnownPurchases(response);
              webRestoreCallback();
            }
          }
          loginForm(document.getElementById('text'), /*optional*/1, /*err*/null, webRestoreCallback);
          curl();
        });
      }
    });
  } else {
    safeTimeout(callback, 0);
  }
}
// Callback expects a localized string, or "", or "free", or "guess"
function getPrice(product, callback) {
  if (window.isIosApp) {
    checkForAppUpdates();
    window.priceCallback = callback;
    callIos("price", product);
  } else if (window.isAndroidApp) {
    window.priceCallback = callback;
    androidBilling.getPrice(product);
  } else if (window.isWeb) {
    checkForAppUpdates();
    if (window.productData && window.productData[product] && window.productData[product].amount) {
      safeTimeout(function () {
        callback.call(this, "$"+(productData[product].amount/100));
      }, 0);
    } else {
      safeTimeout(function() {
        if (window.productData && window.productData[product] && window.productData[product].amount) {
          callback.call(this, "$"+(productData[product].amount/100));
        } else {
          callback.call(this, "guess");
        }
      }, 500);
    }
  } else if (window.isSteamworks) {
    if (window.productData && window.productData[product]) {
      safeTimeout(function () {
        callback.call(this, productData[product]);
      }, 0);
    } else {
      window.awaitSteamProductData = function() {
        doneLoading();
        window.awaitSteamProductData = null;
        if (window.productData && window.productData[product]) {
          callback.call(this, productData[product]);
        } else {
          callback.call(this, "hide");
        }
      };
      startLoading();
      safeTimeout(function() {if (window.awaitSteamProductData) awaitSteamProductData();}, 5000);
    }
  } else {
    safeTimeout(function () {
      callback.call(this, "hide");
    }, 0);
  }
}
// Callback expects no args, but should only be called on success
function purchase(product, callback) {
  var purchaseCallback = function() {
    window.purchaseCallback = null;
    refreshIfAppUpdateReady();
    updateAllPaidSceneCaches();
    safeCall(null, callback);
    if (window.purchaseSubscriptions && purchaseSubscriptions[product]) {
      purchaseSubscriptions[product].call();
    }
  };
  if (window.isIosApp) {
    if (!window.purchaseRequiresLogin || window.registered) {
      window.purchaseCallback = purchaseCallback;
      return callIos("purchase", product);
    } else {
      clearScreen(function() {
        var target = document.getElementById('text');
        target.innerHTML="<p>Please sign in to choiceofgames.com to purchase.</p>";
        loginForm(target, /*optional*/1, /*err*/null, function(registered){
          if (registered) {
            if (window.knownPurchases && window.knownPurchases[product]) {
              purchaseCallback();
            } else {
              clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
              window.doneLoadingCallback = function() {
                window.purchaseCallback = purchaseCallback;
                callIos("purchase", product);
              }
            }
          } else {
            clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
          }
        });
        curl();
      });
    }
  } else if (window.isAndroidApp) {
    window.purchaseCallback = purchaseCallback;
    var androidStackTrace = androidBilling.purchase(product);
    if (androidStackTrace) throw new Error(androidStackTrace);
  } else if (window.isWinOldApp) {
    window.external.Purchase(product);
  } else if (window.isMacApp) {
    return callMac("purchase", product);
  } else if (window.isSteamworks) {
    var steamworksApps = require('../package.json').products;
    if (window.isSteamDeck) {
      var StoreFlagNone = 0;
      console.log('activating');
      steamworks.overlay.activateToStore(steamworksApps[product], StoreFlagNone);
      console.log('activated');
    } else {
      if (steamworksApps[product]) require("electron").shell.openExternal("steam://advertise/" + steamworksApps[product]);
    }
  } else if (window.isCef) {
    cefQuerySimple("Purchase " + product);
    // no callback; we'll refresh on purchase
  } else if (window.isWeb && !isPrerelease() && product == window.appPurchase) {
    var webStoreFallback = function() {
      window.appPurchase = null;
      purchase(product, callback);
    };
    var clickLink = function(id) {
      var link = document.getElementById(id);
      if (!link) return webStoreFallback();
      var href = link.getAttribute("href");
      if (!href) return webStoreFallback();
      window.location.href = href;
    };
    
    // instead of IAP, send Android users to a store
    if (/Silk/.test(navigator.userAgent)) {
      clickLink("kindleLink");
    } else if (/Android/.test(navigator.userAgent)) {
      clickLink("androidLink");
    } else if (window.steamClobber && document.getElementById("steamLink")) {
      clickLink("steamLink");
    } else {
      webStoreFallback();
    }
  } else if (isWebPurchaseSupported()) {
    if (!window.StripeCheckout) return asyncAlert("Sorry, we weren't able to initiate payment. (Your "+
      "network connection may be down.) Please refresh the page and try again, or contact "+
      "support@choiceofgames.com for assistance.");
    var fullProductName = window.storeName + "." + product;
    function stripe() {
      if (window.productData && window.productData[product]) {
        var data = productData[product];
        return StripeCheckout.open({
          key:         window.stripeKey,
          address:     false,
          amount:      data.amount,
          name:        data.display_name,
          email:       window.recordedEmail,
          panelLabel:  'Buy',
          token:       function(response) {
            clearScreen(function() {
              startLoading();
              xhrAuthRequest("POST", "purchase", function(ok, response) {
                doneLoading();
                if (ok) {
                  cacheKnownPurchases(response);
                  return purchaseCallback();
                } else if (/^card error: /.test(response.error)) {
                  var cardError = response.error.substring("card error: ".length);
                  asyncAlert(cardError);
                  clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
                } else if ("purchase already in flight" == response.error) {
                  asyncAlert("Sorry, there was an error handling your purchase. Please wait five minutes and try again, or contact support@choiceofgames.com for assistance.");
                  clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
                } else {
                  asyncAlert("Sorry, there was an error processing your card. (Your "+
                    "network connection may be down.) Please refresh the page and try again, or contact "+
                    "support@choiceofgames.com for assistance.");
                  clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
                }
                curl();
              }, "stripeToken", response.id, "product", fullProductName, "key", window.stripeKey);
            });
          }
        });
      } else {
        return asyncAlert("Sorry, we weren't able to initiate payment. (Your "+
          "network connection may be down.) Please refresh the page and try again, or contact "+
          "support@choiceofgames.com for assistance.");
      }
    }
    if (window.registered && window.recordedEmail) {
      stripe();
    }
    clearScreen(function() {
      var target = document.getElementById('text');
      target.innerHTML="<p>Please sign in to choiceofgames.com to purchase.</p>";
      loginForm(document.getElementById('text'), /*optional*/1, /*err*/null, function(registered){
        if (registered) {
          if (window.knownPurchases && window.knownPurchases[product]) {
            purchaseCallback();
          } else {
            clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
            return stripe();
          }
        } else {
          clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
        }
      });
      curl();
    });
  } else {
    safeTimeout(purchaseCallback, 0);
  }
}

function printDiscount(product, fullYear, oneBasedMonthNumber, dayOfMonth, line, options) {
  if (window.updatedDiscountDates && updatedDiscountDates[product]) {
    var udd = updatedDiscountDates[product];
    fullYear = udd.fullYear;
    oneBasedMonthNumber = udd.oneBasedMonthNumber;
    dayOfMonth = udd.dayOfMonth;
  }
  var shortMonthString = shortMonthStrings[oneBasedMonthNumber];
  var discountTimestamp = new Date(shortMonthString + " " + dayOfMonth + ", " + fullYear).getTime();
  var discountEligible = new Date().getTime() < discountTimestamp;
  var span;
  span = document.createElement("span");
  span.setAttribute("id", "discount_" + product);
  printx(line, span);
  span.innerHTML = span.innerHTML.replace("${choice_discount_ends}", "<span id=discountdate_"+product+">"+shortMonthString + " " + parseInt(dayOfMonth, 10) + "</span>") + " ";

  if (!discountEligible) {
    span.style.display = "none";
  }

  document.getElementById('text').appendChild(span);
}

function rewriteDiscount(product, fullYear, oneBasedMonthNumber, dayOfMonth) {
  if (!window.updatedDiscountDates) window.updatedDiscountDates = {};
  window.updatedDiscountDates[product] = {fullYear:fullYear, oneBasedMonthNumber:oneBasedMonthNumber, dayOfMonth:dayOfMonth};
  var span = document.getElementById("discount_"+product);
  if (!span) return;
  var shortMonthString = shortMonthStrings[oneBasedMonthNumber];
  var discountTimestamp = new Date(shortMonthString + " " + dayOfMonth + ", " + fullYear).getTime();
  var discountEligible = new Date().getTime() < discountTimestamp;
  if (discountEligible) {
    var dateSpan = document.getElementById("discountdate_"+product);
    if (!dateSpan) return;
    span.style.display = "";
    dateSpan.innerHTML = shortMonthString + " " + parseInt(dayOfMonth, 10);
  } else {
    span.style.display = "none";
  }
}

function handleDiscountResponse(ok, response) {
  if (!ok || !response || !window.storeName || !response[storeName]) return;
  if (!window.updatedDiscountDates) window.updatedDiscountDates = {};
  var udds = response[storeName];
  for (var product in udds) {
    if (!udds.hasOwnProperty(product)) continue;
    var udd = udds[product];
    var result = udd.split("-");
    rewriteDiscount(product, result[0], parseInt(result[1],10), parseInt(result[2], 10));
  }
}

function isPrerelease() {
  var steamTrial = window.isSteamApp && window.isTrial;
  if (typeof window != "undefined" && (window.isWeb || steamTrial) && window.releaseDate) {
    if (new Date() > window.releaseDate.getTime()) return false;
    if (/(fullaccess|preview)@choiceofgames.com/.test(getCookieByName("login"))) return false;
    var identity = document.getElementById("identity");
    return !(identity && /(fullaccess|preview)@choiceofgames.com/.test(identity.innerHTML));
  } else {
    return false;
  }
}

function registerNativeAchievement(name) {
  if (window.blockNativeAchievements) return;
  if (window.isIosApp) {
    callIos("achieve", name+"/");
  } else if (window.isMacApp) {
    callMac("achieve", name);
  } else if (window.isWinOldApp) {
    window.external.Achieve(name);
  } else if (window.isCef) {
    cefQuerySimple("Achieve " + name);
  } else if (window.isSteamworks) {
    steamworks.achievement.activate(name);
  }
}

function achieve(name, title, description) {
  if (initStore()) {
    checkAchievements(function() {
      window.store.set("achieved", toJson(nav.achieved));
    })
  }
  trackEvent('unlock_achievement', {
    achievement_id: window.storeName + "." + name
  });
  registerNativeAchievement(name);
  // Game Center shows a prominent banner; no need to show our own
  if (window.isIosApp && !window.isOmnibusApp) return;
  var escapedTitle = title+"".replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
  var escapedDescription = description+"".replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/\[b\]/g, '<b>')
    .replace(/\[\/b\]/g, '</b>')
    .replace(/\[i\]/g, '<i>')
    .replace(/\[\/i\]/g, '</i>');
  var html = "<b>Achievement: "+escapedTitle+"</b><br>" + escapedDescription;
  alertify.log(html);
}

function checkAchievements(callback) {
  safeTimeout(function() {
    if (!initStore()) return callback();
    window.store.get("achieved", function(ok, value){
      function mergeNativeAchievements(achieved) {
        window.checkAchievementCallback = null;
        var nativeRegistered = {};
        for (var i = 0; i < achieved.length; i++) {
          nav.achieved[achieved[i]] = true;
          nativeRegistered[achieved[i]] = true;
        }
        for (var achievement in nav.achieved) {
          if (nav.achieved[achievement] && !nativeRegistered[achievement]) {
            registerNativeAchievement(achievement);
          }
        }
        callback();
      }
      var alreadyLoadingAchievements = false;
      if (ok && value) {
        var achievementRecord = jsonParse(value);
        for (var achieved in achievementRecord) {
          if (achievementRecord[achieved]) nav.achieved[achieved] = true;
        }
      }
      if (window.isIosApp) {
        alreadyLoadingAchievements = !!window.checkAchievementCallback;
        window.checkAchievementCallback = mergeNativeAchievements;
        if (!alreadyLoadingAchievements) callIos("checkachievements");
      } else if (window.isSteamworks) {
        var nativeAchievements = [];
        for (var i = 0; i < window.achievements; i++) {
          if (steamworks.achievement.isActivated(window.achievements[i].name)) {
            nativeAchievements.push(achievement.name);
          }
        }
        mergeNativeAchievements(nativeAchievements);
      } else if (window.isMacApp) {
        alreadyLoadingAchievements = !!window.checkAchievementCallback;
        window.checkAchievementCallback = mergeNativeAchievements;
        if (!alreadyLoadingAchievements) callMac("checkachievements");
      } else if (window.isWinOldApp) {
        var checkWinAchievements = function () {
          var achieved = eval(window.external.GetAchieved());
          if (achieved) {
            mergeNativeAchievements(achieved);
          } else {
            safeTimeout(checkWinAchievements, 100);
          }
        };
        checkWinAchievements();
      } else if (window.isCef) {
        var checkCefAchievements = function() {
          cefQuery({
            request:"GetAchieved ",
            onSuccess: function(response) {
              //console.log("GetAchieved " + response);
              var achieved = eval(response);
              mergeNativeAchievements(achieved);
            },
            onFailure: function(error_code, error_message) {
              //console.error("GetAchieved error " + error_message);
              if (error_code == 1) {
                safeTimeout(checkCefAchievements, 100);
              } else {
                callback();
              }
            }
          });
        };
        checkCefAchievements();
      } else {
        callback();
      }
    });
  },0);
}

function isAdvertisingSupported() {
  if (typeof window === "undefined") return false;
  return (window.isIosApp || window.isAndroidApp || window.adSupportedDebug);
}

function isFullScreenAdvertisingSupported() {
  return isAdvertisingSupported();
}

function showFullScreenAdvertisement(callback) {
  if (window.isIosApp) {
    callIos("advertisement");
    safeTimeout(callback, 0);
  } else if (window.isAndroidApp && window.adBridge) {
    adBridge.displayFullScreenAdvertisement();
    safeTimeout(callback, 0);
  } else if (window.adSupportedDebug) {
    alert("ad!");
    safeTimeout(callback, 0);
  } else {
    safeTimeout(callback, 0);
  }
}

function showFullScreenAdvertisementButton(buttonName, skipCallback, doneCallback) {
  if (typeof isFullScreenAdvertisingSupported == "undefined" || !isFullScreenAdvertisingSupported()) {
    safeTimeout(skipCallback, 0);
    return;
  }
  startLoading();
  checkPurchase("adfree", function (ok, result) {
    doneLoading();
    if (result.adfree) {
      skipCallback();
    } else {
      printButton(buttonName, main, false, function () {
        showFullScreenAdvertisement(doneCallback);
      })
    }
  });
}

function showTicker(target, endTimeInSeconds, finishedCallback) {
  if (!target) target = document.getElementById('text');
  var div = document.createElement("span");
  div.setAttribute("id", "delayTicker");
  target.appendChild(div);
  var timerDisplay = document.createElement("span");
  div.appendChild(timerDisplay);
  var timer;

  var statsButton = document.getElementById("statsButton");
  if (statsButton) {
    var defaultStatsButtonDisplay = statsButton.style.display;
    statsButton.style.display = "none";
  }

  if (endTimeInSeconds > Math.floor(new Date().getTime() / 1000)) {
    if (window.isAndroidApp) {
      notificationBridge.scheduleNotification(endTimeInSeconds);
    } else if (window.isIosApp) {
      callIos("schedulenotification", endTimeInSeconds);
    }
  }

  function cleanUpTicker() {
    window.blockRestart = false;
    if (window.isAndroidApp) {
      notificationBridge.cancelNotification();
    } else if (window.isIosApp) {
      callIos("cancelnotifications");
    }
    clearInterval(timer);
    if (statsButton) statsButton.style.display = defaultStatsButtonDisplay;
  }

  function formatSecondsRemaining(secondsRemaining, forceMinutes) {
    if (!forceMinutes && secondsRemaining < 60) {
      return ""+secondsRemaining+"s";
    } else {
      var minutesRemaining = Math.floor(secondsRemaining / 60);
      var remainderSeconds;
      if (minutesRemaining < 60) {
        remainderSeconds = secondsRemaining - minutesRemaining * 60;
        return ""+minutesRemaining+"m " + formatSecondsRemaining(remainderSeconds);
      } else if (minutesRemaining < 6000) {
        var hoursRemaining = Math.floor(secondsRemaining / 3600);
        remainderSeconds = secondsRemaining - hoursRemaining * 3600;
        return ""+hoursRemaining+"h " + formatSecondsRemaining(remainderSeconds, true);
      } else {
        var daysRemaining = Math.floor(secondsRemaining / 86400);
        remainderSeconds = secondsRemaining - daysRemaining * 86400;
        return ""+daysRemaining+" days " + formatSecondsRemaining(remainderSeconds, true);
      }
    }
  }

  function tick() {
    var tickerElement = document.getElementById("delayTicker");
    var tickerStillVisible = tickerElement && tickerElement.parentNode && tickerElement.parentNode.parentNode;
    if (!tickerStillVisible) {
      cleanUpTicker();
      return;
    }
    var nowInSeconds = Math.floor(new Date().getTime() / 1000);
    var secondsRemaining = endTimeInSeconds - nowInSeconds;
    if (secondsRemaining >= 0) {
      timerDisplay.innerHTML = "" + formatSecondsRemaining(secondsRemaining) + " seconds remaining";
    } else {
      cleanUpTicker();
      tickerElement.innerHTML = "0s remaining";
      if (finishedCallback) safeCall(null, finishedCallback);
    }
  }

  timer = setInterval(tick, 1000);
  tick();
}

function printButton(name, parent, isSubmit, code) {
  var button;
  if (isSubmit) {
    button = document.createElement("input");
    button.type = "submit";
    button.value = name;
    button.name = name;
  } else {
    button = document.createElement("button");
    button.setAttribute("type", "button");
    printx(name, button);
  }
  setClass(button, "next");
  button.setAttribute("accesskey", "n");
  if (code) button.onclick = function(event) {
    if (window.isIosApp) {
      window.freezeCallback = function() {
        window.freezeCallback = null;
        code(event);
      };
      callIos("freeze");
    } else {
      safeCall(null, function() {code(event);});
    }
  };
  if (!isMobile) try { button.focus(); } catch (e) {}
  parent.appendChild(button);
  return button;
}

function printLink(target, href, anchorText, onclick) {
  if (!target) target = document.getElementById('text');
  var link = document.createElement("a");
  link.setAttribute("href", href);
  link.appendChild(document.createTextNode(anchorText));
  if (onclick) {
    if (link.addEventListener) {
      link.addEventListener("click", onclick, true);
    } else {
      link.onclick = onclick;
    }
  }
  target.appendChild(link);
  target.appendChild(document.createTextNode(" "));
}

function kindleButton(target, query, buttonName) {
  printButton(buttonName, main, false,
    function() {
      try {
        window.location.href="http://www.amazon.com/s?rh=n%3A133140011%2Ck%3A" + encodeURIComponent(query);
      } catch (e) {} // xulrunner will intercept this link and throw an exception, opening it in the external browser
    }
  );
}

function printInput(target, inputOptions, callback, minimum, maximum, step) {
    if (!target) target = document.getElementById('text');
    var form = document.createElement("form");
    target.appendChild(form);
    var self = this;
    form.action="#";


    if (inputOptions.long) {
      var input = document.createElement("textarea");
      input.setAttribute("rows", 4);
    } else {
      var input = document.createElement("input");
      if (inputOptions.numeric) {
        input.setAttribute("type", "number");
        input.setAttribute("min", minimum);
        input.setAttribute("max", maximum);
        step = step || "any";
        input.setAttribute("step", step);
      }
    }

    input.setAttribute("autocomplete", "off");

    input.name="text";
    input.setAttribute("style", "font-size: 25px; width: 90%;");
    form.appendChild(input);

    form.onsubmit = function(e) {
        preventDefault(e);
        if (!input.value && !inputOptions.allow_blank) {
            asyncAlert("Don't just leave it blank!  Type something!");
            return;
        }
        if (window.isIosApp) {
          window.freezeCallback = function() {
            window.freezeCallback = null;
            safeCall(null, function() {callback(input.value);});
          };
          callIos("freeze");
        } else {
          safeCall(null, function() {callback(input.value);});
        }
        return false;
    };

    printButton("Next", form, true);

}

function promptEmailAddress(target, defaultEmail, allowContinue, callback) {
  if (!target) target = document.getElementById('text');
  var form = document.createElement("form");
  var self = this;
  form.action="#";

  var message = document.createElement("div");
  message.style.color = "red";
  message.style.fontWeight = "bold";
  message.setAttribute("id", "errorMessage");
  form.appendChild(message);

  var input = document.createElement("input");
  // This can fail on IE
  try { input.type="email"; } catch (e) {}
  input.name="email";
  input.value=defaultEmail;
  input.setAttribute("style", "font-size: 25px; width: 90%;");
  form.appendChild(input);
  target.appendChild(form);
  println("", form);
  println("", form);
  printButton("Next", form, true);

  if (allowContinue) {
    printButton("No, Thanks", target, false, function() {
      callback(true);
    });
  }

  form.onsubmit = function(e) {
    preventDefault(e);
    safeCall(this, function() {
      var email = trim(input.value);
      if (!/^\S+@\S+\.\S+$/.test(email)) {
        var messageText = document.createTextNode("Sorry, \""+email+"\" is not an email address.  Please type your email address again.");
        message.innerHTML = "";
        message.appendChild(messageText);
      } else {
        recordEmail(email, function() {
          callback(false, email);
        });
      }
    });
  };

  curl();
}

function loginForm(target, optional, errorMessage, callback) {
  if (!isRegisterAllowed() || !initStore()) return safeTimeout(function() {
    callback(!"ok");
  }, 0);
  var optional_start = 1;
  var optional_returning_subscribe = 2;
  var optional_returning_no_subscribe = 3;
  var optional_new_subscribe = 4;
  var optional_new_no_subscribe = 5;
  startLoading();
  fetchEmail(function(defaultEmail) {
    isRegistered(function(registered) {
      if (registered) {
        if (defaultEmail) {
          doneLoading();
          loginDiv(registered, defaultEmail);
          return safeTimeout(callback, 0);
        }
        // Cookie says I'm logged in, but we have no local record of the email address
        return getRemoteEmail(function(ok, response) {
          doneLoading();
          if (ok) {
            if (response.email) {
              loginDiv(registered, response.email);
              return recordEmail(response.email, callback);
            } else {
              // not really logged in after all
              logout();
              loginDiv();
              return loginForm(target, optional, errorMessage, callback);
            }
          } else {
            // missed an opportunity to record email locally. meh.
            return safeCall(null, callback);
          }
        });
      }
      doneLoading();
      var form = document.createElement("form");

    if (!errorMessage) errorMessage = "";

      var escapedEmail = defaultEmail.replace(/'/g, "&apos;");
      var passwordButton;
      if (optional == optional_start) {
        form.innerHTML = "<div id=message style='color:red; font-weight:bold'>"+errorMessage+
          "</div><div class='choice'>"+
          "<div><label for=yes class=firstChild><input type=radio name=choice value=yes id=yes checked> My email address is: "+
          "<input type=email name=email id=email value='"+escapedEmail+"' style='font-size: 25px; width: 11em'></label></div>"+
          ((isWeb && window.facebookAppId) ?"<div><label for=facebook><input type=radio name=choice value=facebook id=facebook > Sign in with Facebook.</label></div>":"")+
          ((isWeb && window.googleAppId) ?"<div><label for=google><input type=radio name=choice value=google id=google > Sign in with Google.</label></div>":"")+
          ((window.steamRestoreCallback) ?"<div><label for=steam><input type=radio name=choice value=steam id=steam > Restore purchases from Steam.</label></div>":"")+
          "<div><label for=no class=lastChild><input type=radio name=choice value=no id=no > No, thanks.</label></div></div>"+
          "<p><label class=noBorder for=subscribe><input type=checkbox name=subscribe id=subscribe checked> "+
          "Email me when new games are available.</label></p>";

        form.email.onclick = function() {
          setTimeout(function() {form.email.focus();}, 0);
        };
        setTimeout(function() {form.email.focus();}, 0);
      } else {
        form.innerHTML = "<div id=message style='color:red; font-weight:bold'>"+errorMessage+
          "</div><span><span>My email address is: </span><input type=email name=email id=email value='"+
          escapedEmail+"' style='font-size: 25px; width: 12em'></span><p><label class=noBorder id=subscribeLabel for=subscribe>"+
          "<input type=checkbox name=subscribe id=subscribe checked> "+
          "Email me when new games are available.</label></p><p>Do you have a choiceofgames.com password?</p>"+
          "<div class='choice'>"+
          "<div><label for=new class=firstChild><input type=radio name=choice value=new id=new checked> No, I'm new.</label></div>"+
          "<div><label for=passwordButton><input type=radio name=choice value=passwordButton id=passwordButton> "+
          "Yes, I have a password: <input id=password type=password name=password disabled class=needsclick style='font-size: 25px; width: 11em'></label></div>"+
          "<div><label for=forgot><input type=radio name=choice value=forgot id=forgot> I forgot my password.</label></div>"+
          ((isWeb && window.facebookAppId)?"<div><label for=facebook><input type=radio name=choice value=facebook id=facebook> Sign in with Facebook.</label></div>":"")+
          ((isWeb && window.googleAppId)?"<div><label for=google><input type=radio name=choice value=google id=google> Sign in with Google.</label></div>":"")+
          (optional ? "<div><label for=no><input type=radio name=choice value=no id=no> Cancel.</label></div>" : "") +
          "</div>";

        var labels = form.getElementsByTagName("label");
        setClass(labels[labels.length-1], "lastChild");

        var password = form.password;
        passwordButton = form.passwordButton;

        passwordButton.parentNode.onclick = function() {
          passwordButton.checked = true;
          passwordButton.onchange();
        };

        var radioButtons = form.choice;
        var onchange = function() {
          var enabled = passwordButton.checked;
          password.disabled = !enabled;
          if (enabled) {
            password.focus();
            setTimeout(function() {password.parentNode.scrollIntoView();}, 0);
          }
        };
        for (var i = radioButtons.length - 1; i >= 0; i--) {
          radioButtons[i].onchange = onchange;
        }
        if (optional) {
          form.subscribe.checked = (optional == optional_returning_subscribe || optional == optional_new_subscribe);
          passwordButton.checked = (optional == optional_returning_subscribe || optional == optional_returning_no_subscribe);
        }
      }

      function showMessage(msg) {
        var message = document.getElementById('message');
        var messageText = document.createTextNode(msg);
        message.innerHTML = "";
        message.appendChild(messageText);
      }

      form.onsubmit = function(event) {
        preventDefault(event);
        var email = trim(form.email.value);
        var subscribe = form.subscribe.checked;
        var choice = getFormValue("choice");
        if ("steam" == choice) {
          window.location.href = "https://www.choiceofgames.com/profile/?steamRestore&gameId=" + window.storeName;
        }
        if ("facebook" == choice) {
          if (!window.FB) return asyncAlert("Sorry, we weren't able to sign you in with Facebook. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
          var loginParams = {scope:'email',return_scopes:true};
          if (window.facebookReRequest) loginParams.auth_type = "rerequest";
          return FB.login(function(response){
            if ("connected" == response.status) {
              var grantedScopes = [];
              try { grantedScopes = response.authResponse.grantedScopes.split(","); } catch (e) {}
              var grantedEmail = false;
              for (var i = 0; i < grantedScopes.length; i++) {
                if ("email" == grantedScopes[i]) {
                  grantedEmail = true;
                  break;
                }
              }
              if (grantedEmail) {
                xhrAuthRequest("POST", "facebook-login", function(ok, response){
                  if (ok) {
                    loginDiv(ok, response.email);
                    recordLogin(ok, response.id, response.email);
                    cacheKnownPurchases(response.purchases);
                    safeCall(null, function() {callback("ok");});
                  } else {
                    asyncAlert("Sorry, we weren't able to sign you in with Facebook. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                  }
                }, "app_id", facebookAppId);
              } else {
                showMessage("Sorry, we require an email address to sign you in. Please grant access to your email address, or type your email address below.");
                window.facebookReRequest = true;
              }
            }
          },loginParams);
        }
        if ("google" == choice) {
          if (!window.gapi) return asyncAlert("Sorry, we weren't able to sign you in with Google. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
          var done = false;
          return gapi.auth.signIn({callback: function (authResult) {
            if (done) return;
            done = true;
            if (authResult['status']['signed_in']) {
              isRegistered(function(registered) {
                if (!registered) xhrAuthRequest("POST", "google-login", function(ok, response){
                  loginDiv(ok, response.email);
                  recordLogin(ok, response.id, response.email);
                  cacheKnownPurchases(response.purchases);
                  if (ok) {
                    callback("ok");
                  } else {
                    asyncAlert("Sorry, we weren't able to sign you in with Google. Please try again later, or contact support@choiceofgames.com for assistance.");
                  }
                }, "code", authResult['code'], "client_id", googleAppId);
              });
            } else {
              asyncAlert("Sorry, we weren't able to sign you in with Google. Please try again later, or contact support@choiceofgames.com for assistance.");
            }
          }});
        }
        if (!/^\S+@\S+\.\S+$/.test(email) && "no" != choice) {
          showMessage('Sorry, "'+email+'" is not an email address.  Please type your email address again.');
        } else {
          recordEmail(email, function() {
            if ("yes" == choice) {
              clearScreen(function() {
                if (defaultEmail) {
                  optional = subscribe ? optional_returning_subscribe : optional_returning_no_subscribe;
                } else {
                  optional = subscribe ? optional_new_subscribe : optional_new_no_subscribe;
                }
                loginForm(document.getElementById("text"), optional, null, callback);
                curl();
              });
            } else if ("no" == choice) {
              safeCall(null, function() {callback(false);});
            } else if ("new" == choice) {
              target.innerHTML = "";
              window.scrollTo(0,1);
              form = document.createElement("form");
              var escapedEmail = email.replace(/'/g, "&apos;");
              form.innerHTML = "<div id=message style='color:red; font-weight:bold'></div>"+
                "<div>My email address is: </div><div><input type=email name=email id=email value='"+
                escapedEmail+"' style='font-size: 25px; width: 12em'></div>"+
                "<div>Type it again: </div><div><input type=email name=email2 id=email2 autocomplete='off' style='font-size: 25px; width: 12em'></div>"+
                "<div>Enter a new password:&nbsp;</div><div>"+
                "<input type=password name=password id=password style='font-size: 25px; width: 12em'></div>";
              form.onsubmit = function(event) {
                preventDefault(event);
                var email = trim(form.email.value);
                var email2 = trim(form.email2.value);
                if (!/^\S+@\S+\.\S+$/.test(email)) {
                  showMessage('Sorry, "'+email+'" is not an email address.  Please type your email address again.');
                  return;
                } else if (email != email2) {
                  showMessage('Those email addresses don\'t match.  Please type your email address again.');
                  return;
                }
                startLoading();
                form.style.display = "none";
                window.scrollTo(0,1);
                login(email, form.password.value, /*register*/true, subscribe, function(ok, response) {
                  doneLoading();
                  if (ok) {
                    target.innerHTML = "";
                    loginDiv(ok, email);
                    recordLogin(ok, response.id, email);
                    cacheKnownPurchases(response.purchases);
                    // we need another click event so we can launch Stripe in a pop-up
                    if (window.isWeb) {
                      asyncAlert("You have registered successfully.", function() {
                        safeCall(null, function() {callback("ok");});
                      });
                    } else {
                      return safeCall(null, function() {callback("ok");});
                    }
                  } else if ("incorrect password" == response.error) {
                    target.innerHTML = "";
                    loginForm(target, optional, 'Sorry, the email address "'+email+'" is already in use. Please type your password below, or use a different email address.', callback);
                  } else {
                    form.style.display = "";
                    showMessage("Sorry, we weren't able to sign you in. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                  }
                });
              };
              target.appendChild(form);
              println("", form);
              printButton("Next", form, true);
              if (optional) {
                printButton("Cancel", form, false, function() {
                  safeCall(null, function() {callback(false);});
                });
              }
            } else if ("passwordButton" == choice) {
              startLoading();
              form.style.display = "none";
              window.scrollTo(0,1);
              login(email, form.password.value, /*register*/false, form.subscribe.checked, function(ok, response) {
                doneLoading();
                form.style.display = "";
                if (ok) {
                  target.innerHTML = "";
                  loginDiv(ok, email);
                  recordLogin(ok, response.id, email);
                  cacheKnownPurchases(response.purchases);
                  // we need another click event so we can launch Stripe in a pop-up
                  if (window.isWeb) {
                    asyncAlert("You have registered successfully.", function() {
                      safeCall(null, function() {callback("ok");});
                    });
                  } else {
                    return safeCall(null, function() {callback("ok");});
                  }
                } else if ("unknown email" == response.error) {
                  showMessage('Sorry, we can\'t find a record for the email address "'+email+'". Please try a different email address, or create a new account.');
                } else if ("incorrect password" == response.error) {
                  showMessage('Sorry, that password is incorrect. Please try again, or select "I forgot my password" to reset your password.');
                } else {
                  showMessage("Sorry, we weren't able to sign you in. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                }
              });
            } else if ("forgot" == choice) {
              startLoading();
              form.style.display = "none";
              window.scrollTo(0,1);
              forgotPassword(email, function(ok, response) {
                doneLoading();
                form.style.display = "";
                if (ok) {
                  showMessage("We've emailed you a link to reset your password. Please check your email and click on the link, then return here to sign in.");
                  document.getElementById('passwordButton').checked = true;
                  document.getElementById('passwordButton').onchange();
                } else if ("unknown email" == response.error) {
                  showMessage('Sorry, we can\'t find a record for the email address "'+email+'". Please try a different email address, or create a new account.');
                } else {
                  showMessage("Sorry, we weren't able to sign you in. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                }
              });
            }
          });
        }
      };

      target.appendChild(form);
      if (passwordButton && passwordButton.checked) passwordButton.onchange();
      if (optional && optional > 1) document.getElementById("subscribeLabel").style.display = "none";
      printButton("Next", form, true);
      printFooter();
    });
  });
}

function loginDiv(registered, email) {
  var domain = "https://www.choiceofgames.com/";
  var identity = document.getElementById("identity");
  if (!identity) return;
  var emailLink = document.getElementById("email");
  var logoutLink = document.getElementById("logout");
  if (registered) {
    emailLink.setAttribute("href", domain + "profile" + "/");
    emailLink.innerHTML = "";
    emailLink.appendChild(document.createTextNode(email));
    logoutLink.onclick = function(event) {
      preventDefault(event);
      logout();
      loginDiv();
    };
    emailLink.style.display = "block";
    logoutLink.style.display = "block";
  } else {
    emailLink.style.display = "none";
    logoutLink.style.display = "none";
  }
}

function isRegistered(callback) {
  if (window.isWeb) {
    return safeTimeout(function() {
      if (!window.registered) window.registered = !!getCookieByName("login");
      callback(window.registered);
    }, 0);
  } else if (initStore()) {
    return window.store.get("login", function(ok, value) {
      safeTimeout(function() {
        window.registered = ok && value && "false" != value && "0" != value;
        callback(window.registered);
      }, 0);
    });
  } else {
    safeCall(null, function() {
      window.registered = false;
      callback(false);
    });
  }
}

function isRegisterAllowed() {
  return isWebSavePossible();
}

function preventDefault(event) {
  if (!event) event = window.event;
  if (!event) return;
  if (event.preventDefault) {
    event.preventDefault();
  } else {
    event.returnValue = false;
  }
}

function getPassword(target, code) {
  if (!target) target = document.getElementById('text');
  var textArea = document.createElement("textarea");
  textArea.cols = 41;
  textArea.rows = 30;
  setClass(textArea, "savePassword");
  target.appendChild(textArea);
  println("", target);
  printButton("Next", target, false, function() {
    code(false, textArea.value);
  });

  printButton("Cancel", target, false, function() {
    code(true);
  });
}

function showPassword(target, password) {
  if (!target) target = document.getElementById('text');

  var textBuffer = [];
  var colWidth = 40;
  for (var i = 0; i < password.length; i++) {
    textBuffer.push(password.charAt(i));
    if ((i + 1) % colWidth === 0) {
      textBuffer.push('\n');
    }
  }
  password = "----- BEGIN PASSWORD -----\n" + textBuffer.join('') + "\n----- END PASSWORD -----";

  var shouldButton = isMobile;
  if (shouldButton) {
    var button = printButton("Email My Password to Me", target, false,
      function() {
        safeCall(self, function() {
            if (isWeb) {
              // TODO more reliable system
            }
            window.location.href = "mailto:?subject=Save%20this%20password&body=" + encodeURIComponent(password);
        });
      }
    );
    setClass(button, "");
  }

  var shouldTextArea = !isMobile;
  if (shouldTextArea) {
    var textArea = document.createElement("textarea");
    textArea.cols = colWidth + 1;
    textArea.rows = 30;
    setClass(textArea, "savePassword");

    textArea.setAttribute("readonly", true);
    textArea.onclick = function() {textArea.select();};
    textArea.value = (password);
    target.appendChild(textArea);
  }
}

function changeTitle(title) {
  document.title = title;
  var titleTag = document.getElementById("title");
  if (titleTag) {
    titleTag.innerHTML = "";
    titleTag.appendChild(document.createTextNode(title));
  }
  var text = document.getElementById('text');
  if (text) {
    var textTitleTag = document.createElement('h1');
    textTitleTag.classList.add('gameTitle');
    textTitleTag.appendChild(document.createTextNode(title));
    text.appendChild(textTitleTag);
  }
}

function changeAuthor(author) {
  var authorTag = document.getElementById("author");
  if (authorTag) {
    authorTag.innerHTML = "";
    authorTag.appendChild(document.createTextNode("by " + author));
  }
  var text = document.getElementById('text');
  if (text) {
    var textAuthorTag = document.createElement('h2');
    textAuthorTag.classList.add('gameTitle');
    textAuthorTag.appendChild(document.createTextNode("by " + author));
    text.appendChild(textAuthorTag);
  }
}


function reportBug() {
  var prompt = "Please explain the problem. Be sure to describe what you expect, as well as what actually happened.";
  alertify.prompt(prompt, function(ok, body) {
    var statMsg = "(unknown)";
    try {
        var scene = window.stats.scene;
        statMsg = computeCookie(scene.stats, scene.temps, scene.lineNum, scene.indent);
    } catch (ex) {}
    body += "\n\nGame: " + window.storeName;
    if (window.stats && window.stats.scene) {
      body += "\nScene: " + window.stats.scene.name;
      body += "\nLine: " + (window.stats.scene.lineNum+1);
    }
    body += "\nUser Agent: " + navigator.userAgent;
    body += "\nLoad time: " + window.loadTime;
    if (window.Persist) body += "\nPersist: " + window.Persist.type;
    body += "\nversion=" + window.version;
    body += "\n\n" + statMsg;
    if (window.nav && window.nav.bugLog) body += "\n\n" + window.nav.bugLog.join("\n");
    console.log(body);
    if (ok) alertify.prompt("Please type your email address.", function(ok, email) {
      if (ok) xhrAuthRequest("POST", "support-mail", function(ok, response) {
        if (ok) {
          alertify.log("Thank you for reporting a bug!");
        } else {
          alertify.alert("Bug reporting failed. Please email your bug report to support@choiceofgames.com (and be sure to mention that the bug reporter failed!)");
        }
      }, "email", encodeURIComponent(email),
        "subject", encodeURIComponent("bug report " + window.storeName),
        "text", encodeURIComponent(body));
    });
  });
}

window.registered = false;

function getSupportEmail() {
  if (window.storeName) {
    return "support-" + storeName + "-" + platformCode() + "@choiceofgames.com";
  }
  try {
    return document.getElementById("supportEmail").getAttribute("href").substring(7);
  } catch (e) {
    return "support-external@choiceofgames.com";
  }
}

function absolutizeAboutLink() {
  var aboutAnchor = document.getElementById("aboutLink");
  if (aboutLink) {
    var aboutHref = aboutLink.getAttribute("href");
    if (/^https?:/.test(aboutHref)) return;

    var linkTags = document.getElementsByTagName("link");
    var canonical;
    for (var i = 0; i < linkTags.length; i++) {
      if (linkTags[i].getAttribute("rel") == "canonical") {
        canonical = linkTags[i].getAttribute("href");
        break;
      }
    }

    if (!canonical) return;

    var absoluteCanonical;
    if (/^https?:/.test(canonical)) {
      absoluteCanonical = canonical;
    } else if (/^\//.test(canonical)) {
      absoluteCanonical = "https://www.choiceofgames.com" + canonical;
    } else {
      absoluteCanonical = "https://www.choiceofgames.com/" + canonical;
    }
    if (!/\/$/.test(canonical)) {
      absoluteCanonical += "/";
    }

    aboutLink.setAttribute("href", absoluteCanonical + aboutHref);
  }
}

function aboutClick() {
    window.location.href = document.getElementById("aboutLink").href;
}

function loadPreferences() {
  if (initStore()) {
    store.get("preferredZoom", function(ok, preferredZoom) {
      if (ok && !isNaN(parseFloat(preferredZoom))) {
        setZoomFactor(parseFloat(preferredZoom));
      }
    });
    store.get("preferredBackground", function(ok, preferredBackground) {
      if (!/^(sepia|black|white)$/.test(preferredBackground)) {
        preferredBackground = "sepia";
      }
      if (preferredBackground === "black") {
        document.body.classList.add("nightmode");
      } else if (preferredBackground === "white") {
        document.body.classList.add("whitemode");
      }
    });
    store.get("preferredFamily", function (ok, preferredFontFamily) {
      if (preferredFontFamily === "sans") {
        document.body.classList.add("sans");
      } else if (preferredFontFamily === "dyslexia") {
        document.body.classList.add("dyslexia");
      }
    });
    store.get("preferredAnimation", function(ok, preferredAnimation) {
      window.animateEnabled = parseFloat(preferredAnimation) !== 2;
    });
    store.get("preferredSliding", function (ok, preferredSliding) {
      window.slidingEnabled = preferredSliding !== false && preferredSliding !== "false";
    });
  } else {
    window.animateEnabled = true;
  }
  if (typeof document.body.style.animationName === "undefined") {
    if (typeof document.body.style.webkitAnimationName === "undefined") {
      window.animateEnabled = false;
    } else {
      window.animationProperty = "webkitAnimationName";
    }
  } else {
    window.animationProperty = "animationName";
  }
  if (window.isCef || document.getElementsByTagName("audio").length) {
    delete window.animationProperty;
  }
}

window.addEventListener("error", function (event) {
    var msg = event.message;
    var file = event.source;
    var line = event.lineno;
    var column = event.colno;
    var error = event.error;
    window.reportError(msg, file, line, column, error);
});

window.reportError = function(msg, file, line, column, error) {
    if (window.console) {
      window.console.error(msg);
      if (file) window.console.error("file: " + file);
      if (line) window.console.error("line: " + line);
      if (column) window.console.error("column: " + column);
      if (error) window.console.error(error);
    }
    if (window.isWeb && error && error.name === "QuotaExceededError" && window.location.host === 'www.choiceofgames.com') {
      window.location.assign('https://www.choiceofgames.com/clear-site-data/?qee=1&path=' + encodeURIComponent(window.location.pathname));
    }
    alert(msg);
    if (!isWebSavePossible()) return;
    var ok = confirm("Sorry, an error occurred.  Click OK to email error data to support.");
    if (ok) {
        var statMsg = "(unknown)";
        try {
          var scene = window.stats.scene;
          statMsg = computeCookie(scene.stats, scene.temps, scene.lineNum, scene.indent);
        } catch (ex) {}
        var body = "What were you doing when the error occurred?\n\nError: " + msg;
        body += "\n\nGame: " + window.storeName;
        if (window.stats && window.stats.scene) {
          body += "\nScene: " + window.stats.scene.name;
          body += "\nLine: " + (window.stats.scene.lineNum + 1);
        }
        if (file) body += "\nJS File: " + file;
        if (line) body += "\nJS Line: " + line;
        if (column) body += "\nJS Column: " + column;
        if (error) body += "\nJS Stack: " + error;
        body += "\nUser Agent: " + navigator.userAgent;
        body += "\nLoad time: " + window.loadTime;
        if (window.Persist) body += "\nPersist: " + window.Persist.type;
        body += "\n\n" + statMsg + "\n\nversion=" + window.version;
        if (window.currentVersion) {
          body += "\ncurrentVersion=" + window.currentVersion;
        }
        if (window.nav && window.nav.bugLog) body += "\n\n" + window.nav.bugLog.join("\n");
        var supportEmailHref = "mailto:support-external@choiceofgames.com";
        try {
          supportEmailHref="mailto:"+getSupportEmail();
          supportEmailHref=supportEmailHref.replace(/\+/g,"%2B");
        } catch (e) {}
        window.location.href=(supportEmailHref + "?subject=Error Report&body=" + encodeURIComponent(body));
    }
}

window.onload=function() {
    if (window.alreadyLoaded) return;
    window.alreadyLoaded = true;
    setTimeout(updateAllPaidSceneCaches, 0);
    window.main = document.getElementById("main");
    var head = document.getElementsByTagName("head")[0];
    window.nav.setStartingStatsClone(window.stats);
    loadPreferences();
    if (window.achievements && window.achievements.length) {
      nav.loadAchievements(window.achievements);
      checkAchievements(function() {});
      setButtonTitles();
    }
    nav.loadProducts(window.knownProducts, window.purchases);
    stats.sceneName = window.nav.getStartupScene();
    var map = parseQueryString(window.location.search);
    if (!map) {
      var hashMap = parseQueryString(window.location.hash);
      var realHash = false;
      for (var key in hashMap) {
        if (/^utm_/.test(key)) continue;
        realHash = true;
        break;
      }
      if (realHash) map = hashMap;
    }

    if (!map) {
      if (window.androidQueryString) {
        map = parseQueryString(window.androidQueryString.get());
      } else if (window.forcedScreenshots) {
        map = {forcedScene:"screenshots"};
      }
    }

    if (map) {
      window.forcedScene = map.forcedScene;
      window.slot = map.slot;
      window.debug = map.debug;
      if (map.restart) {
        restartGame();
      } else if (map.achievements) {
        doneLoading();
        showAchievements("hideNextButton");
      } else if (map.omnibusRestore) {
        restorePurchases('adfree', function(purchased) {
          if (window.isIosApp) {
            callIos('close');
          } else {
            setTimeout(function() {window.closer.close()}, 0);
          }
        });
      } else if (map.forcedScene) {
        safeCall(null, function() {loadAndRestoreGame(window.slot, window.forcedScene);});
      } else if (map.persistence) {
        var persistenceParts = map.persistence.split("|");
        if (persistenceParts.length == 2) {
          window.storeName = persistenceParts[0];
          window.remoteStoreName = persistenceParts[1];
        } else {
          window.storeName = map.persistence;
        }
        var startupScene = new Scene("startup", window.stats, window.nav, {secondaryMode:"startup", saveSlot:"startup"});
        startupScene.startupCallback = function() {
          safeCall(null, loadAndRestoreGame);
        }
        startupScene.execute();
      } else if (map.textOptionsMenu) {
        if (initStore()) {
          store.get("preferredSliding", function (ok, preferredSliding) {
            textOptionsMenu();
          });
        } else {
          textOptionsMenu();
        }
      } else {
        safeCall(null, loadAndRestoreGame);
      }
    } else {
      safeCall(null, loadAndRestoreGame);
    }
    if (window.beta) {
      var reportBugButton = document.getElementById("bugButton");
      if (reportBugButton) reportBugButton.setAttribute("style", "");
    }
    if (window.Touch && window.isWeb) {
      // INSERT ADMOB AD
    }
    isRegistered(function(registered){
      if (registered) {
        fetchEmail(function(email) {
          loginDiv(registered, email);
        });
      } else {
        loginDiv();
      }
    });
    if (window.isWinStoreApp || window.isWinOldApp) {
        var subscribeAnchor = document.getElementById("subscribeLink");
        if (subscribeAnchor) {
            subscribeAnchor.onclick = function() {
              safeCall(null, subscribeLink);
              return false;
            };
        }
    }
    if (window.isWinOldApp) {
        absolutizeAboutLink();
        var h1s = document.getElementsByTagName("h1");
        if (h1s.length) window.external.SetTitle(document.getElementsByTagName("h1")[0].innerText);
    }
    if (isFollowEnabled()) {
      var shareElement = document.getElementById("share");
      if (shareElement) shareElement.innerHTML = '<iframe src="//www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Fchoiceofgames&amp;send=false'+
      '&amp;layout=button_count&amp;width=90&amp;show_faces=true&amp;font&amp;colorscheme=light&amp;action=like&amp;height=20&amp;appId=190439350983878"'+
      ' scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:90px; height:20px;" allowTransparency="true"></iframe>'+
      '<iframe allowtransparency="true" frameborder="0" scrolling="no" '+
      'src="//platform.twitter.com/widgets/follow_button.html?screen_name=choiceofgames&amp;show_screen_name=false"'+
      ' style="width:160px; height:20px;"></iframe>';
    }
    var supportEmailLink = document.getElementById("supportEmail");
    if (window.storeName && supportEmailLink) {
      supportEmailLink.href = "mailto:" + getSupportEmail();
    }

    submitAnyDirtySaves();

    if (window.purchaseSubscriptions) {
      var productList = "";
      for (var key in purchaseSubscriptions) {
        productList += (productList ? " " : "") + key;
      }
      if (productList) checkPurchase(productList, function() {});
    }
    if (window.isWeb) {
      (function() {
        if (isPrerelease()) {
          var appLinks = document.getElementById('mobileLinks');
          if (appLinks) appLinks.style.display = 'none';
        }
        var productMap = {};
        if (typeof purchases === "object") {
          for (var scene in purchases) {
            productMap[purchases[scene]] = 1;
          }
        }
        if (!window.knownProducts) window.knownProducts = [];
        for (var product in productMap) {
          window.knownProducts.push(product);
        }

        var fullProducts = [];
        for (var i = 0; i < window.knownProducts.length; i++) {
          fullProducts[i] = window.storeName + "." + window.knownProducts[i];
        }
        xhrAuthRequest("GET", "product-data", function(ok, data) {
          if (!window.productData) window.productData = {};
          for (var i = 0; i < window.knownProducts.length; i++) {
            window.productData[window.knownProducts[i]] = data[window.storeName + "." + window.knownProducts[i]];
          }
        }, "products", fullProducts.join(","));
      })();
    }

    document.addEventListener('keydown', function(ev) {
      var inputType;
      if (ev.target && ev.target.tagName === 'INPUT') {
        inputType = ev.target.type;
      }
      if (inputType === 'text' || inputType === 'number' || inputType === 'email' || inputType === 'password') return;
      var dialog = document.getElementById('keyboardShortcuts');
      if (dialog && dialog.open) {
        dialog.close();
        return;
      }
      var key = ev.key;

      function clickRadio(value) {
        var newTarget = document.querySelector('input[type=radio][value="' + value + '"]');
        if (!newTarget) return;
        if (newTarget.disabled) return;
        newTarget.checked = true;
        newTarget.focus();
        newTarget.blur();
      }

      function clickButton(id) {
        var button = document.querySelector('#' + id);
        if (!button) return;
        button.click();
      }

      if (key === 'j') {
        var oldTarget = document.querySelector('input[type=radio]:checked');
        if (!oldTarget) {
          var input = document.querySelector('#main input');
          if (input) {
            setTimeout(function () { input.focus(); }, 0);
          }
          return;
        }
        var value = Number(oldTarget.value);
        var availableValues = [...oldTarget.form.querySelectorAll('input[type=radio]:not(:disabled)')].map(e => Number(e.value));
        var valueIndex = availableValues.indexOf(value);
        if (value === availableValues.at(-1)) {
          value = availableValues[0];
        } else {
          value = availableValues[valueIndex + 1];
        }
        clickRadio(value);
      } else if (key === 'k') {
        var oldTarget = document.querySelector('input[type=radio]:checked');
        if (!oldTarget) return;
        var value = Number(oldTarget.value);
        var availableValues = [...oldTarget.form.querySelectorAll('input[type=radio]:not(:disabled)')].map(e => Number(e.value));
        var valueIndex = availableValues.indexOf(value);
        if (value == availableValues[0]) {
          value = availableValues.at(-1);
        } else {
          value = availableValues[valueIndex - 1];
        }
        clickRadio(value);
      } else if (!isNaN(key)) {
        if (key === "0") {
          key = 10;
        }
        key--;
        clickRadio(key);
      } else if (key === 'q') {
        clickButton('statsButton');
      } else if (key === 'w') {
        clickButton('menuButton');
      } else if (key === 'Enter') {
        if (ev.target && (ev.target.tagName === "BUTTON" || ev.target.tagName === "A")) {
          if (ev.target.getAttribute("accesskey") === "n") {
            ev.preventDefault();
          } else {
            return;
          }
        }
        if (window.activatingNext) return;
        var checked = document.querySelector('input[type=radio]:checked');
        if (checked) {
          var label = document.querySelector('label[for="' + checked.id + '"]').parentElement;
          if (label) {
            label.scrollIntoView({ block: "nearest", behavior: 'smooth' });
            label.classList.add('selectedKeyboard');
          }
          window.activatingNext = Date.now();
        } else {
          var n;
          if (ev.target && (ev.target.tagName === "BUTTON" || ev.target.tagName === "A")) {
            n = ev.target;
          } else {
            n = document.querySelector('*[accesskey="n"]');
          }
          if (n) {
            n.scrollIntoView({block: "nearest", behavior: 'smooth'});
            n.classList.add('selectedKeyboard');
            window.activatingNext = Date.now();
          }
        }
      } else if (key === '?' || key === '/') {
        if (dialog && dialog.showModal) dialog.showModal();
      }
    }, false);

    document.addEventListener('keyup', function (ev) {
      var now = Date.now();
      var activatingNext = window.activatingNext;
      window.activatingNext = null;
      if (ev.key === 'Enter' && activatingNext && (now - activatingNext > 500)) {
        var n = document.querySelector('.selectedKeyboard');
        if (n && (n.tagName === 'BUTTON' || n.tagName === 'A')) {
          n.click();
        } else {
          n = document.querySelector('*[accesskey="n"]');
          if (n) n.click();
        }
      }
      document.querySelectorAll('.selectedKeyboard').forEach(function (selected) {
        selected.classList.remove('selectedKeyboard');
      })
    });

};

if ( document.addEventListener ) {
  document.addEventListener( "DOMContentLoaded", window.onload, false );
}

try {
  var style = document.createElement('style');
  style.type = 'text/css';
  try {style.innerHTML = 'noscript {display: none;}'; } catch (e) {}
  document.getElementsByTagName('head')[0].appendChild(style);
} catch (e) {}

if (window.isWeb) {
  document.getElementById("dynamic").innerHTML = ".webOnly { display: block; }";
  var checkoutScript = document.createElement("script");
  checkoutScript.async = 1;
  checkoutScript.src="https://checkout.stripe.com/v2/checkout.js";
  document.getElementsByTagName("head")[0].appendChild(checkoutScript);

  var metas = document.getElementsByTagName("meta");
  var facebookAppId, googleAppId;
  var googleLoginCallbackCallback;
  for (var i = 0; i < metas.length; i++) {
    var meta = metas[i];
    if ("fb:app_id" == meta.getAttribute("property")) {
      facebookAppId = meta.getAttribute("content");
    } else if ("google-signin-clientid" == meta.getAttribute("name")) {
      googleAppId = meta.getAttribute("content");
    }
  }

  if (facebookAppId) {
    window.fbAsyncInit = function() {
      FB.init({
        appId      : facebookAppId,
        cookie     : true,  // enable cookies to allow the server to access 
                            // the session
        xfbml      : true,  // parse social plugins on this page
        version    : 'v2.0' // use version 2.0
      });
    };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src ="//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document,'script','facebook-jssdk'));
  }

  if (googleAppId) (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/client:plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
  
} else if (window.isIosApp) {
  document.getElementById("dynamic").innerHTML =
  "#text .gameTitle { display: block; }"+
  ""+
  "#header { display: none; }"+
  ""+
  "body { transition-duration: 0; }"+
  ""+
  "#emailUs { display: none; }"+
  ""+
  "#main { padding-top: 1em; }";
  // Use UIWebView width, not screen width, on iPad
  document.querySelector("meta[name=viewport]").setAttribute("content", "width="+window.innerWidth);
  window.addEventListener("resize", function() {
      document.querySelector("meta[name=viewport]").setAttribute("content", "width="+window.innerWidth);
      // this dummy element seems to be required to get the viewport to stick
      var dummy = document.createElement("p");
      dummy.innerHTML = "&nbsp;";
      document.body.appendChild(dummy);
      window.setTimeout(function() {document.body.removeChild(dummy);}, 10);
    }, false);
  callIos("checkdiscounts");
  // in a timeout because iOS may try to add to the head before mygame.js has run
  (function(){
    var requester = function() {
      if (window.stats) {
        callIos("requestscenes");
      } else {
        safeTimeout(requester, 1);
      }
    }
    if (window.isFile) safeTimeout(requester, 0);
  })();
} else if (window.isAndroidApp) {
  document.getElementById("dynamic").innerHTML =
  "#text .gameTitle { display: block; }" +
  "" +
  "#header { display: none; }"+
  ""+
  "#emailUs { display: none; }"+
  ""+
  "#main { padding-top: 1em; }";
} else if (window.isMacApp || window.isWinOldApp || window.isCef || window.isNode || window.isSteamApp) {
  document.getElementById("dynamic").innerHTML =
    "#header .gameTitle { display: none; }" +
    "" +
    "#text .gameTitle { display: block; }" +
    "" +
    "#headerLinks { display: none; }"+
    ""+
    "#emailUs { display: none; }";
}
// on touch devices, this hover state never goes away
if (!('ontouchstart' in window)) {
  document.getElementById("dynamic").innerHTML += ".choice > div:hover {background-color: #E4DED8;}\n" +
    "body.nightmode .choice > div:hover {background-color: #555;}\n"+
    "body.whitemode .choice > div:hover {background-color: #ddd;}\n";
}
function fixChromeLinks() {
  var aboutLink = document.getElementById("aboutLink");
  aboutLink.addEventListener("click", function() {
    if (chrome.app.window) {
      event.preventDefault();
      chrome.app.window.create("credits.html", {}, function(w) {
        w.contentWindow.addEventListener( "DOMContentLoaded", function() {
          var win = this;
          var back = win.document.getElementById("back");
          back.addEventListener("click", function(event) {
            event.preventDefault();
            win.close();
          }, false);
          var base = win.document.createElement('base');
          base.setAttribute("target", "_blank");
          win.document.head.appendChild(base);
          win.document.documentElement.style.overflowY = "scroll";
        }, false);
      });
    }
  }, false);

  var statsButton = document.getElementById("statsButton");
  if (statsButton) {
    statsButton.onclick = undefined;
    statsButton.addEventListener("click", function() {
      showStats();
    }, false);
  }

  var achievementsButton = document.getElementById("achievementsButton");
  if (achievementsButton) {
    achievementsButton.onclick = undefined;
    achievementsButton.addEventListener("click", function() {
      showAchievements();
    }, false);
  }

  var restartButton = document.getElementById("restartButton");
  restartButton.onclick = undefined;
  restartButton.addEventListener("click", function() {
    restartGame("prompt");
  }, false);

  var subscribeAnchor = document.getElementById("subscribeLink");
  subscribeAnchor.onclick = undefined;
  subscribeAnchor.addEventListener("click", function() {
    subscribeLink();
  }, false);

  var supportAnchor = document.getElementById("supportEmail");
  supportAnchor.addEventListener("click", function(event) {
    event.preventDefault();
  }, false);

  var menuButton = document.getElementById("menuButton");
  menuButton.onclick = undefined;
  menuButton.addEventListener("click", function() {
    textOptionsMenu();
  }, false);
}
if (window.isChromeApp) {
  var base = document.createElement('base');
  base.setAttribute("target", "_blank");
  document.head.appendChild(base);

  document.addEventListener("DOMContentLoaded", fixChromeLinks);
  setInterval(function() {
    document.body.style.height = document.querySelector(".container").offsetHeight + "px";
  }, 100);
}
if (window.isCef) {
  var pollPurchases = function() {
    cefQuery({
      request:"PollPurchases",
      onSuccess:function(response){
        //console.log("PollPurchases: '"+response+"'");
        if (response) {
          clearScreen(loadAndRestoreGame);
        }
        safeTimeout(pollPurchases, 100);
      },
      onFailure:function(error_code, error_message) {
        console.error("PollPurchases error: " + error_message);
      }
    });
  };
  pollPurchases();
} else if (window.isSteamworks) {
	(function() {
		var steamworksApps = require('../package.json').products;
		if (typeof steamworksApps === "undefined") throw new Error("package.json missing products");
		var steamworksAppId = window.isTrial ? steamworksApps.steam_demo : steamworksApps.adfree;
    if (steamworksApi.restartAppIfNecessary(steamworksAppId)) {
      require('electron').ipcRenderer.invoke('quit');
      return;
    }
    try {
      window.steamworks = steamworksApi.init(steamworksAppId);
    } catch (e) {
      alert("There was an error connecting to Steam. Steam must be running" +
        " to play this game. If you launched this game using Steam, try restarting Steam" +
        " or rebooting your computer. If that doesn't work, try completely uninstalling" +
        " Steam and downloading a fresh copy from steampowered.com.\n\nIf none of that works, please contact" +
        " support@choiceofgames.com and we'll try to help. (Mention error code 77779.)")
      require('electron').ipcRenderer.invoke('quit');
      return;
    }
    var adfreePurchased;
    try {
      adfreePurchased = steamworks.apps.isSubscribedApp(steamworksApps.adfree);
    } catch (e) {
      alert("There was an error connecting to Steam. Steam must be running" +
        " to play this game. If you launched this game using Steam, try restarting Steam" +
        " or rebooting your computer. If that doesn't work, try completely uninstalling" +
        " Steam and downloading a fresh copy from steampowered.com.\n\nIf none of that works, please contact" +
        " support@choiceofgames.com and we'll try to help. (Mention error code 77776.)")
      require('electron').ipcRenderer.invoke('quit');
      return;
    }
		if (window.isTrial && adfreePurchased) {
			alert("This is the demo version of the game, " +
				"but you now own the full version. The demo will now exit. Your progress has been saved." +
				" Please launch the full version of the game using Steam.");
			require('electron').ipcRenderer.invoke('quit');
    } else if (!window.isTrial && !adfreePurchased) {
      alert("There was an error connecting to Steam. Steam must be running" +
        " to play this game. If you launched this game using Steam, try restarting Steam" +
        " or rebooting your computer. If that doesn't work, try completely uninstalling" +
        " Steam and downloading a fresh copy from steampowered.com.\n\nIf none of that works, please contact" +
        " support@choiceofgames.com and we'll try to help. (Mention error code 77778.)")
      require('electron').ipcRenderer.invoke('quit');
      return;
    }
    window.isSteamDeck = !!(steamworks.utils.isSteamRunningOnSteamDeck && steamworks.utils.isSteamRunningOnSteamDeck());
		if (window.isSteamDeck) {
      window.addEventListener("DOMContentLoaded", function() {
        window.document.body.addEventListener('click', function (event) {
          if (event.target && event.target.tagName === 'A' && event.target.href !== '#') {
            event.preventDefault();
            var href = event.target.href;
            var intercepts = require('../package.json').intercepts;
            for (var intercept in intercepts) {
              if (href.startsWith(intercept)) {
                var StoreFlagNone = 0;
                console.log('activating to store');
                steamworks.overlay.activateToStore(intercepts[intercept], StoreFlagNone);
                console.log('activated');
                return;
              }
            }
            console.log('activating to web');
            steamworks.overlay.activateToWebPage(href);
            console.log('activated');
          }
        });
      })
    }
    var pollPurchases = function(oldCount) {
			var count = 0;
			for (var product in steamworksApps) {
				if (steamworks.apps.isSubscribedApp(steamworksApps[product])) {
					count++;
				}
			}
			if (count != oldCount && typeof oldCount !== "undefined") clearScreen(loadAndRestoreGame);
			safeTimeout(function() {pollPurchases(count)}, 100);
		};
		pollPurchases();

    var appIds = [];
    for (var product in steamworksApps) {
      appIds.push(steamworksApps[product]);
    }

    xhrAuthRequest("GET", "steam-price", function(ok, data) {
      if (!window.productData) window.productData = {};
      for (var product in steamworksApps) {
        window.productData[product] = data[steamworksApps[product]];
      }
      if (window.awaitSteamProductData) window.awaitSteamProductData();
    }, "user_id", steamworks.localplayer.getSteamId().steamId64, "app_ids", appIds.join(","));
	})();
}

function winStoreShareLinkHandler(e) {
    var request = e.request;
    var canonical = document.querySelector("link[rel=canonical]");
    var canonicalHref = canonical && canonical.getAttribute("href");
    if (!/^https?:/.test(canonicalHref)) {
        canonicalHref = "https://www.choiceofgames.com" + canonicalHref;
    }
    if (!/\/$/.test(canonicalHref)) {
        canonicalHref += "/";
    }
    canonicalHref += "redirect.php?src=winshare";
    request.data.properties.title = document.title;
    request.data.properties.description = document.querySelector("meta[name=description]").getAttribute("content");
    request.data.setUri(new Windows.Foundation.Uri(canonicalHref));
}

if (window.isWinStoreApp) {
    var dataTransferManager = Windows.ApplicationModel.DataTransfer.DataTransferManager.getForCurrentView();
    dataTransferManager.addEventListener("datarequested", winStoreShareLinkHandler);

    baseScript = document.createElement("script");
    baseScript.src = "//Microsoft.WinJS.1.0/js/base.js";
    baseScript.onload = function () {
        WinJS.Application.onsettings = function (e) {
            var privacyCmd = new Windows.UI.ApplicationSettings.SettingsCommand("privacy", "Privacy Policy", function () {
                window.open("https://www.choiceofgames.com/privacy-policy");
            });
            e.detail.e.request.applicationCommands.append(privacyCmd);
        };
        WinJS.Application.start();
    };
    document.head.appendChild(baseScript);

    uiScript = document.createElement("script");
    uiScript.src = "//Microsoft.WinJS.1.0/js/ui.js";
    document.head.appendChild(uiScript);
} else if (window.isWinOldApp) {
    console = {
        log: function (message) { window.external.ConsoleLog(message); },
        error: function (message) { window.external.ConsoleError(message); }
    };
    document.oncontextmenu = function() {return false;};
}

function platformCode() {
  var platform = "unknown";
  if (window.isIosApp) platform = "ios";
  else if (window.isAndroidApp) platform = "android";
  else if (window.isMacApp) platform = "mac";
  else if (window.isWinStoreApp) platform = "windows";
  else if (window.isWinOldApp) platform = "csharp";
  else if (window.isChromeApp) platform = "chrome";
  else if (window.isWebOS) platform = "palm";
  else if (window.isSteamApp) platform = "steam";
  else if (window.isCef) platform = "cef";
  else if (window.isNode) platform = "dl";
  else if (window.isWeb) platform = "web";
  if (window.isOmnibusApp) platform = "omnibus-" + platform;
  return platform;
}

function reinjectNavigator() {
  if (window.stats && window.stats.scene && window.stats.scene.nav) {
    var scene = window.stats.scene;
    scene.nav = window.nav;
    nav.repairStats(scene.stats);
  }
}

;
/*
 * Copyright 2010 by Dan Fabulich.
 *
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 *
 * See the License for the specific language governing
 * permissions and limitations under the License.
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */
function Scene(name, stats, nav, options) {
    if (!name) name = "";
    if (!stats) stats = {};
    // the name of the scene
    this.name = name;

    // the permanent statistics and the temporary values
    this.stats = stats;
    // implicit_control_flow controls whether goto is necessary to leave options (true means no)
    // _choiceEnds stores the line numbers to jump to when choice #options end.
    this.temps = {choice_reuse:"allow", choice_user_restored:false, _choiceEnds:{}, _looplimit: 1000};

    // the navigator determines which scene comes next
    this.nav = nav;

    options = options || {};

    // should we print debugging information?
    this.debugMode = options.debugMode || false;

    // used for stats screen, and maybe other secondary views someday
    this.secondaryMode = options.secondaryMode;

    this.saveSlot = options.saveSlot || "";

    // the array of lines in the scene file
    this.lines = [];

    // the current line number (WARNING 0-based!)
    this.lineNum = 0;
    this.rollbackLineCoverage();

    // when this is true, the main printLoop will halt
    this.finished = false;

    // map of label names to line numbers
    this.labels = {};

    // the current amount of indentation
    this.indent = 0;

    // Did the previous line contain text?
    this.prevLine = "empty";

    // Have we ever printed any text?
    this.screenEmpty = true;

    // Have we run any commands (except for create and scene_list) yet?
    this.initialCommands = true;

    this.stats.sceneName = name;

    // for easy reachability from the window
    this.stats.scene = this;

    // where should we print text?
    this.target = null;

    this.accumulatedParagraph = [];
}

Scene.prototype.reexecute = function reexecute() {
  this.lineNum = this.stats.testEntryPoint || 0;
  this.finished = 0;
  this.indent = this.getIndent(this.lines[this.lineNum]);
  this.prevLine = "empty";
  this.screenEmpty = true;
  this.execute();
};

// the main loop of the scene
Scene.prototype.printLoop = function printLoop() {
    var line;
    for (;!this.finished && this.lineNum < this.lines.length; this.lineNum++) {
        line = this.lines[this.lineNum];
        if (!trim(line)) {
            this.paragraph();
            continue;
        }
        var indent = this.getIndent(line);
        if (indent > this.indent) {
            // ignore indentation level of *comments
            if (/\s*\*comment\b/.test(line)) continue;
            throw new Error(this.lineMsg() + "increasing indent not allowed, expected " + this.indent + " was " + indent);
        } else if (indent < this.indent) {
            this.dedent(indent);
        }
        // Ability to end a choice #option without goto is guarded by implicit_control_flow variable
        if (this.temps._choiceEnds[this.lineNum] &&
                (this.getVar("implicit_control_flow") || this.temps._fakeChoiceDepth > 0)) {
            // Skip to the end of the choice if we hit the end of an #option
            this.rollbackLineCoverage();
            this.lineNum = this.temps._choiceEnds[this.lineNum];
            this.rollbackLineCoverage();
            if (this.temps._fakeChoiceDepth > 0) {
                this.temps._fakeChoiceDepth--;
            }
            continue;
        }
        this.indent = indent;
        if (/^\s*#/.test(line)) {
            throw new Error(this.lineMsg() + "It is illegal to fall out of a *choice statement; you must *goto or *finish before the end of the indented block.");
        }
        if (!this.runCommand(line)) {
            this.prevLine = "text";
            this.screenEmpty = false;
            this.initialCommands = false;
            this.printLine(line);
        }
    }
    this.rollbackLineCoverage();
    if (!this.finished) {
        this.autofinish();
    }
    this.save("temp");
    if (this.skipFooter) {
        this.skipFooter = false;
    } else {
        printFooter();
    }
};

Scene.prototype.dedent = function dedent(newDent) {};

Scene.prototype.printLine = function printLine(line) {
    if (!line) return null;
    this.screenEmpty = false;
    line = this.replaceVariables(line.replace(/^\s*/, ""));
    this.accumulatedParagraph.push(line);
    // insert extra space unless the line ends with hyphen or dash
    if (!/([-\u2011-\u2014]|\[c\/\])$/.test(line)) this.accumulatedParagraph.push(' ');
};

Scene.prototype.replaceVariables = function (line) {
  line = String(line);
  var replacer = /([$@](\!?\!?)\{)/;
  var index = 0;
  var output = [];
  for (var result = replacer.exec(line); result; result = replacer.exec(line.substring(index))) {
    output.push(line.substring(index, index + result.index));
    var curlies = 0;
    var closingCurly = -1;
    var exprStart = index + result.index + result[1].length;
    for (var i = exprStart; i < line.length; i++) {
      var c = line.charAt(i);
      if (c === "{") {
        curlies++;
      } else if (c === "}") {
        if (curlies) {
          curlies--;
        } else {
          closingCurly = i;
          break;
        }
      }
    }
    if (closingCurly == -1) {
      throw new Error(this.lineMsg() + "invalid "+result[0]+"} variable substitution at letter " + (index + result.index + 1));
    }
    var body = line.substring(exprStart, closingCurly);
    var stack, value;
    if (result[0].charAt(0) === "$") {
      stack = this.tokenizeExpr(body);
      value = this.evaluateExpr(stack);
    } else {
      var expr;
      var options;
      if (/^\s*\(/.test(body)) {
        var parens = 0;
        var closingParen = -1;
        for (var i = 1; i < body.length; i++) {
          var c = body.charAt(i);
          if (c === "(") {
            parens++;
          } else if (c === ")") {
            if (parens) {
              parens--;
            } else {
              closingParen = i;
              break;
            }
          }
        }
        if (closingParen == -1) {
          throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; missing closing parenthesis )");
        }
        if (body.charAt(closingParen+1) != " ") {
          throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; there should be a space after the closing parenthesis )");
        }
        expr = body.substring(1, closingParen);
        options = body.substring(closingParen+2).split("|");
      } else {
        if (!/^\S+ /.test(body)) {
          throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; there should be a space after the first word");
        }
        var spaceIndex = body.indexOf(' ');
        expr = body.substring(0, spaceIndex);
        options = body.substring(spaceIndex+1).split("|");
      }
      if (options.length < 2) {
        throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; there should be at least one pipe | to separate options");
      }
      stack = this.tokenizeExpr(expr);
      value = this.evaluateExpr(stack);
      if (typeof value === "boolean" || /^(true|false)$/i.test(value)) {
        value = bool(value) ? 1 : 2;
      }
      value = num(value, this.lineNum+1, this.name);
      if ((value | 0) !== value) {
        throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; '"+expr+"' is equal to " + value + " which is not a whole integer number");
      } else if (value < 1) {
        throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; '"+expr+"' is equal to " + value + " which is not a positive number");
      } else if (value > options.length) {
        throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; '"+expr+"' is equal to " + value + " but there are only " + options.length + " options");
      }
      value = options[value-1];
      value = this.replaceVariables(value);
    }
    var capitalize = result[2];
    if (capitalize) value = String(value);
    if (capitalize == "!") {
      value = value.charAt(0).toUpperCase() + value.slice(1);
    } else if (capitalize == "!!") {
      value = value.toUpperCase();
    }
    if (typeof highlightGenderPronouns != "undefined" && highlightGenderPronouns && /\b(he|him|his|she|her|hers)\b/gi.test(value)) {
      // this zero-width space will give us a hint for highlighting
      output.push("\u200b");
    }
    output.push(value);
    index = closingCurly+1;
  }
  if (index === 0) return line;
  output.push(line.substring(index));
  return output.join("");
};

Scene.prototype.paragraph = function paragraph() {
    printParagraph(this.accumulatedParagraph.join(""));
    this.accumulatedParagraph = [];
    this.prevLine = "empty";
};

Scene.prototype.loadSceneFast = function loadSceneFast(url) {
    if (this.loading) return;
    this.loading = true;
    var result;
    var self = this;
    if (typeof cachedResults != "undefined" && cachedResults && cachedResults[this.name]) {
      result = window.cachedResults[this.name];
      return safeTimeout(function() {self.loadLinesFast(result.crc, result.lines, result.labels);}, 0);
    } else if (typeof allScenes != "undefined") {
      result = allScenes[this.name];
      if (!result) throw new Error("Couldn't load scene '" + this.name + "'\nThe file doesn't exist.");
      return safeTimeout(function() {self.loadLinesFast(result.crc, result.lines, result.labels);}, 0);
    } else if (typeof window != "undefined" && window.isIosApp && window.isFile && !window.isOmnibusApp) {
      startLoading();
      var startedWaiting = new Date().getTime();

      function retryScenes(event, command) {
        if (!command) command = "retryscenes";
        clearScreen(function() {
          startLoading();
          if (command == "retryscenes") curl();
          window.downloadState = null;
          callIos(command);
          startedWaiting = new Date().getTime();
          awaitAllScenes();
        });
      }

      function awaitAllScenes() {
        if (typeof allScenes != "undefined") {
          result = allScenes[self.name];
          if (!result) throw new Error("Couldn't load scene '" + self.name + "'\nThe file doesn't exist.");
          self.loadLinesFast(result.crc, result.lines, result.labels);
        } else if (window.downloadState == "failed" || (new Date().getTime() - startedWaiting) > 5000) {
          doneLoading();
          if (window.downloadRequired) {
            self.printLine("We weren't able to download the latest version of the game.");
            self.paragraph();
            printButton("Try Again", main, false, retryScenes);
          } else {
            self.printLine("We weren't able to download the latest version of the game. Please try downloading again. The latest version may contain important fixes.");
            self.paragraph();
            var retry = {name: "Try downloading again."};
            var ignore = {name: "Continue playing without the latest version."}
            printOptions([""], [retry, ignore], function(option) {
              if (option == retry) {
                retryScenes();
              } else {
                retryScenes(null, "requestscenesforce");
              }
            });
          }
        } else {
          setTimeout(awaitAllScenes, 0);
        }
      }
      return awaitAllScenes();
    } else if (window.purchases[self.name] && isStoreSceneCacheRequired()) {
      var sceneName = this.name.replace(/ /g, "_");
      return window.store.get("cache_scene_hash_"+sceneName, function(ok, hash) {
        function keepScene(result) {
          if (!window.cachedResults) window.cachedResults = {};
          cachedResults[self.name] = result;
          self.loadLinesFast(result.crc, result.lines, result.labels);
        }
        function loadPaidScene() {
          startLoading();
          updateSinglePaidSceneCache(self.name, function(err, result) {
            doneLoading();
            if (err) {
              if (err === "not registered") {
                logout();
                loginDiv();
                return clearScreen(function() {
                  loginForm(main, 0/*optional*/,
                    "Please sign in to access this part of the game.", function() {
                      clearScreen(loadAndRestoreGame);
                    });
                });
              } else if (err === "not purchased") {
                window.rerestore = function () {
                  restorePurchases(window.purchases[self.name], function (purchased) {
                    window.location.reload(); 
                  });
                };
                main.innerHTML = "<div id='text'><p>Our apologies; we were unable to access your purchase while loading game data. (Error 403x)" +
                  "  Please restore purchases now; if that doesn't work, please email " + getSupportEmail() + " with details, including the error number 403x.</p>" +
                  " <p><button class='next' onclick='window.rerestore();'>Restore Now</button></p></div>";
                curl();
                return;
              } else if (/^409-/.test(err)) {
                main.innerHTML = "<div id='text'><p>There was a " + err + " error while loading game data." +
                  "  This error occurs when you've logged into this app with a different choiceofgames.com account from the account you originally used to buy the game." +
                  "  You can resolve this error by going to Settings, signing out, and signing in as the account that originally purchased the game." +
                  "  If you need additional assistance, you can email us at " + getSupportEmail() + " and mention error code " + err + ".</p>"
                curl();
                return;
              }
              main.innerHTML = "<div id='text'><p>Our apologies; there was a " + err + " error while loading game data."+
              "  Please refresh now; if that doesn't work, please click the Restart button and email "+getSupportEmail()+" with details, including the error number.</p>"+
              " <p><button class='next' onclick='window.location.reload();'>Refresh Now</button></p></div>";
              curl();
            } else {
              keepScene(result);
            }
          })
        }
        if (ok && hash == hashes.scenes[sceneName + ".txt.json"]) {
          window.store.get("cache_scene_"+sceneName, function(ok, text) {
            if (ok && text) {
              var parsed;
              try {
                parsed = jsonParse(text);
              } catch (e) {
                if (window.console) console.error(e, e.stack);
              }
              if (parsed && parsed.crc && parsed.lines && parsed.labels) return keepScene(parsed);
              loadPaidScene();
            } else {
              loadPaidScene();
            }
          })
        } else {
          loadPaidScene();
        }
      });
    }
    startLoading();
    if (!url) {
        var fileName = this.name.replace(/ /g, "_") + ".txt.json";
        url = Scene.baseUrl + "/" + fileName;
        if (window.location.protocol == "https:" && window.hashes && window.hashes.scenes[fileName]) {
          url += "?hash="+hashes.scenes[fileName];
        }
    }
    var xhr = findXhr();
    xhr.open("GET", url, true);
    var self = this;
    var done = false;
    xhr.onreadystatechange = function() {
        if (done) return;
        if (xhr.readyState != 4) return;
        if (xhr.status == 403) {
          try {
            var err = JSON.parse(xhr.responseText);
            if (err.error == "not registered") {
              return isRegistered(function(registered) {
                if (registered) {
                  logout();
                  loginDiv();
                }
                return clearScreen(function() {
                  loginForm(main, 0/*optional*/,
                    "Please sign in to access this part of the game.", function() {
                      clearScreen(loadAndRestoreGame);
                    });
                });
              });
            }
          } catch (e) {} // JSON parse failure? must not be a login prompt
        }
        done = true;

        var result;
        try {
          result = jsonParse(xhr.responseText);
        } catch (e) {
          if (window.console) console.error(e, e.stack);
        }
        if (window.isWeb && (xhr.status != 200 || !result)) {
          doneLoading();
          var status = xhr.status;
          if (status == 200 || !status) status = "network";
          main.innerHTML = "<div id='text'><p>Our apologies; there was a " + status + " error while loading game data."+
          "  Please refresh your browser now; if that doesn't work, please click the Restart button and email "+getSupportEmail()+" with details.</p>"+
          " <p><button onclick='window.location.reload();'>Refresh Now</button></p></div>";
          curl();
          return;
        } else if (xhr.responseText === "") {
          throw new Error("Couldn't load " + url + "\nThe file is probably missing or empty.");
        }

        if (!window.cachedResults) window.cachedResults = {};
        cachedResults[self.name] = result;
        self.loadLinesFast(result.crc, result.lines, result.labels);
    };
    if (isIE) {
      // IE8 swallows errors in onreadystatechange if xhr.send is in a try block
      xhr.send(null);
    } else {
      try {
        xhr.send(null);
      } catch (e) {
        if (window.location.protocol == "file:" && !window.isMobile) {
          if (/Chrome/.test(navigator.userAgent)) {
            window.reportError("We're sorry, Google Chrome has blocked ChoiceScript from functioning.  (\"file:\" URLs cannot "+
            "load files in Chrome.)  ChoiceScript works just fine in Chrome, but only on a published website like "+
            "choiceofgames.com.  For the time being, please try another browser like Mozilla Firefox.");
            return;
          }
        }
        window.reportError("Couldn't load URL: " + url + "\n" + e);
      }
    }
};

Scene.prototype.loadLinesFast = function loadLinesFast(crc, lines, labels) {
  this.crc = crc;
  this.lines = lines;
  this.labels = labels;
  this.loading = false;
  this.loaded = true;
  var self = this;
  if (this.executing) {
    safeCall(this, function() {
      doneLoading();
      self.execute();
    });
  }
};

// load the scene file from the specified URL (or from default URL by name)
Scene.prototype.loadScene = function loadScene() {
    if (this.loading) return;
    this.loading = true;
    if (window.isFile) return this.loadFile();
    startLoading();
    var url = Scene.baseUrl + "/" + this.name + ".txt";
    var xhr = findXhr();
    xhr.open("GET", url, true);
    var self = this;
    var done = false;
    xhr.onreadystatechange = function() {
        if (done) return;
        if (xhr.readyState != 4) return;
        done = true;
        if (xhr.status == 403) {
          try {
            var err = JSON.parse(xhr.responseText);
            if (err.error == "not registered") {
              return isRegistered(function(registered) {
                if (registered) {
                  logout();
                  loginDiv();
                }
                return clearScreen(function() {
                  loginForm(main, 0/*optional*/,
                    "Please sign in to access this part of the game.", function() {
                      clearScreen(loadAndRestoreGame);
                    });
                });
              });
            }
          } catch (e) {} // JSON parse failure? must not be a login prompt
        }
        if (window.isWeb && xhr.status != 200) {
            var status = xhr.status || "network";
            main.innerHTML = "<p>Our apologies; there was a " + status + " error while loading game data."+
            "  Please refresh your browser now; if that doesn't work, please email "+getSupportEmail()+" with details.</p>"+
            " <p><button onclick='window.location.reload();'>Refresh Now</button></p>";
            return;
        } else if (xhr.responseText === "") {
          if (window.location.protocol == "file:" && !window.isMobile && /Chrome/.test(navigator.userAgent)) {
            window.reportError("We're sorry, Google Chrome has blocked ChoiceScript from functioning.  (\"file:\" URLs cannot "+
            "load files in Chrome.)  ChoiceScript works just fine in Chrome, but only on a published website like "+
            "choiceofgames.com.  For the time being, please try another browser like Mozilla Firefox.");
            return;
          } else {
            window.reportError("Couldn't load " + url + "\nThe file is probably missing or empty.");
            return;
          }
        }
        var result = xhr.responseText;
        scene = result;
        scene = scene.replace(/\r/g, "");
        this.loading = false;
        self.loadLines(scene);
        if (self.executing) {
            safeCall(self, function () {
              doneLoading();
              self.execute();
            });
        }
    };
    if (isIE) {
      // IE8 swallows errors in onreadystatechange if xhr.send is in a try block
      xhr.send(null);
    } else {
      try {
        xhr.send(null);
      } catch (e) {
        if (window.location.protocol == "file:" && !window.isMobile) {
          if (/Chrome/.test(navigator.userAgent)) {
            window.reportError("We're sorry, Google Chrome has blocked ChoiceScript from functioning.  (\"file:\" URLs cannot "+
            "load files in Chrome.)  ChoiceScript works just fine in Chrome, but only on a published website like "+
            "choiceofgames.com.  For the time being, please try another browser like Mozilla Firefox.");
            return;
          } else if (e.code === 1012 /*NS_ERROR_DOM_BAD_URI*/) {
            window.reportError("Couldn't load scene file: " + url + "\nThe file is probably missing.");
            return;
          }
        }
        window.reportError("Couldn't load URL: " + url + "\n" + e);
      }
    }
};

Scene.prototype.loadFile = function loadFile() {
  var _this = this;
  if (typeof uploadedFiles !== "object") {
    clearScreen(function() {
      var header = document.getElementById('header');
      if (header) header.style.display = "none";
      var makeYourOwnGames = document.getElementById('makeyourowngames');
      if (makeYourOwnGames) makeYourOwnGames.style.display = "none";
      _this.printLine("[b]Please \"Upload\" ChoiceScript[/b]");
      _this.paragraph();
      _this.printLine("To begin, you'll need to grant permission to \"upload\" your choicescript folder containing index.html.")
      _this.paragraph();
      _this.printLine("Use the button below to select your choicescript folder.");
      _this.paragraph();
      var text = document.getElementById('text');
      var input = document.createElement('input');
      input.type = 'file';
      input.webkitdirectory = true;
      input.multiple = true;
      input.addEventListener('change', function searchForStartup(e) {
        var numFiles = input.files.length;
        var startupCandidates = [];
        for (var i = 0; i < numFiles; i++) {
          var file = input.files[i];
          if (file.name === "startup.txt") {
            startupCandidates.push(file);
          }
        }
        if (!startupCandidates.length) {
          return clearScreen(function() {
            _this.printLine("We couldn't find startup.txt in the folder you chose. Please try again.")
            _this.paragraph();
            document.getElementById('text').appendChild(input);
            curl();
          });
        }

        if (startupCandidates.length > 1) {
          return clearScreen(function() {
            _this.printLine("There were multiple files called startup.txt in the folder you chose. Please try again.");
            _this.paragraph();
            for (var i = 0; i < startupCandidates.length; i++) {
              _this.printLine("\u2022 " + startupCandidates[i].webkitRelativePath);
            }
            _this.paragraph();
            document.getElementById('text').appendChild(input);
            curl();
          });
        }

        var startup = startupCandidates[0];
        var rootDirTest = new RegExp("^" + startup.webkitRelativePath.replace(/\/startup.txt$/, "/[^/]+$"));
        var sceneFiles = {};
        for (var i = 0; i < numFiles; i++) {
          var file = input.files[i];
          if (rootDirTest.test(file.webkitRelativePath)) {
            sceneFiles[file.name] = file;
          }
        }
        window.uploadedFiles = sceneFiles;
        if (header) header.style.display = "";
        if (makeYourOwnGames) makeYourOwnGames.style.display = "";
        clearScreen(function() {
          _this.loadFile();
        });
      });
      text.appendChild(input);
      _this.paragraph();
      _this.printLine("(We're not actually going to transfer your code over the Internet, " +
        "but this web page needs permission to upload your choicescript folder in order to access " +
        "your code and run it. The power to access your code would also grant us the power to " +
        "transfer your code elsewhere, but we're not going to do that. JavaScript programmers " +
        "can read our JavaScript to verify that this is true.)");
      _this.paragraph();
      curl();
    });
  } else {
    var fileName = this.name + ".txt";
    if (uploadedFiles[fileName]) {
      startLoading();
      new Response(uploadedFiles[fileName]).text().then(function(result) {
        scene = result;
        scene = scene.replace(/\r/g, "");
        _this.loading = false;
        safeCall(_this, function() {
          _this.loadLines(scene);
          doneLoading();
          _this.execute();
        });
      });
    } else {
      for (var otherFileName in uploadedFiles) {
        if (fileName.toLowerCase() === otherFileName.toLowerCase()) {
          main.innerHTML = "<p>Couldn't find "+fileName+" in the uploaded folder, but we did find "+otherFileName+". Scene file names must match exactly, including capitalization.</p>"+
          " <p><button onclick='window.location.reload();'>Refresh Now</button></p>";
          curl();
          return;
        }
      }
      main.innerHTML = "<p>Couldn't find "+fileName+" in the uploaded folder.</p>"+
        " <p><button onclick='window.location.reload();'>Refresh Now</button></p>";
      curl();
    }
  }
}

Scene.prototype.checkSum = function checkSum() {
  if (this.temps.choice_crc) {
    if (!this.randomtest && !this.quicktest && this.temps.choice_crc != this.crc && this.lineNum) {
      // The scene has changed; restart the scene from backup
      if (typeof alertify !== 'undefined') {
        if (!initStore()) {
          alertify.log(this.name + ".txt has updated. Restarting chapter.");
        } else {
          alertify.log("The game has updated. Restarting chapter.");
        }
      }
      var self = this;
      safeTimeout(function () {
        clearScreen(function () {
          loadAndRestoreGame("backup");
        });
      }, 0);
      return false;
    }
  }
  this.temps.choice_crc = this.crc;
  return true;
};

Scene.prototype.loadLines = function loadLines(str) {
    this.crc = crc32(str);
    this.lines = str.split(/\r?\n/);
    this.parseLabels();
    this.loaded = true;
};

// launch the vignette as soon as it's available
Scene.prototype.execute = function execute() {
    if (!this.loaded) {
        this.executing = true;
        if (Scene.generatedFast || (typeof generatedFast != "undefined" && generatedFast) || typeof allScenes != 'undefined') {
          this.loadSceneFast();
        } else {
          this.loadScene();
        }
        return;
    }
    if (!this.checkSum()) {
      return;
    }
    if (this.nav) this.nav.repairStats(stats);
    if (!this.temps._choiceEnds) this.temps._choiceEnds = {};
    doneLoading();
    if (typeof this.targetLabel != "undefined") {
      var label = this.targetLabel.label.toLowerCase();
      if (typeof(this.labels[label]) != "undefined") {
          this.lineNum = this.labels[label];
          this.indent = this.getIndent(this.lines[this.lineNum]);
          delete this.targetLabel;
      } else {
          throw new Error(this.targetLabel.origin + " line " + (this.targetLabel.originLine+1) + ": "+this.name+" doesn't contain label " + label);
      }
    }
    // this backup slot will only be used when the scene crc changes during upgrades
    if (!this.lineNum) {
      var subsceneStack = this.stats.choice_subscene_stack || [];
      if (!subsceneStack.length) this.save("backup");
    }
    if (this.redirectingFromStats) {
      this.save("");
      delete this.redirectingFromStats;
    }
    this.printLoop();
};

// loop through the file looking for *label commands
Scene.prototype.parseLabels = function parseLabels() {
    var lineLength = this.lines.length;
    var oldLineNum = this.lineNum;
    var screenshots = ("choicescript_screenshots" == this.name);
    var seenChoiceWithoutSet = 0;
    for (this.lineNum = 0; this.lineNum < lineLength; this.lineNum++) {
        this.rollbackLineCoverage();
        var line = this.lines[this.lineNum];
        // strip byte order mark
        if (this.lineNum == 0 && line.charCodeAt(0) == 65279) lines[0] = line.substring(1);
        var invalidCharacter = line.match(/^(.*)\ufffd/);
        if (invalidCharacter) throw new Error(this.lineMsg() + "invalid character. (ChoiceScript text should be saved in the UTF-8 encoding.) " + invalidCharacter[0]);
        var result = /^(\s*)\*(\w+)(.*)/.exec(line);
        if (!result) continue;
        var indentation = result[1];
        var indent = indentation.length;
        var command = result[2].toLowerCase();
        var data = trim(result[3]);
        if ("label" == command) {
            data = data.toLowerCase();
            if (/\s/.test(data)) throw new Error(this.lineMsg() + "label '"+data+"' is not allowed to contain spaces");
            if (this.labels.hasOwnProperty(data)) {
              throw new Error(this.lineMsg() + "label '"+data+"' already defined on line " + (this.labels[data]*1+1));
            }
            this.labels[data] = this.lineNum;
        } else if (screenshots) {
          if ("fake_choice" == command) {
            if (seenChoiceWithoutSet) throw new Error(this.lineMsg() +
              "In choicescript_screenshots, you need to *set at least one variable between *fake_choice commands, so the stat screen looks interesting. " +
              "There was no *set since the last *fake_choice on line " + seenChoiceWithoutSet + ".");
            seenChoiceWithoutSet = this.lineNum+1;
          } else if ("set" == command) {
            seenChoiceWithoutSet = 0;
          }
        }
    }
    this.rollbackLineCoverage();
    this.lineNum = oldLineNum;
};

// if this is a command line, run it
Scene.prototype.runCommand = function runCommand(line) {
    var result = /^\s*\*(\w+)(.*)/.exec(line);
    if (!result) {
      if (this.secondaryMode == "startup" && this.startupCallback) {
        this.finished = true;
        this.skipFooter = true;
        this.startupCallback();
        return true;
      }
      return false;
    }
    var command = result[1].toLowerCase();
    var data = trim(result[2]);
    if (Scene.validCommands[command]) {
        if ("comment" == command) return true;
        if (Scene.initialCommands[command]) {
          if ("startup" != String(this.name).toLowerCase() || !this.initialCommands) {
            throw new Error(this.lineMsg() + "Invalid "+command+" instruction, only allowed at the top of startup.txt");
          }
        } else {
          if (this.secondaryMode == "startup" && this.startupCallback) {
            this.finished = true;
            this.skipFooter = true;
            this.startupCallback();
            return true;
          }
          // if we're here, we're running a non-initial command
          // except, *bug choice_beta can appear in the initial commands
          if (command !== 'bug') this.initialCommands = false;
        }
        if (command == "choice" && String(this.name).toLowerCase() == "choicescript_screenshots") {
          throw new Error(this.lineMsg() + "choicescript_screenshots files should only contain *fake_choice commands, not real *choice commands");
        }
        this[command](data);
    } else {
        throw new Error(this.lineMsg() + "Non-existent command '"+command+"'");
    }
    return true;
};

// *choice [group1] [group2] ...
// prompt the user with a multiple choice question.
// nested lines are options to be presented to the user
//
// Examples:
// *choice
//    good
//      Good choice
//      *finish
//    bad
//      Bad choice
//      *finish
//
// *choice toy
//    spaceship
//      Nice spaceship
//      *finish
//    train
//      Nice train
//      *finish
//    doll
//      Nice doll
//      *finish
//
// *choice color toy
//    red
//      spaceship
//        Nice red spaceship
//        *finish
//      train
//        Nice red train
//        *finish
//    blue
//       spaceship
//         Nice blue spaceship
//        *finish
//       train
//         Nice red train
//        *finish

// If a group is specified, generate a prompt message, e.g. "*choice toy" -> "Select a toy:"
// If no group is specified, don't generate a prompt message
// if multiple groups are specified, allow the user to make multiple choices simultaneously
//   all multi-dimensional choices must be valid (otherwise throw a parse error)
Scene.prototype.choice = function choice(data) {
    var startLineNum = this.lineNum;
    var groups = data.split(/ /);
    for (var i = 0; i < groups.length; i++) {
      if (!/^\w*$/.test(groups[i])) {
        throw new Error(this.lineMsg() + "invalid choice group name: " + groups[i]);
      }
    }
    var options = this.parseOptions(this.indent, groups);
    var self = this;
    this.renderOptions(groups, options, function(option) {
      self.standardResolution(option);
    });
    this.finished = true;
    if (this.temps._fakeChoiceDepth > 0 || this.getVar("implicit_control_flow")) {
      if (!this.temps._choiceEnds) {
        this.temps._choiceEnds = {};
      }
      for (i = 0; i < options.length; i++) {
        this.temps._choiceEnds[options[i].line-1] = this.lineNum;
      }
    }
    this.lineNum = startLineNum;
};

Scene.prototype.fake_choice = function fake_choice(data) {
    if (this.temps._fakeChoiceDepth === undefined) {
        this.temps._fakeChoiceDepth = 0;
    }
    this.temps._fakeChoiceDepth++;
    this.choice(data);
};

Scene.prototype.standardResolution = function(option) {
  var self = this;
  trackEvent('game_choice', {
    choice_file: this.name,
    choice_line: option.line + 1,
  });
  self.lineNum = option.line;
  self.indent = self.getIndent(self.nextNonBlankLine(true/*includingThisOne*/));
  if (option.reuse && option.reuse != "allow") self.temps.choice_used[option.line-1] = 1;
  if (this.nav) this.nav.bugLog.push("#"+(option.line+1) + " " + option.name);

  self.finished = false;
  self.resetPage();
};

Scene.prototype.nextNonBlankLine = function nextNonBlankLine(includingThisOne) {
    var line;
    var i = this.lineNum;
    if (!includingThisOne) i++;
    while(isDefined(line = this.lines[i]) && !trim(line)) {
      i++;
    }
    return line;
};

Scene.prototype.previousNonBlankLineNum = function previousNonBlankLineNum() {
  var line;
  var i = this.lineNum - 1;
  while(isDefined(line = this.lines[i]) && !trim(line)) {
    i--;
  }
  return i;
};


Scene.prototype.resetCheckedPurchases = function resetCheckedPurchases() {
  for (var temp in this.temps) {
    if (/^choice_purchased/.test(temp)) {
      delete this.temps[temp];
    }
  }
};

// reset the page and invoke code after clearing the screen
Scene.prototype.resetPage = function resetPage() {
    var self = this;
    this.resetCheckedPurchases();
    clearScreen(function() {
      // save in the background, eventually
      self.save("");
      self.prevLine = "empty";
      self.screenEmpty = true;
      self.execute();
    });
};

/* The function needs some explaining.
We want the game to be "refreshable," e.g. on the web.
So we only make a "real" autosave as you click "Next"
But if we do it that way, when we visit the stat screen, it's out of date
So we make a "temp" autosave slot, right as the page finishes redrawing,
and the stat screen uses the "temp" autosave to display your current data.
When you refresh the page, the "temp" autosave is rewritten.

If you save stats on the stat screen, they're written into tempStatWrites;
when the stat screen saves, we transfer tempStatWrites back to the main
game (if the main game is running in a separate iframe, e.g. iOS).

If the main game is about to write the main "" slot, we merge the temp
stat writes into the main stats (and clear the stat writes) before
saving.

Thus, stat changes on the stat screen will only be permanently saved when
the player clicks "Next" in the main game, ensuring that the game is still
refreshable.
*/
Scene.prototype.save = function save(slot) {
    if (this.saveSlot) {
      transferTempStatWrites();
    } else {
      if (!slot) {
        slot = "";
        for (var key in tempStatWrites) {
          if (tempStatWrites.hasOwnProperty(key)) {
            this.stats[key] = tempStatWrites[key];
          }
        }
        tempStatWrites = {};
      }

      saveCookie(function() {}, slot, this.stats, this.temps, this.lineNum, this.indent);
    }
};

// *goto labelName
// Go to the line labeled with the label command *label labelName
//
// goto by reference
//   *create foo "labelName"
//   *goto {foo}
Scene.prototype["goto"] = function scene_goto(line) {
    var label;
    if (/[\[\{]/.test(line)) {
      label = this.evaluateReference(this.tokenizeExpr(line));
    } else {
      label = String(line).toLowerCase();
    }
    if (typeof(this.labels[label]) != "undefined") {
        this.lineNum = this.labels[label];
        this.indent = this.getIndent(this.lines[this.lineNum]);
    } else {
        throw new Error(this.lineMsg() + "bad label " + label);
    }
    if (!this.localCoverage) this.localCoverage = {};
    if (this.localCoverage[this.lineNum]) {
        this.localCoverage[this.lineNum]++;
        if (this.temps._looplimit && this.localCoverage[this.lineNum] > this.temps._looplimit) {
            throw new Error(this.lineMsg() + "visited this line too many times (" + this.temps._looplimit + ")");
        }
    } else {
        this.localCoverage[this.lineNum] = 1;
    }
};

Scene.prototype.gosub = function scene_gosub(data) {
    var label = /\S+/.exec(data)[0];
    var rest = data.substring(label.length+1);
    var args = [];
    var stack = this.tokenizeExpr(rest);
    while (stack.length) {
      args.push(this.evaluateValueToken(stack.shift(), stack));
    }
    if (!this.temps.choice_substack) {
      this.temps.choice_substack = [];
    }
    this.temps.choice_substack.push({lineNum: this.lineNum, indent: this.indent});
    // Works exactly the same as gosub_scene, putting args in this.temps.param.
    // This means there's no notion of scope - param acts more like "registers" that
    // get clobbered the next time a sub is called.
    // This may be more intuitive to non-programmers than idea of scope?  Especially
    // if temp normally doesn't follow scoping rules.  gosub_scene can serve this function anyway.
    // The params can be retrieved and put in named temps with "params" command.
    this.temps.param = args;
    this["goto"](label);
};

Scene.prototype.gosub_scene = function scene_gosub_scene(data) {
    if (!this.stats.choice_subscene_stack) {
      this.stats.choice_subscene_stack = [];
    }
    this.stats.choice_subscene_stack.push({name:this.name, lineNum: this.lineNum + 1, indent: this.indent, temps: this.temps});
    this.goto_scene(data, true /*isGosubScene*/);
};

Scene.prototype.params = function scene_params(data) {
    // Name the parameters passed by gosub/gosub_scene.
    // Rules should be the same as for "create."
    // All parameters, even those not named, exposed as param_1, param_2 etc.
    var words = /\w+/.exec(data);
    var nextParamNum = 1;
    this.temps.param_count = this.temps.param.length;
    while (words) {
        var varName = words[0].toLowerCase();
        this.validateVariable(varName);
        if (this.temps.param.length < 1) {
            throw new Error(this.lineMsg() + "No parameter passed for " + varName);
        }
        var paramVal = this.temps.param.shift();
        this.temps[varName] = paramVal;
        this.temps["param_" + nextParamNum] = paramVal;
        nextParamNum++;
        data = data.substring(varName.length+1);
        words = /\w+/.exec(data);
    }
    // All remaining params are anonymous, but you still have to say "params"
    // if you want any of them.
    while (this.temps.param.length > 0) {
        var paramVal = this.temps.param.shift();
        this.temps["param_" + nextParamNum] = paramVal;
        nextParamNum++;
    }
};

Scene.prototype["return"] = function scene_return() {
    var stackFrame;
    if (this.temps.choice_substack && this.temps.choice_substack.length) {
      stackFrame = this.temps.choice_substack.pop();
      this.lineNum = stackFrame.lineNum;
      this.indent = stackFrame.indent;
    } else if (this.stats.choice_subscene_stack && this.stats.choice_subscene_stack.length) {
      stackFrame = this.stats.choice_subscene_stack.pop();
      if (stackFrame.name == this.name) {
        this.temps = stackFrame.temps;
        this.lineNum = stackFrame.lineNum-1;
        this.indent = stackFrame.indent;
        return;
      }
      this.finished = true;
      this.skipFooter = true;
      var scene = new Scene(stackFrame.name, this.stats, this.nav, {debugMode:this.debugMode, secondaryMode:this.secondaryMode, saveSlot:this.saveSlot});
      scene.temps = stackFrame.temps;
      scene.screenEmpty = this.screenEmpty;
      scene.prevLine = this.prevLine;
      scene.lineNum = stackFrame.lineNum;
      scene.indent = stackFrame.indent;
      scene.accumulatedParagraph = this.accumulatedParagraph;
      if (this.randomtest) {
        // pop the stack in randomtest to avoid overflow
        clearScreen(function() {scene.execute()});
      } else {
        scene.execute();
      }
    } else if (!this.temps.choice_substack && !this.stats.choice_subscene_stack) {
      throw new Error(this.lineMsg() + "invalid return; gosub has not yet been called");
    } else {
      throw new Error(this.lineMsg() + "invalid return; we've already returned from the last gosub");
    }

};

// *gotoref expression
// Go to the label identified by the expression
//
// *temp foo
// *set foo "bar"
// *gotoref foo
// Skipped!
// *label bar
Scene.prototype["gotoref"] = function scene_gotoref(expression) {
    var stack = this.tokenizeExpr(expression);
    var value = this.evaluateExpr(stack);
    this["goto"](value);
};


// *finish
// halt the scene
Scene.prototype.finish = function finish(buttonName) {
    this.paragraph();
    this.finished = true;
    var self = this;
    if (this.secondaryMode == "stats") {
      if (typeof window == "undefined") return;
      // In iPad app, the stats screen is always visible
      if (window.isIosApp && window.isIPad) return;

      if (this.screenEmpty) {
        returnFromStats();
        return;
      }
      if (!buttonName) buttonName = "Next";
      buttonName = this.replaceVariables(buttonName);
      printButton(buttonName, main, false,
        function() {
          returnFromStats();
        }
      );
      return;
    }
    var nextSceneName = this.nav && nav.nextSceneName(this.name);
    // if there are no more scenes, then just halt
    if (!nextSceneName) {
        if (!this.secondaryMode) this.ending();
        return;
    }
    if (this.screenEmpty) {
      this.goto_scene(nextSceneName);
      return;
    }
    if (!buttonName) buttonName = "Next Chapter";
    buttonName = this.replaceVariables(buttonName);


    printButton(buttonName, main, false,
      function() {
        safeCall(self, function() {
            var scene = new Scene(nextSceneName, self.stats, self.nav, {debugMode:self.debugMode, secondaryMode:self.secondaryMode});
            scene.resetPage();
        });
      }
    );
    if (this.debugMode) println(computeCookie(this.stats, this.temps, this.lineNum, this.indent));
};

Scene.prototype.autofinish = function autofinish(buttonName) {
  this.finish(buttonName);
};

// *reset
// clear all stats
Scene.prototype.reset = function reset() {
    this.nav.resetStats(this.stats);
    this.stats.scene = this;
};

Scene.prototype.parseGotoScene = function parseGotoScene(data) {
  var sceneName, label, param = [], stack;

  if (/[\[\{]/.test(data)) {
    stack = this.tokenizeExpr(data);
    sceneName = this.evaluateReference(stack, {toLowerCase: false});
    // Labels are required for arguments to avoid ambiguity
    if (stack.length) {
      label = this.evaluateReference(stack);
    }
    while (stack.length) {
      // Arguments when treating gosub_scene like a function call
      param.push(this.evaluateValueToken(stack.shift(), stack));
    }
  } else {
    // scenes and labels can contain hyphens and other non-expression punctuation
    // so we'll try to extract the first two words as the scene and label
    var match = /(\S+)\s+(\S+)\s*(.*)/.exec(data);
    if (match) {
      sceneName = match[1];
      label = match[2];
      stack = this.tokenizeExpr(match[3]);
      while (stack.length) {
        // Arguments when treating gosub_scene like a function call
        param.push(this.evaluateValueToken(stack.shift(), stack));
      }
    } else {
      if (data === "") throw new Error(this.lineMsg() + "missing scene name");
      sceneName = data;
    }
  }
  return {sceneName:sceneName, label:label, param:param};
};

// *goto_scene foo
//
Scene.prototype.goto_scene = function gotoScene(data, isGosubScene) {
    if (!isGosubScene && (this.stats.choice_subscene_stack || []).length) {
      var stackFrame = this.stats.choice_subscene_stack.pop();
      this.warning("You should *return before *goto_scene after *gosub_scene from from " + stackFrame.name + " line " + stackFrame.lineNum);
      delete this.stats.choice_subscene_stack;
    }
    var result = this.parseGotoScene(data);

    if (result.sceneName == this.name) {
      if (typeof result.label === "undefined") {
        this.lineNum = -1; // the printLoop will increment the line number to 0
      } else {
        this["goto"](result.label);
      }
      this.temps = {choice_reuse:"allow", choice_user_restored:false, _choiceEnds:{}};
      this.temps.param = result.param;
      this.initialCommands = true;
      return;
    }

    this.finished = true;
    this.skipFooter = true;
    var scene = new Scene(result.sceneName, this.stats, this.nav, {debugMode:this.debugMode, secondaryMode:this.secondaryMode, saveSlot:this.saveSlot});
    scene.screenEmpty = this.screenEmpty;
    scene.prevLine = this.prevLine;
    scene.accumulatedParagraph = this.accumulatedParagraph;
    if (typeof result.label != "undefined") scene.targetLabel = {label:result.label, origin:this.name, originLine:this.lineNum};
    if (typeof result.param != "undefined") scene.temps.param = result.param;
    if (this.redirectingFromStats) scene.redirectingFromStats = true;
    scene.execute();
};

// *redirect_scene foo
Scene.prototype.redirect_scene = function redirectScene(data) {
  if (this.secondaryMode != "stats") throw new Error(this.lineMsg() + "The *redirect_scene command can only be used from the stats screen.");
  var result = this.parseGotoScene(data);
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  redirectFromStats(result.sceneName, result.label, this.lineNum, function() {
    delete self.secondaryMode;
    delete self.saveSlot;
    self.redirectingFromStats = true;
    self.goto_scene(data);
  });
};

Scene.prototype.product = function product(productId) {
  if (!/^[a-z]+$/.test(productId)) throw new Error(this.lineMsg()+"Invalid product id (only lowercase letters, no numbers or punctuation): " +productId);
  if (this.nav) this.nav.products[productId] = {};
}

Scene.prototype.restore_purchases = function scene_restorePurchases(data) {
  var self = this;
  var target = this.target;
  if (!target) target = document.getElementById('text');
  var button = printButton("Restore Purchases", target, false,
    function() {
      safeCall(self, function() {
          restorePurchases(null, function() {
            self["goto"](data);
            self.finished = false;
            self.resetPage();
          });
      });
    }
  );

  setClass(button, "");
  this.prevLine = "block";
};

Scene.prototype.check_purchase = function scene_checkPurchase(data) {
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  var productList = data.split(/ /);
  for (var i = 0; i < productList.length; i++) {
    var product = productList[i];
    if (!this.nav.products[product] && product != "adfree") {
      throw new Error(this.lineMsg() + "The product " + product + " wasn't declared in a *product command");
    }
  }
  checkPurchase(data, function(ok, result) {
    self.finished = false;
    self.skipFooter = false;
    if (!ok) {
      result = {billingSupported:true};
      self.temps.choice_purchase_error = true;
    }
    result = result || {};
    var products = data.split(/ /);
    var everything = true;
    for (var i = 0; i < products.length; i++) {
      var purchasedProduct = result[products[i]] || false;
      self.temps["choice_purchased_"+products[i]] = purchasedProduct;
      if (!purchasedProduct) everything = false;
    }
    self.temps.choice_purchased_everything = everything;
    self.temps.choice_purchase_supported = !!result.billingSupported;
    self.execute();
  });
};

Scene.prototype.parsePurchase = function parsePurchase(data) {
  var result;
  if (/^\{/.test(data)) {
    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error(this.lineMsg() + "Couldn't parse purchase JSON: " + e)
    }
    if (!result.product) {
      throw new Error(this.lineMsg() + "JSON missing product");
    }
    if (!result['goto']) {
      throw new Error(this.lineMsg() + "JSON missing goto");
    }
    if (result.priceGuess && result.discount) {
      throw new Error(this.lineMsg() + "JSON has both top-level priceGuess and discount; there should be one or the other");
    }
    if (!(result.priceGuess || result.discount)) {
      throw new Error(this.lineMsg() + "JSON has neither top-level priceGuess nor discount; there should be one or the other");
    }
    if (result.discount) {
      if (!result.discount.end) throw new Error(this.lineMsg() + "JSON discount doesn't include end");
      result.discount.end = parseDateStringInCurrentTimezone(result.discount.end, this.lineNum + 1);
      if (!result.discount.lowPrice) throw new Error(this.lineMsg() + "JSON discount doesn't include lowPrice");
      if (!/^\$/.test(result.discount.lowPrice)) throw new Error(this.lineMsg() + "lowPrice " + fullPriceGuess + "doesn't start with dollar");
      if (!result.discount.fullPrice) throw new Error(this.lineMsg() + "JSON discount doesn't include fullPrice");
      if (!/^\$/.test(result.discount.fullPrice)) throw new Error(this.lineMsg() + "fullPrice " + fullPriceGuess + "doesn't start with dollar");
    }
    if (!result.title) result.title = "It";
  } else {
    var parsed = /^(\w+)\s+(\S+)\s+(.*)/.exec(data);
    if (!parsed) throw new Error(this.lineMsg() + "invalid line; can't parse purchaseable product: " + data);
    result = {product: parsed[1], priceGuess: parsed[2], "goto": parsed[3], title: "It"};
  }
  return result;
}

Scene.prototype.purchase = function purchase(data) {
  var parsed = this.parsePurchase(data);
  if (parsed.discount) {
    this.buyButtonDiscount(parsed.product, parsed.discount.end, parsed.discount.fullPrice, parsed.discount.lowPrice, parsed['goto'], parsed.title);
  } else {
    this.buyButton(parsed.product, parsed.priceGuess, parsed['goto'], parsed.title);
  }
}

Scene.prototype.buyButton = function(product, priceGuess, label, title) {
  if (label && typeof this.temps["choice_purchased_" + product] === "undefined") {
    throw new Error(this.lineMsg() + "Didn't check_purchases on this page");
  }
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  var purchaseFinished = function() {
    if (label) self["goto"](label);
    self.finished = false;
    self.skipFooter = false;
    self.resetPage();
  }
  getPrice(product, function (price) {
    if (!price || "free" == price) {
      purchaseFinished();
    } else {
      if (price == "guess") price = priceGuess + " USD";
      var prerelease = self.getVar('choice_prerelease');
      var buttonText;
      if (prerelease) {
        buttonText = "Pre-Order " + title;
      } else {
        buttonText = "Buy "+title+" Now";
      }
      if (price != "hide") {
        buttonText += " for " + price;
      }
      var target = self.target;
      if (!target) target = document.getElementById('text');
      self.paragraph();
      var button = printButton(buttonText, target, false,
        function() {
          safeCall(self, function() {
              purchase(product, function() {
                safeCall(self, purchaseFinished);
              });
          });
        }
      );
      self.prevLine = "block";
      if (isRestorePurchasesSupported()) {
        self.prevLine = "text";
        printLink(printParagraph("If you've already purchased, click here to "), "#", "restore purchases",
          function(e) {
            preventDefault(e);
            safeCall(self, function() {
                restorePurchases(product, function(purchased) {
                  if (purchased) {
                    purchaseFinished();
                  } else {
                    // refresh, in case we're on web showing a full-screen login. Not necessary on mobile? But, meh.
                    clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
                  }
                });
            });
          }
        );
      }

      if (label) {
        self.skipFooter = false;
        self.finished = false;
        self.execute();
      }
    }
  });
};

Scene.prototype.purchase_discount = function purchase_discount(line) {
  this.paragraph();
  var args = trim(String(line)).split(" ");
  if (args.length != 5) throw new Error(this.lineMsg() + "expected five arguments, saw "+args.length+": " + line);
  var product = args[0];
  var expectedEndDateString = args[1];
  var expectedEndDate = parseDateStringInCurrentTimezone(expectedEndDateString, this.lineNum+1);
  var fullPriceGuess = this.replaceVariables(args[2]);
  var discountedPriceGuess = this.replaceVariables(args[3]);
  var label = args[4];
  var startsWithDollar = /^\$/;
  if (!startsWithDollar.test(fullPriceGuess)) {
    throw new Error(this.lineMsg() + "full price guess "+fullPriceGuess+"doesn't start with dollar: " + line);
  }
  if (!startsWithDollar.test(discountedPriceGuess)) {
    throw new Error(this.lineMsg() + "discounted price guess "+discountedPriceGuess+"doesn't start with dollar: " + line);
  }
  var title = "It";
  this.buyButtonDiscount(product, expectedEndDate, fullPriceGuess, discountedPriceGuess, label, title);
}

Scene.prototype.buyButtonDiscount = function buyButtonDiscount(product, expectedEndDate, fullPriceGuess, discountedPriceGuess, label, title) {
  var prerelease = this.getVar('choice_prerelease');
  var discountText;
  if (prerelease) {
    discountText = "[b]Buy now before the price increases![/b]";
  } else {
    discountText = "[b]On sale until "+shortMonthStrings[expectedEndDate.getMonth()+1]+" "+expectedEndDate.getDate()+"! Buy now before the price increases![/b]"
  }
  if (typeof printDiscount != "undefined") {
    printDiscount(product, expectedEndDate.getYear()+1900, expectedEndDate.getMonth()+1, expectedEndDate.getDate(), discountText);
  }
  var priceGuess;
  if (new Date().getTime() < expectedEndDate.getTime()) {
    priceGuess = discountedPriceGuess;
  } else {
    priceGuess = fullPriceGuess;
  }
  this.buyButton(product, priceGuess, label, title);
}

Scene.prototype.print_discount = function print_Discount(line) {
  var result = /(\w+) (\d{4})-(\d{2})-(\d{2}) (.*$)/.exec(line);
  if (!result) throw new Error("invalid discount: " + line);
  var product = result[1];
  var fullYear = result[2];
  var oneBasedMonthNumber = parseInt(result[3],10);
  var dayOfMonth = parseInt(result[4],10);
  var discountText = result[5];
  this.temps.choice_discount_ends = "POISONTOKEN";
  discountText = this.replaceVariables(discountText).replace("POISONTOKEN", "${choice_discount_ends}");
  delete this.temps.choice_discount_ends;
  if (typeof printDiscount != "undefined") printDiscount(product, fullYear, oneBasedMonthNumber, dayOfMonth, discountText);
};

// *abort
// halt the scene without showing a button
Scene.prototype.abort = function() {
  this.paragraph();
  this.finished = true;
};

// *create
// create a new permanent stat
Scene.prototype.create = function create(line) {
    var result = /^(\w*)(.*)/.exec(line);
    if (!result) throw new Error(this.lineMsg() + "Invalid create instruction, no variable specified: " + line);
    var variable = result[1];
    this.validateVariable(variable);
    variable = variable.toLowerCase();
    var expr = result[2];
    var stack = this.tokenizeExpr(expr);
    if (stack.length > 1) throw new Error(this.lineMsg() + "Invalid create instruction, too many values: " + line);
    this.createVariable(variable, stack[0], line);
}

Scene.prototype.createVariable = function createVariable(variable, token, line) {
  var self = this;
  if (!token) throw new Error(this.lineMsg() + "Invalid create instruction, no value specified: " + line);
  function complexError() {
    throw new Error(self.lineMsg() + "Invalid create instruction, value must be a number, true/false, or a quoted string: " + line);
  }
  if (!/STRING|NUMBER|VAR/.test(token.name)) complexError();
  if ("VAR" == token.name && !/^true|false$/i.test(token.value)) complexError();
  if ("STRING" == token.name && /(\$|@)!?!?{/.test(token.value)) throw new Error(this.lineMsg() + "Invalid create instruction, value must be a simple string without ${} or @{}: " + line);
  var value = this.evaluateExpr([token]);
  if (!this.created) this.created = {};
  if (this.created[variable]) throw new Error(this.lineMsg() + "Invalid create. " + variable + " was previously created on line " + this.created[variable]);
  this.created[variable] = this.lineNum + 1;
  this.stats[variable] = value;
  if (this.nav) this.nav.startingStats[variable] = value;
}

// *create_array {name} {length} {value(s)}
// create an "array" of permanent stats:
//    myarray_1
//    myarray_2
//    ...
//    myarray_count
Scene.prototype.create_array = function create(line) {
  this.defineArray("create", line);
};

// *temp
// create a temporary stat for the current scene
Scene.prototype.temp = function temp(line) {
    var result = /^(\w*)(.*)/.exec(line);
    if (!result) throw new Error(this.lineMsg()+"Invalid temp instruction, no variable specified: " + line);
    var variable = result[1];
    this.validateVariable(variable);
    var expr = result[2];
    var stack = this.tokenizeExpr(expr);
    if (stack.length === 0) {
      this.temps[variable.toLowerCase()] = null;
      return;
    }
    var value = this.evaluateExpr(stack);
    if (typeof this.stats[variable.toLowerCase()] !== 'undefined') {
      this.warning("This is a temp, but we already ran *create " + variable);
    }
    this.temps[variable.toLowerCase()] = value;
};

// *temp_array
// create an "array" of temporary stats for the current scene
Scene.prototype.temp_array = function temp_array(line) {
  this.defineArray("temp", line);
};

Scene.prototype.defineArray = function defineArray(command, line) {
  var result = /^(\w+)(.*)/.exec(line);
  if (!result) throw new Error(this.lineMsg() + "Invalid " + command + "_array instruction, no array name specified: " + line);
  var variable = result[1];
  this.validateVariable(variable);
  variable = variable.toLowerCase();
  var stack = this.tokenizeExpr(result[2].trim());
  if (!stack.length) {
    throw new Error(this.lineMsg() + "Invalid " + command + "_array instruction, missing length: " + line);
  }
  var length = Number(stack.shift().value);
  if (length !== Math.floor(length) || length < 1) {
    throw new Error(this.lineMsg() + "Invalid " + command + "_array instruction, length should be a whole number greater than 0: " + line);
  }

  var token;
  var value = null;
  var self = this;
  var i;
  function create(suffix) {
    if (command === "create") {
      self.createVariable(variable + "_" + suffix, token, line);
    } else {
      self.temps[variable + "_" + suffix] = value;
    }
  }

  function next() {
    token = stack[0];
    if (!token) throw new Error(self.lineMsg() + "Too few values. Expected 1 default value or " + length + " explicit values, not " + i + ": " + line);
    value = self.evaluateValueToken(stack.shift(), stack);
  }

  if (stack.length) next();
  
  if (!stack.length) {
    // Use first default value for all creations
    for (i = 0; i < length; i++) {
      create(i+1);
    }
  } else {
    create(1);
    for (i = 1; i < length; i++) {
      next();
      create(i+1);
    }
  }

  if (stack.length) {
    throw new Error(this.lineMsg() + "Too many values. Expected 1 default value or " + length + " explicit values: " + line);
  }

  token = { name: "NUMBER", value: length };
  value = length;
  create("count");
}

// retrieve the value of the variable, preferring temp scope
Scene.prototype.getVar = function getVar(variable) {
    var value;
    variable = String(variable).toLowerCase();
    if (variable && !isNaN(1*variable) && String(1*variable) === variable) return 1*variable;
    if (variable == "true") return true;
    if (variable == "false") return false;
    if (variable == "choice_subscribe_allowed") return true;
    if (variable == "choice_register_allowed") return isRegisterAllowed();
    if (variable == "choice_registered") return typeof window != "undefined" && !!window.registered;
    if (variable == "choice_is_web") return typeof window != "undefined" && !!window.isWeb;
    if (variable == "choice_is_steam") return typeof window != "undefined" && !!window.isSteamApp;
    if (variable == "choice_is_steam_deck") return typeof window != "undefined" && !!window.isSteamApp && !!window.isSteamDeck;
    if (variable == "choice_is_ios_app") return typeof window != "undefined" && !!window.isIosApp;
    if (variable == "choice_is_ipad_app") return typeof window != "undefined" && !!window.isIosApp && !!window.isIPad;
    if (variable == "choice_is_android_app") return typeof window != "undefined" && !!window.isAndroidApp;
    if (variable == "choice_is_omnibus_app") return typeof window != "undefined" && !!window.isOmnibusApp;
    if (variable == "choice_is_amazon_app") return typeof window != "undefined" && !!window.isAmazonApp;
    if (variable == "choice_is_advertising_supported") return typeof isAdvertisingSupported != "undefined" && !!isAdvertisingSupported();
    if (variable == "choice_is_trial") return !!(typeof isTrial != "undefined" && isTrial);
    if (variable == "choice_release_date") {
      if (typeof window != "undefined" && window.releaseDate) {
        return simpleDateFormat(window.releaseDate);
      }
      return "release day";
    }
    if (variable == "choice_prerelease") return typeof isPrerelease != "undefined" && !!isPrerelease();
    if (variable == "choice_kindle") return typeof isKindle !== "undefined" && !!isKindle;
    if (variable == "choice_randomtest") return !!this.randomtest;
    if (variable == "choice_quicktest") return false; // quicktest will explore "false" paths
    if (variable == "choice_linenum") return this.lineNum;
    if (variable == "choice_scene") return this.name;
    if (variable == "choice_restore_purchases_allowed") return isRestorePurchasesSupported();
    if (variable == "choice_save_allowed") return areSaveSlotsSupported();
    if (variable == "choice_time_stamp") return Math.floor(new Date()/1000);
    if (variable == "choice_nightmode") return typeof isNightMode != "undefined" && isNightMode();
    if (variable == "choice_title") {
      if (typeof this.stats.choice_title === "undefined") {
        throw new Error(this.lineMsg() + "This game is missing a *title command");
      }
    }
    if (variable.startsWith("choice_saved_checkpoint")) {
      return !!this.stats[variable];
    }
    if ((!this.temps.hasOwnProperty(variable))) {
        if ((!this.stats.hasOwnProperty(variable))) {
            if (variable == "implicit_control_flow") return false;
            throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
        }
        value = this.stats[variable];
        if (value === null || value === undefined) {
            throw new Error(this.lineMsg() + "Variable '"+variable+"' exists but has no value");
        }
        if (this.debugMode) println("stats["+ variable + "]==" + value);
        return value;
    }
    value = this.temps[variable];
    if (value === null || value === undefined) {
        throw new Error(this.lineMsg() + "Variable '"+variable+"' exists but has no value");
    }
    if (this.debugMode) println("temps["+ variable + "]==" + value);
    return value;
};

// set the value of the variable, preferring temp scope
Scene.prototype.setVar = function setVar(variable, value) {
    variable = variable.toLowerCase();
    if (this.debugMode) println(variable +"="+ value);
    if ("undefined" === typeof this.temps[variable]) {
        if ("undefined" === typeof this.stats[variable]) {
            throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
        }
        this.stats[variable] = value;
        if (this.saveSlot == "temp") tempStatWrites[variable] = value;
        // Implicit control flow flag is ideally set just once in startup.
        // Removing these lines makes this not possible with quicktest.
        if (variable == "implicit_control_flow" && this.nav) {
            this.nav.startingStats["implicit_control_flow"] = value;
        }
    } else {
        this.temps[variable] = value;
    }
};

// *delete variable
// deletes the named variable
Scene.prototype["delete"] = function scene_delete(variable) {
    variable = variable.toLowerCase();
    if ("undefined" === typeof this.temps[variable]) {
        if ("undefined" === typeof this.stats[variable]) {
            throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
        }
        delete this.stats[variable];
    } else {
        delete this.temps[variable];
    }
};

Scene.prototype["delete_array"] = function scene_delete_array(arrayName) {
  arrayName = arrayName.toLowerCase();
  if ("undefined" === typeof this.temps[arrayName + "_count"]) {
      if ("undefined" === typeof this.stats[arrayName + "_count"]) {
          throw new Error(this.lineMsg() + "Non-existent array '"+arrayName+"'");
      }
      var length = this.stats[arrayName + "_count"];
      delete this.stats[arrayName + "_count"];
      for (var i = 1; i <= length; i++) {
        delete this.stats[arrayName + ("_" + i)];
      }
  } else {
      var length = this.temps[arrayName + "_count"];
      delete this.temps[arrayName + "_count"];
      for (var i = 1; i <= length; i++) {
        delete this.temps[arrayName + ("_" + i)];
      }
  }
};

// during a choice, recursively parse the options
Scene.prototype.parseOptions = function parseOptions(startIndent, choicesRemaining, expectedSubOptions) {
    // nextIndent: the level of indentation after the current line
    // For example, in the color/toy sample above, we start at 0
    // then the nextIndent is 2 for "red"
    // then the nextIndent is 4 for "spaceship"
    var nextIndent = null;
    var options = [];
    var choiceEnds = [];
    var line;
    var currentChoice = choicesRemaining[0];
    if (!currentChoice) currentChoice = "choice";
    var suboptionsEncountered = false;
    var bodyExpected = false;
    var previousSubOptions;
    var namesEncountered = {};
    var atLeastOneSelectableOption = false;
    var prevOption, ifResult;
    var startingLine = this.lineNum;
    var self = this;
    function removeModifierCommand(stripParethentical) {
      if (stripParethentical) {
        var openParen = line.indexOf("(")+1;
        var closingParen = matchBracket(line, "()", openParen);
        if (closingParen == -1) {
          throw new Error(self.lineMsg() + "missing closing parenthesis");
        }
        line = trim(line.substr(closingParen+1));
      } else {
        line = trim(line.replace(/^\s*\*(\w+)(.*)/, "$2"));
      }
      parsed = /^\s*\*(\w+)(.*)/.exec(line);
      if (parsed) {
        command = parsed[1].toLowerCase();
        data = trim(parsed[2]);
      } else {
        command = "";
      }
    }
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent <= startIndent) {
                throw new Error(this.lineMsg() + "invalid indent, expected at least one '" + currentChoice + "'");
            }
            this.indent = nextIndent = indent;
        }
        if (indent <= startIndent) {
            // it's over!
            break;
        }
        if (indent < this.indent) {
            // TODO drift detection
            if (false) /*(indent != nextIndent)*/ {
                // error: indentation has decreased, but not all the way back
                // Example:
                // *choice
                //     red
                //   blue
                throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
            }

            // we must be falling out of a sub-block
            this.dedent(indent);
            this.indent = indent;
        }
        if (indent > this.indent) {
            // body of the choice
            // ...unless we haven't identified our choices yet
            // TODO is this error test valid?
            if (choicesRemaining.length>1) throw new Error(this.lineMsg() + "invalid indent, there were subchoices remaining: [" + choicesRemaining.join(",") + "]");
            this.rollbackLineCoverage();
            bodyExpected = false;
            continue;
        }

        // here's the end of the previous option
        if (options.length) {
          prevOption = options[options.length-1];
          if (!prevOption.endLine) prevOption.endLine = this.lineNum;
        }

        // Execute *if commands (etc.) during option loop
        // sub-commands may modify this.indent
        var parsed = /^\s*\*(\w+)(.*)/.exec(line);
        var unselectable = false;
        var inlineIf = null;
        var selectableIf = null;
        var self = this;

        var overrideDefaultReuseSetting = false;
        var reuse = this.temps.choice_reuse;
        if (parsed) {
            var command = parsed[1].toLowerCase();
            var data = trim(parsed[2]);
            // TODO whitelist commands
            if ("hide_reuse" == command) {
              reuse = "hide";
              overrideDefaultReuseSetting = true;
              removeModifierCommand();
            }
            if ("disable_reuse" == command) {
              reuse = "disable";
              overrideDefaultReuseSetting = true;
              removeModifierCommand();
            }
            if ("allow_reuse" == command) {
              reuse = "allow";
              overrideDefaultReuseSetting = true;
              removeModifierCommand();
            }
            if ("random_weight" == command) {
              removeModifierCommand(true /*stripParenthetical*/);
            }

            if ("print" == command) {
                line = this.evaluateExpr(this.tokenizeExpr(data));
            } else if ("if" == command) {
              choiceEnds.push(this.lineNum);
              ifResult = this.parseOptionIf(data, command);
              if (ifResult) {
                inlineIf = ifResult.condition;
                if (ifResult.result) {
                  line = ifResult.line;
                } else {
                  continue;
                }
              } else {
                this["if"](data, true /*inChoice*/);
                continue;
              }
            } else if ("else" == command) {
              if (data) throw new Error(this.lineMsg() + "Invalid content after *" + command + "; move the #option to the next line, indented: " + data);
              this[command](data, true /*inChoice*/);
              continue;
            } else if (/^(elseif|elsif)$/.test(command)) {
              ifResult = this.parseOptionIf(data, command);
              if (ifResult) {
                throw new Error(this.lineMsg() + "Invalid content after *" + command + "; move the #option to the next line, indented: " + ifResult.line);
              }
              this[command](data, true /*inChoice*/);
              continue;
            } else if ("selectable_if" == command) {
              ifResult = this.parseOptionIf(data, command);
              if (!ifResult) throw new Error(this.lineMsg() + "Couldn't parse the line after *selectable_if: " + data);
              line = ifResult.line;
              selectableIf = ifResult.condition;
              unselectable = unselectable || !ifResult.result;
            } else if ("comment" == command) {
                continue;
            } else if (!command) {
              // command was rewritten by earlier modifier
            } else {
                if (Scene.validCommands[command]) {
                  throw new Error(this.lineMsg() + "Invalid indent? Expected an #option here, not *"+command);
                }  else {
                    throw new Error(this.lineMsg() + "Non-existent command '"+command+"'");
                }
            }
        }

        if ("allow" != reuse) {
          if (!this.temps.choice_used) this.temps.choice_used = {};
          if (this.temps.choice_used[this.lineNum]) {
            if ("hide" == reuse) continue;
            unselectable = true;
          }
        }

        // this line should be a valid option
        if (!/^\s*\#\s*\S/.test(line)) {
            throw new Error(this.lineMsg() + "Expected option starting with #");
        }
        // replace variables here and discard the result, so error messages display the correct line
        this.replaceVariables(line);
        line = trim(trim(line).substring(1));
        var option = {name:line, group:currentChoice};
        if (reuse != "allow") option.reuse = reuse;
        if (this.displayOptionConditions) {
          option.displayIf = [];
          for (var i = 0; i < this.displayOptionConditions.length; i++) {
            option.displayIf[i] = this.displayOptionConditions[i];
          }
          if (inlineIf) option.displayIf.push(inlineIf);
        } else if (inlineIf) {
          option.displayIf = [inlineIf];
        }
        if (selectableIf) {
          option.selectableIf = selectableIf;
        }
        option.line = this.lineNum + 1;
        if (unselectable) {
          option.unselectable = true;
        }
        if (namesEncountered[line]) {
            this.conflictingOptions(this.lineMsg() + "Invalid option; conflicts with option '"+option.name+"' on line " + namesEncountered[line]);
        } else {
            namesEncountered[line] = option.line;
        }
        options.push(option);
        if (choicesRemaining.length>1) {
            // recursive call will modify this.indent
            option.suboptions = this.parseOptions(this.indent, choicesRemaining.slice(1), previousSubOptions);
            // now restore it
            this.indent = nextIndent;
            if (!previousSubOptions) previousSubOptions = option.suboptions;
            suboptionsEncountered = true;
        } else {
            bodyExpected = true;
        }
        if (!unselectable) atLeastOneSelectableOption = true;
    }

    // TODO is this error test valid?
    if (choicesRemaining.length>1 && !suboptionsEncountered) {
        throw new Error(this.lineMsg() + "invalid indent, there were subchoices remaining: [" + choicesRemaining.join(",") + "]");
    }
    if (bodyExpected &&
            (this.temps._fakeChoiceDepth === undefined || this.temps._fakeChoiceDepth < 1)) {
        throw new Error(this.lineMsg() + "Expected choice body");
    }
    if (!atLeastOneSelectableOption) this.conflictingOptions(this.lineMsg() + "No selectable options");
    if (expectedSubOptions) {
        this.verifyOptionsMatch(expectedSubOptions, options);
    }
    this.rollbackLineCoverage();
    prevOption = options[options.length-1];
    this.lineNum = this.previousNonBlankLineNum();
    if (!prevOption.endLine) prevOption.endLine = this.lineNum+1;
    for (i = 0; i < choiceEnds.length; i++) {
        this.temps._choiceEnds[choiceEnds[i]] = this.lineNum;
    }
    this.rollbackLineCoverage();
    return options;
};

// compute *if statement during options
Scene.prototype.parseOptionIf = function parseOptionIf(data) {
  var parsed = /^\s*\((.*)\)\s+(#.*)/.exec(data);
  if (!parsed) {
    return;
  }
  var condition = parsed[1];
  var stack = this.tokenizeExpr(condition);
  var result = this.evaluateExpr(stack);
  if (this.debugMode) println(condition + " :: " + result);
  result = bool(result, this.lineNum+1);
  // In the autotester, all conditionals are enabled
  result = result || this.testPath;
  return {result:result, line:parsed[2], condition:null};
};

// Add this as a separate method so we can override it elsewhere
// We want this error during randomtest but not during autotest
// Because autotest makes impossible situations happen
Scene.prototype.conflictingOptions = function conflictingOptions(str) {
  throw new Error(str);
};

// verify that the current option set corresponds to the previous option set
// (for multichoices)
Scene.prototype.verifyOptionsMatch = function verifyOptionsMatch(prev, current) {
    // find matching option by name
    function findMatch(name, options) {
        for (var i = 0; i < options.length; i++) {
            var option = options[i];
            if (option && name == option.name) {
                return option;
            }
        }
        return null;
    }

    var prevOpt, curOpt;
    for (var i = 0; i < prev.length; i++) {
        prevOpt = prev[i];
        curOpt = findMatch(prevOpt.name, current);
        if (!curOpt) throw new Error(this.lineMsg()+"Missing expected suboption '"+prevOpt.name+"'; all suboptions must have same option list");
    }

    if (prev.length == current.length) return;

    for (i = 0; i < current.length; i++) {
        curOpt = current[i];
        prevOpt = findMatch(curOpt.name, prev);
        if (!prevOpt) throw new Error(this.lineMsg()+"Added unexpected suboption '"+curOpt.name+"'; all suboptions must have same option list");
    }

    throw new Error(this.lineMsg()+"Bug? previous options and current options mismatch, but no particular missing element");
};

// render the prompt and the radio buttons
Scene.prototype.renderOptions = function renderOptions(groups, options, callback) {
    var self = this;
    function replaceVars(options) {
      for (var i = 0; i < options.length; i++) {
        var option = options[i];
        option.name = self.replaceVariables(option.name);
        if (option.suboptions) replaceVars(option.suboptions);
      }
    }
    replaceVars(options);
    this.paragraph();
    printOptions(groups, options, callback);

    if (this.debugMode) println(computeCookie(this.stats, this.temps, this.lineNum, this.indent));

    if (this.finished) printFooter();
};

// *page_break
// pause and prompt the user to press "Next"
Scene.prototype.page_break = function page_break(buttonName) {
    if (this.screenEmpty) return;
    if (!buttonName) buttonName = "Next";
    buttonName = this.replaceVariables(buttonName);
    this.paragraph();
    this.finished = true;

    var self = this;
    printButton(buttonName, main, false,
      function() {
        delayBreakEnd();
        self.finished = false;
        self.resetPage();
      }
    );
    if (this.debugMode) println(computeCookie(this.stats, this.temps, this.lineNum, this.indent));
};

Scene.prototype.page_break_advertisement = function pageBreakAdvertisement(line) {
  if (line) throw new Error(this.lineMsg() + "*page_break_advertisement doesn't allow you to change the button message. This text will never be shown: " + line);
  var self = this;
  this.finished = true;
  showFullScreenAdvertisementButton("Watch an Ad to Continue", function () {
    self.finished = false;
    if (self.screenEmpty) {
      self.skipFooter = false;
      self.resetPage();
    } else {
      self.page_break("");
    }
  }, function () {
    delayBreakEnd();
    self.finished = false;
    self.skipFooter = false;
    self.resetPage();
  });
};

Scene.prototype.finish_advertisement = function finishAdvertisement(line) {
  if (line) throw new Error(this.lineMsg() + "*finish_advertisement doesn't allow you to change the button message. This text will never be shown: " + line);
  var self = this;
  this.finished = true;
  showFullScreenAdvertisementButton("Watch an Ad for the Next Chapter", function () {
    self.finish("");
  }, function () {
    var nextSceneName = self.nav && nav.nextSceneName(self.name);
    var scene = new Scene(nextSceneName, self.stats, self.nav, { debugMode: self.debugMode, secondaryMode: self.secondaryMode });
    scene.resetPage();
  });
};

// *line_break
// single line break in the middle of a paragraph
Scene.prototype.line_break = function line_break() {
    // We want to prevent a huge <p><br></p> between blocks
    // so if there's existing text we'll just toss in a [n/]
    // and if there's no text yet, we'll directly insert a <br>
    if (this.accumulatedParagraph.length) {
      this.accumulatedParagraph.push('[n/]');
    } else {
      println();
    }
};

// *image
// display named image
Scene.prototype.image = function image(data, invert) {
    this.paragraph();
    data = data || "";
    data = this.replaceVariables(data);
    var match = /(\S+) (\S+)(.*)/.exec(data);
    var source, alignment;
    var alt = null;
    if (match) {
      var source = match[1];
      var alignment = match[2];
      var alt = trim(match[3]);
    } else {
      source = data;
    }
    if (source === "") throw new Error(this.lineMsg()+"*image requires the file name of an image");
    alignment = alignment || "center";
    if (!/(right|left|center|none)/.test(alignment)) throw new Error(this.lineMsg()+"Invalid alignment, expected right, left, center, or none: " + data);
    printImage(source, alignment, alt, invert);
    if (this.verifyImage) this.verifyImage(source);
    if (alignment == "none") this.prevLine = "text";
    this.screenEmpty = false;
};

Scene.prototype.text_image = function textImage(data) {
  this.image(data, "invert");
}

// *sound
// play named sound file
Scene.prototype.sound = function sound(source) {
    if (typeof playSound == "function") playSound(source);
    if (this.verifyImage) this.verifyImage(source);
};

Scene.prototype.kindle_image = function kindle_image() {
  // Do nothing on non-Kindle devices; show only on Kindle
};

Scene.prototype.youtube = function youtube(slug) {
  if (typeof printYoutubeFrame !== "undefined") {
    printYoutubeFrame(slug);
    this.prevLine = "block";
    this.screenEmpty = false;
  }
}

Scene.prototype.kindle_search = Scene.prototype.kindle_product = function kindle_search(data) {
  var result = /^\((.+)\) ([^\)]+)/.exec(data);
  if (!result) throw new Error(this.lineMsg()+"Invalid arguments: " + data);
  var query = result[1];
  var buttonName = result[2];
  if ("undefined" != typeof kindleButton) kindleButton(this.target, query, buttonName);
};

// *link
// Display URL with anchor text
Scene.prototype.link = function link(data) {
    var result = /^(\S+)\s*(.*)/.exec(data);
    if (!result) throw new Error(this.lineMsg() + "invalid line; this line should have an URL: " + data);
    var href = result[1].replace(/\]/g, "%5D");
    var anchorText = trim(result[2]) || href;
    this.printLine("[url="+href+"]"+anchorText+"[/url]");
    this.prevLine = "text";
    this.screenEmpty = false;
};

// *link_button
// Display button that takes you to an URL
Scene.prototype.link_button = function linkButton(data) {
    if (typeof window == "undefined") return;
    var result = /^(\S+)\s*(.*)/.exec(data);
    if (!result) throw new Error(this.lineMsg() + "invalid line; this line should have an URL: " + data);
    var href = result[1];
    var anchorText = trim(result[2]) || href;
    this.paragraph();
    var target = this.target;
    if (!target) target = document.getElementById('text');
    printButton(anchorText, target, false, function() {
      window.location.href = href;
    });
    this.prevLine = "empty";
    this.screenEmpty = false;
};

// how many spaces is this line indented?
Scene.prototype.getIndent = function getIndent(line) {
    if (line === null || line === undefined) return 0;
    var spaces = line.match(/^(\s*)/);
    if (spaces === null || spaces === undefined) return 0;
    if (/[^ \t]/.test(spaces[1])) {
      throw new Error(this.lineMsg() + "The indentation on this line includes whitespace that is neither a space nor a tab. Delete the whitespace and replace it with spaces or tabs.");
    }
    var whitespace = spaces[0];
    var len = whitespace.length;
    if (0 === len) return 0;
    var tab = /\t/.test(whitespace);
    var space = / /.test(whitespace);
    if (tab && space) {
        throw new Error(this.lineMsg()+"Tabs and spaces appear on the same line");
    }
    if (tab) {
        this.firstTab = this.lineNum+1;
        if (this.firstSpace) {
            throw new Error(this.lineMsg()+"Illegal mixing of spaces and tabs; this line has a tab, but there were spaces on line " + this.firstSpace);
        }
    } else {
        this.firstSpace = this.lineNum + 1;
        if (this.firstTab) {
            throw new Error(this.lineMsg()+"Illegal mixing of spaces and tabs; this line has a space, but there were tabs on line " + this.firstTab);
        }
    }
    return len;
};

// *comment ignorable text
Scene.prototype.comment = function comment(line) {
    if (this.debugMode) println("*comment " + line);
};

Scene.prototype.advertisement = function advertisement(durationInSeconds) {
  if (/^\s*\*delay_break/.test(this.lines[this.lineNum - 1])) {
    throw new Error(this.lineMsg() + "*advertisement is not allowed immediately after *delay_break (*delay_break includes its own advertisement)");
  }
  if (this.getVar("choice_prerelease") || this.getVar("choice_is_steam")) return;
  var self = this;
  this.finished = true;
  this.skipFooter = true;
  startLoading();
  checkPurchase("adfree", function(ok, result) {
    doneLoading();
    if (result.adfree) {
      self.finished = false;
      self.skipFooter = false;
      self.execute();
      return;
    }
    self.printLine("Come back later to play the next part of [i]${choice_title}[/i]!");
    self.paragraph();
    self.printLine("Or you can buy the game now to skip the wait.");
    self.paragraph();
    self.buyButton("adfree", "$1.99", null, "It");
    self.delay_break(durationInSeconds || 300);
  });
};

// *looplimit 5
// The number of times a given line is allowed to be accessed
Scene.prototype.looplimit = function looplimit(count) {
  this.temps._looplimit = num(count, this.lineNum, this.name);
};

Scene.prototype.hide_reuse = function hide_reuse() {
  this.temps.choice_reuse = "hide";
};

Scene.prototype.disable_reuse = function disable_reuse() {
  this.temps.choice_reuse = "disable";
};

Scene.prototype.allow_reuse = function allow_reuse() {
  this.temps.choice_reuse = "allow";
};

// *label labelName
// Labels a line for use later in *goto
// Do nothing here; these labels are parsed in this.parseLabel
Scene.prototype.label = function label() {};

// *print expr
// print the value of the specified expression
Scene.prototype.print = function scene_print(expr) {
    var value = this.evaluateExpr(this.tokenizeExpr(expr));
    this.prevLine = "text";
    this.screenEmpty = false;
    this.printLine(value);
};

Scene.prototype.parseInputText = function parseInputText(line) {
  var stack = this.tokenizeExpr(line);
  var variable = this.evaluateReference(stack);
  if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
    throw new Error(this.lineMsg() + "Non-existent variable '" + variable + "'");
  }

  var inputOptions = { long: false, allow_blank: false };
  for (var i = 0; i < stack.length; i++) {
    var token = stack[i];
    if (token.name !== "VAR") {
      throw new Error(this.lineMsg() + "Couldn't understand this input_text line");
    }
    var option = token.value;
    if (typeof inputOptions[option] === "undefined") {
      throw new Error(this.lineMsg() + "Couldn't understand this input_text option: " + option);
    }
    inputOptions[option] = true;
  }
  return {variable:variable, inputOptions:inputOptions};
}

// *input_text var
// record text typed by the user and store it in the specified variable
Scene.prototype.input_text = function input_text(line) {
    var result = this.parseInputText(line);
    var variable = result.variable;

    this.finished = true;
    this.paragraph();
    var self = this;
    printInput(this.target, result.inputOptions, function(value) {
      safeCall(self, function() {
        value = trim(String(value));
        value = value.replace(/\n/g, "[n/]");
        if (self.nav) self.nav.bugLog.push("*input_text " + variable + " " + value);
        self.finished = false;
        self.setVar(variable, value);
        self.resetPage();
      });
    });
    if (this.debugMode) println(computeCookie(this.stats, this.temps, this.lineNum, this.indent));
};

// *input_number var min max
// record number typed by the user and store it in the specified variable
Scene.prototype.input_number = function input_number(data) {
    var stack = this.tokenizeExpr(data);
    if (!stack.length) throw new Error(this.lineMsg() + "Invalid input_number statement, expected three args: varname min max");
    var variable = this.evaluateReference(stack);
    if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
      throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
    }

    var simpleConstants;
    if (stack.length == 2 && stack[0].name == "NUMBER" && stack[1].name == "NUMBER") {
      simpleConstants = true;
    } else {
      simpleConstants = false;
    }

    if (!stack.length) throw new Error(this.lineMsg() + "Invalid input_number statement, expected three args: varname min max");
    var minimum = this.evaluateValueToken(stack.shift(), stack);
    if (isNaN(minimum*1)) throw new Error(this.lineMsg() + "Invalid minimum, not numeric: " + minimum);
    if (!stack.length) throw new Error(this.lineMsg() + "Invalid input_number statement, expected three args: varname min max");

    var maximum = this.evaluateValueToken(stack.shift(), stack);
    if (stack.length) throw new Error(this.lineMsg() + "Invalid input_number statement, expected three args: varname min max");
    if (isNaN(maximum*1)) throw new Error(this.lineMsg() + "Invalid maximum, not numeric: " + maximum);

    // in quicktest, min and max can get mixed up as the interpreter "cheats" on if statements
    // so quicktest will ignore min/max errors unless they're simple constants e.g. *input_number x 6 4
    var checkMinMax = !this.quicktest || simpleConstants;
    if (checkMinMax && parseFloat(minimum) > parseFloat(maximum)) {
      throw new Error(this.lineMsg() + "Minimum " + minimum+ " should not be greater than maximum " + maximum);
    }

    function isInt(x) {
       var y=parseInt(x,10);
       if (isNaN(y)) return false;
       return x==y && x.toString()==y.toString();
    }
    var intRequired;
    if (isInt(minimum) && isInt(maximum)) {
      intRequired = 1;
    }
    this.finished = true;
    this.paragraph();
    var self = this;
    printInput(this.target, {numeric: true}, function(value) {
      safeCall(self, function() {
        var numValue = parseFloat(""+value);
        if (isNaN(numValue)) {
          asyncAlert("Please type in a number.");
          return;
        }
        if (intRequired && !isInt(value)) {
          asyncAlert("Please type in an integer number.");
          return;
        }
        if (numValue < minimum * 1) {
          asyncAlert("Please use a number greater than or equal to " + minimum);
          return;
        }
        if (numValue > maximum * 1 && !this.quicktest) {
          asyncAlert("Please use a number less than or equal to " + maximum);
          return;
        }
        if (self.nav) self.nav.bugLog.push("*input_number " + variable + " " + value);
        self.finished = false;
        self.setVar(variable, numValue);
        self.resetPage();
      });
    }, minimum, maximum, intRequired);
    if (this.debugMode) println(computeCookie(this.stats, this.temps, this.lineNum, this.indent));
};

// *script code
// evaluate the specified ECMAScript
Scene.prototype.script = function script(code) {
    var stats = this.stats;
    var temps = this.temps;
    try {
      if (typeof window == "undefined") {
        (function() {
          var window = _global;
          eval(code);
        }).call(this);
      } else {
        eval(code);
      }
    } catch (e) {
      throw new Error(this.lineMsg() + "error executing *script: " + e + (e.stack ? "\n" + e.stack : ""));
    }
};

// is this a valid variable name?
Scene.prototype.validateVariable = function validateVariable(variable) {
    if (!variable || !/^[a-zA-Z]/.test(variable)) {
        throw new Error(this.lineMsg()+"Invalid variable name, must start with a letter: " + variable);
    }
    if (!/^\w+$/.test(variable)) {
        throw new Error(this.lineMsg()+"Invalid variable name: '" + variable + "'");
    }
    if (/^(and|or|true|false|scene|scenename)$/i.test(variable)) throw new Error(this.lineMsg()+"Invalid variable name, '" + variable + "' is a reserved word");
    if (/^choice_/.test(variable)) throw new Error(this.lineMsg()+"Invalid variable name, variables may not start with 'choice_'; this is a reserved prefix");
};

// *rand varname min max
// Set varname to a random number from min to max
//
// Example:
// *rand foo 1 6
//   roll a cube die
// *rand foo 1.0 6.0
//   compute a decimal from [1.0,6.0)
Scene.prototype.rand = function rand(data) {
    var stack = this.tokenizeExpr(data);
    if (!stack.length) throw new Error(this.lineMsg() + "Invalid rand statement, expected three args: varname min max");
    var variable = this.evaluateReference(stack);
    if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
      throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
    }

    if (!stack.length) throw new Error(this.lineMsg() + "Invalid rand statement, expected three args: varname min max");
    var minimum = this.evaluateValueToken(stack.shift(), stack);
    if (!stack.length) throw new Error(this.lineMsg() + "Invalid rand statement, expected three args: varname min max");
    var maximum = this.evaluateValueToken(stack.shift(), stack);
    if (stack.length) throw new Error(this.lineMsg() + "Invalid rand statement, expected three args: varname min max");
    var diff;

    diff = maximum - minimum;
    if (isNaN(diff)) {
        throw new Error(this.lineMsg() + "Invalid rand statement, min and max must be numbers");
    }
    if (diff < 0) {
        throw new Error(this.lineMsg() + "Invalid rand statement, min must be less than max: " + minimum + " > " + maximum);
    }
    if (diff === 0) {
      this.setVar(variable, minimum);
      return;
    }
    function isInt(x) {
       var y=parseInt(x,10);
       if (isNaN(y)) return false;
       return x==y && x.toString()==y.toString();
    }
    var result;
    var random = Math.random();
    if (isInt(minimum) && isInt(maximum)) {
        // int random
        result = 1*minimum + Math.floor(random*(diff+1));
    } else {
        result = 1*minimum + random*diff;
    }
    this.setVar(variable, result);
    if (this.randomLog) {
      this.randomLog("*rand " + variable + " " + result);
    }
    if (this.nav) this.nav.bugLog.push("*rand " + variable + " " + result);
};

// *set varname expr
// sets the specified varname to the value of the expr
//
// Examples:
//
// literal
//     literal int: 2
//     literal decimal: 2.3
//     boolean value: true
//     quoted string: "fie"
//         with backslash escaping "she said it was \"ironic\"!"  "c:\\foo"
//     variable name: foo
//
// math
//     +: 2+2
//     -: foo-3
//     *: 2*3
//     /: 8/2
//     if one operand is a string, we'll try to parse it as a number, fail if that doesn't work
//
// fairmath
//     %+: foo%+30
//     %-: foo%-20
//
// concatenate
//     &: "foo"&bar
//
// may omit leading operand
//     *set foo +2
//     *set foo %+30
//     *set foo &"blah blah"
//
// spaces optional
//     *set foo+2
//     *set foo bar + 2
//     *set bar% +30
//
// multiple operators in one line, parentheses mandatory
//     *set foo (foo+2)/4
//     *set foo 2+(foo/2)
//     *set foo (foo/2)+(bar/3)
//     *set foo +(bar/3)
//
// set variable by reference
//
//     *set foo bar
//     *set {foo} 3
//     *comment now bar=3
Scene.prototype.set = function set(line) {
    var stack = this.tokenizeExpr(line);
    var variable = this.evaluateReference(stack);
    if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
      throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
    }
    if (stack.length === 0) throw new Error(this.lineMsg()+"Invalid set instruction, no expression specified: " + line);
    // if the first token is an operator, then it's implicitly based on the variable
    if (/OPERATOR|FAIRMATH/.test(stack[0].name)) stack.unshift({name:"VAR", value:variable, pos:"(implicit)"});
    var value = this.evaluateExpr(stack);
    this.setVar(variable, value);
};

// *setref variableExpr expr
// just like *set, but variableExpr is a string expression naming a variable reference
//
// Example:
// *set foo "bar"
// *setref foo 3
// *comment now bar=3
Scene.prototype.setref = function setref(line) {
    var stack = this.tokenizeExpr(line);
    var variable = this.evaluateValueToken(stack.shift(), stack);
    variable = String(variable).toLowerCase();

    if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
      throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
    }

    // if the first token is an operator, then it's implicitly based on the variable
    if (/OPERATOR|FAIRMATH/.test(stack[0].name)) stack.unshift({name:"VAR", value:variable, pos:"(implicit)"});
    var value = this.evaluateExpr(stack);
    this.setVar(variable, value);
};

Scene.prototype.share_this_game = function share_links(now) {
  now = !!trim(now);
  this.paragraph();
  printShareLinks(this.target, now);
  this.prevLine = "empty"; // printShareLinks provides its own paragraph break
};

Scene.prototype.more_games = function more_games(now) {
  if (typeof window == "undefined" || typeof moreGames == "undefined") return;
  if (!!trim(now)) {
    moreGames();
    return;
  }
  var self = this;
  this.paragraph();
  var target = this.target;
  if (!target) target = document.getElementById('text');
  var button = printButton("Play More Games Like This", target, false,
    function() {
      safeCall(self, moreGames);
    }
  );

  setClass(button, "");
  this.prevLine = "block";
};

Scene.prototype.ending = function ending() {
    if (typeof window == "undefined") return;
    trackEvent('game_end', {
      choice_file: this.name,
      choice_line: this.lineNum + 1,
    });
    this.paragraph();
    var groups = [""];
    options = [];
    options.push({name:"Play again.", group:"choice", restart:true});

    var self = this;
    function endingMenu() {
      printFollowButtons();
      self.renderOptions([""], options, function(option) {
        if (option.restart) {
          return restartGame();
        } else if (option.moreGames) {
          self.more_games("now");
          if (typeof curl != "undefined") curl();
        } else if (option.share) {
          clearScreen(function() {
            self.share_this_game("now");
            endingMenu();
          });
        } else if (option.subscribe) {
          subscribeLink();
        }
      });
    }
    endingMenu();
    this.finished = true;
};

Scene.prototype.restart = function restart() {
  delayBreakEnd();
  if (this.secondaryMode) {
    if (this.secondaryMode == "stats") {
      this.reset();
      this.redirect_scene(this.nav.getStartupScene());
    } else {
      throw new Error(this.lineMsg() + "Cannot *restart in " + this.secondaryMode + " mode");
    }
  } else {
    restartGame();
  }
  this.finished = true;
};

/* Subscribe options, in JSON format.
"now" on mobile means we should immediately mailto: the subscribe address
otherwise, we should display a Subscribe button which launches the mailto:
On non-mailte: platforms, we ignore "now"

"allowContinue" is the default; setting it to false blocks the "No, Thanks"
button and the "Next" button after successfully subscribing
Only Coming Soon pages use "allowContinue"

"message" is the message we'll show to justify subscribing
the default message is: "we'll notify you when our next game is ready!" */
Scene.prototype.subscribe = function scene_subscribe(data) {
  this.paragraph();
  var options = {};
  if (data) {
    try {
      options = JSON.parse(data);
    } catch (e) {
      throw new Error(this.lineMsg() + "Couldn't parse subscribe arguments: " + data);
    }
  }
  this.prevLine = "block";
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  subscribe(this.target, options, function(now) {
    self.finished = false;
    // if "now" actually worked, then continue the scene
    // otherwise, reset the page before continuing
    if (now) {
      self.skipFooter = false;
      self.execute();
    } else {
      self.resetPage();
    }
  });
};

Scene.prototype.restore_game = function restore_game(data) {
  var cancelLabel;
  if (data) {
    var result = /^cancel=(\S+)$/.exec(data);
    if (!result) throw new Error(this.lineMsg() + "invalid restore_game line: " + data);
    cancelLabel = result[1];
  }
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  var daysToUndelete = 30;
  var unrestorableScenes = this.parseRestoreGame(false/*alreadyFinished*/);
  function renderRestoreMenu(saveList, dirtySaveList) {
    var recentlyDeletedCount = 0;
    self.paragraph();
    var options = [];
    for (var i = 0; i < saveList.length; i++) {
      var save = saveList[i];
      var date = new Date(save.timestamp*1);
      if (!save) continue;
      var name = "";
      if (save.temps && save.temps.choice_restore_name) name = save.temps.choice_restore_name;
      if (save.deleted) {
        if (!save.undeleted || save.undeleted < save.deleted) {
          if ((Date.now() - save.deleted) < daysToUndelete * 1000 * 60 * 60 * 24) {
            recentlyDeletedCount++;
          }
          continue;
        }
      }
      options.push({name:name + " ("+simpleDateTimeFormat(date)+")", group:"choice", state:save});
    }
    var anythingToDelete = options.length > 0;
    if (false) options.push({name:"Restore using a password.", group:"choice", password:true});
    options.push({name:"Retrieve saved games online from choiceofgames.com.", group:"choice", fetch:true});
    if (anythingToDelete) options.push({ name: "Delete saves.", group: "choice", deleting: true });
    if (recentlyDeletedCount) {
      var recentlyDeletedMessage;
      if (recentlyDeletedCount === 1) {
        recentlyDeletedMessage = "1 save recently deleted."
      } else {
        recentlyDeletedMessage = recentlyDeletedCount + " saves recently deleted."
      }
      options.push({ name: "Undelete saves. (" + recentlyDeletedMessage + ")", group: "choice", undeleting: true });
    }
    if (dirtySaveList.length) options.push({name:"Upload saved games to choiceofgames.com.", group:"choice", upload:true});
    options.push({name:"Cancel.", group:"choice", cancel:true});
    var groups = [""];
    self.renderOptions(groups, options, function(option) {
      function synchronizeBeforeEdit(renderMenu) {
        clearScreen(function () {
          fetchEmail(function (defaultEmail) {
            self.printLine("Please type your email address to identify yourself.");
            self.paragraph();
            promptEmailAddress(this.target, defaultEmail, "allowContinue", function (cancel, email) {
              if (cancel) {
                self.finished = false;
                if (typeof cancelLabel !== "undefined") {
                  self["goto"](cancelLabel);
                }
                self.resetPage();
                return;
              }
              clearScreen(function () {
                startLoading();
                getRemoteSaves(email, function (remoteSaveList) {
                  doneLoading();
                  self.prevLine = "text";
                  if (!remoteSaveList) {
                    self.printLine("Error downloading saves. Please try again later.");
                    renderRestoreMenu(saveList, dirtySaveList);
                  } else {
                    mergeRemoteSaves(remoteSaveList, "recordDirty", function (saveList, newRemoteSaves, dirtySaveList) {
                      if (dirtySaveList && dirtySaveList.length) {
                        submitDirtySaves(dirtySaveList, email, function (ok) {
                          if (ok) {
                            renderMenu(email);
                          } else {
                            self.printLine("Error downloading saves. Please try again later.");
                            renderRestoreMenu(saveList, dirtySaveList);
                          }
                        });
                      } else {
                        renderMenu(email);
                      }
                    });
                  }
                });
              });
            });
          });
        });
      }


      if (option.upload) {
        clearScreen(function() {
          fetchEmail(function(defaultEmail){
            self.printLine("Please type your email address to identify yourself.");
            self.paragraph();
            promptEmailAddress(this.target, defaultEmail, "allowContinue", function(cancel, email) {
              if (cancel) {
                self.finished = false;
                if (typeof cancelLabel !== "undefined") {
                  self["goto"](cancelLabel);
                }
                self.resetPage();
                return;
              }
              clearScreen(function() {
                startLoading();
                submitDirtySaves(dirtySaveList, email, function(ok) {
                  doneLoading();
                  self.prevLine = "text"; // Put some space between the message and the option list
                  if (!ok) {
                    self.printLine("Error uploading saves. Please try again later.");
                    renderRestoreMenu(saveList, dirtySaveList);
                  } else {
                    var count = dirtySaveList.length + (dirtySaveList.length == 1 ? " save" : " saves");
                    self.printLine("Uploaded " + count + ".");
                    renderRestoreMenu(saveList, []);
                  }
                });
              });
            });
          });
        });
      } else if (option.fetch) {
        clearScreen(function() {
          fetchEmail(function(defaultEmail){
            self.printLine("Please type your email address to identify yourself.");
            self.paragraph();
            promptEmailAddress(this.target, defaultEmail, "allowContinue", function(cancel, email) {
              if (cancel) {
                self.finished = false;
                if (typeof cancelLabel !== "undefined") {
                  self["goto"](cancelLabel);
                }
                self.resetPage();
                return;
              }
              clearScreen(function() {
                startLoading();
                getRemoteSaves(email, function (remoteSaveList) {
                  doneLoading();
                  self.prevLine = "text";
                  if (!remoteSaveList) {
                    self.printLine("Error downloading saves. Please try again later.");
                    renderRestoreMenu(saveList, dirtySaveList);
                  } else {
                    mergeRemoteSaves(remoteSaveList, "recordDirty", function(saveList, newRemoteSaves, dirtySaveList) {
                      if (!remoteSaveList.length) {
                        self.printLine("No saves downloaded for email address \""+email+"\". (Is that the correct email address?) If you're having trouble, please contact support at "+getSupportEmail()+".");
                        renderRestoreMenu(saveList, dirtySaveList);
                      } else {
                        var downloadCount = remoteSaveList.length + " saved " + (remoteSaveList.length == 1 ? "game" : "games");
                        var newCount = newRemoteSaves + " new saved " + (newRemoteSaves == 1 ? "game" : "games");
                        self.printLine("Synchronized " + downloadCount + ". Downloaded " + newCount + ".");
                        renderRestoreMenu(saveList, dirtySaveList);
                      }
                    });
                  }
                });
              });
            });
          });
        });
      } else if (option.deleting) {
        synchronizeBeforeEdit(function renderDeleteMenu(email) {
          var options = [];
          for (var i = 0; i < saveList.length; i++) {
            var save = saveList[i];
            var date = new Date(save.timestamp * 1);
            if (!save) continue;
            if (save.deleted) {
              if (!save.undeleted || save.undeleted < save.deleted) {
                continue;
              }
            }
            var name = "";
            if (save.temps && save.temps.choice_restore_name) name = save.temps.choice_restore_name;
            options.push({ name: name + " (" + simpleDateTimeFormat(date) + ")", group: "choice", state: save });
          }
          if (!options.length) {
            self.printLine("There are no saves to delete.");
            renderRestoreMenu(saveList, dirtySaveList);
            return;
          }
          function submitButtonNameFunction(count) {
            if (count == 1) {
              return "Delete 1 Save";
            } else {
              return "Delete " + count + " Saves";
            }
          }
          printCheckboxes(options, submitButtonNameFunction, function (results) {
            startLoading();
            var deletionDate = Date.now();
            clearScreen(function () {
              Promise.all(results.map(function (result, i) {
                if (result) {
                  return new Promise(function (resolve, reject) {
                    var save = options[i].state;
                    var slot = "save" + save.timestamp;
                    var oldDeleted = save.deleted;
                    save.deleted = deletionDate;
                    var value = computeCookie(save.stats, save.temps, save.lineNum, save.indent, save.deleted, save.undeleted);
                    writeCookie(value, slot, function(ok) {
                      submitRemoteSave(slot, email, !"subscribe", function (ok) {
                        if (ok) {
                          resolve();
                        } else {
                          save.deleted = oldDeleted;
                          var value = computeCookie(save.stats, save.temps, save.lineNum, save.indent, save.deleted, save.undeleted);
                          writeCookie(value, slot, function () {});
                          reject(new Error("Failed submitting " + slot));
                        }
                      })
                    })
                  });
                }
              })).then(function () {
                doneLoading();
                renderRestoreMenu(saveList, dirtySaveList);
              }).catch(function(err) {
                self.printLine("There was an error deleting saves. Please try again later.");
                renderRestoreMenu(saveList, dirtySaveList);
              });
            });
          });
          printFooter();
        });
      } else if (option.undeleting) {
        synchronizeBeforeEdit(function renderUndeleteMenu(email) {
          var options = [];
          for (var i = 0; i < saveList.length; i++) {
            var save = saveList[i];
            var date = new Date(save.timestamp * 1);
            if (!save) continue;
            if (!save.deleted || save.deleted < save.undeleted) {
              continue;
            }
            var name = "";
            if (save.temps && save.temps.choice_restore_name) name = save.temps.choice_restore_name;
            options.push({ name: name + " (" + simpleDateTimeFormat(date) + ")", group: "choice", state: save });
          }
          if (!options.length) {
            self.printLine("There are no recently deleted saves to undelete.");
            renderRestoreMenu(saveList, dirtySaveList);
            return;
          }
          function submitButtonNameFunction(count) {
            if (count == 1) {
              return "Undelete 1 Save";
            } else {
              return "Undelete " + count + " Saves";
            }
          }
          printCheckboxes(options, submitButtonNameFunction, function (results) {
            startLoading();
            var undeletionDate = Date.now();
            clearScreen(function () {
              Promise.all(results.map(function (result, i) {
                if (result) {
                  return new Promise(function (resolve) {
                    var save = options[i].state;
                    var slot = "save" + save.timestamp;
                    var oldUndeleted = save.undeleted;
                    save.undeleted = undeletionDate;
                    var value = computeCookie(save.stats, save.temps, save.lineNum, save.indent, save.deleted, save.undeleted);
                    writeCookie(value, slot, function (ok) {
                      submitRemoteSave(slot, email, !"subscribe", function (ok) {
                        if (ok) {
                          resolve();
                        } else {
                          save.undeleted = oldUndeleted;
                          var value = computeCookie(save.stats, save.temps, save.lineNum, save.indent, save.deleted, save.undeleted);
                          writeCookie(value, slot, function () { });
                          reject(new Error("Failed submitting " + slot));
                        }
                      })
                    })
                  });
                }
              })).then(function () {
                doneLoading();
                renderRestoreMenu(saveList, dirtySaveList);
              }).catch(function (err) {
                self.printLine("There was an error undeleting saves. Please try again later.");
                renderRestoreMenu(saveList, dirtySaveList);
              });
            });
          });
          printFooter();
        });
      } else if (option.password) {
        clearScreen(function() {
          self.restore_password();
        });
      } else {
        if (option.cancel) {
          self.finished = false;
          if (typeof cancelLabel !== "undefined") {
            self["goto"](cancelLabel);
          }
          self.resetPage();
        } else {
          var state = option.state;
          var sceneName = null;
          if (state.stats && state.stats.sceneName) sceneName = (""+state.stats.sceneName).toLowerCase();
          var unrestorable = unrestorableScenes[sceneName];

          if (unrestorable) {
            asyncAlert(unrestorable);
            self.finished = false;
            self.resetPage();
            return;
          }

          saveCookie(function() {
            clearScreen(function() {
              restoreGame(state, null, /*userRestored*/true);
            });
          }, "", state.stats, state.temps, state.lineNum, state.indent);
        }
      }
    });
  }
  getDirtySaveList(function(dirtySaveList) {
    getSaves(function(saveList) {
      renderRestoreMenu(saveList, dirtySaveList);
    });
  });
};

Scene.prototype.restore_password = function restore_password() {
  var alreadyFinished = this.finished;
  this.finished = true;
  this.paragraph();
  this.printLine('Please paste your password here, then press "Next" below to continue.');
  this.prevLine = "text";
  this.paragraph();
  var self = this;
  var unrestorableScenes = this.parseRestoreGame(alreadyFinished);
  getPassword(this.target, function (cancel, password) {
    if (cancel) {
      self.finished = false;
      self.resetPage();
      return;
    }
    password = password.replace(/\s/g, "");
    password = password.replace(/^.*BEGINPASSWORD-----/, "");
    var token = self.deobfuscatePassword(password);
    token = token.replace(/^[^\{]*/, "");
    token = token.replace(/[^\}]*$/, "");
    var state;
    try {
      state = jsonParse(token);
    } catch (e) {
      asyncAlert("Sorry, that password was invalid. Please contact " + getSupportEmail() + " for assistance. Be sure to include your password in the email.");
      return;
    }

    var sceneName = null;
    if (state.stats && state.stats.sceneName) sceneName = (""+state.stats.sceneName).toLowerCase();

    var unrestorable = unrestorableScenes[sceneName];
    if (unrestorable) {
      asyncAlert(unrestorable);
      self.finished = false;
      self.resetPage();
      return;
    }

    saveCookie(function() {
      clearScreen(function() {
        // we're going to pretend not to be user restored, so we get reprompted to save
        restoreGame(state, null, /*userRestored*/false);
      });
    }, "", state.stats, state.temps, state.lineNum, state.indent);
  });
  if (alreadyFinished) printFooter();
};

Scene.prototype.parseRestoreGame = function parseRestoreGame(alreadyFinished) {
    if (alreadyFinished) {
      // if we're already finished, the printLoop bumped us an extra line ahead
      this.lineNum--;
      this.rollbackLineCoverage();
    }
    // nextIndent: the level of indentation after the current line
    var nextIndent = null;
    var unrestorableScenes = {};
    var line;
    var startIndent = this.indent;
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent > startIndent) {
                this.indent = nextIndent = indent;
            }
        }
        if (indent <= startIndent) {
            // it's over!
            if (!alreadyFinished) {
              this.lineNum--;
              this.rollbackLineCoverage();
            }
            return unrestorableScenes;
        }
        if (indent != this.indent) {
            // all chart rows are supposed to be at the same indentation level
            // anything at the wrong indentation level might be a mis-indented title/definition
            // or just a typo
            throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
        }

        //
        // *restore_game
        //   ending You can't restore to the ending.

        line = trim(line);
        var result = /^(\w+)\s+(.*)/.exec(line);
        if (!result) throw new Error(this.lineMsg() + "invalid line; this line should have a scene name followed by an error message: " + line);
        var sceneName = result[1].toLowerCase();
        var error = trim(result[2]);
        unrestorableScenes[sceneName] = error;
    }
    if (!alreadyFinished) {
      this.lineNum--;
      this.rollbackLineCoverage();
    }
    return unrestorableScenes;
};

Scene.prototype.check_registration = function scene_checkRegistration() {
  if (typeof window == "undefined" || typeof isRegistered == "undefined") return;
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  isRegistered(function() {
    self.finished = false;
    self.skipFooter = false;
    self.execute();
  });
};

Scene.prototype.login = function scene_login(optional) {
  if (typeof window == "undefined" || typeof loginForm == "undefined") return;
  optional = trim(optional);
  if (optional) {
    if (optional != "optional") throw new Error(this.lineMsg() + "invalid *login option: " + optional);
    optional = 1;
  }
  var self = this;
  this.finished = true;
  this.skipFooter = true;
  this.paragraph();
  var target = this.target;
  if (!target) target = document.getElementById('text');
  loginForm(target, optional, null, function() {
    clearScreen(function() {
      self.finished = false;
      self.prevLine = "empty";
      self.screenEmpty = true;
      self.execute();
    });
  });
};

Scene.prototype.save_game = function save_game(destinationSceneName) {
  if (!destinationSceneName) throw new Error(this.lineMsg()+"*save_game requires a destination file name, e.g. *save_game Episode2");
  if (this.temps.choice_user_restored) return;
  var self = this;
  this.finished = true;
  this.skipFooter = true;
  fetchEmail(function(defaultEmail){
    self.paragraph();
    var form = document.createElement("form");
    setClass(form, "saveGame");

    form.action="#";

    var message = document.createElement("div");
    message.style.color = "red";
    message.style.fontWeight = "bold";
    form.appendChild(message);

    var saveName = document.createElement("input");
    saveName.type="text";
    saveName.name="saveName";
    saveName.setAttribute("placeholder", "Type a name for your saved game");
    saveName.setAttribute("style", "display:block; font-size: 25px; width: 90%; margin: 1rem 0");
    form.appendChild(saveName);

    var hideEmailForm = false;
    // hideEmailForm = _global.automaticCloudStorage;
    if (!hideEmailForm) {
      println("Please login to the choiceofgames.com save system with your email address below.", form);

      var emailInput = document.createElement("input");
      // This can fail on IE
      try { emailInput.type="email"; } catch (e) {}
      emailInput.name="email";
      emailInput.value=defaultEmail;
      emailInput.setAttribute("placeholder", "you@example.com");
      emailInput.setAttribute("style", "display:block; font-size: 25px; width: 90%; margin: 1rem 0");
      form.appendChild(emailInput);

      var subscribeLabel = document.createElement("label");
      subscribeLabel.setAttribute("for", "subscribeBox");
      var subscribeBox = document.createElement("input");
      subscribeBox.type = "checkbox";
      subscribeBox.name = "subscribe";
      subscribeBox.setAttribute("id", "subscribeBox");
      subscribeBox.setAttribute("checked", true);
      subscribeLabel.appendChild(subscribeBox);
      subscribeLabel.appendChild(document.createTextNode("Email me when new games are available."));
      form.appendChild(subscribeLabel);
    }

    var target = this.target;
    if (!target) target = document.getElementById('text');
    target.appendChild(form);
    printButton("Next", form, true);

    printButton("Cancel", target, false, function() {
      clearScreen(function() {
        self.finished = false;
        self.prevLine = "empty";
        self.screenEmpty = true;
        self.execute();
      });
    });

    form.onsubmit = function(e) {
      preventDefault(e);
      safeCall(this, function() {
        var messageText;
        if (!trim(saveName.value)) {
          messageText = document.createTextNode("Please type a name for your saved game.");
          message.innerHTML = "";
          message.appendChild(messageText);
          return;
        }

        var slot = "save" + new Date().getTime();
        // create a clone stats object whose scene name is the destination scene
        var saveStats = {};
        for (var stat in self.stats) {
          if ("scene" == stat) continue;
          saveStats[stat] = self.stats[stat];
        }
        saveStats.scene = {name:destinationSceneName};

        if (hideEmailForm) {
          clearScreen(function() {
            saveCookie(function() {
              recordSave(slot, function() {
                self.finished = false;
                self.prevLine = "empty";
                self.screenEmpty = true;
                self.execute();
              });
            }, slot, saveStats, {choice_reuse:"allow", choice_user_restored:true, choice_restore_name:saveName.value}, 0, 0);
          });
          return;
        }

        var shouldSubscribe = subscribeBox.checked;
        var subscribe = shouldSubscribe && (window.isHeartsChoice ? "hc" : "cog");
        var email = trim(emailInput.value);
        if (!/^\S+@\S+\.\S+$/.test(email)) {
          messageText = document.createTextNode("Sorry, \""+email+"\" is not an email address.  Please type your email address again.");
          message.innerHTML = "";
          message.appendChild(messageText);
          return;
        }

        recordEmail(email, function() {
          clearScreen(function() {
            saveCookie(function() {
              recordSave(slot, function() {
                startLoading();
                submitRemoteSave(slot, email, subscribe, function(ok) {
                  doneLoading();
                  if (!ok) {
                    asyncAlert("Couldn't upload your saved game to choiceofgames.com. You can try again later from the Restore menu.", function() {
                      self.finished = false;
                      self.prevLine = "empty";
                      self.screenEmpty = true;
                      self.execute();
                    });
                  } else {
                    self.finished = false;
                    self.prevLine = "empty";
                    self.screenEmpty = true;
                    self.execute();
                  }
                });
              });
            }, slot, saveStats, {choice_reuse:"allow", choice_user_restored:true, choice_restore_name:saveName.value}, 0, 0);
          });
        });
      });
    };

    printFooter();
  });
};

Scene.prototype.show_password = function show_password() {
  if (this.temps.choice_user_restored) return;
  this.paragraph();
  if (typeof(window) != "undefined" && !window.isMobile) {
    this.printLine('Please copy and paste the password in a safe place, then press "Next" below to continue.');
    println("", this.target);
    println("", this.target);
  }
  var password = computeCookie(this.stats, this.temps, this.lineNum, this.indent);
  password = this.obfuscate(password);
  showPassword(this.target, password);
  this.prevLine = "block";
};

Scene.prototype.obfuscate = function obfuscate(password) {
  var self = this;
  return password.replace(/./g,
    function(x) {
      var y = self.obfuscator[x];
      return y;
    }
  );
};

// The obfuscator must take US-ASCII and obfuscate it
// for use in a password.  This password will be sent via
// HTML email and its whitespace handling will be unpredictable,
// So we can't output any of these characters: [ <>&]
// Since we're losing four characters of output, we JSON-escape
// four characters of input [^`|~].
Scene.prototype.obfuscator = {
  " ": "k",
  "!": "E",
  "\"": "`",
  "#": "\\",
  "$": "r",
  "%": "J",
  "&": "o",
  "'": "0",
  "(": "Z",
  ")": "M",
  "*": "G",
  "+": "t",
  ",": "Y",
  "-": "f",
  ".": "2",
  "/": "!",
  "0": "i",
  "1": "*",
  "2": "1",
  "3": "3",
  "4": "[",
  "5": "6",
  "6": "v",
  "7": "\"",
  "8": "F",
  "9": "9",
  ":": "{",
  ";": "Q",
  "<": "?",
  "=": "5",
  ">": "#",
  "?": "K",
  "@": "/",
  "A": "=",
  "B": "N",
  "C": "z",
  "D": "$",
  "E": "W",
  "F": "(",
  "G": ")",
  "H": "q",
  "I": "C",
  "J": "+",
  "K": "U",
  "L": ".",
  "M": "H",
  "N": "B",
  "O": "S",
  "P": "X",
  "Q": "I",
  "R": "-",
  "S": "m",
  "T": "D",
  "U": "^",
  "V": "A",
  "W": "a",
  "X": "y",
  "Y": ",",
  "Z": "d",
  "[": "O",
  "\\": "s",
  "]": "8",
  "^": "sVii6h",
  "_": "]",
  "`": "sViivi",
  "a": "4",
  "b": "g",
  "c": "%",
  "d": "w",
  "e": "h",
  "f": "n",
  "g": "b",
  "h": "7",
  "i": "x",
  "j": "~",
  "k": "_",
  "l": "l",
  "m": ":",
  "n": "c",
  "o": "L",
  "p": "j",
  "q": "u",
  "r": "R",
  "s": "}",
  "t": "p",
  "u": "V",
  "v": "P",
  "w": "'",
  "x": "T",
  "y": "|",
  "z": "@",
  "{": "e",
  "|": "sVii\"%",
  "}": ";",
  "~": "sVii\"h"
};
Scene.prototype.deobfuscator = {
  "k": " ",
  "E": "!",
  "`": "\"",
  "\\": "#",
  "r": "$",
  "J": "%",
  "o": "&",
  "0": "'",
  "Z": "(",
  "M": ")",
  "G": "*",
  "t": "+",
  "Y": ",",
  "f": "-",
  "2": ".",
  "!": "/",
  "i": "0",
  "*": "1",
  "1": "2",
  "3": "3",
  "[": "4",
  "6": "5",
  "v": "6",
  "\"": "7",
  "F": "8",
  "9": "9",
  "{": ":",
  "Q": ";",
  "?": "<",
  "5": "=",
  "#": ">",
  "K": "?",
  "/": "@",
  "=": "A",
  "N": "B",
  "z": "C",
  "$": "D",
  "W": "E",
  "(": "F",
  ")": "G",
  "q": "H",
  "C": "I",
  "+": "J",
  "U": "K",
  ".": "L",
  "H": "M",
  "B": "N",
  "S": "O",
  "X": "P",
  "I": "Q",
  "-": "R",
  "m": "S",
  "D": "T",
  "^": "U",
  "A": "V",
  "a": "W",
  "y": "X",
  ",": "Y",
  "d": "Z",
  "O": "[",
  "s": "\\",
  "8": "]",
  "]": "_",
  "4": "a",
  "g": "b",
  "%": "c",
  "w": "d",
  "h": "e",
  "n": "f",
  "b": "g",
  "7": "h",
  "x": "i",
  "~": "j",
  "_": "k",
  "l": "l",
  ":": "m",
  "c": "n",
  "L": "o",
  "j": "p",
  "u": "q",
  "R": "r",
  "}": "s",
  "p": "t",
  "V": "u",
  "P": "v",
  "'": "w",
  "T": "x",
  "|": "y",
  "@": "z",
  "e": "{",
  ";": "}"
};

Scene.prototype.deobfuscatePassword = function deobfuscatePassword(password) {
  var self = this;
  password = password.replace(/./g,
    function(x) {
      var y = self.deobfuscator[x];
      return y;
    }
  );
  return password;
};

Scene.prototype.stat_chart = function stat_chart() {
  this.paragraph();
  var rows = this.parseStatChart();
  var target = this.target;
  if (!target) target = document.getElementById('text');

  var barWidth = 0;
  var standardFontSize = 0;

  function fixFontSize(span1, span2) {
    if (!standardFontSize) {
      if (window.getComputedStyle) {
        standardFontSize = parseInt(getComputedStyle(document.body).fontSize, 10);
      } else if (document.body.currentStyle) {
        standardFontSize = parseInt(document.body.currentStyle.fontSize, 10);
      } else {
        standardFontSize = 16;
      }
    }
    if (!barWidth) barWidth = span1.parentNode.offsetWidth;
    var spanMaxWidth, biggestSpanWidth;
    if (span2) {
      spanMaxWidth = barWidth / 2 - 1; /* minus one as a fudge factor; why is this needed? */
      biggestSpanWidth = Math.max(span1.offsetWidth, span2.offsetWidth);
    } else {
      spanMaxWidth = barWidth;
      biggestSpanWidth = span1.offsetWidth;
    }

    if (biggestSpanWidth > spanMaxWidth) {
      var newSize = Math.floor(standardFontSize * spanMaxWidth / biggestSpanWidth);
      span1.parentNode.style.fontSize = newSize + "px";
      if (window.getComputedStyle) {
        // on Android, if the user is using non-standand styles, browser may try to ignore our font setting
        var actual = parseInt(getComputedStyle(span1).fontSize, 10);
        if (actual > newSize) {
          newSize *= newSize / actual;
          span1.parentNode.style.fontSize = newSize + "px";
        }
      }
    }

  }

  for (i = 0; i < rows.length; i++) {
    var row = rows[i];
    var type = row.type;
    var variable = row.variable;
    var value = this.evaluateExpr(this.tokenizeExpr(variable));
    var label = this.replaceVariables(row.label);
    var definition = this.replaceVariables(row.definition || "");

    var statWidth, div, span, statValue;
    if (type == "text") {
      div = document.createElement("div");
      setClass(div, "statText");
      span = document.createElement("span");
      if (trim(label) || trim(value)) {
        printx(label + ": " + value, span);
      } else {
        // unofficial line_break
        printx(" ", span);
      }
      div.appendChild(span);
      target.appendChild(div);
    } else if (type == "percent") {
      div = document.createElement("div");
      setClass(div, "statBar statLine");
      span = document.createElement("span");
      printx("\u00a0\u00a0"+label+": "+value+"%", span);
      div.appendChild(span);
      statValue = document.createElement("div");
      setClass(statValue, "statValue");
      statValue.style.width = value+"%";
      statValue.innerHTML = "&nbsp;";
      div.appendChild(statValue);
      target.appendChild(div);
      fixFontSize(span);
    } else if (type == "opposed_pair") {
      div = document.createElement("div");
      setClass(div, "statBar statLine opposed");
      span0 = document.createElement("span");
      printx("\u00a0\u00a0"+label+": "+value+"% ", span0);
      div.appendChild(span0);
      span = document.createElement("span");
      span.setAttribute("style", "float: right");
      printx(this.replaceVariables(row.opposed_label)+": "+(100-value)+"%\u00a0\u00a0", span);
      div.appendChild(span);
      statValue = document.createElement("div");
      setClass(statValue, "statValue");
      statValue.style.width = value+"%";
      statValue.innerHTML = "&nbsp;";
      div.appendChild(statValue);
      target.appendChild(div);
      fixFontSize(span0, span);
    } else {
      throw new Error("Bug! Parser accepted an unknown row type: " + type);
    }
  }
  this.prevLine = "block";
  this.screenEmpty = false;
};

Scene.prototype.save_checkpoint = function saveCheckpoint(slot) {
  var stat;
  if (slot) {
    if (!/^[a-zA-Z0-9_]+$/.test(slot)) throw new Error(this.lineMsg() + "Invalid *save_checkpoint slot, must be only letters, numbers, and _ underscores: " + slot);
    slot = slot.toLowerCase();
    stat = "choice_saved_checkpoint_" + slot;
  } else {
    slot = "checkpoint";
    stat = "choice_saved_checkpoint";
  }
  if (this.secondaryMode) throw new Error(this.lineMsg() + "Cannot *save_checkpoint in " + this.secondaryMode + " mode");
  this.stats[stat] = true;
  this.temps.choice_just_restored_checkpoint = false;
  saveCookie(function () {}, slot, this.stats, this.temps, this.lineNum + 1, this.indent, this.debugMode, this.nav);
}

Scene.prototype.restore_checkpoint = function restoreCheckpoint(slot) {
  var stat;
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  if (!this.testPath && this.secondaryMode) {
    if (this.secondaryMode === 'stats') {
      restoreCheckpointFromStats(function () {
        delete self.secondaryMode;
        delete self.saveSlot;
        self.restore_checkpoint(slot);
      })
      return;
    } else {
      throw new Error(this.lineMsg() + "Cannot *restore_checkpoint in " + this.secondaryMode + " mode");
    }
  }

  if (slot) {
    if (!/^[a-zA-Z0-9_]+$/.test(slot)) throw new Error(this.lineMsg() + "Invalid *restore_checkpoint slot, must be only letters, numbers, and _ underscores: " + slot);
    slot = slot.toLowerCase();
    stat = "choice_saved_checkpoint_" + slot;
  } else {
    slot = "checkpoint";
    stat = "choice_saved_checkpoint";
  }
  if (!this.stats[stat]) {
    var certainty = this.testPath ? " could fail; we might not have" : " failed; we haven't";
    if (slot === "checkpoint") {
      throw new Error(this.lineMsg() + "*restore_checkpoint" + certainty + " saved a checkpoint. Use *if " + stat);
    } else {
      throw new Error(this.lineMsg() + "*restore_checkpoint for slot " + slot + certainty + " reached *save_checkpoint " + slot + ". Use *if " + stat);
    }
  }

  if (this.testPath) return;

  var forcedStats = null;
  var forcedTemps = {choice_just_restored_checkpoint: true};
  if (this.stats.checkpoint_exclusions || this.temps.checkpoint_exclusions) {
    var exclusions = trim(this.getVar('checkpoint_exclusions').toLowerCase()).split(' ');
    for (var i = 0; i < exclusions.length; i++) {
      var exclusion = exclusions[i];
      if (exclusion in this.stats) {
        if (!forcedStats) forcedStats = {};
        forcedStats[exclusion] = this.stats[exclusion];
      }
      if (exclusion in this.temps) {
        if (!forcedTemps) forcedTemps = {};
        forcedTemps[exclusion] = this.temps[exclusion];
      }
    }
  }

  loadAndRestoreGame(slot, null, forcedStats, forcedTemps);
}

Scene.prototype.parseStatChart = function parseStatChart() {
    // nextIndent: the level of indentation after the current line
    var nextIndent = null;
    var rows = [];
    var line, line1, line2, line2indent;
    var startIndent = this.indent;
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent <= startIndent) {
                throw new Error(this.lineMsg() + "invalid indent, expected at least one row");
            }
            this.indent = nextIndent = indent;
        }
        if (indent <= startIndent) {
            // it's over!
            this.rollbackLineCoverage();
            this.lineNum = this.previousNonBlankLineNum();
            this.rollbackLineCoverage();
            return rows;
        }
        if (indent != this.indent) {
            // all chart rows are supposed to be at the same indentation level
            // anything at the wrong indentation level might be a mis-indented title/definition
            // or just a typo
            throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
        }

        //
        // *stat_chart
        //   text wounds Wounds
        //     Definition
        //   percent Infamy Infamy
        //     Definition
        //   opposed_pair brutality
        //     Brutality
        //       Strength and cruelty
        //     Finesse
        //       Precision and aerial maneuverability
        //

        // TODO opposed_pair
        // TODO definitions
        // TODO variable substitutions
        // TODO *if/*else
        // TODO *line_break
        line = trim(line);
        var result = /^(text|percent|opposed_pair)\s+(.*)/.exec(line);
        if (!result) throw new Error(this.lineMsg() + "invalid line; this line should start with 'percent', 'text', or 'opposed_pair'");
        var type = result[1].toLowerCase();
        var data = trim(result[2]);
        if ("opposed_pair" == type) {
          this.getVar(data);
          line1 = this.lines[++this.lineNum];
          this.replaceVariables(line1);
          line1indent = this.getIndent(line1);
          if (line1indent <= this.indent) throw new Error(this.lineMsg() + "invalid indent; expected at least one indented line to indicate opposed pair name. indent: " + line1indent + ", expected greater than " + this.indent);
          line2 = this.lines[this.lineNum + 1];
          line2indent = this.getIndent(line2);
          if (line2indent <= this.indent) {
            // line1 was the only line
            rows.push({type: type, variable: data, label: data, opposed_label: trim(line1)});
          } else {
            this.lineNum++;
            this.replaceVariables(line2);
            if (line2indent == line1indent) {
              // two lines: first label, second label
              rows.push({type: type, variable: data, label: trim(line1), opposed_label: trim(line2)});
            } else if (line2indent > line1indent) {
              // line 2 is a definition; therefore the opposed_label and its definition must be on lines 3 and 4
              var line1definition = line2;
              var line3 = this.lines[++this.lineNum];
              this.replaceVariables(line3);
              var line3indent = this.getIndent(line3);
              if (line3indent != line1indent) throw new Error(this.lineMsg() + "invalid indent; this line should be the opposing label name. expected " + line1indent + " was " + line3indent);
              var line4 = this.lines[++this.lineNum];
              this.replaceVariables(line4);
              var line4indent = this.getIndent(line4);
              if (line4indent != line2indent) throw new Error(this.lineMsg() + "invalid indent; this line should be the opposing label definition. expected " + line2indent + " was " + line4indent);
              rows.push({type: type, variable: data, label: trim(line1), definition:trim(line2), opposed_label: trim(line3), opposed_definition: trim(line4)});
            } else {
              throw new Error(this.lineMsg() + "invalid indent; expected a second line with indent " + line1indent + " to match line " + this.lineNum + ", or else no more opposed_pair lines");
            }
          }
        } else {
          var variable, label;
          if (!/ /.test(data)) {
            variable = data;
            label = data;
          } else if (/^\(/.test(data)) {
            var parens = 0;
            var closingParen = -1;
            for (var i = 1; i < data.length; i++) {
              var c = data.charAt(i);
              if (c === "(") {
                parens++;
              } else if (c === ")") {
                if (parens) {
                  parens--;
                } else {
                  closingParen = i;
                  break;
                }
              }
            }
            if (closingParen == -1) {
              throw new Error(this.lineMsg() + "missing closing parenthesis");
            }
            variable = data.substring(1, closingParen);
            label = trim(data.substring(closingParen+1))
            if (label === "") {
              label = variable;
            }
          } else {
            result = /^(\S+) (.*)/.exec(data);
            if (!result) throw new Error(this.lineMsg() + "Bug! can't find a space when a space was found");
            variable = result[1];
            label = result[2];
          }
          this.evaluateExpr(this.tokenizeExpr(variable));
          this.replaceVariables(label);
          line2 = this.lines[this.lineNum + 1];
          line2indent = this.getIndent(line2);
          if (line2indent <= this.indent) {
            // No definition line
            rows.push({type: type, variable: variable, label: label});
          } else {
            this.lineNum++;
            this.replaceVariables(line2);
            rows.push({type: type, variable: variable, label: label, definition: trim(line2)});
          }
        }
    }
    return rows;
};

// *timer Dec 25, 2016 9:30:00 PDT
Scene.prototype.timer = function(dateString) {
  var end;
  if (dateString == "release") {
    if (typeof window === "undefined" || !window.releaseDate) return;
    end = window.releaseDate/1000;
  } else {
    end = Date.parse(dateString)/1000;
  }
  var now = new Date()/1000;
  if (now < end) {
    var target = this.target;
    if (!target) {
      target = document.createElement("p");
      document.getElementById('text').appendChild(target);
    }
    var self = this;
    showTicker(target, end, function() {
      clearScreen(loadAndRestoreGame());
    });
  }
}

// *delay_break 1200
Scene.prototype.delay_break = function(durationInSeconds) {
  if (isNaN(durationInSeconds * 1)) throw new Error(this.lineMsg() + "invalid duration");
  this.finished = true;
  this.skipFooter = true;
  var target = this.target;
  if (!target) {
    target = document.createElement("p");
    document.getElementById('text').appendChild(target);
  }
  this.paragraph();
  var self = this;
  delayBreakStart(function(delayStart) {
    window.blockRestart = true;
    var endTimeInSeconds = durationInSeconds * 1 + delayStart * 1;
    showTicker(target, endTimeInSeconds, function() {
      self.page_break_advertisement();
    });
    printFooter();
  });
};

// *delay_ending 1200 $2.99 $0.99
Scene.prototype.delay_ending = function(data) {
  // Steam doesn't do delay breaks and especially not skiponce
  if (typeof window != "undefined" && !!window.isSteamApp) {
    return this.ending();
  }
  var args = data.split(/ /);
  var durationInSeconds = args[0];
  var fullPriceGuess = args[1];
  var singleUsePriceGuess = args[2];
  if (isNaN(durationInSeconds * 1)) throw new Error(this.lineMsg() + "invalid duration");
  if (!/^\$/.test(fullPriceGuess)) throw new Error(this.lineMsg() + "invalid fullPriceGuess: \""+fullPriceGuess+"\"");
  if (singleUsePriceGuess && !/^\$/.test(singleUsePriceGuess)) throw new Error(this.lineMsg() + "invalid singleUsePriceGuess: \""+singleUsePriceGuess+"\"");
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  checkPurchase("adfree", function(ok, result) {
    if (result.adfree || !result.billingSupported) {
      self.ending();
      return;
    }
    getPrice("adfree", function (fullPrice) {
      if (fullPrice == "guess") fullPrice = fullPriceGuess;
      getPrice("skiponce", function (singleUsePrice) {
        if (singleUsePrice == "guess") singleUsePrice = singleUsePriceGuess;

        options = [];
        var finishedWaiting = {name: "Play again after a short wait. ", unselectable: true};
        options.push(finishedWaiting);
        var upgradeSkip = {name: "Upgrade to the unlimited version for " + fullPrice + " to skip the wait forever."};
        options.push(upgradeSkip);
        var skipOnce = {name: "Skip the wait one time for " + singleUsePrice + "."};
        if (singleUsePriceGuess) options.push(skipOnce);
        var restorePurchasesOption = {name: "Restore purchases from another device."};
        if (isRestorePurchasesSupported()) options.push(restorePurchasesOption);
        var playMoreGames = {name: "Play more games like this."};
        options.push(playMoreGames);
        var emailMe = {name: "Email me when new games are available."};
        options.push(emailMe);

        function restartNow() {
          window.blockRestart = false;
          restartGame();
        }

        self.paragraph();
        printOptions([""], options, function(option) {
          if (option == playMoreGames) {
            self.more_games("now");
            if (typeof curl != "undefined") curl();
          } else if (option == emailMe) {
            subscribeLink();
          } else if (option == upgradeSkip) {
            purchase("adfree", restartNow);
          } else if (option == skipOnce) {
            purchase("skiponce", restartNow);
          } else if (option == restorePurchasesOption) {
            restorePurchases("adfree", function() {
              clearScreen(loadAndRestoreGame);
            });
          } else {
            return restartGame();
          }
        });

        var target = document.querySelector(".choice label");

        delayBreakStart(function(delayStart) {
          window.blockRestart = true;
          var endTimeInSeconds = durationInSeconds * 1 + delayStart * 1;
          showTicker(target, endTimeInSeconds, function() {
            clearScreen(function() {
              self.ending();
            });
          });
          printFooter();
        });
      });
    });
  });

};

// *if booleanExpr
// execute different code depending on whether the booleanExpr is true or false
//
// Examples:
// *if bool-expression
//     blah
//     blah
// *elseif bool-expression
//     blah
//     blah
// *else
//     blah
//     blah
// bool-expression
//     by reference
//         *set foo true
//         *if foo ...
//     equality
//         foo=2
//         foo="blah"
//         2="2"
//             true
//     inequality
//         foo>2
//         foo<2
//         foo<=2
//         foo>=2
//     and/or logic, parentheses mandatory
//         (foo=2) or (foo=3)
//         ((foo>4) and (foo<8)) or (bar=0)
//
// NOTE: *if commands may be used inside *choices, to make some choices conditionally available
Scene.prototype["if"] = function scene_if(line) {
    var stack = this.tokenizeExpr(line);
    var result = this.evaluateExpr(stack);
    if (this.debugMode) println(line + " :: " + result);
    result = bool(result, this.lineNum+1);
    if (result) {
        // "true" branch, just go on to the next line
        this.indent = this.getIndent(this.nextNonBlankLine());
    } else {
        // "false" branch; skip over the true branch
        this.skipTrueBranch(false);
    }
};

// TODO Rename this function to just skipBranch
Scene.prototype.skipTrueBranch = function skipTrueBranch(inElse) {
  var startIndent = this.indent;
  var nextIndent = null;
  var line;
  while (isDefined(line = this.lines[++this.lineNum])) {
      this.rollbackLineCoverage();
      if (!trim(line)) continue;
      var indent = this.getIndent(line);
      if (nextIndent === null || nextIndent === undefined) {
          if (indent <= startIndent) throw new Error(this.lineMsg() + "invalid indent, expected at least one line in 'if' true block");
          nextIndent = indent;
      }
      if (indent <= startIndent) {
          // true block is over
          var parsed = null;
          // check to see if this is an *else or *elseif
          if (indent == startIndent) parsed = /^\s*\*(\w+)(.*)/.exec(line);
          if (!parsed || inElse) {
              this.lineNum = this.previousNonBlankLineNum();
              this.rollbackLineCoverage();
              this.indent = indent;
              return;
          }
          var command = parsed[1].toLowerCase();
          var data = trim(parsed[2]);
          if ("else" == command) {
              if (data) {
                if (/^if\b/.test(data)) {
                  throw new Error(this.lineMsg() + "'else if' is invalid, use 'elseif'");
                }
                throw new Error(this.lineMsg() + "nothing should appear on a line after 'else': " + data);
              }
              this.lineNum = this.lineNum; // code coverage
              // go on to the next line
              this.indent = this.getIndent(this.nextNonBlankLine());
          } else if (/^else?if$/.test(command)) {
              this.lineNum = this.lineNum; // code coverage
              this["if"](data);
          } else if ("comment" == command) {
              continue;
          } else {
              this.lineNum = this.previousNonBlankLineNum();
              this.rollbackLineCoverage();
              this.indent = this.getIndent(this.nextNonBlankLine());
          }
          return;
      }
      if (indent < nextIndent) {
          // *if foo
          //      foo
          //    bar
          throw new Error(this.lineMsg() + "invalid indent, expected "+nextIndent+", was " + indent);
      }
  }
};

Scene.prototype["else"] = Scene.prototype.elsif = Scene.prototype.elseif = function scene_else(data, inChoice) {
    // Authors can avoid using goto to get out of an if branch with:  *create implicit_control_flow true
    // This avoids the error message at the end of the function.
    if (inChoice || this.getVar("implicit_control_flow")) {
      this.skipTrueBranch(true);
      return;
    }
    throw new Error(this.lineMsg() + "It is illegal to fall in to an *else statement; you must *goto or *finish before the end of the indented block.");
};

// break the string up into a stack of tokens, defined in Scene.tokens below
Scene.prototype.tokenizeExpr = function tokenizeExpr(str) {
    var stack = [];
    var tokenTypes = Scene.tokens;
    var tokenTypesLength = tokenTypes.length;
    var pos = 0;
    while (str) {
        var matched = false;
        for (var i = 0; i < tokenTypesLength; i++) {
            var tokenType = tokenTypes[i];
            var token = tokenType.test(str, this.lineNum+1, this);
            if (token) {
                matched = true;
                str = str.substr(token.length);
                pos += token.length;
                var item = {name:tokenType.name, value:token, pos:pos};
                if (this.testPath && tokenType.name === "VAR" && /^choice_saved_checkpoint/i.test(token)) {
                  // handle choice_saved_checkpoint in quicktest
                  this.stats[token.toLowerCase()] = true;
                }
                if ("WHITESPACE" == tokenType.name) {
                    break;
                } else if ("CURLY_QUOTE" == tokenType.name) {
                  throw new Error(this.lineMsg()+"Invalid use of curly smart quote: " + token + "\nUse straight quotes \" instead")
                } else if ("FUNCTION" == tokenType.name) {
                  item.func = /^\w+/.exec(token)[0];
                }
                stack.push(item);
                break;
            }
        }
        if (!matched) throw new Error(this.lineMsg()+"Invalid expression, couldn't extract another token: " + str);
    }
    return stack;
};

// evaluate the stack of tokens
// parenthetical == true if we're evaluating a parenthetical expression
// all expressions consist of either a "singleton" value (2) or two values and one operator (2+2)
Scene.prototype.evaluateExpr = function evaluateExpr(stack, parenthetical) {
    if (!stack.length) {
        throw new Error(this.lineMsg() + "no expression specified");
    }
    var self = this;
    function getToken() {
        var token = stack.shift();
        if (!token) throw new Error(self.lineMsg() + "null token");
        return token;
    }

    var token, value1, value2, operator, result;

    value1 = this.evaluateValueToken(getToken(), stack);

    if (!stack.length) {
        if (parenthetical) {
            throw new Error(this.lineMsg() + "Invalid expression, expected " + parenthetical);
        }
        return value1;
    }

    token = getToken();

    if (parenthetical && parenthetical == token.name) {
        return value1;
    }

    // Since this isn't a singleton, it must be an operator
    operator = Scene.operators[token.value];
    if (!operator) {
      throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected OPERATOR"+
        (parenthetical?" or " + parenthetical : "")+
        ", was: " + token.name + " [" + token.value + "]");
    }

    if (token.value === '%') {
      this.warning("this is a bare % sign, which should be replaced with %+, %-, or modulo if you're really advanced.");
      this.warning("For more details on modulo, see: https://forum.choiceofgames.com/t/21176");
    }

    if (!stack[0]) {
      throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected something after a "+token.value);
    }

    if (stack[0].func == "auto") {
      value2 = this.autobalance(stack, token, value1);
    } else {
      value2 = this.evaluateValueToken(getToken(), stack);
    }

    // and do the operator
    result = operator(value1, value2, this.lineNum+1, this);

    if (parenthetical) {
        // expect close parenthesis
        if (stack.length) {
            token = getToken();
            if (parenthetical == token.name) {
                return result;
            } else {
                throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected "+parenthetical+", was: " + token.name + " [" + token.value + "]");
            }
        } else {
            throw new Error(this.lineMsg() + "Invalid expression, expected " + parenthetical);
        }
    } else {
        // if not parenthetical, expect no more tokens
        if (stack.length) {
            token = getToken();
            throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected no more tokens, found: " + token.name + " [" + token.value + "]");
        } else {
            return result;
        }
    }
    throw new Error(this.lineMsg() + "bug, how did I get here?");
};

// turn a number, string, or var token into its value
// or, if this is an open parenthesis, evaluate the parenthetical expression
Scene.prototype.evaluateValueToken = function evaluateValueToken(token, stack) {
    var name = token.name;
    var value;
    if ("OPEN_PARENTHESIS" == name) {
        return this.evaluateExpr(stack, "CLOSE_PARENTHESIS");
    } else if ("OPEN_CURLY" == name) {
        value = this.evaluateExpr(stack, "CLOSE_CURLY");
        return this.getVar(value);
    } else if ("FUNCTION" == name) {
        if (!this.functions[token.func]) throw new Error(this.lineMsg + "Unknown function " + token.func);
        value = this.evaluateExpr(stack, "CLOSE_PARENTHESIS");
        return this.functions[token.func].call(this, value);
    } else if ("NUMBER" == name) {
        return token.value;
    } else if ("STRING" == name) {
        // strip off the quotes and unescape backslashes
        return this.replaceVariables(token.value.slice(1,-1).replace(/\\(.)/g, "$1"));
    } else if ("VAR" == name) {
        var variable = String(token.value);
        while (stack.length && stack[0].name == "OPEN_SQUARE") {
          stack.shift();
          variable += "_" + this.evaluateExpr(stack, "CLOSE_SQUARE");
        }
        return this.getVar(variable);
    } else {
        throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected NUMBER, STRING, VAR or PARENTHETICAL, was: " + name + " [" + token.value + "]");
    }
};

// turn a var token into its name, remove it from the stack
// or if it's a curly parenthesis, evaluate that
// or if it's an array expression, convert it into its raw underscore name
Scene.prototype.evaluateReference = function evaluateReference(stack, options) {
  var toLowerCase = true;
  if (options && options.hasOwnProperty("toLowerCase")) toLowerCase = !!options.toLowerCase;
  function findClosingBracket(stack, type, offset) {
    if (!offset) offset = 0;
    var opens = 0;
    var openType = "OPEN_"+type;
    var closeType = "CLOSE_"+type;
    for (var i = offset; i < stack.length; i++) {
      if (stack[i].name == openType) {
        opens++;
      } else if (stack[i].name == closeType) {
        if (opens) {
          opens--;
        } else {
          return i;
        }
      }
    }
    return -1;
  }
  function normalizeCase(name) {
    if (toLowerCase) {
      return String(name).toLowerCase();
    } else {
      return name;
    }
  }
  if (!stack.length) throw new Error(this.lineMsg()+"Invalid expression, expected a name");
  var name;
  if (stack[0].name === "OPEN_CURLY") {
    stack.shift();
    var closingCurly = findClosingBracket(stack, "CURLY");
    if (closingCurly == -1) throw new Error(this.lineMsg()+"Invalid expression, no closing curly bracket: " + data);
    name = this.evaluateExpr(stack.slice(0, closingCurly));
    stack.splice(0, closingCurly+1);
    return normalizeCase(name);
  } else if (stack[0].name === "NUMBER") {
    // you could have a label that's just a number
    name = stack[0].value;
    stack.shift();
    return name;
  } else {
    if (stack[0].name !== "VAR") throw new Error(this.lineMsg() + "Invalid expression; expected name, found " + stack[0].name + " at char " + stack[0].pos);
    name = String(stack[0].value);
    stack.shift();
    while(stack.length && stack[0].name == "OPEN_SQUARE") {
      var closingBracket = findClosingBracket(stack, "SQUARE", 1);
      if (closingBracket == -1) throw new Error(this.lineMsg()+"Invalid expression, no closing array bracket at char " + stack[1].pos);
      var index = this.evaluateExpr(stack.slice(1, closingBracket));
      name += "_" + index;
      stack.splice(0, closingBracket+1);
    }
    return normalizeCase(name);
  }
};

Scene.prototype.functions = {
  not: function(value) {
    return !bool(value, this.lineNum+1);
  },
  round: function(value) {
    if (isNaN(value*1)) throw new Error(this.lineMsg()+"round() value is not a number: " + value);
    return Math.round(value);
  },
  timestamp: function(value) {
    return Date.parse(value)/1000;
  },
  log: function(value) {
    if (isNaN(value*1)) throw new Error(this.lineMsg()+"log() value is not a number: " + value);
    return Math.log(value)/Math.log(10);
  },
  length: function(value) {
    return String(value).length;
  },
  auto: function() {
    throw new Error(this.lineMsg()+"Invalid expression, auto() must come after a < or > symbol");
  }
};

Scene.prototype.autobalance = function autobalance(stack, operatorToken, value) {
  if (operatorToken.name !== "INEQUALITY") {
    throw new Error(this.lineMsg()+"Invalid expression, auto() must come after a < or > symbol");
  }
  stack.shift(); // remove auto function

  if (stack.length < 4 ||
    stack[0].name !== "NUMBER" ||
    stack[1].name !== "COMMA" ||
    !(stack[2].name == "VAR" || stack[2].name == "NUMBER") ||
    stack[3].name !== "CLOSE_PARENTHESIS"
  ) {
    throw new Error(this.lineMsg()+"Invalid expression, auto() requires (percentage, id)");
  }
  var rateString = stack.shift().value;
  var rate = parseFloat(rateString);
  if (isNaN(rate) || rate < 1 || rate > 99) {
    throw new Error(this.lineMsg()+"the first auto() parameter should be a number between 1 and 99: " + rateString);
  }
  stack.shift(); // comma
  var id = stack.shift().value;
  stack.shift(); // close parenthesis
  var result = this.stats['auto' + '_' + this.name + '_' + id];
  if (typeof result != "undefined") {
    return result;
  } else if (this.recordBalance) {
    return this.recordBalance(value, operatorToken.value, rate, id);
  }
  return 50;
}

Scene.prototype.evaluateValueExpr = function evaluateValueExpr(expr) {
    var stack = this.tokenizeExpr(expr);
    var token = stack.shift();
    if (!token) throw new Error(this.lineMsg() + "null token");
    var value = this.evaluateValueToken(token, stack);
    if (stack.length) {
        token = stack.shift();
        if (!token) throw new Error(this.lineMsg() + "null token");
        throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected no more tokens, found: " + token.name + " [" + token.value + "]");
    }
    return value;
};

Scene.prototype.goto_random_scene = function gotoRandomScene(data) {
  var parsed = this.parseGotoRandomScene(data);
  var allowReuseGlobally = /\ballow_reuse\b/.test(data);
  var allowNoSelection = /\ballow_no_selection\b/.test(data);
  var option = this.computeRandomSelection(Math.random(), parsed, allowReuseGlobally);

  if (option) {
    this.goto_scene(option.name);
  } else {
    if (allowNoSelection) {
      return;
    } else {
      throw new Error(this.lineMsg() + "No selectable scenes");
    }
  }

};

Scene.prototype.parseGotoRandomScene = function parseGotoRandomScene(data) {
    data = data || "";
    var directives = data.split(" ");
    var allowReuseGlobally = false;
    var allowNoSelection = false;
    for (var i = 0; i < directives; i++) {
      var directive = trim(directives[i]);
      if (!directive) continue;
      if (directive == "allow_reuse") {
        allowReuseGlobally = true;
      } else if (directive == "allow_no_selection") {
        allowNoSelection = true;
      } else {
        throw new Error(this.lineMsg() + "invalid command: '" + directive + "'");
      }
    }

    // nextIndent: the level of indentation after the current line
    var nextIndent = null;
    var options = [];
    var line;
    var startIndent = this.indent;
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent <= startIndent) {
                throw new Error(this.lineMsg() + "invalid indent, expected at least one line in *goto_random_scene");
            }
            this.indent = nextIndent = indent;
        }
        if (indent <= startIndent) {
            // it's over!
            this.rollbackLineCoverage();
            this.lineNum--;
            this.rollbackLineCoverage();
            break;
        }
        if (indent != this.indent) {
            // all chart rows are supposed to be at the same indentation level
            // anything at the wrong indentation level might be a mis-indented title/definition
            // or just a typo
            throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
        }
        line = trim(line);

        var option = {allowReuse:allowReuseGlobally};
        var command;
        while(!!(command = /^\*(\S+)/.exec(line))) {
          command = command[1];
          if ("allow_reuse" == command) {
            option.allowReuse = true;
            line = trim(line.substring("*allow_reuse".length));
            command = /^\*(\S+)/.exec(line);
            continue;
          } else if ("if" == command) {
            var conditional = /^\*if\s+\((.+)\)\s+([^\)]+)/.exec(line);
            if (!conditional) throw new Error(this.lineMsg() + " invalid *if, expected () followed by scene name: " + line);
            line = conditional[2];
            var stack = this.tokenizeExpr(conditional[1]);
            this.evaluateExpr(stack);
            option.conditional = conditional[1];
          } else {
            throw new Error(this.lineMsg() + " invalid command: " + line);
          }
        }
        // TODO weights
        option.name = trim(line);
        options.push(option);
    }
    return options;
};

Scene.prototype.computeRandomSelection = function computeRandomSelection(randomFloat, options, allowReuseGlobally) {
  var filtered = [];
  var finished = {};
  if (!allowReuseGlobally) {
    if (!this.stats.choice_grs) this.stats.choice_grs = [];
  }
  var grs = this.stats.choice_grs;
  for (var i = 0; i < grs.length; i++) {
    finished[grs[i]] = 1;
  }
  var option;
  for (i = 0; i < options.length; i++) {
    option = options[i];
    if (!option.allowReuse) {
      if (finished[option.name]) continue;
    }
    if (option.conditional) {
      var stack = this.tokenizeExpr(option.conditional);
      var pass = this.evaluateExpr(stack);
      if (!pass) continue;
    }
    filtered.push(option);
  }
  if (!filtered.length) return null;
  // TODO weights
  var randomSelection = Math.floor(randomFloat*filtered.length);
  option = filtered[randomSelection];
  if (!option.allowReuse) {
    this.stats.choice_grs.push(option.name);
  }
  return option;
};

Scene.prototype.end_trial = function endTrial() {
  this.paragraph();
  printLink(this.target, "#", "Start Over from the Beginning", function(e) {
    preventDefault(e);
    return restartGame("prompt");
  });
  this.prevLine = "block";
  this.screenEmpty = false;
  this.finished = true;
};

Scene.prototype.achieve = function scene_achieve(name) {
  name = name.toLowerCase();
  if (!this.nav.achievements.hasOwnProperty(name)) {
    throw new Error(this.lineMsg() + "the achievement name "+name+" was not declared as an *achievement in startup");
  }
  var achievement = this.nav.achievements[name];
  this.nav.achieved[name] = true;
  if (typeof achieve != "undefined") {
    achieve(name, achievement.title, achievement.earnedDescription);
  }
};

Scene.prototype.check_achievements = function scene_checkAchievements() {
  var self = this;
  function callback(immediately) {
    for (var achievement in nav.achievements) {

      self.temps["choice_achieved_"+achievement] = nav.achieved.hasOwnProperty(achievement);
    }
    if (!immediately) {
      self.finished = false;
      self.skipFooter = false;
      self.execute();
    }
  }
  if (typeof checkAchievements == "undefined") {
    callback("immediately");
  } else {
    this.finished = true;
    this.skipFooter = true;
    checkAchievements(callback);
  }
};

Scene.prototype.scene_list = function scene_list() {
  var scenes = this.parseSceneList();
  this.nav.setSceneList(scenes);
};

Scene.prototype.parseSceneList = function parseSceneList() {
  var nextIndent = null;
  var scenes = [];
  var line;
  var startIndent = this.indent;
  while(isDefined(line = this.lines[++this.lineNum])) {
      if (!trim(line)) {
          this.rollbackLineCoverage();
          continue;
      }
      var indent = this.getIndent(line);
      if (nextIndent === null || nextIndent === undefined) {
          // initialize nextIndent with whatever indentation the line turns out to be
          // ...unless it's not indented at all
          if (indent <= startIndent) {
              throw new Error(this.lineMsg() + "invalid indent, expected at least one row");
          }
          this.indent = nextIndent = indent;
      }
      if (indent <= startIndent) {
          // it's over!
          this.rollbackLineCoverage();
          this.lineNum--;
          this.rollbackLineCoverage();
          return scenes;
      }
      if (indent != this.indent) {
          // all scenes are supposed to be at the same indentation level
          throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
      }

      line = trim(line);
      var purchaseMatch = /^\$(\w*)\s+(.*)/.exec(line);
      if (purchaseMatch) {
        line = purchaseMatch[2];
      }
      if (!scenes.length && "startup" != String(line).toLowerCase()) scenes.push("startup");
      scenes.push(line);
  }
  return scenes;
};

Scene.prototype.title = function scene_title(title) {
  this.stats.choice_title = trim(title);
  if (this.nav) this.nav.startingStats.choice_title = trim(title);
  if (typeof changeTitle != "undefined") {
    changeTitle(title);
  }
};

Scene.prototype.author = function scene_author(author) {
  if (typeof changeAuthor != "undefined") {
    changeAuthor(author);
  }
};

// *achievement name hidden|visible 100 Achievement Title
//     Earned description
//     Pre-earned description
Scene.prototype.achievement = function scene_achievement(data) {
  var parsed = /(\S+)\s+(\S+)\s+(\S+)\s+(.*)/.exec(data);
  if (!parsed) throw new Error(this.lineMsg() + "Invalid *achievement, requires short name, visibility, points, and display title: " + data);
  var achievementName = parsed[1];
  if (!/^[a-z][a-z0-9_]+$/.test(achievementName)) throw new Error(this.lineMsg()+"Invalid achievement name: " +achievementName);

  if (!this.parsedAnAchievment && Object.keys(this.nav.achievements).length > 0) {
    // blow away pre-existing mygame.js achievements
    this.nav.achievements = {};
    this.nav.achievementList = [];
    this.achievementTotal = 0;
    this.seenAchievementTitles = {};
  }

  this.parsedAnAchievment = true;

  if (this.nav.achievements.hasOwnProperty(achievementName)) {
    var preExisting = this.nav.achievements[achievementName];
    throw new Error(this.lineMsg()+"Achievement "+achievementName+" already defined on line " + this.nav.achievements[achievementName].lineNumber);
  }

  var lineNumber = this.lineNum+1;
  var visibility = parsed[2];
  if (visibility != "hidden" && visibility != "visible") {
    throw new Error(this.lineMsg()+"Invalid *achievement, the second word should be either 'hidden' or 'visible': " +visibility);
  }
  var visible = (visibility != "hidden");
  var pointString = parsed[3];
  if (!/[1-9][0-9]*/.test(pointString)) {
    throw new Error(this.lineMsg()+"Invalid *achievement, the third word should be an integer number of points: " + pointString);
  }
  var points = parseInt(pointString, 10);
  if (points > 100) throw new Error(this.lineMsg()+"Invalid *achievement, no achievement may be worth more than 100 points: " + points);
  if (points < 1) throw new Error(this.lineMsg()+"Invalid *achievement, no achievement may be worth less than 1 point: " + points);
  if (!this.achievementTotal) this.achievementTotal = 0;
  this.achievementTotal += points;
  if (this.achievementTotal > 1000) {
    throw new Error(this.lineMsg()+"Invalid achievements. Adding " + points + " would add up to more than 1,000 points: " + this.achievementTotal);
  }
  var title = parsed[4];
  var titleAllowedLength = 50;
  if (/(\$\{)/.test(title)) throw new Error(this.lineMsg()+"Invalid *achievement. ${} not permitted in achievement title: " + title);
  if (/(\@\{)/.test(title)) throw new Error(this.lineMsg()+"Invalid *achievement. @{} not permitted in achievement title: " + title);
  if (/(\[)/.test(title)) throw new Error(this.lineMsg()+"Invalid *achievement. [] not permitted in achievement title: " + title);
  if (title.length > titleAllowedLength) throw new Error(this.lineMsg() + "Invalid *achievement. Title must be " + titleAllowedLength + " characters or fewer: " + title);

  // Get the description from the next indented line
  var line = this.lines[++this.lineNum];
  var indent = this.getIndent(line);
  if (!indent) {
    throw new Error(this.lineMsg()+"Invalid *achievement. An indented description is required.");
  }
  var preEarnedDescription = trim(line);
  var descriptionAllowedLength = 200;
  if (/(\$\{)/.test(preEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. ${} not permitted in achievement description: " + preEarnedDescription);
  if (/(\@\{)/.test(preEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. @{} not permitted in achievement description: " + preEarnedDescription);
  if (/(\[)/.test(preEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. [] not permitted in achievement description: " + preEarnedDescription);
  if (preEarnedDescription.length > descriptionAllowedLength) throw new Error(this.lineMsg() + "Invalid *achievement. Pre-earned description must be " + descriptionAllowedLength + " characters or fewer: " + preEarnedDescription);

  if (!visible) {
    if (preEarnedDescription.toLowerCase() != "hidden") throw new Error(this.lineMsg()+"Invalid *achievement. Hidden achievements must set their pre-earned description to 'hidden'.");
  }

  // Optionally get a post-earned description from the next line
  var postEarnedDescription = null;
  while(isDefined(line = this.lines[++this.lineNum])) {
    if (trim(line)) break;
    this.rollbackLineCoverage();
  }
  indent = this.getIndent(line);
  if (indent) {
    postEarnedDescription = trim(line);
    if (/(\$\{)/.test(postEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. ${} not permitted in achievement description: " + postEarnedDescription);
    if (/(\@\{)/.test(postEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. @{} not permitted in achievement description: " + postEarnedDescription);
    if (/(\[)/.test(postEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. [] not permitted in achievement description: " + postEarnedDescription);
    if (postEarnedDescription.length > descriptionAllowedLength) throw new Error(this.lineMsg() + "Invalid *achievement. Post-earned description must be " + descriptionAllowedLength + " characters or fewer: " + postEarnedDescription);
  } else {
    // No indent means the next line is not a post-earned description
    this.rollbackLineCoverage();
    this.lineNum--;
    this.rollbackLineCoverage();
  }

  if (!postEarnedDescription) {
    if (!visible) throw new Error(this.lineMsg()+"Invalid *achievement. Hidden achievements must set a post-earned description.");
    postEarnedDescription = preEarnedDescription;
  }

  if (!this.nav.achievements.hasOwnProperty(achievementName)) {
    this.nav.achievementList.push(achievementName);
    if (this.nav.achievementList.length > 100) {
      throw new Error(this.lineMsg()+"Too many *achievements. Each game can have up to 100 achievements.");
    }
  }

  if (!this.seenAchievementTitles) this.seenAchievementTitles = {};

  if (this.seenAchievementTitles[title]) {
    throw new Error(this.lineMsg()+"An achievement with display title \"" + title + "\" was already defined at line " + this.seenAchievementTitles[title]);
  }

  this.seenAchievementTitles[title] = this.lineNum+1;

  this.nav.achievements[achievementName] = {
    visible: visible,
    points: points,
    title: title,
    earnedDescription: postEarnedDescription,
    preEarnedDescription: preEarnedDescription,
    lineNumber: lineNumber
  };

  if (typeof setButtonTitles != "undefined") setButtonTitles();
};


Scene.prototype.bug = function scene_bug(message) {
  if (message) {
    message = "Bug: " + this.replaceVariables(message);
  } else {
    message = "Bug";
  }
  if (message === "Bug: choice_beta" && _global.beta) return;
  throw new Error(this.lineMsg() + message);
};

Scene.prototype.warning = function scene_warning(message) {
  // quicktest implements this
}

Scene.prototype.feedback = function scene_feedback() {
  this.stats.choice_feedback_requested = true;
  if (typeof window == "undefined" || this.randomtest) return;
  trackEvent('game_feedback_display', {
    choice_file: this.name,
    choice_line: this.lineNum + 1,
  });
  this.paragraph();
  this.printLine("On a scale from 1 to 10, how likely are you to recommend this game to a friend?");
  this.paragraph();
  var options = [{name:"10 (Most likely)"}];
  for (var i = 9; i > 1; i--) {
    options.push({name:i});
  }
  options.push({name:"1 (Least likely)"});
  options.push({name:"No response."});
  var self = this;
  if (window.prepareReviewPrompt) window.prepareReviewPrompt();
  this.renderOptions([""], options, function(option) {
    var value = "null";
    var numberMatch = /^(\d+)/.exec(option.name);
    if (numberMatch) value = numberMatch[1]*1;
    trackEvent('game_feedback_response', {
      feedback: value,
      choice_file: self.name,
      choice_line: self.lineNum + 1,
    });
    if (!isWebSavePossible()) {
      self.finished = false;
      self.resetPage();
      return;
    }

    var postFeedback = function() {
      xhrAuthRequest("POST", "feedback", function(ok, response) {
        if (window.console) console.log("ok", ok, response);
      }, "game", window.storeName, "platform", platformCode(), "rating", value);
      if (/^(9|10)/.test(option.name)) {
        if (isReviewSupported()) {
          return clearScreen(function() {
            if (promptForReview()) {
              self.screenEmpty = false;
              self.prevLine = "text";
              self.page_break();
              printFooter();
            } else {
              self.finished = false;
              self.resetPage();
            }
          });
        }
      }
      self.finished = false;
      self.resetPage();
    }

    if (value == "null") {
      self.finished = false;
      self.resetPage();
      return;
    }

    isRegistered(function(registered) {
      if (registered) {
        postFeedback();
      } else {
        clearScreen(function() {
          loginForm(main, 1/*optional*/, "Please sign in to have your vote counted!", postFeedback);
        });
      }
    });
  });
  this.finished = true;
};

Scene.prototype.parseTrackEvent = function(data) {
  var params = {};
  var stack = this.tokenizeExpr(data);
  if (!stack.length) throw new Error(this.lineMsg() + "Invalid track_event statement, expected at least one arg: name");
  params.__name = this.evaluateValueToken(stack.shift(), stack);
  while (stack.length) {
    var parameterName = this.evaluateValueToken(stack.shift(), stack);
    if (!stack.length) throw new Error(this.lineMsg() + "Invalid track_event statement, expected value for parameter " + parameterName);
    var parameterValue = this.evaluateValueToken(stack.shift(), stack);
    params[parameterName] = parameterValue;
  }
  return params;
}

Scene.prototype.track_event = function track_event(data) {
  var params = this.parseTrackEvent(data);
  var name = params.__name;
  delete params.__name;
  trackEvent(name, params);
}

Scene.prototype.ai = function ai(data) {}

Scene.prototype.config = function config(data) {
    var stack = this.tokenizeExpr(data);
    var variable = this.evaluateReference(stack);
    if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
      throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
    }
    if (stack.length === 0) throw new Error(this.lineMsg()+"Invalid set instruction, no expression specified: " + line);
    var value = this.evaluateExpr(stack);
    this.setVar(variable, value);
    if ("undefined" !== typeof remoteConfig && !this.randomtest && !this.quicktest) {
      this.finished = true;
      this.skipFooter = true;
      var self = this;
      remoteConfig(variable, function(result) {
        if (result !== null) self.setVar(variable, result);
        self.finished = false;
        self.skipFooter = false;
        self.execute();
      })
    }
};

Scene.prototype.ifid = function ifid(id) {
  if (!/^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}$/.test(id)) {
    var example = "a0a0a0a0-a0a0-a0a0-a0a0-a0a0a0a0a0a0";
    try {
      example = crypto.randomUUID();
    } catch (e) {}
    throw new Error(this.lineMsg() + "Invalid IFID. It should have five parts, like \""+example+"\": " + id);
  }
  if (!/^[A-F0-9\-]{36}$/i.test(id)) {
    throw new Error(this.lineMsg() + "Invalid IFID. It should contain only numbers, letters A-F, and dashes: " + id);
  }
}

Scene.prototype.lineMsg = function lineMsg() {
    return this.name + " line " + (this.lineNum+1) + ": ";
};

Scene.prototype.rollbackLineCoverage = function() {};

Scene.baseUrl = "scenes";
Scene.regexpMatch = function regexpMatch(str, re) {
    var result = re.exec(str);
    if (!result) return null;
    return result[0];
};
// Each token has a name and a test, which returns the matching string
Scene.tokens = [
    {name:"OPEN_PARENTHESIS", test:function(str){ return Scene.regexpMatch(str,/^\(/); } },
    {name:"CLOSE_PARENTHESIS", test:function(str){ return Scene.regexpMatch(str,/^\)/); } },
    {name:"OPEN_CURLY", test:function(str){ return Scene.regexpMatch(str,/^\{/); } },
    {name:"CLOSE_CURLY", test:function(str){ return Scene.regexpMatch(str,/^\}/); } },
    {name:"OPEN_SQUARE", test:function(str){ return Scene.regexpMatch(str,/^\[/); } },
    {name:"CLOSE_SQUARE", test:function(str){ return Scene.regexpMatch(str,/^\]/); } },
    {name:"FUNCTION", test:function(str){ return Scene.regexpMatch(str,/^(not|round|timestamp|log|length|auto)\s*\(/); } },
    {name:"NUMBER", test:function(str){ return Scene.regexpMatch(str,/^\d+(\.\d+)?\b/); } },
    {name:"STRING", test:function(str, line, sceneObj) {
            var i;
            if (!/^\"/.test(str)) return null;
            for (i = 1; i < str.length; i++) {
                var x = str.charAt(i);
                if ("\\" == x) {
                    i++;
                } else if ('"' == x) {
                    return str.substring(0,i+1);
                }
            }
            var errMessage = "line " + line + ": ";
            if (sceneObj) {
              errMessage = sceneObj.lineMsg();
            }
            throw new Error(errMessage+"Invalid string, open quote with no close quote: " + str);
        }
    },
    {name:"CURLY_QUOTE", test:function(str){ return Scene.regexpMatch(str,/^[\u201c\u201d]/); } },
    {name:"WHITESPACE", test:function(str){ return Scene.regexpMatch(str,/^\s+/); } },
    {name:"NAMED_OPERATOR", test:function(str){ return Scene.regexpMatch(str,/^(and|or|modulo)\b/); } },
    {name:"VAR", test:function(str){ return Scene.regexpMatch(str,/^\w*/); } },
    {name:"FAIRMATH", test:function(str){ return Scene.regexpMatch(str,/^%[\+\-]/); } },
    {name:"OPERATOR", test:function(str){ return Scene.regexpMatch(str,/^[\+\-\*\/\&\%\^\#]/); } },
    {name:"INEQUALITY", test:function(str){ return Scene.regexpMatch(str,/^[\!<>]\=?/); } },
    {name:"EQUALITY", test:function(str){ return Scene.regexpMatch(str,/^=/); } },
    {name:"COMMA", test:function(str){ return Scene.regexpMatch(str,/^,/); } }
    //
];
Scene.operators = {
    "+": function add(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) + num(v2,line,name); },
    "-": function subtract(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) - num(v2,line,name); },
    "*": function multiply(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) * num(v2,line,name); },
    "/": function divide(v1,v2,line,sceneObj) {
      var name = null; if (sceneObj) name = sceneObj.name; 
      v2 = num(v2, line, name);
      if (v2 === 0) throw new Error(name+" line "+line+": can't divide by zero");
      return num(v1,line,name) / num(v2,line,name);
    },
    "^": function exponent(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return Math.pow(num(v1,line,name), num(v2,line,name)); },
    "&": function concatenate(v1,v2) { return [v1,v2].join(""); },
    "#": function charAt(v1,v2,line,sceneObj) {
      var name = null;
      var errMessage = "line " + line + ": ";
      if (sceneObj) {
        name = sceneObj.name;
        errMessage = sceneObj.lineMsg();
      }
      var i = num(v2,line,name);
      if (i < 1) {
        throw new Error(errMessage+"There is no character at position " + i + "; the position must be greater than or equal to 1.");
      }
      if (i > String(v1).length) {
        throw new Error(errMessage+"There is no character at position " + i + ". \""+v1+"\" is only " + String(v1).length + " characters long.");
      }
      return String(v1).charAt(i-1);
    },
    "%+": function fairAdd(v1, v2, line, sceneObj) {
        var name = null;
        var errMessage = "line " + line + ": ";
        if (sceneObj) {
          name = sceneObj.name;
          errMessage = sceneObj.lineMsg();
        }
        v1 = num(v1,line,name);
        v2 = num(v2,line,name);
        var validValue = (v1 >= 0 && v1 <= 100);
        if (!validValue) {
            throw new Error(errMessage+"Can't fairAdd to non-percentile value: " + v1);
        }
        if (v2 > 0) {
          var multiplier = (100 - v1) / 100;
          var actualModifier = v2 * multiplier;
          var value = 1 * v1 + actualModifier;
          value = Math.floor(value);
          if (value > 99) value = 99;
          return value;
        } else {
          var multiplier = v1 / 100;
          var actualModifier = (0-v2) * multiplier;
          var value = v1 - actualModifier;
          value = Math.ceil(value);
          if (value < 1) value = 1;
          return value;
        }
    },
    "%-": function fairSubtract(v1, v2, line, sceneObj) {
        var name = null; if (sceneObj) name = sceneObj.name; 
        v2 = num(v2,line,name);
        return Scene.operators["%+"](v1,0-v2,line,sceneObj);
    },
    "=": function equals(v1,v2) { return v1 == v2 || String(v1) == String(v2); },
    "<": function lessThan(v1,v2,line,sceneObj) {
        var name = null; if (sceneObj) name = sceneObj.name; 
        return num(v1,line,name) < num(v2,line,name); },
    ">": function greaterThan(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) > num(v2,line,name); },
    "<=": function lessThanOrEquals(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) <= num(v2,line,name); },
    ">=": function greaterThanOrEquals(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) >= num(v2,line,name); },
    "!=": function notEquals(v1,v2) { return v1 != v2; },
    "and": function and(v1, v2, line, sceneObj) {
        var name = null; if (sceneObj) name = sceneObj.name; 
        return bool(v1,line,name) && bool(v2,line,name);
    },
    "or": function or(v1, v2, line, sceneObj) {
        var name = null; if (sceneObj) name = sceneObj.name; 
        return bool(v1,line,name) || bool(v2,line,name);
    },
    "modulo": function modulo(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) % num(v2,line,name); },
};

Scene.initialCommands = {"create":1,"create_array":1,"scene_list":1,"title":1,"author":1,"comment":1,"achievement":1,"product":1,"ifid":1};

Scene.validCommands = {"comment":1, "goto":1, "gotoref":1, "label":1, "looplimit":1, "finish":1, "abort":1,
    "choice":1, "create":1, "create_array": 1, "temp":1, "temp_array": 1, "delete":1, "delete_array":1, "set":1, "setref":1, "print":1, "if":1, "rand":1,
    "page_break":1, "line_break":1, "script":1, "else":1, "elseif":1, "elsif":1, "reset":1,
    "goto_scene":1, "fake_choice":1, "input_text":1, "ending":1, "share_this_game":1, "stat_chart":1,
    "subscribe":1, "show_password":1, "gosub":1, "return":1, "hide_reuse":1, "disable_reuse":1, "allow_reuse":1,
    "check_purchase":1,"restore_purchases":1,"purchase":1,"restore_game":1,"advertisement":1,
    "kindle_search":1,"kindle_product":1,"feedback":1,
    "save_game":1,"delay_break":1,"image":1,"kindle_image":1,"link":1,"input_number":1,"goto_random_scene":1,
    "restart":1,"more_games":1,"delay_ending":1,"end_trial":1,"login":1,"achieve":1,"scene_list":1,"title":1,
    "bug":1,"link_button":1,"check_registration":1,"sound":1,"author":1,"gosub_scene":1,"achievement":1,
    "check_achievements":1,"redirect_scene":1,"print_discount":1,"purchase_discount":1,"track_event":1,
    "timer":1,"youtube":1,"product":1,"text_image":1,"ai":1,"params":1,"config":1,"ifid":1,
    "page_break_advertisement":1, "finish_advertisement":1, "save_checkpoint": 1, "restore_checkpoint": 1
    };

;
/*
 * Copyright 2010 by Dan Fabulich.
 * 
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License. 
 * You may obtain a copy of the License at
 * 
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 * 
 * See the License for the specific language governing
 * permissions and limitations under the License.
 * 
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */
function SceneNavigator(sceneList) {
    this.setSceneList(sceneList);
    this.startingStats = {};
}

SceneNavigator.prototype.setSceneList = function setSceneList(sceneList) {
    this._sceneList = sceneList;
    this._sceneMap = {};
    for (var i = 0; i < sceneList.length-1; i++) {
        var scene1 = sceneList[i];
        var scene2 = sceneList[i+1];
        this._sceneMap[scene1] = scene2;
    }
    this._startupScene = sceneList[0];
};

SceneNavigator.prototype.nextSceneName = function nextSceneName(currentSceneName) {
    var nextScene = this._sceneMap[currentSceneName];
    //if (!nextScene) throw new Error("No scene follows " + currentSceneName);
    return nextScene;
};

SceneNavigator.prototype.getStartupScene = function getStartupScene() {
    return this._startupScene;
};

SceneNavigator.prototype.setStartingStatsClone = function setStartingStatsClone(stats) {
  this.startingStats = {};
  for (var i in stats) {
    this.startingStats[i] = stats[i];
  }
};

SceneNavigator.prototype.resetStats = function resetStats(stats) {
  for (var i in stats) {
    delete stats[i];
  }
  for (i in this.startingStats) {
    stats[i] = this.startingStats[i];
  }
  this.bugLog = [];
};

SceneNavigator.prototype.repairStats = function repairStats(stats) {
  for (var i in this.startingStats) {
    var startingStat = this.startingStats[i];
    if (startingStat === null || startingStat === undefined) continue;
    if (typeof(stats[i]) === "undefined" || stats[i] === null) {
      stats[i] = this.startingStats[i];
    }
  }
};

SceneNavigator.prototype.bugLog = [];
SceneNavigator.prototype.achievements = {};
SceneNavigator.prototype.achievementList = [];
SceneNavigator.prototype.achieved = {};
SceneNavigator.prototype.products = {};

SceneNavigator.prototype.loadAchievements = function(achievementArray) {
  if (!achievementArray) return;
  this.achievements = {};
  this.achievementList = [];
  for (var i = 0; i < achievementArray.length; i++) {
    var achievement = achievementArray[i];
    var achievementName = achievement[0];
    var visible = achievement[1];
    var points = achievement[2];
    var title = achievement[3];
    var earnedDescription = achievement[4];
    var preEarnedDescription = achievement[5];
    this.achievements[achievementName] = {
      visible: visible,
      points: points,
      title: title,
      earnedDescription: earnedDescription,
      preEarnedDescription: preEarnedDescription
    };
    this.achievementList.push(achievementName);
  }
};
SceneNavigator.prototype.loadProducts = function(productArray, purchaseMap) {
  if (!productArray && !purchaseMap) return;
  this.products = {};
  for (var i = 0; i < productArray; i++) {
    this.products[productArray[i]] = {};
  }
  for (var scene in purchaseMap) {
    var product = purchaseMap[scene];
    this.products[product] = {};
  }
}

;
ï»¿nav = new SceneNavigator([
 "startup",
 "ch1_selvaggio_arrival",
 "ch1_selvaggio_docks",
 "ch1_selvaggio_departure_row",
 "ch1_selvaggio_first_night",
 "ch1_selvaggio_crew_hunt",
 "ch1_selvaggio_the_bell",
 "ch2_galluuns_tooth_approach",
 "ch2_galluuns_tooth_port",
 "ch2_galluuns_tooth_reef",
 "ch3_merrenbach_arrival",
 "ch3_merrenbach_warren",
 "ch3_merrenbach_reef_walk",
 "ch4_brannach_landfall",
 "ch4_brannach_fissures",
 "ch4_brannach_forge",
 "ch5_kelvanni_clinic",
 "ch5_kelvanni_debts",
 "ch5_kelvanni_crisis",
 "ch6_velundri_market",
 "ch6_velundri_revelation",
 "ch6_velundri_cliffhanger"
]);
stats = {
 "choice_title": "Kingsrun",
 "mc_name": "Merdou Akkan",
 "mc_first_name": "Merdou",
 "mc_surname": "Akkan",
 "mc_parent": "oni_mother",
 "mc_height": "imposing",
 "mc_height_feet": "6'7\"",
 "mc_horns": "ram_curved",
 "mc_skin": "ash_white",
 "mc_build": "broad",
 "mc_hair": "black_mane",
 "mc_outfit": "highland",
 "mc_backstory": "exile",
 "mc_motivation": "prove_wrong",
 "dominion_armoring": "5",
 "dominion_vision": "5",
 "dominion_king": "0",
 "dominion_lean": "balanced",
 "armoring_tier": "Flicker",
 "vision_tier": "Flicker",
 "king_tier": "Dormant",
 "king_manifested": "false",
 "korvaan_stage": "none",
 "korvaan_training": "false",
 "korvaan_progress": "0",
 "has_god_fruit": "false",
 "god_fruit_name": "none",
 "god_fruit_type": "none",
 "god_fruit_awakened": "false",
 "bounty": "0",
 "bounty_tier": "Unknown",
 "grimoire_followers": "0",
 "rep_wardensea": "0",
 "rep_kolmari": "0",
 "rep_renegade": "0",
 "rep_khari_warrens": "0",
 "rep_oni_highlands": "0",
 "rep_dessaren": "0",
 "rep_kuldhara": "0",
 "rep_senmovar": "0",
 "rep_vassago": "0",
 "rep_daeshara": "0",
 "wardensea_standing": "Unknown",
 "kolmari_standing": "Unknown",
 "renegade_standing": "Nobody",
 "khari_standing": "Outsider",
 "oni_standing": "Exiled",
 "sovereigns": "12",
 "supplies": "15",
 "food_days": "3",
 "ship_condition": "0",
 "has_ship": "false",
 "ship_name": "none",
 "ship_acquisition_method": "none",
 "crew_count": "0",
 "crew1_exists": "false",
 "crew1_name": "empty",
 "crew1_race": "unknown",
 "crew1_role": "empty",
 "crew1_alive": "true",
 "crew1_loyalty": "0",
 "crew1_trust": "stranger",
 "crew1_romance": "0",
 "crew1_romance_active": "false",
 "crew2_exists": "false",
 "crew2_name": "empty",
 "crew2_race": "unknown",
 "crew2_role": "empty",
 "crew2_alive": "true",
 "crew2_loyalty": "0",
 "crew2_trust": "stranger",
 "crew2_romance": "0",
 "crew2_romance_active": "false",
 "crew3_exists": "false",
 "crew3_name": "empty",
 "crew3_race": "unknown",
 "crew3_role": "empty",
 "crew3_alive": "true",
 "crew3_loyalty": "0",
 "crew3_trust": "stranger",
 "crew3_romance": "0",
 "crew3_romance_active": "false",
 "crew4_exists": "false",
 "crew4_name": "empty",
 "crew4_race": "unknown",
 "crew4_role": "empty",
 "crew4_alive": "true",
 "crew4_loyalty": "0",
 "crew4_trust": "stranger",
 "crew4_romance": "0",
 "crew4_romance_active": "false",
 "crew5_exists": "false",
 "crew5_name": "empty",
 "crew5_race": "unknown",
 "crew5_role": "empty",
 "crew5_alive": "true",
 "crew5_loyalty": "0",
 "crew5_trust": "stranger",
 "crew5_romance": "0",
 "crew5_romance_active": "false",
 "met_mavrokka": "false",
 "met_caelmund": "false",
 "met_tomoe": "false",
 "met_suuba": "false",
 "met_kovesse": "false",
 "rival_mavrokka": "0",
 "rival_caelmund": "0",
 "rival_tomoe": "0",
 "rival_suuba": "0",
 "rival_kovesse": "0",
 "met_officer_selvaggio": "false",
 "officer_selvaggio_name": "unknown",
 "officer_selvaggio_attitude": "0",
 "met_goltieri": "false",
 "goltieri_attitude": "0",
 "personality_aggression": "50",
 "personality_loyalty": "50",
 "personality_openness": "50",
 "personality_mercy": "50",
 "rang_departure_bell": "false",
 "bell_rings": "0",
 "selvaggio_fight_won": "false",
 "selvaggio_gambit_encountered": "false",
 "found_ship": "false",
 "carved_name_reef": "false",
 "galluuns_tooth_challenge": "none",
 "completed_reef_walk": "false",
 "khari_guide_name": "unknown",
 "khari_trust_earned": "false",
 "merrenbach_deal": "none",
 "received_slag_gift": "false",
 "brannach_eruption_survived": "false",
 "obtained_weapon": "false",
 "weapon_name": "none",
 "weapon_grade": "none",
 "clinic_debt_owed": "false",
 "kelvanni_favor": "none",
 "met_oursseva": "false",
 "coat_traded": "false",
 "velundri_revelation": "false",
 "revelation_type": "none",
 "second_age_fragment": "false",
 "broadcast_count": "0",
 "latest_broadcast": "none",
 "current_stop": "1",
 "current_stop_name": "Selvaggio",
 "days_since_departure": "0",
 "total_sea_days": "0",
 "injured": "false",
 "injury_type": "none",
 "injury_severity": "0",
 "injury_days_remaining": "0",
 "game_version": "1.0.0"
};
purchases = {};
achievements = [];
nav.setStartingStatsClone(stats);if (achievements.length) {
  nav.loadAchievements(achievements);
}
if (nav.loadProducts) nav.loadProducts([], purchases);
</script><style>html {
  font: -apple-system-body; /* we'll override the font, but keep the size from iOS dynamic text sizing */
}

body {
  position: relative;
  max-width: 80ch;
  min-height: 100vh; /* keep iOS address bar from popping in and out */
  font-size: 100%;  /* reset for CWS */
  font-family: Palatino,Cambria,Georgia,"Times New Roman",serif;
  background-color: #F7F4F1;
  color: rgba(0, 0, 0, 0.85);
  margin: 1ch auto;
  padding: 0;
  -webkit-user-select: text; /* selectable text for Chrome app support */
  transition-property: background-color, color;
  transition-duration: 2s;
  -webkit-transition-property: background-color, color;
  -webkit-transition-duration: 2s;
}

@font-face {
  font-family: 'OpenDyslexic';
  src: url('OpenDyslexic-Regular.woff2') format('woff2');
  font-weight: normal;
  font-style: normal;
  font-display: block;
}

@font-face {
  font-family: 'OpenDyslexic';
  src: url('OpenDyslexic-Italic.woff2') format('woff2');
  font-weight: normal;
  font-style: italic;
  font-display: block;
}

@font-face {
  font-family: 'OpenDyslexic';
  src: url('OpenDyslexic-Bold.woff2') format('woff2');
  font-weight: bold;
  font-style: normal;
  font-display: block;
}

@font-face {
  font-family: 'OpenDyslexic';
  src: url('OpenDyslexic-BoldItalic.woff2') format('woff2');
  font-weight: bold;
  font-style: italic;
  font-display: block;
}

.serif {
  font-family: Palatino, Cambria, Georgia, "Times New Roman", serif;
}

.sans {
  font-family: Helvetica, sans-serif;
}

.dyslexia {
  font-family: OpenDyslexic, "Comic Sans MS", fantasy;
}

a {
  /* colored underlined links for XULRunner support */
  color: blue;
  text-decoration: underline;
  cursor: pointer;
}

#main {
	line-height: 1.5;
}

.container {
  position: absolute; /* so containers can overlap */
  left: 0;
  right: 0;
  margin: 0 1ch;
  animation-duration: 0.5s;
  -webkit-animation-duration: 0.5s;
  transition-property: opacity;
  transition-duration: 0.5s;
  transition-timing-function: ease-in;
  -webkit-transition-property: opacity;
  -webkit-transition-duration: 0.5s;
  -webkit-transition-timing-function: ease-in;
}

@keyframes containerslidein {
  from {
    transform: translateX(100%);
  }

  to {
    transform: none;
  }
}

@-webkit-keyframes containerslidein {
  from {
    -webkit-transform: translateX(100%);
  }

  to {
    -webkit-transform: none;
  }
}

.tempfocus:focus {
  outline: none;
}

#loading {
  position: fixed;
  bottom: 0;
  right: 0;
}

.frozen {
  overflow-x: hidden;
  pointer-events: none;
}

#text img {
  max-width: 100%;
}

/*credits*/
#main.container img {
  max-width: 100%;
}

.statBar {
  background-color: #949291;
  height: 2rem;
  line-height: 2rem;
  margin: 0.5ch 0;
  width: 20rem;
  max-width: 100%;
  color: #f7f4f1;
  position: relative; /* to allow absolute positioned value */
  z-index: 0;
}
.opposed {
  background-color: #6D6DFC;
}

table {
  margin-bottom: 1.5em;
}

.statText {
  margin-left: 2ex;
  text-indent: -1ex;
}

.statBar > span, .statLine > span {
  position: relative;
  z-index: 1; /* visible over stat value */
  white-space: nowrap; /* remain on single line so we can resize font based on width */
}
.statValue {
  background-color: #ff5955;
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  z-index: -1;
  /* width will be determined at runtime, 0-100% */
}

.choice {
  margin: 1rem 0;
}

.choice > div {
  position: relative; /* so the .shuttle can be positioned absolutely within it */
  min-height: 1.25cm;
  display: flex;
  flex-direction: column;
  justify-content: center;
  border-color:#a9acaf;
  border-style:solid;
  border-width: 1px 1px 0px 1px;
}

.choice label{
    transition-property: background-color, color;
    transition-duration: 0.1s;
    -webkit-transition-property: background-color, color;
    -webkit-transition-duration: 0.1s;
    -webkit-tap-highlight-color: transparent;
    padding: 0.5em 1ch;
    display:block;
}

.shuttle {
  position: absolute;
  right: 0px;
  top: 0px;
  width: 20%;
  height: 100%;
  background-color: #626160; /* match next */
  opacity: 0.25;
  transition-property: opacity;
  transition-duration: 0.3s;
  -webkit-transition-property: opacity;
  -webkit-transition-duration: 0.3s;
}

.shuttle.discovery {
  width: 20%;
  animation-name: shuttlefadein, shuttleslide, shuttlefadeout;
  animation-duration: 0.75s, 1s, 1s;
  animation-delay: 0s, 0.75s, 1.75s;
  -webkit-animation-name: shuttlefadein, shuttleslide, shuttlefadeout;
  -webkit-animation-duration: 0.75s, 1s, 1s;
  -webkit-animation-delay: 0s, 0.75s, 1.75s;
}

@keyframes shuttlefadein {
  from {opacity: 0;}
  to {opacity: 0.25;}
}

@keyframes shuttlefadeout {
  from {opacity: 0.25; transform: translateX(-401%);} /* borders, maybe? */
  to {opacity: 0; transform: translateX(-401%);}
}

@keyframes shuttleslide {
  from { opacity: 0.25; transform: translateX(0);}
  to { opacity: 0.25; transform: translateX(-401%); }
}

@-webkit-keyframes shuttlefadein {
  from {opacity: 0;}
  to {opacity: 0.25;}
}

@-webkit-keyframes shuttlefadeout {
  from {opacity: 0.25; -webkit-transform: translateX(-401%);} /* borders, maybe? */
  to {opacity: 0; -webkit-transform: translateX(-401%);}
}

@-webkit-keyframes shuttleslide {
  from { opacity: 0.25; -webkit-transform: translateX(0);}
  to { opacity: 0.25; -webkit-transform: translateX(-401%); }
}

.selected {
  color: rgba(255,255,255,0.85);
  background-color: #007AFF;
}

.selectedKeyboard, .choice>div.selectedKeyboard:hover, .next.selectedKeyboard {
  color: rgba(255, 255, 255, 0.85);
  background-color: #007AFF;
  transition-property: background-color, color;
  transition-duration: 0.5s;
  transition-timing-function: linear;
  -webkit-transition-property: background-color, color;
  -webkit-transition-duration: 0.5s;
  -webkit-transition-timing-function: linear;
}

.choice>div:first-child{
    border-top-width:1px;
    -webkit-border-top-right-radius:1ch;
    -webkit-border-top-left-radius:1ch;
    border-top-right-radius:1ch;
    border-top-left-radius:1ch;
}
/* IE doesn't support label:last-child */
.choice>div:last-child{
    border-bottom-width:1px;
    -webkit-border-bottom-right-radius:1ch;
    -webkit-border-bottom-left-radius:1ch;
    border-bottom-right-radius:1ch;
    border-bottom-left-radius:1ch;
}

.choice .noBorder {
  border-width: 0;
}

input[type="radio"], input[type="checkbox"] {
  margin-right: 1ch;
}

.saveGame>label {
  display:block;
}

.choice .disabled {
  color: gray;
}

input[type=password]:disabled {
  background-color: lightgray;
}

/* Reset for Firefox vs. Chrome */
input[type=email],input[type=password] {
  padding: 1px;
  margin: 2px 0;
}

button {
  font-size: 100%;
}

.next {
    clear: both;
    display:block;
    width:100%;
    font-size:1.5em;
    font-weight:bolder;
    font-family: -apple-system, sans-serif; /* reset, for Android */
    margin: 1rem 0; /* reset button margin */
    -webkit-appearance: none; /* Safari, don't override my CSS styles */
    color: #f7f4f1; /* Match background color */ 
    background-color: #626160;
    border: none;
    -webkit-border-radius: 0.5em;
    -moz-border-radius: 0.5em;
    border-radius: 0.5em;
    padding: 6px;
}

.linkButton {
  text-align: center;
  text-decoration: none;
}

.next:hover {
  color: #E4DED8;
}

h1 {
  font-size: 1.5em;
  font-weight: normal;
}

h2 {
  font-size: 1.125em;
  font-weight: normal;
}

#identity {
  float: right;
}

#identity > a {
  display: block;
  text-align: end;
}

#footer {
  margin:10px 0px 75px 0px;
}

#mobileLinks a img {
  border: 0;
}

.mobileBadges {
  margin: 0;
}

.spacedLink {
  margin-right:0.5em;
}

.spacedLink:last-child {
  margin-right:0;
}

#sharelist {
  margin: 0; /* Eliminate leading space before share links */
}

#sharelist li {
  line-height: 1cm; /* Don't let the links bunch up */
}

.alertify-cover {
  background-color: black;
  filter:alpha(opacity=50);
  opacity: 0.5;
}

#greybackground {
    position: fixed;
    width:100%;
    height:100%;
    background-color: black;
    filter:alpha(opacity=50);
    opacity: 0.5;
    top:0;
    left:0;
}

.savePassword {
  font-family: monospace;
  display: block;
}

.webOnly { /* We'll override this in JavaScript */
  display: none;
}

.alignleft {
  display: inline;
  float: left;
  margin-right: 1.625em;
  margin-bottom: 1.5em;
}
.alignright {
  display: inline;
  float: right;
  margin-left: 1.625em;
  margin-bottom: 1.5em;
}
.aligncenter {
  clear: both;
  display: block;
  margin-left: auto;
  margin-right: auto;
  margin-bottom: 1.5em;
}

#main form {
  clear: both;
}

.paidOnly {
  display: none;
}

.videoWrapper {
  position: relative;
  padding-bottom: 56.25%; /* 16:9 */
  height: 0;
}

.videoWrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

body.nightmode {
  background-color: #242424;
  color: rgba(255,255,255,0.85);
}

body.nightmode a {
  color: #7bc8fa;
}

body.nightmode .next {
  color: #242424; /* Match background color */
  background-color: #D9D9D9;
}

body.nightmode .shuttle {
  background-color: #D9D9D9;
}

body.nightmode .next:hover {
  color: #555;
}

body.nightmode .alertify {
  color: black;
}

body.nightmode a.alertify-button {
  color: white;
}

body.nightmode img.invert {
  -webkit-filter: invert(100%);
  filter: invert(100%);
}

body.whitemode {
  background-color: white;
}

body.whitemode .next {
  color: white; /* Match background color */
}

body.whitemode .next:hover {
  color: #ddd;
}

/* hide <dialog> on old browsers */
dialog:not([open]) {
  display: none;
}

#keyboardShortcuts {
  font-family: system-ui;
}

#keyboardShortcuts::backdrop {
  background: rgba(0, 0, 0, 0.4);
}

#keyboardShortcuts header {
  display: flex;
  justify-content: space-between;
}

#keyboardShortcuts header span {
  font-weight: bold;
}

#keyboardShortcuts .table {
  display: grid;
  grid-template-columns: 1fr 1fr;
}

#keyboardShortcuts .table div {
  padding: 0.5em;
}

#keyboardShortcuts .key {
  background-color: ghostwhite;
  border: thin solid lightgrey;
  border-radius: 5px;
  padding: 0.3em;
  font-family: monospace;
}

#text .gameTitle {
  display: none;
}

@media (max-width: 480px) or (max-height: 640px) {
  .definition{
    display: none;
  }
  
  #headerLinks {
    display: none;
  }

  #title {
    font-size: 1.125em;
  }

  #author {
    display: none;
  }

  #text .gameTitle {
    display: block;
  }

  #advertisement {
    margin: -8px;
  }
  
  .mobileBadges {
    float: none;
  }
  
  #header {
    margin-top: 30px;
  }

  /** Floating images should leave enough room for text */
  #text .alignleft, #text .alignright {
    max-width: 45%;
  }
  
  #identity {
    display: none;
  }
}

@media (max-width: 375px) {
  #achievementsButton {
    display: none;
  }
}.alertify-show,
.alertify-log {
	-webkit-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1); /* older webkit */
	-webkit-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	   -moz-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	    -ms-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	     -o-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	        transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275); /* easeOutBack */
}
.alertify-hide {
	-webkit-transition: all 250ms cubic-bezier(0.600, 0, 0.735, 0.045); /* older webkit */
	-webkit-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	   -moz-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	    -ms-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	     -o-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	        transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045); /* easeInBack */
}
.alertify-cover {
	position: fixed; z-index: 99999;
	top: 0; right: 0; bottom: 0; left: 0;
}
.alertify {
	position: fixed; z-index: 99999;
	top: 50px; left: 50%;
	width: 550px;
	margin-left: -275px;
}
	.alertify-hidden {
		top: -50px;
		visibility: hidden;
	}
.alertify-logs {
	position: fixed;
	z-index: 5000;
	bottom: 10px;
	right: 10px;
	width: 300px;
}
	.alertify-log {
		display: block;
		margin-top: 10px;
		position: relative;
		right: -300px;
	}
	.alertify-log-show {
		right: 0;
	}
	.alertify-dialog {
		padding: 25px;
	}
		.alertify-resetFocus {
			border: 0;
			clip: rect(0 0 0 0);
			height: 1px;
			margin: -1px;
			overflow: hidden;
			padding: 0;
			position: absolute;
			width: 1px;
		}
		.alertify-inner {
			text-align: center;
		}
		.alertify-text {
			margin-bottom: 15px;
			width: 100%;
			-webkit-box-sizing: border-box;
			   -moz-box-sizing: border-box;
			        box-sizing: border-box;
			font-size: 100%;
		}
		.alertify-buttons {
		}
			.alertify-button {
				/* line-height and font-size for input button */
				line-height: 1.5;
				font-size: 100%;
				display: inline-block;
				cursor: pointer;
				margin-left: 5px;
			}

@media only screen and (max-width: 680px) {
	.alertify,
	.alertify-logs {
		width: 90%;
		-webkit-box-sizing: border-box;
		   -moz-box-sizing: border-box;
		        box-sizing: border-box;
	}
	.alertify {
		left: 5%;
		margin: 0;
	}
}
/**
 * Default Look and Feel
 */
.alertify,
.alertify-log {
	font-family: sans-serif;
}
.alertify {
	background: #FFF;
	border: 10px solid #333; /* browsers that don't support rgba */
	border: 10px solid rgba(0,0,0,.7);
	border-radius: 8px;
	box-shadow: 0 3px 3px rgba(0,0,0,.3);
	-webkit-background-clip: padding;     /* Safari 4? Chrome 6? */
	   -moz-background-clip: padding;     /* Firefox 3.6 */
	        background-clip: padding-box; /* Firefox 4, Safari 5, Opera 10, IE 9 */
}
	.alertify-text {
		border: 1px solid #CCC;
		padding: 10px;
		border-radius: 4px;
	}
	.alertify-button {
		border-radius: 4px;
		color: #FFF;
		font-weight: bold;
		padding: 6px 15px;
		text-decoration: none;
		text-shadow: 1px 1px 0 rgba(0,0,0,.5);
		box-shadow: inset 0 1px 0 0 rgba(255,255,255,.5);
		background-image: -webkit-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:    -moz-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:     -ms-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:      -o-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:         linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
	}
	.alertify-button:hover,
	.alertify-button:focus {
		outline: none;
		box-shadow: 0 0 15px #2B72D5;
		background-image: -webkit-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:    -moz-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:     -ms-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:      -o-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:         linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
	}
	.alertify-button:active {
		position: relative;
		top: 1px;
	}
		.alertify-button-cancel {
			background-color: #FE1A00;
			border: 1px solid #D83526;
		}
		.alertify-button-ok {
			background-color: #5CB811;
			border: 1px solid #3B7808;
		}
		
.alertify-log {
	background: #1F1F1F;
	background: rgba(0,0,0,.9);
	padding: 15px;
	border-radius: 4px;
	color: #FFF;
	text-shadow: -1px -1px 0 rgba(0,0,0,.5);
}
	.alertify-log-error {
		background: #FE1A00;
		background: rgba(254,26,0,.9);
	}
	.alertify-log-success {
		background: #5CB811;
		background: rgba(92,184,17,.9);
	}</style>
<style id="kingsrun-release">
/* â”€â”€â”€ Version footer â”€â”€â”€ */
#kingsrun-footer {
  text-align: center;
  padding: 1.5em 0 1em;
  font-size: 0.75em;
  color: rgba(0,0,0,0.35);
  font-family: Helvetica, sans-serif;
}

/* â”€â”€â”€ Mobile button improvements â”€â”€â”€ */
@media (max-width: 640px) {
  /* Larger touch targets for choices */
  label.choiceItem, .choice label {
    padding: 0.75em 0.5em !important;
    margin: 0.3em 0 !important;
    font-size: 1.05em !important;
    line-height: 1.4 !important;
  }

  /* Better spacing on small screens */
  body {
    padding: 0 0.5ch !important;
  }

  /* Bigger Next/Submit buttons */
  .nextButton, [type="submit"], .button, button {
    min-height: 44px;
    font-size: 1em !important;
  }

  /* Header buttons more tappable */
  #buttons button {
    padding: 0.5em 0.75em;
    margin: 0.2em;
  }
}

/* â”€â”€â”€ Checkpoint code display â”€â”€â”€ */
.checkpoint-code-wrap {
  position: relative;
  background: rgba(0,0,0,0.05);
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  padding: 1em;
  margin: 1em 0;
  word-break: break-all;
  font-family: monospace;
  font-size: 0.9em;
  line-height: 1.6;
  user-select: all;
  -webkit-user-select: all;
}

.copy-btn {
  display: inline-block;
  margin-top: 0.5em;
  padding: 0.5em 1.2em;
  background: #4a4a4a;
  color: #fff;
  border: none;
  border-radius: 4px;
  font-size: 0.9em;
  cursor: pointer;
  font-family: Helvetica, sans-serif;
}
.copy-btn:hover {
  background: #333;
}
.copy-btn:active {
  background: #111;
}
.copy-btn.copied {
  background: #2a7a2a;
}

/* â”€â”€â”€ DEV MODE panel â”€â”€â”€ */
#dev-mode-panel {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(0,0,0,0.85);
  color: #0f0;
  font-family: monospace;
  font-size: 0.7em;
  padding: 0.5em 1em;
  z-index: 9999;
  max-height: 30vh;
  overflow-y: auto;
}
#dev-mode-panel.visible {
  display: block;
}
#dev-mode-toggle {
  position: fixed;
  bottom: 4px;
  right: 4px;
  width: 20px;
  height: 20px;
  background: transparent;
  border: 1px solid rgba(0,0,0,0.1);
  border-radius: 2px;
  cursor: pointer;
  z-index: 10000;
  font-size: 8px;
  color: rgba(0,0,0,0.15);
  line-height: 20px;
  text-align: center;
  padding: 0;
}
#dev-mode-toggle:hover {
  border-color: rgba(0,0,0,0.3);
  color: rgba(0,0,0,0.4);
}
</style>
</head>
<body><div class="container" id="container1">
<div id="advertisement">
</div>
<div id="header">
  <div id="identity"><a href="#" id="email" style="display: none">you@example.com</a>
  <a href="#" onclick="logout(); loginDiv(); return false;" id="logout" style="display: none">Sign Out</a>
  </div>

  <h1 class='gameTitle'>Kingsrun</h1>
<h2 id="author" class="gameTitle">by Mert Akhan</h2>

  <p id="headerLinks">
      <!-- <a href="credits.html" id="aboutLink" class="spacedLink">About</a> -->
    </p>
  <p id="buttons">
    <button id="statsButton" class="spacedLink" onclick="showStats()">Show Stats</button>
    <button id="achievementsButton" onclick="showAchievements()" class="spacedLink" style="display: none">Achievements</button>
    <button id="bugButton" onclick="reportBug()" class="spacedLink" style="display: none">Report Bug</button>
    <button id="menuButton" onclick="showMenu()" class="spacedLink">Menu</button>
  </p>
</div>
<div id="main">
<div id="text">
</div>
<script>
startLoading();
</script>
</div>
<div id="mobileLinks" class="webOnly">
</div>
<noscript>
<p>This game requires JavaScript; please enable JavaScript and refresh this page.</p>
</noscript>

<div id="tools"></div>
<!-- dev tools removed for release -->
<dialog id="keyboardShortcuts" onclick="event.target === this && this.close()">
<header><span>Keyboard Shortcuts</span> <form method=dialog><button>X</button></form></header>
<div class="table">
  <div>Scroll Down</div>
  <div><span class="key">Space</span></div>
  <div>Scroll Up</div>
  <div><span class="key">Shift</span> + <span class="key">Space</span></div>
  <div>Next Option</div>
  <div><span class="key">J</span></div>
  <div>Previous Option</div>
  <div><span class="key">K</span></div>
  <div>Next (Press and Hold)</div>
  <div><span class="key">Enter</span></div>
  <div>Jump to Option</div>
  <div><span class="key">1</span> - <span class="key">9</span></div>
  <div>Show Stats</div>
  <div><span class="key">Q</span></div>
  <div>Menu</div>
  <div><span class="key">W</span></div>
  <div>Show Shortcuts</div>
  <div><span class="key">?</span></div>
</div>
</dialog>

<!-- Kingsrun Release Enhancements -->
<div id="kingsrun-footer">Kingsrun v1.0.0 &mdash; &copy; Mert Akhan</div>
<button id="dev-mode-toggle" title="DEV MODE">&bull;</button>
<div id="dev-mode-panel"></div>

<script>
(function() {
  'use strict';

  // â”€â”€â”€ Copy-to-clipboard for checkpoint codes â”€â”€â”€
  // MutationObserver watches for the checkpoint code display
  var observer = new MutationObserver(function(mutations) {
    var textEl = document.getElementById('text');
    if (!textEl) return;

    var html = textEl.innerHTML;
    // Look for the checkpoint code pattern
    if (html.indexOf('YOUR KINGSRUN CHECKPOINT') !== -1 && !textEl.querySelector('.checkpoint-code-wrap')) {
      // Find the save code â€” it's between "Code:" and the closing divider
      var codeMatch = html.match(/<b>Code:<\/b>\s*<br>([\s\S]*?)<br>\s*<b>/);
      if (codeMatch) {
        var rawCode = codeMatch[1].replace(/<[^>]*>/g, '').trim();

        // Wrap the code in a styled container with copy button
        var replacement = '<b>Code:</b><br>' +
          '<div class="checkpoint-code-wrap" id="checkpoint-code">' + rawCode + '</div>' +
          '<button class="copy-btn" id="copy-code-btn" onclick="copyCheckpointCode()">Copy Code</button>' +
          '<br><b>';

        textEl.innerHTML = html.replace(/<b>Code:</b>s*<br>[sS]*?<br>s*<b>/, replacement);
      }
    }
  });

  observer.observe(document.getElementById('text') || document.body, {
    childList: true, subtree: true, characterData: true
  });

  // Global copy function
  window.copyCheckpointCode = function() {
    var codeEl = document.getElementById('checkpoint-code');
    var btn = document.getElementById('copy-code-btn');
    if (!codeEl || !btn) return;

    var code = codeEl.textContent.trim();

    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(code).then(function() {
        btn.textContent = 'Copied!';
        btn.classList.add('copied');
        setTimeout(function() { btn.textContent = 'Copy Code'; btn.classList.remove('copied'); }, 2000);
      }).catch(function() {
        fallbackCopy(code, btn);
      });
    } else {
      fallbackCopy(code, btn);
    }
  };

  function fallbackCopy(text, btn) {
    var ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    ta.style.opacity = '0';
    document.body.appendChild(ta);
    ta.select();
    try {
      document.execCommand('copy');
      btn.textContent = 'Copied!';
      btn.classList.add('copied');
      setTimeout(function() { btn.textContent = 'Copy Code'; btn.classList.remove('copied'); }, 2000);
    } catch(e) {
      btn.textContent = 'Select & copy manually';
      setTimeout(function() { btn.textContent = 'Copy Code'; }, 3000);
    }
    document.body.removeChild(ta);
  }

  // â”€â”€â”€ DEV MODE â”€â”€â”€
  var devActive = false;
  var devPanel = document.getElementById('dev-mode-panel');
  var devToggle = document.getElementById('dev-mode-toggle');

  devToggle.addEventListener('click', function() {
    devActive = !devActive;
    devPanel.classList.toggle('visible', devActive);
    if (devActive) updateDevPanel();
  });

  function updateDevPanel() {
    if (!devActive || !devPanel) return;

    var info = [];
    try {
      var stats = window.stats || (typeof _global !== 'undefined' && _global.stats) || {};
      var nav = window.nav || (typeof _global !== 'undefined' && _global.nav) || {};

      info.push('<b>Scene:</b> ' + (stats.sceneName || 'unknown'));
      info.push('<b>Line:</b> ' + (typeof _global !== 'undefined' && _global.lineNum || '?'));

      // Key stats
      var keys = ['dominion_armoring','dominion_vision','dominion_king','bounty',
                  'personality_aggression','personality_loyalty','personality_openness','personality_mercy',
                  'ship_condition','sovereigns','supplies','days_since_departure'];
      for (var i = 0; i < keys.length; i++) {
        if (stats[keys[i]] !== undefined) {
          info.push('<b>' + keys[i] + ':</b> ' + stats[keys[i]]);
        }
      }

      // Crew
      for (var c = 1; c <= 5; c++) {
        if (stats['crew' + c + '_exists']) {
          info.push('<b>Crew ' + c + ':</b> ' + (stats['crew' + c + '_name'] || '?') +
                    ' [' + (stats['crew' + c + '_role'] || '?') + '] trust=' + (stats['crew' + c + '_trust'] || '?'));
        }
      }
    } catch(e) {
      info.push('<b>Error reading stats:</b> ' + e.message);
    }

    devPanel.innerHTML = info.join(' &nbsp;|&nbsp; ');
  }

  // Update dev panel on DOM changes (scene transitions)
  var devObserver = new MutationObserver(function() {
    if (devActive) updateDevPanel();
  });
  devObserver.observe(document.getElementById('text') || document.body, {
    childList: true, subtree: true
  });

  // â”€â”€â”€ localStorage availability check â”€â”€â”€
  try {
    localStorage.setItem('_kingsrun_test', '1');
    localStorage.removeItem('_kingsrun_test');
  } catch(e) {
    // localStorage unavailable â€” show warning after game loads
    setTimeout(function() {
      var warning = document.createElement('div');
      warning.style.cssText = 'background:#fff3cd;color:#856404;border:1px solid #ffc107;padding:0.75em 1em;margin:0.5em 0;border-radius:4px;font-size:0.85em;';
      warning.innerHTML = '<b>Note:</b> Your browser cannot save progress (private/incognito mode or storage disabled). ' +
        'Your game will not be saved if you close or refresh. Use the checkpoint code at the end to preserve your progress.';
      var header = document.getElementById('header');
      if (header) header.parentNode.insertBefore(warning, header.nextSibling);
    }, 2000);
  }

})();
</script>
</body>
</html>
